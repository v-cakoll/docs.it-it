---
title: Eccezioni in thread gestiti
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- unhandled exceptions,in managed threads
- threading [.NET Framework],unhandled exceptions
- threading [.NET Framework],exceptions in managed threads
- managed threading
ms.assetid: 11294769-2e89-43cb-890e-ad4ad79cfbee
ms.openlocfilehash: 6c14c60b30f8f70aa5e888ed45d6f867154e18d8
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "78159650"
---
# <a name="exceptions-in-managed-threads"></a><span data-ttu-id="bff53-102">Eccezioni in thread gestiti</span><span class="sxs-lookup"><span data-stu-id="bff53-102">Exceptions in Managed Threads</span></span>
<span data-ttu-id="bff53-103">A partire da .NET Framework versione 2.0, Common Language Runtime consente alla maggior parte delle eccezioni non gestite nei thread di proseguire normalmente.</span><span class="sxs-lookup"><span data-stu-id="bff53-103">Starting with the .NET Framework version 2.0, the common language runtime allows most unhandled exceptions in threads to proceed naturally.</span></span> <span data-ttu-id="bff53-104">Nella maggior parte dei casi questo significa che l'eccezione non gestita provoca l'interruzione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bff53-104">In most cases this means that the unhandled exception causes the application to terminate.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="bff53-105">Si tratta di una cambiamento significativo rispetto alle versioni 1.0 e 1.1 di .NET Framework, che forniscono una barriera per numerose eccezioni non gestite, ad esempio, eccezioni non gestite nel pool di thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-105">This is a significant change from the .NET Framework versions 1.0 and 1.1, which provide a backstop for many unhandled exceptions — for example, unhandled exceptions in thread pool threads.</span></span> <span data-ttu-id="bff53-106">Vedere [Cambiamenti rispetto alle versioni precedenti](#ChangeFromPreviousVersions) più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="bff53-106">See [Change from Previous Versions](#ChangeFromPreviousVersions) later in this topic.</span></span>  
  
 <span data-ttu-id="bff53-107">Common Language Runtime fornisce una barriera per determinate eccezioni non gestite usate per controllare il flusso del programma:</span><span class="sxs-lookup"><span data-stu-id="bff53-107">The common language runtime provides a backstop for certain unhandled exceptions that are used for controlling program flow:</span></span>  
  
- <span data-ttu-id="bff53-108">Viene generata un'eccezione <xref:System.Threading.ThreadAbortException> in un thread perché è stato chiamato il metodo <xref:System.Threading.Thread.Abort%2A>.</span><span class="sxs-lookup"><span data-stu-id="bff53-108">A <xref:System.Threading.ThreadAbortException> is thrown in a thread because <xref:System.Threading.Thread.Abort%2A> was called.</span></span>  
  
- <span data-ttu-id="bff53-109">Viene generata un'eccezione <xref:System.AppDomainUnloadedException> in un thread perché è in corso lo scaricamento del dominio dell'applicazione in cui è in esecuzione il thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-109">An <xref:System.AppDomainUnloadedException> is thrown in a thread because the application domain in which the thread is executing is being unloaded.</span></span>  
  
- <span data-ttu-id="bff53-110">Common Language Runtime o un processo host termina il thread generando un'eccezione interna.</span><span class="sxs-lookup"><span data-stu-id="bff53-110">The common language runtime or a host process terminates the thread by throwing an internal exception.</span></span>  
  
 <span data-ttu-id="bff53-111">Se una qualsiasi di queste eccezioni viene gestita nei thread creati da Common Language Runtime, l'eccezione termina il thread, ma Common Language Runtime non consente all'eccezione di proseguire.</span><span class="sxs-lookup"><span data-stu-id="bff53-111">If any of these exceptions are unhandled in threads created by the common language runtime, the exception terminates the thread, but the common language runtime does not allow the exception to proceed further.</span></span>  
  
 <span data-ttu-id="bff53-112">Se queste eccezioni vengono gestite nel thread principale o in thread immessi nel runtime dal codice non gestito, esse proseguono normalmente con una conseguente chiusura dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bff53-112">If these exceptions are unhandled in the main thread, or in threads that entered the runtime from unmanaged code, they proceed normally, resulting in termination of the application.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="bff53-113">È possibile che il runtime generi un'eccezione non gestita prima che qualsiasi codice gestito abbia avuto la possibilità di installare un gestore di eccezioni.</span><span class="sxs-lookup"><span data-stu-id="bff53-113">It is possible for the runtime to throw an unhandled exception before any managed code has had a chance to install an exception handler.</span></span> <span data-ttu-id="bff53-114">Anche se il codice gestito non può gestire tale eccezione, all'eccezione è consentito proseguire normalmente.</span><span class="sxs-lookup"><span data-stu-id="bff53-114">Even though managed code had no chance to handle such an exception, the exception is allowed to proceed naturally.</span></span>  
  
## <a name="exposing-threading-problems-during-development"></a><span data-ttu-id="bff53-115">Esposizione di problemi di threading durante lo sviluppo</span><span class="sxs-lookup"><span data-stu-id="bff53-115">Exposing Threading Problems During Development</span></span>  
 <span data-ttu-id="bff53-116">Quando nei thread si verifica un errore in modo silenzioso ma l'applicazione non viene terminata, è possibile che vengano rilevati gravi problemi di programmazione.</span><span class="sxs-lookup"><span data-stu-id="bff53-116">When threads are allowed to fail silently, without terminating the application, serious programming problems can go undetected.</span></span> <span data-ttu-id="bff53-117">Si tratta di un problema specifico dei servizi e delle altre applicazioni eseguite per periodi prolungati.</span><span class="sxs-lookup"><span data-stu-id="bff53-117">This is a particular problem for services and other applications which run for extended periods.</span></span> <span data-ttu-id="bff53-118">In caso di errore dei thread, il programma viene gradualmente danneggiato.</span><span class="sxs-lookup"><span data-stu-id="bff53-118">As threads fail, program state gradually becomes corrupted.</span></span> <span data-ttu-id="bff53-119">L'errore può influire negativamente sulle prestazioni dell'applicazione o l'applicazione potrebbe bloccarsi.</span><span class="sxs-lookup"><span data-stu-id="bff53-119">Application performance may degrade, or the application might become unresponsive.</span></span>  
  
 <span data-ttu-id="bff53-120">Consentire alle eccezioni non gestite nei thread di proseguire normalmente finché il sistema operativo non termina il programma permette di esporre tali problemi durante le fasi di sviluppo e test.</span><span class="sxs-lookup"><span data-stu-id="bff53-120">Allowing unhandled exceptions in threads to proceed naturally, until the operating system terminates the program, exposes such problems during development and testing.</span></span> <span data-ttu-id="bff53-121">I report di errore relativi alle chiusure dei programmi supportano il debug.</span><span class="sxs-lookup"><span data-stu-id="bff53-121">Error reports on program terminations support debugging.</span></span>  
  
<a name="ChangeFromPreviousVersions"></a>
## <a name="change-from-previous-versions"></a><span data-ttu-id="bff53-122">Cambiamenti dalle versioni precedenti</span><span class="sxs-lookup"><span data-stu-id="bff53-122">Change from Previous Versions</span></span>  
 <span data-ttu-id="bff53-123">Il cambiamento più significativo riguarda i thread gestiti.</span><span class="sxs-lookup"><span data-stu-id="bff53-123">The most significant change pertains to managed threads.</span></span> <span data-ttu-id="bff53-124">In .NET Framework versioni 1.0 e 1.1, Common Language Runtime fornisce una barriera per le eccezioni non gestite nelle situazioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="bff53-124">In the .NET Framework versions 1.0 and 1.1, the common language runtime provides a backstop for unhandled exceptions in the following situations:</span></span>  
  
- <span data-ttu-id="bff53-125">Non esiste alcun equivalente di un'eccezione non gestita in un pool di thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-125">There is no such thing as an unhandled exception on a thread pool thread.</span></span> <span data-ttu-id="bff53-126">Quando un'attività genera un'eccezione non gestibile, il runtime consente di stampare la traccia dello stack eccezione nella console e quindi restituisce il thread al pool di thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-126">When a task throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then returns the thread to the thread pool.</span></span>  
  
- <span data-ttu-id="bff53-127">Non esiste alcun equivalente di un'eccezione non gestita in un thread creato con il metodo <xref:System.Threading.Thread.Start%2A> della classe <xref:System.Threading.Thread>.</span><span class="sxs-lookup"><span data-stu-id="bff53-127">There is no such thing as an unhandled exception on a thread created with the <xref:System.Threading.Thread.Start%2A> method of the <xref:System.Threading.Thread> class.</span></span> <span data-ttu-id="bff53-128">Quando un codice in esecuzione su un thread simile genera un'eccezione non gestibile, il runtime consente di stampare la traccia dello stack eccezione nella console e quindi termina normalmente il thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-128">When code running on such a thread throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then gracefully terminates the thread.</span></span>  
  
- <span data-ttu-id="bff53-129">Non esiste alcun equivalente di un'eccezione non gestita nel thread finalizzatore.</span><span class="sxs-lookup"><span data-stu-id="bff53-129">There is no such thing as an unhandled exception on the finalizer thread.</span></span> <span data-ttu-id="bff53-130">Se un finalizzatore genera un'eccezione non gestibile, il runtime consente di stampare la traccia dello stack eccezione nella console e consente quindi al thread finalizzatore di riprendere l'esecuzione dei finalizzatori.</span><span class="sxs-lookup"><span data-stu-id="bff53-130">When a finalizer throws an exception that it does not handle, the runtime prints the exception stack trace to the console and then allows the finalizer thread to resume running finalizers.</span></span>  
  
 <span data-ttu-id="bff53-131">Lo stato in primo piano o in background di un thread gestito non influisce su tale comportamento.</span><span class="sxs-lookup"><span data-stu-id="bff53-131">The foreground or background status of a managed thread does not affect this behavior.</span></span>  
  
 <span data-ttu-id="bff53-132">Per le eccezioni non gestite nei thread di origine nel codice non gestito, la differenza è più complessa.</span><span class="sxs-lookup"><span data-stu-id="bff53-132">For unhandled exceptions on threads originating in unmanaged code, the difference is more subtle.</span></span> <span data-ttu-id="bff53-133">La finestra di dialogo dell'associazione JIT del runtime ha la precedenza sulla finestra di dialogo del sistema operativo per le eccezioni gestite o native nei thread passati attraverso il codice nativo.</span><span class="sxs-lookup"><span data-stu-id="bff53-133">The runtime JIT-attach dialog preempts the operating system dialog for managed exceptions or native exceptions on threads that have passed through native code.</span></span> <span data-ttu-id="bff53-134">Il processo viene terminato in tutti i casi.</span><span class="sxs-lookup"><span data-stu-id="bff53-134">The process terminates in all cases.</span></span>  
  
### <a name="migrating-code"></a><span data-ttu-id="bff53-135">Migrazione del codice</span><span class="sxs-lookup"><span data-stu-id="bff53-135">Migrating Code</span></span>  
 <span data-ttu-id="bff53-136">In generale, il cambiamento metterà in evidenza i problemi di programmazione in precedenza non riconosciuti in modo che possano essere risolti.</span><span class="sxs-lookup"><span data-stu-id="bff53-136">In general, the change will expose previously unrecognized programming problems so that they can be fixed.</span></span> <span data-ttu-id="bff53-137">In alcuni casi, tuttavia, i programmatori potrebbero aver sfruttato la barriera di runtime, ad esempio per interrompere i thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-137">In some cases, however, programmers might have taken advantage of the runtime backstop, for example to terminate threads.</span></span> <span data-ttu-id="bff53-138">A seconda della situazione, è necessario considerare una delle seguenti strategie di migrazione:</span><span class="sxs-lookup"><span data-stu-id="bff53-138">Depending on the situation, they should consider one of the following migration strategies:</span></span>  
  
- <span data-ttu-id="bff53-139">Ristrutturare il codice in modo che il thread venga chiuso normalmente quando viene ricevuto un segnale.</span><span class="sxs-lookup"><span data-stu-id="bff53-139">Restructure the code so the thread exits gracefully when a signal is received.</span></span>  
  
- <span data-ttu-id="bff53-140">Usare il metodo <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> per interrompere il thread.</span><span class="sxs-lookup"><span data-stu-id="bff53-140">Use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method to abort the thread.</span></span>  
  
- <span data-ttu-id="bff53-141">Se un thread deve essere arrestato in modo che la terminazione del processo possa continuare, spostare il thread in background in modo che venga terminato automaticamente all'uscita dal processo.</span><span class="sxs-lookup"><span data-stu-id="bff53-141">If a thread must be stopped so that process termination can proceed, make the thread a background thread so that it is automatically terminated on process exit.</span></span>  
  
 <span data-ttu-id="bff53-142">In tutti i casi, la strategia deve rispettare le linee guida di progettazione per le eccezioni.</span><span class="sxs-lookup"><span data-stu-id="bff53-142">In all cases, the strategy should follow the design guidelines for exceptions.</span></span> <span data-ttu-id="bff53-143">Vedere [Linee guida di progettazione delle eccezioni](../../../docs/standard/design-guidelines/exceptions.md).</span><span class="sxs-lookup"><span data-stu-id="bff53-143">See [Design Guidelines for Exceptions](../../../docs/standard/design-guidelines/exceptions.md).</span></span>  
  
### <a name="application-compatibility-flag"></a><span data-ttu-id="bff53-144">Contrassegno della compatibilità delle applicazioni</span><span class="sxs-lookup"><span data-stu-id="bff53-144">Application Compatibility Flag</span></span>  
 <span data-ttu-id="bff53-145">Come misura di compatibilità temporanea, gli amministratori possono inserire un contrassegno di compatibilità nella sezione `<runtime>` del file di configurazione dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="bff53-145">As a temporary compatibility measure, administrators can place a compatibility flag in the `<runtime>` section of the application configuration file.</span></span> <span data-ttu-id="bff53-146">In questo modo Common Language Runtime può ripristinare il comportamento delle versioni 1.0 e 1.1.</span><span class="sxs-lookup"><span data-stu-id="bff53-146">This causes the common language runtime to revert to the behavior of versions 1.0 and 1.1.</span></span>  
  
```xml  
<legacyUnhandledExceptionPolicy enabled="1"/>  
```  
  
## <a name="host-override"></a><span data-ttu-id="bff53-147">Override dell'host</span><span class="sxs-lookup"><span data-stu-id="bff53-147">Host Override</span></span>  
 <span data-ttu-id="bff53-148">In .NET Framework versione 2.0 un host non gestito può sfruttare l'interfaccia [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) nell'API di hosting per eseguire l'override del criterio predefinito dell'eccezione non gestita di Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="bff53-148">In the .NET Framework version 2.0, an unmanaged host can use the [ICLRPolicyManager](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-interface.md) interface in the Hosting API to override the default unhandled exception policy of the common language runtime.</span></span> <span data-ttu-id="bff53-149">La funzione [ICLRPolicyManager:: SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) viene usata per impostare il criterio per le eccezioni non gestite.</span><span class="sxs-lookup"><span data-stu-id="bff53-149">The [ICLRPolicyManager::SetUnhandledExceptionPolicy](../../../docs/framework/unmanaged-api/hosting/iclrpolicymanager-setunhandledexceptionpolicy-method.md) function is used to set the policy for unhandled exceptions.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="bff53-150">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="bff53-150">See also</span></span>

- [<span data-ttu-id="bff53-151">Nozioni di base sul threading gestito</span><span class="sxs-lookup"><span data-stu-id="bff53-151">Managed Threading Basics</span></span>](../../../docs/standard/threading/managed-threading-basics.md)
