---
title: Procedure consigliate per un modello di progettazione observer
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- observer design pattern [.NET Framework], best practices
- best practices [.NET Framework], observer design pattern
ms.assetid: c834760f-ddd4-417f-abb7-a059679d5b8c
ms.openlocfilehash: 2da29e0baf429142707d0ddd39b1a11c13a17a90
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "73141534"
---
# <a name="observer-design-pattern-best-practices"></a><span data-ttu-id="805b9-102">Procedure consigliate per un modello di progettazione observer</span><span class="sxs-lookup"><span data-stu-id="805b9-102">Observer Design Pattern Best Practices</span></span>
<span data-ttu-id="805b9-103">In.NET Framework, il modello di progettazione osservatore è implementato come un insieme di interfacce.</span><span class="sxs-lookup"><span data-stu-id="805b9-103">In the .NET Framework, the observer design pattern is implemented as a set of interfaces.</span></span> <span data-ttu-id="805b9-104">L'interfaccia <xref:System.IObservable%601?displayProperty=nameWithType> rappresenta il provider di dati, che è anche responsabile di fornire un'implementazione di <xref:System.IDisposable> che consenta agli osservatori di annullare la sottoscrizione di notifiche.</span><span class="sxs-lookup"><span data-stu-id="805b9-104">The <xref:System.IObservable%601?displayProperty=nameWithType> interface represents the data provider, which is also responsible for providing an <xref:System.IDisposable> implementation that lets observers unsubscribe from notifications.</span></span> <span data-ttu-id="805b9-105">L'interfaccia <xref:System.IObserver%601?displayProperty=nameWithType> rappresenta l'osservatore.</span><span class="sxs-lookup"><span data-stu-id="805b9-105">The <xref:System.IObserver%601?displayProperty=nameWithType> interface represents the observer.</span></span> <span data-ttu-id="805b9-106">In questo argomento vengono descritte le procedure consigliate che gli sviluppatori devono seguire per implementare il modello di progettazione osservatore usando queste interfacce.</span><span class="sxs-lookup"><span data-stu-id="805b9-106">This topic describes the best practices that developers should follow when implementing the observer design pattern using these interfaces.</span></span>  
  
## <a name="threading"></a><span data-ttu-id="805b9-107">Threading</span><span class="sxs-lookup"><span data-stu-id="805b9-107">Threading</span></span>  
 <span data-ttu-id="805b9-108">In genere, un provider implementa il metodo <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> aggiungendo un osservatore specifico a un elenco di server di sottoscrizione, che è rappresentato da un oggetto di raccolta, e implementa il metodo <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> rimuovendo un osservatore specifico dall'elenco dei server di sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="805b9-108">Typically, a provider implements the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method by adding a particular observer to a subscriber list that is represented by some collection object, and it implements the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> method by removing a particular observer from the subscriber list.</span></span> <span data-ttu-id="805b9-109">Un osservatore può chiamare questi metodi in qualsiasi momento.</span><span class="sxs-lookup"><span data-stu-id="805b9-109">An observer can call these methods at any time.</span></span> <span data-ttu-id="805b9-110">Inoltre, perché il contratto provider/osservatore non specifica chi è responsabile dell'annullamento della sottoscrizione dopo il metodo di callback <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, il provider e l'osservatore possono provare a rimuovere lo stesso membro dall'elenco.</span><span class="sxs-lookup"><span data-stu-id="805b9-110">In addition, because the provider/observer contract does not specify who is responsible for unsubscribing after the <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> callback method, the provider and observer may both try to remove the same member from the list.</span></span> <span data-ttu-id="805b9-111">Grazie a questa possibilità, entrambi i metodi <xref:System.IObservable%601.Subscribe%2A> e <xref:System.IDisposable.Dispose%2A> dovrebbero essere thread-safe.</span><span class="sxs-lookup"><span data-stu-id="805b9-111">Because of this possibility, both the <xref:System.IObservable%601.Subscribe%2A> and <xref:System.IDisposable.Dispose%2A> methods should be thread-safe.</span></span> <span data-ttu-id="805b9-112">In genere, ciò comporta l'uso di una [raccolta simultanea](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) o di un blocco.</span><span class="sxs-lookup"><span data-stu-id="805b9-112">Typically, this involves using a [concurrent collection](../../../docs/standard/parallel-programming/data-structures-for-parallel-programming.md) or a lock.</span></span> <span data-ttu-id="805b9-113">Le implementazioni che non sono thread-safe devono documentare esplicitamente che non lo sono.</span><span class="sxs-lookup"><span data-stu-id="805b9-113">Implementations that are not thread-safe should explicitly document that they are not.</span></span>  
  
 <span data-ttu-id="805b9-114">Tutte le garanzie aggiuntive devono essere specificate in un livello all'inizio del contratto provider/osservatore.</span><span class="sxs-lookup"><span data-stu-id="805b9-114">Any additional guarantees have to be specified in a layer on top of the provider/observer contract.</span></span> <span data-ttu-id="805b9-115">Gli implementatori devono indicare chiaramente quando impongono requisiti aggiuntivi per evitare confusione sul contratto di osservatore.</span><span class="sxs-lookup"><span data-stu-id="805b9-115">Implementers should clearly call out when they impose additional requirements to avoid user confusion about the observer contract.</span></span>  
  
## <a name="handling-exceptions"></a><span data-ttu-id="805b9-116">Gestione delle eccezioni</span><span class="sxs-lookup"><span data-stu-id="805b9-116">Handling Exceptions</span></span>  
 <span data-ttu-id="805b9-117">A causa dell'accoppiamento debole tra un provider di dati e un osservatore, le eccezioni nel modello di progettazione osservatore sono esclusivamente informative.</span><span class="sxs-lookup"><span data-stu-id="805b9-117">Because of the loose coupling between a data provider and an observer, exceptions in the observer design pattern are intended to be informational.</span></span> <span data-ttu-id="805b9-118">Ciò influisce sul modo in cui provider e osservatori gestiscono le eccezioni nel modello di progettazione osservatore.</span><span class="sxs-lookup"><span data-stu-id="805b9-118">This affects how providers and observers handle exceptions in the observer design pattern.</span></span>  
  
### <a name="the-provider----calling-the-onerror-method"></a><span data-ttu-id="805b9-119">Provider: Chiamata al metodo OnError</span><span class="sxs-lookup"><span data-stu-id="805b9-119">The Provider -- Calling the OnError Method</span></span>  
 <span data-ttu-id="805b9-120">Il metodo <xref:System.IObserver%601.OnError%2A> è concepito come un messaggio informativo agli osservatori, in modo analogo al metodo <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="805b9-120">The <xref:System.IObserver%601.OnError%2A> method is intended as an informational message to observers, much like the <xref:System.IObserver%601.OnNext%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="805b9-121">Tuttavia, il metodo <xref:System.IObserver%601.OnNext%2A> è progettato al fine di fornire a un osservare dati correnti o aggiornati, laddove il metodo <xref:System.IObserver%601.OnError%2A> è progettato per indicare che il provider non può fornire dati validi.</span><span class="sxs-lookup"><span data-stu-id="805b9-121">However, the <xref:System.IObserver%601.OnNext%2A> method is designed to provide an observer with current or updated data, whereas the <xref:System.IObserver%601.OnError%2A> method is designed to indicate that the provider is unable to provide valid data.</span></span>  
  
 <span data-ttu-id="805b9-122">Il provider dovrebbe seguire queste procedure consigliate durante la gestione delle eccezioni e la chiamata del metodo <xref:System.IObserver%601.OnError%2A>:</span><span class="sxs-lookup"><span data-stu-id="805b9-122">The provider should follow these best practices when handling exceptions and calling the <xref:System.IObserver%601.OnError%2A> method:</span></span>  
  
- <span data-ttu-id="805b9-123">Il provider deve gestire le proprie eccezioni in caso di requisiti specifici.</span><span class="sxs-lookup"><span data-stu-id="805b9-123">The provider must handle its own exceptions if it has any specific requirements.</span></span>  
  
- <span data-ttu-id="805b9-124">Il provider non dovrebbe aspettarsi o richiedere che gli osservatori gestiscano le eccezioni in alcun modo particolare.</span><span class="sxs-lookup"><span data-stu-id="805b9-124">The provider should not expect or require that observers handle exceptions in any particular way.</span></span>  
  
- <span data-ttu-id="805b9-125">Il provider dovrà chiamare il metodo <xref:System.IObserver%601.OnError%2A> quando gestisce un'eccezione che compromette la sua capacità di fornire aggiornamenti.</span><span class="sxs-lookup"><span data-stu-id="805b9-125">The provider should call the <xref:System.IObserver%601.OnError%2A> method when it handles an exception that compromises its ability to provide updates.</span></span> <span data-ttu-id="805b9-126">Le informazioni su tali eccezioni possono essere passate all'osservatore.</span><span class="sxs-lookup"><span data-stu-id="805b9-126">Information on such exceptions can be passed to the observer.</span></span> <span data-ttu-id="805b9-127">In altri casi, non è necessario notificare un'eccezione agli osservatori.</span><span class="sxs-lookup"><span data-stu-id="805b9-127">In other cases, there is no need to notify observers of an exception.</span></span>  
  
 <span data-ttu-id="805b9-128">Quando il provider chiama il metodo <xref:System.IObserver%601.OnError%2A> o <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>, non vi saranno altre notifiche e il provider potrà annullare la sottoscrizione dei relativi osservatori.</span><span class="sxs-lookup"><span data-stu-id="805b9-128">Once the provider calls the <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> method, there should be no further notifications, and the provider can unsubscribe its observers.</span></span> <span data-ttu-id="805b9-129">Questi ultimi, tuttavia, potranno a loro volta annullare una sottoscrizione in qualsiasi momento, sia prima sia dopo aver ricevuto una notifica <xref:System.IObserver%601.OnError%2A> o <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="805b9-129">However, the observers can also unsubscribe themselves at any time, including both before and after they receive an <xref:System.IObserver%601.OnError%2A> or <xref:System.IObserver%601.OnCompleted%2A?displayProperty=nameWithType> notification.</span></span> <span data-ttu-id="805b9-130">Il modello di progettazione dell'osservatore non indica se il provider o l'osservatore è responsabile dell'annullamento della sottoscrizione. Quindi, è possibile che entrambi provino ad annullare la sottoscrizione.</span><span class="sxs-lookup"><span data-stu-id="805b9-130">The observer design pattern does not dictate whether the provider or the observer is responsible for unsubscribing; therefore, there is a possibility that both may attempt to unsubscribe.</span></span> <span data-ttu-id="805b9-131">In genere, quando gli osservatori annullano l'iscrizione, vengono rimossi da una raccolta di sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="805b9-131">Typically, when observers unsubscribe, they are removed from a subscribers collection.</span></span> <span data-ttu-id="805b9-132">In un'applicazione a thread singolo, l'implementazione di <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> dovrà garantire che un riferimento all'oggetto sia valido e che l'oggetto sia un membro della raccolta di sottoscrittori prima di provare a rimuoverlo.</span><span class="sxs-lookup"><span data-stu-id="805b9-132">In a single-threaded application, the <xref:System.IDisposable.Dispose%2A?displayProperty=nameWithType> implementation should ensure that an object reference is valid and that the object is a member of the subscribers collection before attempting to remove it.</span></span> <span data-ttu-id="805b9-133">In un'applicazione multithreading, è necessario usare un oggetto di raccolta thread-safe, come ad esempio un oggetto <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="805b9-133">In a multithreaded application, a thread-safe collection object, such as a <xref:System.Collections.Concurrent.BlockingCollection%601?displayProperty=nameWithType> object, should be used.</span></span>  
  
### <a name="the-observer----implementing-the-onerror-method"></a><span data-ttu-id="805b9-134">Osservatore: implementazione del metodo OnError</span><span class="sxs-lookup"><span data-stu-id="805b9-134">The Observer -- Implementing the OnError Method</span></span>  
 <span data-ttu-id="805b9-135">Quando un osservatore riceve una notifica di errore da un provider, l'osservatore deve considerare l'eccezione come informativa e non deve eseguire alcuna operazione particolare.</span><span class="sxs-lookup"><span data-stu-id="805b9-135">When an observer receives an error notification from a provider, the observer should treat the exception as informational and should not be required to take any particular action.</span></span>  
  
 <span data-ttu-id="805b9-136">L'osservatore dovrebbe seguire queste procedure consigliate durante la risposta a gestione delle eccezioni e la chiamata al metodo <xref:System.IObserver%601.OnError%2A> da un provider:</span><span class="sxs-lookup"><span data-stu-id="805b9-136">The observer should follow these best practices when responding to an <xref:System.IObserver%601.OnError%2A> method call from a provider:</span></span>  
  
- <span data-ttu-id="805b9-137">L'osservatore non deve generare eccezioni dalle implementazioni dell'interfaccia, come ad esempio <xref:System.IObserver%601.OnNext%2A> o <xref:System.IObserver%601.OnError%2A>.</span><span class="sxs-lookup"><span data-stu-id="805b9-137">The observer should not throw exceptions from its interface implementations, such as <xref:System.IObserver%601.OnNext%2A> or <xref:System.IObserver%601.OnError%2A>.</span></span> <span data-ttu-id="805b9-138">Tuttavia, se l'osservatore genera eccezioni, deve aspettarsi che queste eccezioni rimangano non gestite.</span><span class="sxs-lookup"><span data-stu-id="805b9-138">However, if the observer does throw exceptions, it should expect these exceptions to go unhandled.</span></span>  
  
- <span data-ttu-id="805b9-139">Per preservare lo stack di chiamate, un osservatore che intenda generare un oggetto <xref:System.Exception> che è stato passato al relativo metodo <xref:System.IObserver%601.OnError%2A> dovrà eseguire il wrapping dell'eccezione prima di generarla.</span><span class="sxs-lookup"><span data-stu-id="805b9-139">To preserve the call stack, an observer that wishes to throw an <xref:System.Exception> object that was passed to its <xref:System.IObserver%601.OnError%2A> method should wrap the exception before throwing it.</span></span> <span data-ttu-id="805b9-140">A questo scopo è necessario usare un oggetto eccezione standard.</span><span class="sxs-lookup"><span data-stu-id="805b9-140">A standard exception object should be used for this purpose.</span></span>  
  
## <a name="additional-best-practices"></a><span data-ttu-id="805b9-141">Procedure consigliate aggiuntive</span><span class="sxs-lookup"><span data-stu-id="805b9-141">Additional Best Practices</span></span>  
 <span data-ttu-id="805b9-142">Un tentativo di annullamento della registrazione nel metodo <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> può produrre un riferimento null.</span><span class="sxs-lookup"><span data-stu-id="805b9-142">Attempting to unregister in the <xref:System.IObservable%601.Subscribe%2A?displayProperty=nameWithType> method may result in a null reference.</span></span> <span data-ttu-id="805b9-143">È quindi consigliabile evitare questa operazione.</span><span class="sxs-lookup"><span data-stu-id="805b9-143">Therefore, we recommend that you avoid this practice.</span></span>  
  
 <span data-ttu-id="805b9-144">Nonostante sia possibile associare un osservatore a più provider, il modello consigliato consiste nell'associare un'istanza di <xref:System.IObserver%601> a una sola istanza di <xref:System.IObservable%601>.</span><span class="sxs-lookup"><span data-stu-id="805b9-144">Although it is possible to attach an observer to multiple providers, the recommended pattern is to attach an <xref:System.IObserver%601> instance to only one <xref:System.IObservable%601> instance.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="805b9-145">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="805b9-145">See also</span></span>

- [<span data-ttu-id="805b9-146">Modello di progettazione observer</span><span class="sxs-lookup"><span data-stu-id="805b9-146">Observer Design Pattern</span></span>](../../../docs/standard/events/observer-design-pattern.md)
- [<span data-ttu-id="805b9-147">Procedura: Implementare un elemento Observer</span><span class="sxs-lookup"><span data-stu-id="805b9-147">How to: Implement an Observer</span></span>](../../../docs/standard/events/how-to-implement-an-observer.md)
- [<span data-ttu-id="805b9-148">Procedura: Implementare un provider</span><span class="sxs-lookup"><span data-stu-id="805b9-148">How to: Implement a Provider</span></span>](../../../docs/standard/events/how-to-implement-a-provider.md)
