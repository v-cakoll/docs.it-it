---
title: Runtime Callable Wrapper
ms.date: 03/30/2017
helpviewer_keywords:
- COM interop, COM wrappers
- RCW
- COM wrappers
- runtime callable wrappers
- interoperation with unmanaged code, COM wrappers
ms.assetid: 7e542583-1e31-4e10-b523-8cf2f29cb4a4
ms.openlocfilehash: 0b448379fba965060fdf3bf067e65374f40d1fc2
ms.sourcegitcommit: 00aa62e2f469c2272a457b04e66b4cc3c97a800b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 02/28/2020
ms.locfileid: "78156010"
---
# <a name="runtime-callable-wrapper"></a><span data-ttu-id="4ffaa-102">Runtime Callable Wrapper</span><span class="sxs-lookup"><span data-stu-id="4ffaa-102">Runtime Callable Wrapper</span></span>
<span data-ttu-id="4ffaa-103">Common Language Runtime espone gli oggetti COM tramite un proxy denominato Runtime Callable Wrapper (RCW).</span><span class="sxs-lookup"><span data-stu-id="4ffaa-103">The common language runtime exposes COM objects through a proxy called the runtime callable wrapper (RCW).</span></span> <span data-ttu-id="4ffaa-104">Benché l'RCW appaia ai client .NET come un normale oggetto, la sua funzione principale consiste nell'effettuare il marshalling tra un client .NET e un oggetto COM.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-104">Although the RCW appears to be an ordinary object to .NET clients, its primary function is to marshal calls between a .NET client and a COM object.</span></span>  
  
 <span data-ttu-id="4ffaa-105">Il runtime crea esattamente un RCW per ciascun oggetto COM, indipendentemente dal numero di riferimenti all'oggetto.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-105">The runtime creates exactly one RCW for each COM object, regardless of the number of references that exist on that object.</span></span> <span data-ttu-id="4ffaa-106">Il runtime mantiene un solo RCW a processo per ciascun oggetto.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-106">The runtime maintains a single RCW per process for each object.</span></span>  <span data-ttu-id="4ffaa-107">Se si crea un RCW in un apartment o dominio applicazione e si passa quindi un riferimento a un altro apartment o dominio applicazione, verrà usato un proxy al primo oggetto.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-107">If you create an RCW in one application domain or apartment, and then pass a reference to another application domain or apartment, a proxy to the first object will be used.</span></span>  <span data-ttu-id="4ffaa-108">Come illustrato nella figura che segue, un numero qualsiasi di client gestiti può stabilire un riferimento agli oggetti COM che espongono le interfacce INew e INewer.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-108">As the following illustration shows, any number of managed clients can hold a reference to the COM objects that expose INew and INewer interfaces.</span></span>  

<span data-ttu-id="4ffaa-109">La figura seguente illustra il processo per accedere a oggetti COM tramite Runtime Callable Wrapper:</span><span class="sxs-lookup"><span data-stu-id="4ffaa-109">The following image shows the process for accessing COM objects through the runtime callable wrapper:</span></span>

 ![Processo per accedere a oggetti COM tramite RCW.](./media/runtime-callable-wrapper/runtime-callable-wrapper.gif)  

 <span data-ttu-id="4ffaa-111">Usando i metadati derivati da una libreria dei tipi, il runtime crea sia l'oggetto COM che si sta chiamando che il relativo wrapper.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-111">Using metadata derived from a type library, the runtime creates both the COM object being called and a wrapper for that object.</span></span> <span data-ttu-id="4ffaa-112">Ogni RCW mantiene una cache dei puntatori a interfaccia impostati sull'oggetto COM di cui effettua il wrapping e rilascia i riferimenti all'oggetto COM quando l'RCW non è più necessario.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-112">Each RCW maintains a cache of interface pointers on the COM object it wraps and releases its reference on the COM object when the RCW is no longer needed.</span></span> <span data-ttu-id="4ffaa-113">Il runtime esegue la procedura di Garbage Collection sull'RCW.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-113">The runtime performs garbage collection on the RCW.</span></span>  
  
 <span data-ttu-id="4ffaa-114">Tra le altre attività, l'RCW effettua il marshalling dei dati trasferiti tra il codice gestito e quello non gestito, per conto dell'oggetto di cui effettua il wrapping.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-114">Among other activities, the RCW marshals data between managed and unmanaged code, on behalf of the wrapped object.</span></span> <span data-ttu-id="4ffaa-115">In particolare, l'RCW effettua il marshalling degli argomenti e dei valori restituiti dei metodi ogni volta che il client e il server adottano rappresentazioni diverse dei dati scambiati.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-115">Specifically, the RCW provides marshaling for method arguments and method return values whenever the client and server have different representations of the data passed between them.</span></span>  
  
 <span data-ttu-id="4ffaa-116">Il wrapper standard applica le regole di marshalling incorporate.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-116">The standard wrapper enforces built-in marshaling rules.</span></span> <span data-ttu-id="4ffaa-117">Quando ad esempio un client .NET passa come parte di un argomento un tipo String a un oggetto gestito, il wrapper converte la stringa in un tipo BSTR.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-117">For example, when a .NET client passes a String type as part of an argument to an unmanaged object, the wrapper converts the string to a BSTR type.</span></span> <span data-ttu-id="4ffaa-118">Nel caso in cui l'oggetto COM dovesse restituire un valore di tipo BSTR, il relativo chiamante gestito riceverebbe una stringa.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-118">Should the COM object return a BSTR to its managed caller, the caller receives a String.</span></span> <span data-ttu-id="4ffaa-119">Sia il client che il server inviano e ricevono dati rispettivamente noti.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-119">Both the client and the server send and receive data that is familiar to them.</span></span> <span data-ttu-id="4ffaa-120">Gli altri tipi non richiedono alcuna conversione.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-120">Other types require no conversion.</span></span> <span data-ttu-id="4ffaa-121">Un wrapper standard, ad esempio, trasferirà sempre un intero di 4 byte tra il codice gestito e quello non gestito senza operare alcuna conversione di tipo.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-121">For instance, a standard wrapper will always pass a 4-byte integer between managed and unmanaged code without converting the type.</span></span>  
  
## <a name="marshaling-selected-interfaces"></a><span data-ttu-id="4ffaa-122">Interfacce sottoposte a marshalling</span><span class="sxs-lookup"><span data-stu-id="4ffaa-122">Marshaling selected interfaces</span></span>  
 <span data-ttu-id="4ffaa-123">L'obiettivo principale di un oggetto [Runtime Callable Wrapper](runtime-callable-wrapper.md) (RCW) è quello di nascondere le differenze tra i modelli di programmazione gestiti e non gestiti.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-123">The primary goal of the [runtime callable wrapper](runtime-callable-wrapper.md) (RCW) is to hide the differences between the managed and unmanaged programming models.</span></span> <span data-ttu-id="4ffaa-124">Per semplificare la transizione, l'RCW usa interfacce COM selezionate senza esporle al client .NET, come illustrato nella figura che segue.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-124">To create a seamless transition, the RCW consumes selected COM interfaces without exposing them to the .NET client, as shown in the following illustration.</span></span>

 <span data-ttu-id="4ffaa-125">L'immagine seguente illustra le interfacce COM e Runtime Callable Wrapper:</span><span class="sxs-lookup"><span data-stu-id="4ffaa-125">The following image shows COM interfaces and the runtime callable wrapper:</span></span>
  
 ![Screenshot di Runtime Callable Wrapper con interfacce.](./media/runtime-callable-wrapper/runtime-callable-wrapper-interfaces.gif)  
  
 <span data-ttu-id="4ffaa-127">Quando viene creato come oggetto ad associazione anticipata, l'RCW è specifico del tipo.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-127">When created as an early-bound object, the RCW is a specific type.</span></span> <span data-ttu-id="4ffaa-128">Esso implementa le interfacce implementate dall'oggetto COM ed espone i metodi, le proprietà e gli eventi delle interfacce dell'oggetto.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-128">It implements the interfaces that the COM object implements and exposes the methods, properties, and events from the object's interfaces.</span></span> <span data-ttu-id="4ffaa-129">Nella figura l'oggetto RCW espone l'interfaccia INew, ma utilizza le interfacce **IUnknown** e **IDispatch**.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-129">In the illustration, the RCW exposes the INew interface but consumes the **IUnknown** and **IDispatch** interfaces.</span></span> <span data-ttu-id="4ffaa-130">L'RCW espone inoltre al client .NET tutti i membri dell'interfaccia INew.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-130">Further, the RCW exposes all members of the INew interface to the .NET client.</span></span>  
  
 <span data-ttu-id="4ffaa-131">L'RCW usa le interfacce elencate nella tabella che segue, che sono esposte dall'oggetto di cui effettua il wrapping.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-131">The RCW consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="4ffaa-132">Interfaccia</span><span class="sxs-lookup"><span data-stu-id="4ffaa-132">Interface</span></span>|<span data-ttu-id="4ffaa-133">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4ffaa-133">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="4ffaa-134">**IDispatch**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-134">**IDispatch**</span></span>|<span data-ttu-id="4ffaa-135">Per l'associazione tardiva a oggetti COM tramite reflection.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-135">For late binding to COM objects through reflection.</span></span>|  
|<span data-ttu-id="4ffaa-136">**IErrorInfo**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-136">**IErrorInfo**</span></span>|<span data-ttu-id="4ffaa-137">Fornisce una descrizione testuale dell'errore, la relativa origine, un file della Guida, un contesto della Guida e il GUID dell'interfaccia che ha definito l'errore (sempre **GUID_NULL** per le classi .NET).</span><span class="sxs-lookup"><span data-stu-id="4ffaa-137">Provides a textual description of the error, its source, a Help file, Help context, and the GUID of the interface that defined the error (always **GUID_NULL** for .NET classes).</span></span>|  
|<span data-ttu-id="4ffaa-138">**IProvideClassInfo**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-138">**IProvideClassInfo**</span></span>|<span data-ttu-id="4ffaa-139">Se l'oggetto COM di cui si esegue il wrapping implementa **IProvideClassInfo**, l'oggetto RCW estrarrà le informazioni sul tipo da questa interfaccia per definire meglio l'identità del tipo.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-139">If the COM object being wrapped implements **IProvideClassInfo**, the RCW extracts the type information from this interface to provide better type identity.</span></span>|  
|<span data-ttu-id="4ffaa-140">**IUnknown**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-140">**IUnknown**</span></span>|<span data-ttu-id="4ffaa-141">Per l'identità del tipo, la coercizione dei tipi e la gestione della durata:</span><span class="sxs-lookup"><span data-stu-id="4ffaa-141">For object identity, type coercion, and lifetime management:</span></span><br /><br /> <span data-ttu-id="4ffaa-142">- Identità degli oggetti</span><span class="sxs-lookup"><span data-stu-id="4ffaa-142">-   Object identity</span></span><br />     <span data-ttu-id="4ffaa-143">Il runtime distingue tra gli oggetti COM confrontando il valore dell'interfaccia **IUnknown** di ciascun oggetto.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-143">The runtime distinguishes between COM objects by comparing the value of the **IUnknown** interface for each object.</span></span><br /><span data-ttu-id="4ffaa-144">- Coercizione dei tipi</span><span class="sxs-lookup"><span data-stu-id="4ffaa-144">-   Type coercion</span></span><br />     <span data-ttu-id="4ffaa-145">L'oggetto RCW riconosce l'individuazione dei tipi dinamica eseguita dal metodo **QueryInterface**.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-145">The RCW recognizes the dynamic type discovery performed by the **QueryInterface** method.</span></span><br /><span data-ttu-id="4ffaa-146">- Gestione del ciclo di vita</span><span class="sxs-lookup"><span data-stu-id="4ffaa-146">-   Lifetime management</span></span><br />     <span data-ttu-id="4ffaa-147">Usando il metodo **QueryInterface**, l'oggetto RCW ottiene e mantiene un riferimento a un oggetto non gestito fino a quando il runtime non esegue una procedura di Garbage Collection sul wrapper, rilasciando l'oggetto non gestito.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-147">Using the **QueryInterface** method, the RCW gets and holds a reference to an unmanaged object until the runtime performs garbage collection on the wrapper, which releases the unmanaged object.</span></span>|  
  
 <span data-ttu-id="4ffaa-148">RCW usa facoltativamente le interfacce elencate nella tabella che segue, che sono esposte dall'oggetto di cui effettua il wrapping.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-148">The RCW optionally consumes the interfaces listed in the following table, which are exposed by the object it wraps.</span></span>  
  
|<span data-ttu-id="4ffaa-149">Interfaccia</span><span class="sxs-lookup"><span data-stu-id="4ffaa-149">Interface</span></span>|<span data-ttu-id="4ffaa-150">Descrizione</span><span class="sxs-lookup"><span data-stu-id="4ffaa-150">Description</span></span>|  
|---------------|-----------------|  
|<span data-ttu-id="4ffaa-151">**IConnectionPoint** e **IConnectionPointContainer**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-151">**IConnectionPoint** and **IConnectionPointContainer**</span></span>|<span data-ttu-id="4ffaa-152">Talvolta l'RCW usa le interfacce elencate nella tabella che segue, che sono esposte dall'oggetto di cui effettua il wrapping.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-152">The RCW converts objects that expose the connection-point event style to delegate-based events.</span></span>|  
|<span data-ttu-id="4ffaa-153">**IDispatchEx** (solo .NET Framework)</span><span class="sxs-lookup"><span data-stu-id="4ffaa-153">**IDispatchEx** (.NET Framework Only)</span></span> |<span data-ttu-id="4ffaa-154">Se la classe implementa **IDispatchEx**, l'oggetto RCW implementa **IExpando**.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-154">If the class implements **IDispatchEx**, the RCW implements **IExpando**.</span></span> <span data-ttu-id="4ffaa-155">L'interfaccia **IDispatchEx** è un'estensione dell'interfaccia **IDispatch** che, diversamente da **IDispatch**, consente l'enumerazione, l'aggiunta, l'eliminazione e la chiamata dei membri con distinzione tra maiuscole e minuscole.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-155">The **IDispatchEx** interface is an extension of the **IDispatch** interface that, unlike **IDispatch**, enables enumeration, addition, deletion, and case-sensitive calling of members.</span></span>|  
|<span data-ttu-id="4ffaa-156">**IEnumVARIANT**</span><span class="sxs-lookup"><span data-stu-id="4ffaa-156">**IEnumVARIANT**</span></span>|<span data-ttu-id="4ffaa-157">Consente di trattare come raccolte i tipi COM che supportano l'enumerazione.</span><span class="sxs-lookup"><span data-stu-id="4ffaa-157">Enables COM types that support enumerations to be treated as collections.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="4ffaa-158">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="4ffaa-158">See also</span></span>

- [<span data-ttu-id="4ffaa-159">Wrapper COM</span><span class="sxs-lookup"><span data-stu-id="4ffaa-159">COM Wrappers</span></span>](com-wrappers.md)
- [<span data-ttu-id="4ffaa-160">COM Callable Wrapper</span><span class="sxs-lookup"><span data-stu-id="4ffaa-160">COM Callable Wrapper</span></span>](com-callable-wrapper.md)
- <span data-ttu-id="4ffaa-161">[Riepilogo della conversione da libreria dei tipi ad assembly](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/k83zzh38(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="4ffaa-161">[Type Library to Assembly Conversion Summary](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/k83zzh38(v=vs.100))</span></span>
- [<span data-ttu-id="4ffaa-162">Importazione di una libreria dei tipi come assembly</span><span class="sxs-lookup"><span data-stu-id="4ffaa-162">Importing a Type Library as an Assembly</span></span>](../../framework/interop/importing-a-type-library-as-an-assembly.md)
