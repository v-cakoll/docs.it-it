---
title: Personalizzazione del marshalling dei parametri - .NET
description: Informazioni su come personalizzare il modo in cui .NET effettua il marshalling dei parametri in una rappresentazione nativa.
ms.date: 01/18/2019
ms.openlocfilehash: 1999cad057875f15b283421f87f485c2e5ca2306
ms.sourcegitcommit: e7748001b1cee80ced691d8a76ca814c0b02dd9b
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/14/2020
ms.locfileid: "86374312"
---
# <a name="customizing-parameter-marshaling"></a><span data-ttu-id="9414e-103">Personalizzazione del marshalling dei parametri</span><span class="sxs-lookup"><span data-stu-id="9414e-103">Customizing parameter marshaling</span></span>

<span data-ttu-id="9414e-104">Quando il comportamento di marshalling dei parametri predefinito del runtime .NET non esegue le operazioni desiderate, è possibile usare l'attributo <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> per personalizzare il modo in cui viene effettuato il marshalling dei parametri.</span><span class="sxs-lookup"><span data-stu-id="9414e-104">When the .NET runtime's default parameter marshaling behavior doesn't do what you want, use can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute?displayProperty=nameWithType> attribute to customize how your parameters are marshaled.</span></span>

## <a name="customizing-string-parameters"></a><span data-ttu-id="9414e-105">Personalizzazione dei parametri stringa</span><span class="sxs-lookup"><span data-stu-id="9414e-105">Customizing string parameters</span></span>

<span data-ttu-id="9414e-106">.NET offre un'ampia gamma di formati per il marshalling delle stringhe.</span><span class="sxs-lookup"><span data-stu-id="9414e-106">.NET has a variety of formats for marshaling strings.</span></span> <span data-ttu-id="9414e-107">Questi metodi sono suddivisi in sezioni distinte per le stringhe in stile C e per i formati di stringa per Windows.</span><span class="sxs-lookup"><span data-stu-id="9414e-107">These methods are split into distinct sections on C-style strings and Windows-centric string formats.</span></span>

### <a name="c-style-strings"></a><span data-ttu-id="9414e-108">Stringhe in stile C</span><span class="sxs-lookup"><span data-stu-id="9414e-108">C-Style strings</span></span>

<span data-ttu-id="9414e-109">Ognuno di questi formati passa una stringa con terminazione Null al codice nativo.</span><span class="sxs-lookup"><span data-stu-id="9414e-109">Each of these formats passes a null-terminated string to native code.</span></span> <span data-ttu-id="9414e-110">Si differenziano per la codifica della stringa nativa.</span><span class="sxs-lookup"><span data-stu-id="9414e-110">They differ by the encoding of the native string.</span></span>

| <span data-ttu-id="9414e-111">Valore della proprietà `System.Runtime.InteropServices.UnmanagedType`</span><span class="sxs-lookup"><span data-stu-id="9414e-111">`System.Runtime.InteropServices.UnmanagedType` value</span></span> | <span data-ttu-id="9414e-112">Codifica</span><span class="sxs-lookup"><span data-stu-id="9414e-112">Encoding</span></span> |
|------------------------------------------------------|----------|
| <span data-ttu-id="9414e-113">LPStr</span><span class="sxs-lookup"><span data-stu-id="9414e-113">LPStr</span></span> | <span data-ttu-id="9414e-114">ANSI</span><span class="sxs-lookup"><span data-stu-id="9414e-114">ANSI</span></span> |
| <span data-ttu-id="9414e-115">LPUTF8Str</span><span class="sxs-lookup"><span data-stu-id="9414e-115">LPUTF8Str</span></span> | <span data-ttu-id="9414e-116">UTF-8</span><span class="sxs-lookup"><span data-stu-id="9414e-116">UTF-8</span></span> |
| <span data-ttu-id="9414e-117">LPWStr</span><span class="sxs-lookup"><span data-stu-id="9414e-117">LPWStr</span></span> | <span data-ttu-id="9414e-118">UTF-16</span><span class="sxs-lookup"><span data-stu-id="9414e-118">UTF-16</span></span> |
| <span data-ttu-id="9414e-119">LPTStr</span><span class="sxs-lookup"><span data-stu-id="9414e-119">LPTStr</span></span> | <span data-ttu-id="9414e-120">UTF-16</span><span class="sxs-lookup"><span data-stu-id="9414e-120">UTF-16</span></span> |

<span data-ttu-id="9414e-121">Il formato <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> è leggermente diverso.</span><span class="sxs-lookup"><span data-stu-id="9414e-121">The <xref:System.Runtime.InteropServices.UnmanagedType.VBByRefStr?displayProperty=nameWithType> format is slightly different.</span></span> <span data-ttu-id="9414e-122">Ad esempio `LPWStr`, effettua il marshalling della stringa in una stringa in stile C nativo con codifica UTF-16.</span><span class="sxs-lookup"><span data-stu-id="9414e-122">Like `LPWStr`, it marshals the string to a native C-style string encoded in UTF-16.</span></span> <span data-ttu-id="9414e-123">Tuttavia, la firma gestita richiede il passaggio della stringa per riferimento e la firma nativa corrispondente accetta la stringa per valore.</span><span class="sxs-lookup"><span data-stu-id="9414e-123">However, the managed signature has you pass in the string by reference and the matching native signature takes the string by value.</span></span> <span data-ttu-id="9414e-124">Questa distinzione consente di usare un'API nativa che accetta una stringa per valore e la modifica sul posto senza dover usare `StringBuilder`.</span><span class="sxs-lookup"><span data-stu-id="9414e-124">This distinction allows you to use a native API that takes a string by value and modifies it in-place without having to use a `StringBuilder`.</span></span> <span data-ttu-id="9414e-125">È consigliabile evitare di usare questo formato manualmente, perché è soggetto a creare confusione con le firme native e gestite non corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="9414e-125">We recommend against manually using this format since it's prone to cause confusion with the mismatching native and managed signatures.</span></span>

### <a name="windows-centric-string-formats"></a><span data-ttu-id="9414e-126">Formati di stringa per Windows</span><span class="sxs-lookup"><span data-stu-id="9414e-126">Windows-centric string formats</span></span>

<span data-ttu-id="9414e-127">Quando si interagisce con le interfacce COM oppure OLE, probabilmente si scoprirà che le funzioni native accettano stringhe come argomenti `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="9414e-127">When interacting with COM or OLE interfaces, you'll likely find that the native functions take strings as `BSTR` arguments.</span></span> <span data-ttu-id="9414e-128">È possibile usare il tipo non gestito <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> per effettuare il marshalling di una stringa come `BSTR`.</span><span class="sxs-lookup"><span data-stu-id="9414e-128">You can use the <xref:System.Runtime.InteropServices.UnmanagedType.BStr?displayProperty=nameWithType> unmanaged type to marshal a string as a `BSTR`.</span></span>

<span data-ttu-id="9414e-129">Se si interagisce con API WinRT, è possibile usare il formato <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> per effettuare il marshalling di una stringa come `HSTRING`.</span><span class="sxs-lookup"><span data-stu-id="9414e-129">If you're interacting with WinRT APIs, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.HString?displayProperty=nameWithType> format to marshal a string as an `HSTRING`.</span></span>

## <a name="customizing-array-parameters"></a><span data-ttu-id="9414e-130">Personalizzazione dei parametri di matrice</span><span class="sxs-lookup"><span data-stu-id="9414e-130">Customizing array parameters</span></span>

<span data-ttu-id="9414e-131">.NET offre anche vari modi per effettuare il marshalling di parametri di matrice.</span><span class="sxs-lookup"><span data-stu-id="9414e-131">.NET also provides you multiple ways to marshal array parameters.</span></span> <span data-ttu-id="9414e-132">Se si chiama un'API che accetta una matrice in stile C, usare il tipo non gestito <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9414e-132">If you're calling an API that takes a C-style array, use the <xref:System.Runtime.InteropServices.UnmanagedType.LPArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="9414e-133">Se i valori nella matrice richiedono il marshalling personalizzato, è possibile usare il campo <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> per l'attributo `[MarshalAs]` a tale scopo.</span><span class="sxs-lookup"><span data-stu-id="9414e-133">If the values in the array need customized marshaling, you can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.ArraySubType> field on the `[MarshalAs]` attribute for that.</span></span>

<span data-ttu-id="9414e-134">Se si usano API COM, probabilmente sarà necessario effettuare il marshalling dei parametri di matrice come `SAFEARRAY*`.</span><span class="sxs-lookup"><span data-stu-id="9414e-134">If you're using COM APIs, you'll likely have to marshal your array parameters as `SAFEARRAY*`s.</span></span> <span data-ttu-id="9414e-135">A tale scopo, è possibile usare il tipo non gestito <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="9414e-135">To do so, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.SafeArray?displayProperty=nameWithType> unmanaged type.</span></span> <span data-ttu-id="9414e-136">Il tipo predefinito degli elementi di `SAFEARRAY` è indicato nella tabella sulla [personalizzazione dei campi `object`](./customize-struct-marshaling.md#marshal-systemobject).</span><span class="sxs-lookup"><span data-stu-id="9414e-136">The default type of the elements of the `SAFEARRAY` can be seen in the table on [customizing `object` fields](./customize-struct-marshaling.md#marshal-systemobject).</span></span> <span data-ttu-id="9414e-137">È possibile usare i campi <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> e <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> per personalizzare il tipo di elemento esatto di `SAFEARRAY`.</span><span class="sxs-lookup"><span data-stu-id="9414e-137">You can use the <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArraySubType?displayProperty=nameWithType> and <xref:System.Runtime.InteropServices.MarshalAsAttribute.SafeArrayUserDefinedSubType?displayProperty=nameWithType> fields to customize the exact element type of the `SAFEARRAY`.</span></span>

## <a name="customizing-boolean-or-decimal-parameters"></a><span data-ttu-id="9414e-138">Personalizzazione dei parametri booleani o decimali</span><span class="sxs-lookup"><span data-stu-id="9414e-138">Customizing boolean or decimal parameters</span></span>

<span data-ttu-id="9414e-139">Per informazioni sul marshalling dei parametri booleani o decimali, vedere [Personalizzazione del marshalling delle strutture](customize-struct-marshaling.md).</span><span class="sxs-lookup"><span data-stu-id="9414e-139">For information on marshaling boolean or decimal parameters, see [Customizing structure marshaling](customize-struct-marshaling.md).</span></span>

## <a name="customizing-object-parameters-windows-only"></a><span data-ttu-id="9414e-140">Personalizzazione dei parametri oggetto (solo Windows)</span><span class="sxs-lookup"><span data-stu-id="9414e-140">Customizing object parameters (Windows-only)</span></span>

<span data-ttu-id="9414e-141">In Windows, il runtime .NET offre molti modi diversi per effettuare il marshalling dei parametri oggetto in codice nativo.</span><span class="sxs-lookup"><span data-stu-id="9414e-141">On Windows, the .NET runtime provides a number of different ways to marshal object parameters to native code.</span></span>

### <a name="marshaling-as-specific-com-interfaces"></a><span data-ttu-id="9414e-142">Marshalling come interfacce COM specifiche</span><span class="sxs-lookup"><span data-stu-id="9414e-142">Marshaling as specific COM interfaces</span></span>

<span data-ttu-id="9414e-143">Se l'API accetta un puntatore a un oggetto COM, è possibile usare uno dei formati `UnmanagedType` seguenti per un parametro di tipo `object` per indicare a .NET di effettuare il marshalling come queste interfacce specifiche:</span><span class="sxs-lookup"><span data-stu-id="9414e-143">If your API takes a pointer to a COM object, you can use any of the following `UnmanagedType` formats on an `object`-typed parameter to tell .NET to marshal as these specific interfaces:</span></span>

- `IUnknown`
- `IDispatch`
- `IInspectable`

<span data-ttu-id="9414e-144">Inoltre, se il tipo è contrassegnato `[ComVisible(true)]` o si effettua il marshalling del tipo `object`, è possibile usare il formato <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> per effettuare il marshalling dell'oggetto come un COM Callable Wrapper per la visualizzazione COM del tipo.</span><span class="sxs-lookup"><span data-stu-id="9414e-144">Additionally, if your type is marked `[ComVisible(true)]` or you're marshaling the `object` type, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Interface?displayProperty=nameWithType> format to marshal your object as a COM callable wrapper for the COM view of your type.</span></span>

### <a name="marshaling-to-a-variant"></a><span data-ttu-id="9414e-145">Marshaling in `VARIANT`</span><span class="sxs-lookup"><span data-stu-id="9414e-145">Marshaling to a `VARIANT`</span></span>

<span data-ttu-id="9414e-146">Se l'API nativa richiede un `VARIANT` Win32, è possibile usare il formato <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> per il parametro `object` per effettuare il marshalling degli oggetti come `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="9414e-146">If your native API takes a Win32 `VARIANT`, you can use the <xref:System.Runtime.InteropServices.UnmanagedType.Struct?displayProperty=nameWithType> format on your `object` parameter to marshal your objects as `VARIANT`s.</span></span> <span data-ttu-id="9414e-147">Vedere la documentazione sulla [personalizzazione dei campi `object`](customize-struct-marshaling.md#marshal-systemobject) per informazioni sul mapping tra tipi .NET e tipi `VARIANT`.</span><span class="sxs-lookup"><span data-stu-id="9414e-147">See the documentation on [customizing `object` fields](customize-struct-marshaling.md#marshal-systemobject) for a mapping between .NET types and `VARIANT` types.</span></span>

### <a name="custom-marshalers"></a><span data-ttu-id="9414e-148">Gestori di marshalling personalizzati</span><span class="sxs-lookup"><span data-stu-id="9414e-148">Custom marshalers</span></span>

<span data-ttu-id="9414e-149">Se si vuole proiettare un'interfaccia COM nativa in un tipo gestito diverso, è possibile usare il formato `UnmanagedType.CustomMarshaler` e un'implementazione di <xref:System.Runtime.InteropServices.ICustomMarshaler> per fornire il proprio codice di marshalling personalizzato.</span><span class="sxs-lookup"><span data-stu-id="9414e-149">If you want to project a native COM interface into a different managed type, you can use the `UnmanagedType.CustomMarshaler` format and an implementation of <xref:System.Runtime.InteropServices.ICustomMarshaler> to provide your own custom marshaling code.</span></span>
