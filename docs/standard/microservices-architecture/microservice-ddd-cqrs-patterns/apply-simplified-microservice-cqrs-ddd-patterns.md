---
title: Applicazione di schemi CQRS e DDD semplificati in un microservizio
description: Architettura dei microservizi .NET per le applicazioni .NET in contenitori | Riconoscere la relazione globale tra criteri CQRS e DDD.
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 10/08/2018
ms.openlocfilehash: ef3260143c91c2500becd7c8c1a6cd0b81dbf3d2
ms.sourcegitcommit: ccd8c36b0d74d99291d41aceb14cf98d74dc9d2b
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 12/10/2018
ms.locfileid: "53148067"
---
# <a name="apply-simplified-cqrs-and-ddd-patterns-in-a-microservice"></a><span data-ttu-id="f3732-103">Applicare modelli CQRS e DDD semplificati in un microservizio</span><span class="sxs-lookup"><span data-stu-id="f3732-103">Apply simplified CQRS and DDD patterns in a microservice</span></span>

<span data-ttu-id="f3732-104">CQRS è uno schema architetturale che separa i modelli per la lettura e la scrittura dei dati.</span><span class="sxs-lookup"><span data-stu-id="f3732-104">CQRS is an architectural pattern that separates the models for reading and writing data.</span></span> <span data-ttu-id="f3732-105">Il termine correlato [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) è stato originariamente definito da Bertrand Meyer nel suo libro *Object Oriented Software Construction*.</span><span class="sxs-lookup"><span data-stu-id="f3732-105">The related term [Command Query Separation (CQS)](https://martinfowler.com/bliki/CommandQuerySeparation.html) was originally defined by Bertrand Meyer in his book *Object Oriented Software Construction*.</span></span> <span data-ttu-id="f3732-106">L'idea di base è che è possibile dividere le operazioni di un sistema in due categorie nettamente distinte:</span><span class="sxs-lookup"><span data-stu-id="f3732-106">The basic idea is that you can divide a system’s operations into two sharply separated categories:</span></span>

- <span data-ttu-id="f3732-107">Query.</span><span class="sxs-lookup"><span data-stu-id="f3732-107">Queries.</span></span> <span data-ttu-id="f3732-108">Restituiscono un risultato, non modificano lo stato del sistema e sono prive di effetti collaterali.</span><span class="sxs-lookup"><span data-stu-id="f3732-108">These return a result and do not change the state of the system, and they are free of side effects.</span></span>

- <span data-ttu-id="f3732-109">Comandi.</span><span class="sxs-lookup"><span data-stu-id="f3732-109">Commands.</span></span> <span data-ttu-id="f3732-110">Modificano lo stato di un sistema.</span><span class="sxs-lookup"><span data-stu-id="f3732-110">These change the state of a system.</span></span>

<span data-ttu-id="f3732-111">CQS è un concetto semplice: riguarda i metodi all'interno di un oggetto, che si tratti di query o comandi.</span><span class="sxs-lookup"><span data-stu-id="f3732-111">CQS is a simple concept—it is about methods within the same object being either queries or commands.</span></span> <span data-ttu-id="f3732-112">Ogni metodo restituisce lo stato oppure modifica lo stato, ma non esegue entrambe le operazioni.</span><span class="sxs-lookup"><span data-stu-id="f3732-112">Each method either returns state or mutates state, but not both.</span></span> <span data-ttu-id="f3732-113">Anche un singolo oggetto di schema di repository può essere conforme a CQS.</span><span class="sxs-lookup"><span data-stu-id="f3732-113">Even a single repository pattern object can comply with CQS.</span></span> <span data-ttu-id="f3732-114">CQS può essere considerato un principio fondamentale per CQRS.</span><span class="sxs-lookup"><span data-stu-id="f3732-114">CQS can be considered a foundational principle for CQRS.</span></span>

<span data-ttu-id="f3732-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) è stato introdotto da Greg Young e fortemente promosso da Udi Dahan e altri esperti.</span><span class="sxs-lookup"><span data-stu-id="f3732-115">[Command and Query Responsibility Segregation (CQRS)](https://martinfowler.com/bliki/CQRS.html) was introduced by Greg Young and strongly promoted by Udi Dahan and others.</span></span> <span data-ttu-id="f3732-116">È basato sul principio CQS, sebbene sia più dettagliato.</span><span class="sxs-lookup"><span data-stu-id="f3732-116">It is based on the CQS principle, although it is more detailed.</span></span> <span data-ttu-id="f3732-117">Può essere considerato uno schema basato sui comandi e sugli eventi, oltre che facoltativamente sui messaggi asincroni.</span><span class="sxs-lookup"><span data-stu-id="f3732-117">It can be considered a pattern based on commands and events plus optionally on asynchronous messages.</span></span> <span data-ttu-id="f3732-118">In molti casi, CQRS è correlato a scenari più avanzati, come l'uso di un database per le operazioni di lettura (query) diverso da quello per le operazioni di scrittura (aggiornamenti).</span><span class="sxs-lookup"><span data-stu-id="f3732-118">In many cases, CQRS is related to more advanced scenarios, like having a different physical database for reads (queries) than for writes (updates).</span></span> <span data-ttu-id="f3732-119">Inoltre, un sistema CQRS più evoluto potrebbe implementare la [determinazione dell'origine degli eventi](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) per il database degli aggiornamenti, consentendo di archiviare solo gli eventi nel modello di dominio, anziché archiviare i dati sullo stato corrente.</span><span class="sxs-lookup"><span data-stu-id="f3732-119">Moreover, a more evolved CQRS system might implement [Event-Sourcing (ES)](http://codebetter.com/gregyoung/2010/02/20/why-use-event-sourcing/) for your updates database, so you would only store events in the domain model instead of storing the current-state data.</span></span> <span data-ttu-id="f3732-120">In questa guida, tuttavia, non sarà applicato tale approccio. Verrà usato l'approccio più semplice a CQRS, che prevede solo la separazione delle query dai comandi.</span><span class="sxs-lookup"><span data-stu-id="f3732-120">However, this is not the approach used in this guide; we are using the simplest CQRS approach, which consists of just separating the queries from the commands.</span></span>

<span data-ttu-id="f3732-121">L'aspetto di separazione di CQRS viene ottenuto mediante il raggruppamento delle operazioni di query in un livello e dei comandi in un altro livello.</span><span class="sxs-lookup"><span data-stu-id="f3732-121">The separation aspect of CQRS is achieved by grouping query operations in one layer and commands in another layer.</span></span> <span data-ttu-id="f3732-122">Ogni livello dispone di un proprio modello di dati (si noti che parliamo di modello, non necessariamente di un database diverso) e viene creato tramite una specifica combinazione di schemi e tecnologie.</span><span class="sxs-lookup"><span data-stu-id="f3732-122">Each layer has its own data model (note that we say model, not necessarily a different database) and is built using its own combination of patterns and technologies.</span></span> <span data-ttu-id="f3732-123">Cosa ancora più importante, i due livelli possono essere contenuti nello stesso livello o microservizio, come illustrato nell'esempio (microservizio per gli ordini) usato per questa guida.</span><span class="sxs-lookup"><span data-stu-id="f3732-123">More importantly, the two layers can be within the same tier or microservice, as in the example (ordering microservice) used for this guide.</span></span> <span data-ttu-id="f3732-124">In alternativa, possono essere implementati in diversi microservizi o processi, in modo da poter essere ottimizzati e scalati in orizzontale separatamente senza influire l'uno sull'altro.</span><span class="sxs-lookup"><span data-stu-id="f3732-124">Or they could be implemented on different microservices or processes so they can be optimized and scaled out separately without affecting one another.</span></span>

<span data-ttu-id="f3732-125">CQRS significa creare due oggetti per un'operazione di lettura/scrittura, dove in altri contesti ne è presente uno.</span><span class="sxs-lookup"><span data-stu-id="f3732-125">CQRS means having two objects for a read/write operation where in other contexts there is one.</span></span> <span data-ttu-id="f3732-126">Esistono diversi motivi per cui è consigliabile disporre di un database denormalizzato per le letture (informazioni in proposito sono disponibili nella documentazione più avanzata su CQRS).</span><span class="sxs-lookup"><span data-stu-id="f3732-126">There are reasons to have a denormalized reads database, which you can learn about in more advanced CQRS literature.</span></span> <span data-ttu-id="f3732-127">In questo caso, non useremo tale approccio, perché il nostro obiettivo è avere maggiore flessibilità nelle query invece di limitare le query con vincoli dagli schemi DDD come gli aggregati.</span><span class="sxs-lookup"><span data-stu-id="f3732-127">But we are not using that approach here, where the goal is to have more flexibility in the queries instead of limiting the queries with constraints from DDD patterns like aggregates.</span></span>

<span data-ttu-id="f3732-128">Un esempio di questo tipo di servizio è il microservizio per gli ordini dell'applicazione di riferimento eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="f3732-128">An example of this kind of service is the ordering microservice from the eShopOnContainers reference application.</span></span> <span data-ttu-id="f3732-129">Questo servizio implementa un microservizio basato su un approccio CQRS semplificato.</span><span class="sxs-lookup"><span data-stu-id="f3732-129">This service implements a microservice based on a simplified CQRS approach.</span></span> <span data-ttu-id="f3732-130">Usa una singola origine dati o un singolo database, ma due modelli logici, più schemi DDD per il dominio transazionale, come illustrato nella figura 7-2.</span><span class="sxs-lookup"><span data-stu-id="f3732-130">It uses a single data source or database, but two logical models plus DDD patterns for the transactional domain, as shown in Figure 7-2.</span></span>

![Il microservizio logico Ordinamento include il proprio database Ordinamento, che può essere incluso o meno nello stesso host Docker.](./media/image2.png)

<span data-ttu-id="f3732-133">**Figura 7-2**.</span><span class="sxs-lookup"><span data-stu-id="f3732-133">**Figure 7-2**.</span></span> <span data-ttu-id="f3732-134">Microservizio semplificato basato su CQRS e DDD</span><span class="sxs-lookup"><span data-stu-id="f3732-134">Simplified CQRS- and DDD-based microservice</span></span>

<span data-ttu-id="f3732-135">Il livello dell'applicazione può essere la stessa API Web.</span><span class="sxs-lookup"><span data-stu-id="f3732-135">The application layer can be the Web API itself.</span></span> <span data-ttu-id="f3732-136">L'aspetto di progettazione importante a questo proposito è che il microservizio ha suddiviso le query e i ViewModel (modelli di dati creati appositamente per le applicazioni client) dai comandi, dal modello di dominio e dalle transazioni seguendo lo schema CQRS.</span><span class="sxs-lookup"><span data-stu-id="f3732-136">The important design aspect here is that the microservice has split the queries and ViewModels (data models especially created for the client applications) from the commands, domain model, and transactions following the CQRS pattern.</span></span> <span data-ttu-id="f3732-137">Questo approccio mantiene le query indipendenti da restrizioni e vincoli provenienti da schemi DDD che sono applicabili esclusivamente per le transazioni e gli aggiornamenti, come descritto nelle sezioni successive.</span><span class="sxs-lookup"><span data-stu-id="f3732-137">This approach keeps the queries independent from restrictions and constraints coming from DDD patterns that only make sense for transactions and updates, as explained in later sections.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="f3732-138">[Precedente](index.md)
>[Successivo](eshoponcontainers-cqrs-ddd-microservice.md)</span><span class="sxs-lookup"><span data-stu-id="f3732-138">[Previous](index.md)
[Next](eshoponcontainers-cqrs-ddd-microservice.md)</span></span>