---
title: Progettazione di un modello di dominio del microservizio
description: Architettura dei microservizi .NET per le applicazioni .NET in contenitori | Progettazione di un modello di dominio del microservizio
keywords: Docker, microservizi, ASP.NET, contenitore
author: CESARDELATORRE
ms.author: wiwagn
ms.date: 11/09/2017
ms.prod: .net-core
ms.technology: dotnet-docker
ms.topic: article
ms.workload:
- dotnet
- dotnetcore
ms.openlocfilehash: 752c4cceada2bf0649facbfd46c36c26dc666d29
ms.sourcegitcommit: c883637b41ee028786edceece4fa872939d2e64c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/26/2018
---
# <a name="designing-a-microservice-domain-model"></a><span data-ttu-id="ba9ef-104">Progettazione di un modello di dominio del microservizio</span><span class="sxs-lookup"><span data-stu-id="ba9ef-104">Designing a microservice domain model</span></span>

<span data-ttu-id="ba9ef-105">*Definire un modello di dominio avanzato per ogni microservizio aziendale o contesto limitato*</span><span class="sxs-lookup"><span data-stu-id="ba9ef-105">*Define one rich domain model for each business microservice or Bounded Context*</span></span>

<span data-ttu-id="ba9ef-106">L'obiettivo consiste nel creare un modello di dominio coerente per ogni microservizio aziendale o contesto limitato.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-106">Your goal is to create a single cohesive domain model for each business microservice or Bounded Context (BC).</span></span> <span data-ttu-id="ba9ef-107">Tenere presente, tuttavia, che un contesto limitato o un microservizio aziendale è costituito talvolta da diversi servizi fisici che condividono un unico modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-107">Keep in mind, however, that a BC or business microservice could sometimes be composed of several physical services that share a single domain model.</span></span> <span data-ttu-id="ba9ef-108">Quest'ultimo deve acquisire le regole, il comportamento, il linguaggio aziendale e i vincoli del singolo contesto delimitato o microservizio aziendale che rappresenta.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-108">The domain model must capture the rules, behavior, business language, and constraints of the single Bounded Context or business microservice that it represents.</span></span>

## <a name="the-domain-entity-pattern"></a><span data-ttu-id="ba9ef-109">Schema Domain Entity</span><span class="sxs-lookup"><span data-stu-id="ba9ef-109">The Domain Entity pattern</span></span>

<span data-ttu-id="ba9ef-110">Le entità rappresentano oggetti di dominio e vengono definite principalmente in base alla loro identità, continuità e persistenza nel tempo, e non solo in base agli attributi che le caratterizzano.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-110">Entities represent domain objects and are primarily defined by their identity, continuity, and persistence over time, and not only by the attributes that comprise them.</span></span> <span data-ttu-id="ba9ef-111">Come sostiene Eric Evans, "un oggetto definito principalmente dalla propria identità prende il nome di entità".</span><span class="sxs-lookup"><span data-stu-id="ba9ef-111">As Eric Evans says, “an object primarily defined by its identity is called an Entity.”</span></span> <span data-ttu-id="ba9ef-112">Le entità sono molto importanti nel modello di dominio, poiché costituiscono la base per il modello.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-112">Entities are very important in the domain model, since they are the base for a model.</span></span> <span data-ttu-id="ba9ef-113">È quindi necessario identificarle e progettarle attentamente.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-113">Therefore, you should identify and design them carefully.</span></span>

<span data-ttu-id="ba9ef-114">*L'identità di un'entità può coinvolgere più microservizi o contesti limitati.*</span><span class="sxs-lookup"><span data-stu-id="ba9ef-114">*An entity’s identity can cross multiple microservices or Bounded Contexts.*</span></span>

<span data-ttu-id="ba9ef-115">La stessa identità (ma non la stessa entità) può essere modellata in più microservizi o contesti limitati.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-115">The same identity (though not the same entity) can be modeled across multiple Bounded Contexts or microservices.</span></span> <span data-ttu-id="ba9ef-116">Questo non significa tuttavia che la stessa entità, con gli stessi attributi e la stessa logica, venga implementata in più contesti delimitati.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-116">However, that does not imply that the same entity, with the same attributes and logic would be implemented in multiple Bounded Contexts.</span></span> <span data-ttu-id="ba9ef-117">Al contrario, le entità presenti in ogni contesto delimitato limitano i relativi attributi e comportamenti a quelli strettamente necessari nel dominio del contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-117">Instead, entities in each Bounded Context limit their attributes and behaviors to those required in that Bounded Context’s domain.</span></span>

<span data-ttu-id="ba9ef-118">È possibile, ad esempio, che all'entità "acquirente" sia associata la maggior parte degli attributi di persona definiti nell'entità utente del microservizio dell'identità o del profilo, inclusa l'identità.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-118">For instance, the buyer entity might have most of a person’s attributes that are defined in the user entity in the profile or identity microservice, including the identity.</span></span> <span data-ttu-id="ba9ef-119">Nel microservizio degli ordini, tuttavia, è possibile che all'entità acquirente sia associato un minor numero di attributi, poiché solo alcuni dati dell'acquirente sono effettivamente correlati al processo di ordine.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-119">But the buyer entity in the ordering microservice might have fewer attributes, because only certain buyer data is related to the order process.</span></span> <span data-ttu-id="ba9ef-120">Il contesto di ogni microservizio o contesto delimitato influisce sul relativo modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-120">The context of each microservice or Bounded Context impacts its domain model.</span></span>

<span data-ttu-id="ba9ef-121">*Le entità di dominio devono implementare il comportamento oltre agli attributi dei dati*</span><span class="sxs-lookup"><span data-stu-id="ba9ef-121">*Domain entities must implement behavior in addition to implementing data attributes*</span></span>

<span data-ttu-id="ba9ef-122">In una progettazione basata su domini, un'entità di dominio deve implementare la logica di dominio o il comportamento correlato ai dati dell'entità (l'oggetto a cui si accede in memoria).</span><span class="sxs-lookup"><span data-stu-id="ba9ef-122">A domain entity in DDD must implement the domain logic or behavior related to the entity data (the object accessed in memory).</span></span> <span data-ttu-id="ba9ef-123">Nell'ambito della classe di un'entità ordine, ad esempio, è necessario che le operazioni e la logica aziendale siano implementate come i metodi per attività quali l'aggiunta di un elemento ordine, la convalida dei dati e il calcolo totale.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-123">For example, as part of an order entity class you must have business logic and operations implemented as methods for tasks such as adding an order item, data validation, and total calculation.</span></span> <span data-ttu-id="ba9ef-124">I metodi di un'entità si occupano delle invarianti e delle regole dell'entità per evitare che le regole vengano disseminate nel livello dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-124">The entity’s methods take care of the invariants and rules of the entity instead of having those rules spread across the application layer.</span></span>

<span data-ttu-id="ba9ef-125">La figura 9-8 illustra un'entità di dominio che implementa non solo gli attributi dei dati, ma anche le operazioni o i metodi con la logica di dominio correlata.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-125">Figure 9-8 shows a domain entity that implements not only data attributes but operations or methods with related domain logic.</span></span>

![](./media/image9.png)

<span data-ttu-id="ba9ef-126">**Figura 9-8**.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-126">**Figure 9-8**.</span></span> <span data-ttu-id="ba9ef-127">Esempio di progettazione di un'entità di dominio che implementa dati e comportamento</span><span class="sxs-lookup"><span data-stu-id="ba9ef-127">Example of a domain entity design implementing data plus behavior</span></span>

<span data-ttu-id="ba9ef-128">In alcuni casi, naturalmente, è possibile che un'entità non implementi alcuna logica nell'ambito della classe di entità.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-128">Of course, sometimes you can have entities that do not implement any logic as part of the entity class.</span></span> <span data-ttu-id="ba9ef-129">Questa situazione può verificarsi nelle entità figlio all'interno di un aggregazione se l'entità figlio non contiene alcuna logica speciale, poiché la maggior parte della logica è definita nella radice di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-129">This can happen in child entities within an aggregate if the child entity does not have any special logic because most of the logic is defined in the aggregate root.</span></span> <span data-ttu-id="ba9ef-130">Se si ha un microservizio complesso in cui la maggior parte della logica è implementata nelle classi del servizio anziché nelle entità di dominio, è possibile che si abbia a che fare con un modello di dominio anemico, illustrato nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-130">If you have a complex microservice that has a lot of logic implemented in the service classes instead of in the domain entities, you could be falling into the anemic domain model, explained in the following section.</span></span>

### <a name="rich-domain-model-versus-anemic-domain-model"></a><span data-ttu-id="ba9ef-131">Modello di dominio avanzato e modello di dominio anemico a confronto</span><span class="sxs-lookup"><span data-stu-id="ba9ef-131">Rich domain model versus anemic domain model</span></span>

<span data-ttu-id="ba9ef-132">Nel post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler descrive così un modello di dominio anemico:</span><span class="sxs-lookup"><span data-stu-id="ba9ef-132">In his post [AnemicDomainModel](https://martinfowler.com/bliki/AnemicDomainModel.html), Martin Fowler describes an anemic domain model this way:</span></span>

<span data-ttu-id="ba9ef-133">La caratteristica principale di un modello di dominio anemico è che inizialmente sembra un oggetto reale.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-133">The basic symptom of an Anemic Domain Model is that at first blush it looks like the real thing.</span></span> <span data-ttu-id="ba9ef-134">Alcuni oggetti, denominati in base ai nomi presenti nello spazio di dominio, sono connessi con la stessa struttura e le stesse relazioni avanzate che hanno i veri modelli di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-134">There are objects, many named after the nouns in the domain space, and these objects are connected with the rich relationships and structure that true domain models have.</span></span> <span data-ttu-id="ba9ef-135">Quando se ne osserva il comportamento, tuttavia, ci si accorge che questi oggetti non hanno pressoché alcun tipo di comportamento, essendo in realtà poco più che contenitori di proprietà Get e Set.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-135">The catch comes when you look at the behavior, and you realize that there is hardly any behavior on these objects, making them little more than bags of getters and setters.</span></span>

<span data-ttu-id="ba9ef-136">Quando si usa un modello di dominio anemico, ovviamente, questi modelli di dati vengono usati da un set di oggetti servizio (tradizionalmente denominato *livello aziendale*) che acquisisce tutta la logica aziendale o di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-136">Of course, when you use an anemic domain model, those data models will be used from a set of service objects (traditionally named the *business layer*) which capture all the domain or business logic.</span></span> <span data-ttu-id="ba9ef-137">Il livello aziendale si basa quindi sul modello di dati, che usa come dati.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-137">The business layer sits on top of the data model and uses the data model just as data.</span></span>

<span data-ttu-id="ba9ef-138">Il modello di dominio anemico è una progettazione di tipo procedurale.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-138">The anemic domain model is just a procedural style design.</span></span> <span data-ttu-id="ba9ef-139">Gli oggetti entità anemici non sono oggetti reali perché non hanno un comportamento (metodi).</span><span class="sxs-lookup"><span data-stu-id="ba9ef-139">Anemic entity objects are not real objects because they lack behavior (methods).</span></span> <span data-ttu-id="ba9ef-140">Si limitano a contenere proprietà di dati e, pertanto, non hanno una progettazione orientata agli oggetti.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-140">They only hold data properties and thus it is not object-oriented design.</span></span> <span data-ttu-id="ba9ef-141">Inserendo tutti i tipi di comportamento in oggetti servizio (il livello aziendale), tuttavia, si finisce per avere [blocchi di codice complicato](https://en.wikipedia.org/wiki/Spaghetti_code) o [script transazionali](https://martinfowler.com/eaaCatalog/transactionScript.html) e, quindi, si perdono i vantaggi offerti da un modello di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-141">By putting all the behavior out into service objects (the business layer) you essentially end up with [spaghetti code](https://en.wikipedia.org/wiki/Spaghetti_code) or [transaction scripts](https://martinfowler.com/eaaCatalog/transactionScript.html), and therefore you lose the advantages that a domain model provides.</span></span>

<span data-ttu-id="ba9ef-142">Indipendentemente dal fatto che il microservizio o il contesto limitato sia molto semplice (un servizio CRUD), è possibile che il modello di dominio anemico sotto forma di oggetti entità contenenti solo le proprietà dei dati sia sufficiente e, in questo caso, non sarebbe necessario implementare schemi di progettazione basata su domini più complessi.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-142">Regardless, if your microservice or Bounded Context is very simple (a CRUD service), the anemic domain model in the form of entity objects with just data properties might be good enough, and it might not be worth implementing more complex DDD patterns.</span></span> <span data-ttu-id="ba9ef-143">Si tratterà semplicemente di un modello di persistenza, poiché è stata intenzionalmente creata un'entità contenente solo i dati necessari per il servizio CRUD.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-143">In that case, it will be simply a persistence model, because you have intentionally created an entity with only data for CRUD purposes.</span></span>

<span data-ttu-id="ba9ef-144">Ecco perché le architetture di microservizi sono ideali per un approccio a più architetture basato sul contesto delimitato.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-144">That is why microservices architectures are perfect for a multi-architectural approach depending on each Bounded Context.</span></span> <span data-ttu-id="ba9ef-145">In eShopOnContainers, ad esempio, il microservizio degli ordini implementa schemi di progettazione basata su domini, ma non il microservizio catalogo, che è un semplice servizio CRUD.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-145">For instance, in eShopOnContainers, the ordering microservice implements DDD patterns, but the catalog microservice, which is a simple CRUD service, does not.</span></span>

<span data-ttu-id="ba9ef-146">Alcune persone sostengono che il modello di dominio anemico sia un antipattern:</span><span class="sxs-lookup"><span data-stu-id="ba9ef-146">Some people say that the anemic domain model is an anti-pattern.</span></span> <span data-ttu-id="ba9ef-147">dipende essenzialmente da cosa si sta implementando.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-147">It really depends on what you are implementing.</span></span> <span data-ttu-id="ba9ef-148">Se il microservizio che si sta creando è abbastanza semplice (ad esempio, un servizio CRUD), il modello di dominio anemico che ne consegue non è un antipattern.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-148">If the microservice you are creating is simple enough (for example, a CRUD service), following the anemic domain model it is not an anti-pattern.</span></span> <span data-ttu-id="ba9ef-149">Se invece è necessario affrontare la complessità di un dominio di microservizio con molte regole in continua evoluzione, è possibile che il modello di dominio anemico sia davvero un antipattern per il microservizio o il contesto limitato in questione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-149">However, if you need to tackle the complexity of a microservice’s domain that has a lot of ever-changing business rules, the anemic domain model might be an anti-pattern for that microservice or Bounded Context.</span></span> <span data-ttu-id="ba9ef-150">In questo caso, progettandolo come un modello avanzato con entità contenenti dati e comportamento, nonché implementando altri schemi di progettazione basata su domini (aggregazioni, oggetti valore e così via), è possibile ottenere vantaggi significativi per il successo a lungo termine di questo microservizio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-150">In that case, designing it as a rich model with entities containing data plus behavior as well as implementing additional DDD patterns (aggregates, value objects, etc.) might have huge benefits for the long-term success of such a microservice.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="ba9ef-151">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="ba9ef-151">Additional resources</span></span>

-   <span data-ttu-id="ba9ef-152">**DevIQ. Domain Entity**
    [*http://deviq.com/entity/*](http://deviq.com/entity/)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-152">**DevIQ. Domain Entity**
[*http://deviq.com/entity/*](http://deviq.com/entity/)</span></span>

-   <span data-ttu-id="ba9ef-153">**Martin Fowler. Il modello di dominio**
    [*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-153">**Martin Fowler. The Domain Model**
[*https://martinfowler.com/eaaCatalog/domainModel.html*](https://martinfowler.com/eaaCatalog/domainModel.html)</span></span>

-   <span data-ttu-id="ba9ef-154">**Martin Fowler. The Anemic Domain Model (Il modello di dominio anemico)**</span><span class="sxs-lookup"><span data-stu-id="ba9ef-154">**Martin Fowler. The Anemic Domain Model**</span></span>

    <https://martinfowler.com/bliki/AnemicDomainModel.html>

### <a name="the-value-object-pattern"></a><span data-ttu-id="ba9ef-155">Schema Value Object</span><span class="sxs-lookup"><span data-stu-id="ba9ef-155">The Value Object pattern</span></span>

<span data-ttu-id="ba9ef-156">Come ha osservato Eric Evans: "Molti oggetti non hanno un'identità concettuale,</span><span class="sxs-lookup"><span data-stu-id="ba9ef-156">As Eric Evans has noted, “Many objects do not have conceptual identity.</span></span> <span data-ttu-id="ba9ef-157">ma descrivono alcune caratteristiche di un elemento".</span><span class="sxs-lookup"><span data-stu-id="ba9ef-157">These objects describe certain characteristics of a thing.”</span></span>

<span data-ttu-id="ba9ef-158">Un'entità richiede un'identità, che non è necessaria invece in molti oggetti presenti in un sistema, come lo schema Value Object.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-158">An entity requires an identity, but there are many objects in a system that do not, like the Value Object pattern.</span></span> <span data-ttu-id="ba9ef-159">Un oggetto valore è un oggetto senza identità concettuale che descrive un aspetto di un dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-159">A value object is an object with no conceptual identity that describes a domain aspect.</span></span> <span data-ttu-id="ba9ef-160">Si tratta di oggetti per i quali è necessario creare un'istanza che rappresenti gli elementi di progettazione temporaneamente richiesti.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-160">These are objects that you instantiate to represent design elements that only concern you temporarily.</span></span> <span data-ttu-id="ba9ef-161">L'importante è *cosa* sono, non *chi* sono.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-161">You care about *what* they are, not *who* they are.</span></span> <span data-ttu-id="ba9ef-162">Alcuni esempi possono essere numeri e stringhe, ma anche concetti di livello superiore come gruppi di attributi.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-162">Examples include numbers and strings, but can also be higher-level concepts like groups of attributes.</span></span>

<span data-ttu-id="ba9ef-163">È possibile che un elemento che rappresenta un'entità in un microservizio non svolga la stessa funzione in un altro microservizio poiché, in questo secondo caso, il contesto limitato ha un significato diverso.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-163">Something that is an entity in a microservice might not be an entity in another microservice, because in the second case, the Bounded Context might have a different meaning.</span></span> <span data-ttu-id="ba9ef-164">È possibile, ad esempio, che un indirizzo in un'applicazione di e-commerce non abbia alcuna identità, poiché rappresenta solo un gruppo di attributi del profilo cliente relativo a una persona o una società.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-164">For example, an address in an e-commerce application might not have an identity at all, since it might only represent a group of attributes of the customer’s profile for a person or company.</span></span> <span data-ttu-id="ba9ef-165">In questo caso, l'indirizzo deve essere classificato come un oggetto valore.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-165">In this case, the address should be classified as a value object.</span></span> <span data-ttu-id="ba9ef-166">In un'applicazione per una società di energia elettrica, invece, l'indirizzo del cliente può essere importante per il dominio aziendale.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-166">However, in an application for an electric power utility company, the customer address could be important for the business domain.</span></span> <span data-ttu-id="ba9ef-167">L'indirizzo, quindi, deve avere un'identità in modo che il sistema di fatturazione sia direttamente collegato all'indirizzo.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-167">Therefore, the address must have an identity so the billing system can be directly linked to the address.</span></span> <span data-ttu-id="ba9ef-168">In questo caso, l'indirizzo deve essere classificato come un'entità di dominio.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-168">In that case, an address should be classified as a domain entity.</span></span>

<span data-ttu-id="ba9ef-169">Una persona con un nome e un cognome, in genere, costituisce un'entità perché ogni persona ha un'identità, anche se il nome e il cognome coincidono con un altro set di valori, come nel caso in cui i nomi facciano riferimento anche a una persona diversa.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-169">A person with a name and surname is usually an entity because a person has identity, even if the name and surname coincide with another set of values, such as if those names also refers to a different person.</span></span>

<span data-ttu-id="ba9ef-170">Gli oggetti valore sono difficili da gestire nei database relazionali e in ORM come Entity Framework, mentre nei database orientati ai documenti sono più facili da implementare e usare.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-170">Value objects are hard to manage in relational databases and ORMs like EF, whereas in document oriented databases they are easier to implement and use.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="ba9ef-171">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="ba9ef-171">Additional resources</span></span>

-   <span data-ttu-id="ba9ef-172">**Martin Fowler. Modello oggetto di valore**
    [*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-172">**Martin Fowler. Value Object pattern**
[*https://martinfowler.com/bliki/ValueObject.html*](https://martinfowler.com/bliki/ValueObject.html)</span></span>

-   <span data-ttu-id="ba9ef-173">**Oggetto valore**
    [*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-173">**Value Object**
[*http://deviq.com/value-object/*](http://deviq.com/value-object/)</span></span>

-   <span data-ttu-id="ba9ef-174">**Valore di oggetti in fase di sviluppo TDD**
    [*https://leanpub.com/tdd-ebook/read\#oggetti leanpub-auto-valore*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-174">**Value Objects in Test-Driven Development**
[*https://leanpub.com/tdd-ebook/read\#leanpub-auto-value-objects*](https://leanpub.com/tdd-ebook/read#leanpub-auto-value-objects)</span></span>

-   <span data-ttu-id="ba9ef-175">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software (Progettazione basata su domini: gestire le complessità nel software).**</span><span class="sxs-lookup"><span data-stu-id="ba9ef-175">**Eric Evans. Domain-Driven Design: Tackling Complexity in the Heart of Software.**</span></span> <span data-ttu-id="ba9ef-176">(Libro. Include una trattazione sugli oggetti valore) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-176">(Book; includes a discussion of value objects) [*https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/*](https://www.amazon.com/Domain-Driven-Design-Tackling-Complexity-Software/dp/0321125215/)</span></span>

### <a name="the-aggregate-pattern"></a><span data-ttu-id="ba9ef-177">Schema Aggregate</span><span class="sxs-lookup"><span data-stu-id="ba9ef-177">The Aggregate pattern</span></span>

<span data-ttu-id="ba9ef-178">Un modello di dominio contiene cluster di vari processi ed entità di dati che possono controllare un'area significativa di funzionalità, ad esempio per la gestione dell'inventario o l'evasione degli ordini.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-178">A domain model contains clusters of different data entities and processes that can control a significant area of functionality, such as order fulfilment or inventory.</span></span> <span data-ttu-id="ba9ef-179">L'aggregazione costituisce un'unità di progettazione basata su domini più dettagliata, che descrive un cluster o un gruppo di entità e comportamenti che è possibile considerare come un'unica unità.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-179">A more fine-grained DDD unit is the aggregate, which describes a cluster or group of entities and behaviors that can be treated as a cohesive unit.</span></span>

<span data-ttu-id="ba9ef-180">In genere, un'aggregazione viene definita in base alle transazioni necessarie.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-180">You usually define an aggregate based on the transactions that you need.</span></span> <span data-ttu-id="ba9ef-181">Un esempio classico è un ordine contenente un elenco di elementi ordine,</span><span class="sxs-lookup"><span data-stu-id="ba9ef-181">A classic example is an order that also contains a list of order items.</span></span> <span data-ttu-id="ba9ef-182">ciascuno dei quali costituirà un'entità.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-182">An order item will usually be an entity.</span></span> <span data-ttu-id="ba9ef-183">In particolare, costituirà un'entità figlio all'interno dell'aggregazione ordine, che conterrà anche l'entità ordine come entità principale, solitamente definita "radice di aggregazione".</span><span class="sxs-lookup"><span data-stu-id="ba9ef-183">But it will be a child entity within the order aggregate, which will also contain the order entity as its root entity, typically called an aggregate root.</span></span>

<span data-ttu-id="ba9ef-184">Identificare le aggregazioni può essere difficile.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-184">Identifying aggregates can be hard.</span></span> <span data-ttu-id="ba9ef-185">Un'aggregazione è un gruppo di oggetti che devono essere coerenti tra loro: non è sufficiente, quindi, selezionare un gruppo di oggetti e contrassegnarli come un'aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-185">An aggregate is a group of objects that must be consistent together, but you cannot just pick a group of objects and label them an aggregate.</span></span> <span data-ttu-id="ba9ef-186">È necessario iniziare con il concetto di dominio e prendere in considerazione le entità usate nelle transazioni più comuni relative a questo concetto.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-186">You must start with a domain concept and think about the entities that are used in the most common transactions related to that concept.</span></span> <span data-ttu-id="ba9ef-187">Queste entità, che devono essere coerenti a livello di transazione, formano un'aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-187">Those entities that need to be transactionally consistent are what forms an aggregate.</span></span> <span data-ttu-id="ba9ef-188">Pensare alle operazioni delle transazioni costituisce probabilmente il modo migliore per identificare le aggregazioni.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-188">Thinking about transaction operations is probably the best way to identify aggregates.</span></span>

### <a name="the-aggregate-root-or-root-entity-pattern"></a><span data-ttu-id="ba9ef-189">Schema Aggregate Root o Root Entity</span><span class="sxs-lookup"><span data-stu-id="ba9ef-189">The Aggregate Root or Root Entity pattern</span></span>

<span data-ttu-id="ba9ef-190">Un'aggregazione è composta da almeno un'entità: la radice di aggregazione, definita anche entità radice o entità principale.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-190">An aggregate is composed of at least one entity: the aggregate root, also called root entity or primary entity.</span></span> <span data-ttu-id="ba9ef-191">Può avere più entità figlio e oggetti valore, che interagiscono per implementare le transazioni e il comportamento richiesti.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-191">Additionally, it can have multiple child entities and value objects, with all entities and objects working together to implement required behavior and transactions.</span></span>

<span data-ttu-id="ba9ef-192">Lo scopo di una radice di aggregazione è garantire la coerenza dell'aggregazione: deve essere il solo punto di ingresso per gli aggiornamenti dell'aggregazione eseguiti tramite operazioni o metodi nella classe della radice di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-192">The purpose of an aggregate root is to ensure the consistency of the aggregate; it should be the only entry point for updates to the aggregate through methods or operations in the aggregate root class.</span></span> <span data-ttu-id="ba9ef-193">Ma non solo: eventuali modifiche alle entità all'interno dell'aggregazione devono essere apportate solo tramite la radice di aggregazione,</span><span class="sxs-lookup"><span data-stu-id="ba9ef-193">You should make changes to entities within the aggregate only via the aggregate root.</span></span> <span data-ttu-id="ba9ef-194">che deve controllare la coerenza dell'aggregazione tenendo conto di tutte le invarianti e le regole di coerenza che devono essere rispettate nell'aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-194">It is the aggregate’s consistency guardian, taking into account all the invariants and consistency rules you might need to comply with in your aggregate.</span></span> <span data-ttu-id="ba9ef-195">Se si modifica un entità figlio o un oggetto valore in modo indipendente, la radice di aggregazione non può garantire che l'aggregazione sia in uno stato valido.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-195">If you change a child entity or value object independently, the aggregate root cannot ensure that the aggregate is in a valid state.</span></span> <span data-ttu-id="ba9ef-196">Sarebbe come un tavolo con una gamba fissata male.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-196">It would be like a table with a loose leg.</span></span> <span data-ttu-id="ba9ef-197">Mantenere la coerenza, quindi, è lo scopo principale della radice di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-197">Maintaining consistency is the main purpose of the aggregate root.</span></span>

<span data-ttu-id="ba9ef-198">Nella figura 9-9 è possibile osservare aggregazioni di esempio come l'aggregazione Buyer (acquirente), che contiene un'unica entità (la radice di aggregazione Buyer).</span><span class="sxs-lookup"><span data-stu-id="ba9ef-198">In Figure 9-9, you can see sample aggregates like the buyer aggregate, which contains a single entity (the aggregate root Buyer).</span></span> <span data-ttu-id="ba9ef-199">L'aggregazione Order contiene invece più entità e un oggetto valore.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-199">The order aggregate contains multiple entities and a value object.</span></span>

![](./media/image10.png)

<span data-ttu-id="ba9ef-200">**Figura 9-9**.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-200">**Figure 9-9**.</span></span> <span data-ttu-id="ba9ef-201">Esempio di aggregazioni con una o più entità</span><span class="sxs-lookup"><span data-stu-id="ba9ef-201">Example of aggregates with multiple or single entities</span></span>

<span data-ttu-id="ba9ef-202">L'aggregazione Buyer può avere entità figlio aggiuntive, in base al dominio, come avviene nel microservizio degli ordini nell'applicazione di riferimento eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-202">Note that the Buyer aggregate could have additional child entities, depending on your domain, as it does in the ordering microservice in the eShopOnContainers reference application.</span></span> <span data-ttu-id="ba9ef-203">La figura 9-9 illustra un caso in cui l'aggregazione Buyer contiene un'unica entità, come esempio di aggregazione contente solo una radice di aggregazione.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-203">Figure 9-9 just illustrates a case in which the buyer has a single entity, as an example of an aggregate that contains only an aggregate root.</span></span>

<span data-ttu-id="ba9ef-204">Per mantenere le aggregazioni separate in un modello di progettazione basata su domini, è buona norma impedire l'esplorazione diretta tra le aggregazioni e mantenere solo il campo della chiave esterna, come implementato nel [modello di dominio del microservizio degli ordini](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-204">In order to maintain separation of aggregates and keep clear boundaries between them, it is a good practice in a DDD domain model to disallow direct navigation between aggregates and only having the foreign key (FK) field, as implemented in the [Ordering microservice domain model](https://github.com/dotnet-architecture/eShopOnContainers/blob/master/src/Services/Ordering/Ordering.Domain/AggregatesModel/OrderAggregate/Order.cs) in eShopOnContainers.</span></span> <span data-ttu-id="ba9ef-205">L'entità Order include solo un campo di chiave esterna per l'aggregazione Buyer, ma non una proprietà di navigazione EF Core, come illustrato nel codice seguente:</span><span class="sxs-lookup"><span data-stu-id="ba9ef-205">The Order entity only has a FK field for the buyer, but not an EF Core navigation property, as shown in the following code:</span></span>

```csharp
public class Order : Entity, IAggregateRoot
{
    private DateTime _orderDate;
    public Address Address { get; private set; }
    private int? _buyerId; //FK pointing to a different aggregate root
    public OrderStatus OrderStatus { get; private set; }
    private readonly List<OrderItem> _orderItems;
    public IReadOnlyCollection<OrderItem> OrderItems => _orderItems;
    // ... Additional code
}
```

<span data-ttu-id="ba9ef-206">Identificare ed eseguire operazioni sulle aggregazioni richiede esperienza e ricerca.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-206">Identifying and working with aggregates requires research and experience.</span></span> <span data-ttu-id="ba9ef-207">Per altre informazioni, vedere l'elenco di Risorse aggiuntive seguente.</span><span class="sxs-lookup"><span data-stu-id="ba9ef-207">For more information, see the following Additional resources list.</span></span>

#### <a name="additional-resources"></a><span data-ttu-id="ba9ef-208">Risorse aggiuntive</span><span class="sxs-lookup"><span data-stu-id="ba9ef-208">Additional resources</span></span>

-   <span data-ttu-id="ba9ef-209">**Vaughn Vernon. Progettazione di aggregazione efficace - parte i: modellazione di una singola funzione di aggregazione**
    [*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_approfondimento\_AGGREGAZIONI\_parte \_pdf 1.*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-209">**Vaughn Vernon. Effective Aggregate Design - Part I: Modeling a Single Aggregate**
[*https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD\_COMMUNITY\_ESSAY\_AGGREGATES\_PART\_1.pdf*](https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_1.pdf)</span></span>

-   <span data-ttu-id="ba9ef-210">**Vaughn Vernon. Progettazione aggregazione efficace - parte II: Apportato aggregazioni lavorano insieme**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span><span class="sxs-lookup"><span data-stu-id="ba9ef-210">**Vaughn Vernon. Effective Aggregate Design - Part II: Making Aggregates Work Together**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_2.pdf> *</span></span>

-   <span data-ttu-id="ba9ef-211">**Vaughn Vernon. Progettazione aggregazione efficace - parte III: Ottenere informazioni dettagliate tramite l'individuazione**
    *<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span><span class="sxs-lookup"><span data-stu-id="ba9ef-211">**Vaughn Vernon. Effective Aggregate Design - Part III: Gaining Insight Through Discovery**
*<https://vaughnvernon.co/wordpress/wp-content/uploads/2014/10/DDD_COMMUNITY_ESSAY_AGGREGATES_PART_3.pdf> *</span></span>

-   <span data-ttu-id="ba9ef-212">**Sergey Grybniak. Modelli di progettazione tattico DDD**
    [*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-212">**Sergey Grybniak. DDD Tactical Design Patterns**
[*https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part*](https://www.codeproject.com/Articles/1164363/Domain-Driven-Design-Tactical-Design-Patterns-Part)</span></span>

-   <span data-ttu-id="ba9ef-213">**Chris Richardson. Lo sviluppo di Microservizi transazionale utilizzando funzioni di aggregazione**
    [*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-213">**Chris Richardson. Developing Transactional Microservices Using Aggregates**
[*https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson*](https://www.infoq.com/articles/microservices-aggregates-events-cqrs-part-1-richardson)</span></span>

-   <span data-ttu-id="ba9ef-214">**DevIQ. Il modello di aggregazione**
    [*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-214">**DevIQ. The Aggregate pattern**
[*http://deviq.com/aggregate-pattern/*](http://deviq.com/aggregate-pattern/)</span></span>


>[!div class="step-by-step"]
<span data-ttu-id="ba9ef-215">[Precedente] (ddd-oriented-microservice.md) [Successivo] (net-core-microservice-domain-model.md)</span><span class="sxs-lookup"><span data-stu-id="ba9ef-215">[Previous] (ddd-oriented-microservice.md) [Next] (net-core-microservice-domain-model.md)</span></span>
