---
title: Suggerimenti per l'implementazione del modello asincrono basato su eventi
ms.date: 03/30/2017
ms.technology: dotnet-standard
helpviewer_keywords:
- Event-based Asynchronous Pattern
- ProgressChangedEventArgs class
- BackgroundWorker component
- events [.NET Framework], asynchronous
- AsyncOperationManager class
- threading [.NET Framework], asynchronous features
- AsyncOperation class
- AsyncCompletedEventArgs class
ms.assetid: 4acd2094-4f46-4eff-9190-92d0d9ff47db
ms.openlocfilehash: 439b862612d7997c9277ffb2cf4f15b14bd0b106
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 03/15/2020
ms.locfileid: "78156049"
---
# <a name="best-practices-for-implementing-the-event-based-asynchronous-pattern"></a><span data-ttu-id="913fd-102">Suggerimenti per l'implementazione del modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-102">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>
<span data-ttu-id="913fd-103">Il modello asincrono basato su eventi offre un sistema efficace per l'esposizione del comportamento asincrono nelle classi attraverso una semantica nota di eventi e delegati.</span><span class="sxs-lookup"><span data-stu-id="913fd-103">The Event-based Asynchronous Pattern provides you with an effective way to expose asynchronous behavior in classes, with familiar event and delegate semantics.</span></span> <span data-ttu-id="913fd-104">Per implementare tale modello, è necessario soddisfare alcuni requisiti comportamentali specifici.</span><span class="sxs-lookup"><span data-stu-id="913fd-104">To implement Event-based Asynchronous Pattern, you need to follow some specific behavioral requirements.</span></span> <span data-ttu-id="913fd-105">Nelle sezioni riportate di seguito vengono illustrati i requisiti e le indicazioni da tenere presenti per l'implementazione di una classe che segue il modello asincrono basato su eventi.</span><span class="sxs-lookup"><span data-stu-id="913fd-105">The following sections describe requirements and guidelines you should consider when you implement a class that follows the Event-based Asynchronous Pattern.</span></span>  
  
 <span data-ttu-id="913fd-106">Per informazioni generali, vedere [Implementazione del modello asincrono basato su eventi](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="913fd-106">For an overview, see [Implementing the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="required-behavioral-guarantees"></a><span data-ttu-id="913fd-107">Garanzie comportamentali richieste</span><span class="sxs-lookup"><span data-stu-id="913fd-107">Required Behavioral Guarantees</span></span>  
 <span data-ttu-id="913fd-108">Se si implementa il modello asincrono basato su eventi, è necessario fornire garanzie sul comportamento della classe e sull'affidabilità di tale comportamento per i client.</span><span class="sxs-lookup"><span data-stu-id="913fd-108">If you implement the Event-based Asynchronous Pattern, you must provide a number of guarantees to ensure that your class will behave properly and clients of your class can rely on such behavior.</span></span>  
  
### <a name="completion"></a><span data-ttu-id="913fd-109">Completion</span><span class="sxs-lookup"><span data-stu-id="913fd-109">Completion</span></span>  
 <span data-ttu-id="913fd-110">Richiamare sempre il <em>MethodName</em>**Completed** gestore dell'evento quando si dispone di completamento, un errore o un annullamento.</span><span class="sxs-lookup"><span data-stu-id="913fd-110">Always invoke the <em>MethodName</em>**Completed** event handler when you have successful completion, an error, or a cancellation.</span></span> <span data-ttu-id="913fd-111">È infatti consigliabile che le applicazioni non si trovino mai in una situazione permanente di inattività nella quale il completamento non si verifica mai.</span><span class="sxs-lookup"><span data-stu-id="913fd-111">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span> <span data-ttu-id="913fd-112">Fa eccezione a questa regola il caso in cui l'operazione asincrona stessa sia progettata per non essere mai completata.</span><span class="sxs-lookup"><span data-stu-id="913fd-112">One exception to this rule is if the asynchronous operation itself is designed so that it never completes.</span></span>  
  
### <a name="completed-event-and-eventargs"></a><span data-ttu-id="913fd-113">Eventi Completed e classi EventArgs</span><span class="sxs-lookup"><span data-stu-id="913fd-113">Completed Event and EventArgs</span></span>  
 <span data-ttu-id="913fd-114">Per ogni metodo MethodName Async separato, applicare i requisiti di progettazione seguenti:For each separate <em>MethodName</em>**Async** method, apply the following design requirements:</span><span class="sxs-lookup"><span data-stu-id="913fd-114">For each separate <em>MethodName</em>**Async** method, apply the following design requirements:</span></span>  
  
- <span data-ttu-id="913fd-115">Definire un <em>evento NomeMetodo</em>**Completed** nella stessa classe del metodo.</span><span class="sxs-lookup"><span data-stu-id="913fd-115">Define a <em>MethodName</em>**Completed** event on the same class as the method.</span></span>  
  
- <span data-ttu-id="913fd-116">Definire <xref:System.EventArgs> una classe e il delegato associato per l'evento <em>NomeMetodo</em>**Completed** che deriva dalla <xref:System.ComponentModel.AsyncCompletedEventArgs> classe.</span><span class="sxs-lookup"><span data-stu-id="913fd-116">Define an <xref:System.EventArgs> class and accompanying delegate for the <em>MethodName</em>**Completed** event that derives from the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span> <span data-ttu-id="913fd-117">Il nome della classe predefinita deve essere nel formato <em>NomeMetodo</em>**CompletedEventArgs**.</span><span class="sxs-lookup"><span data-stu-id="913fd-117">The default class name should be of the form <em>MethodName</em>**CompletedEventArgs**.</span></span>  
  
- <span data-ttu-id="913fd-118">Verificare che la classe <xref:System.EventArgs> sia specifica dei valori restituiti del metodo <em>NomeMetodo</em>.</span><span class="sxs-lookup"><span data-stu-id="913fd-118">Ensure that the <xref:System.EventArgs> class is specific to the return values of the <em>MethodName</em> method.</span></span> <span data-ttu-id="913fd-119">Quando si usa la classe <xref:System.EventArgs>, è consigliabile non richiedere mai agli sviluppatori di eseguire il cast del risultato.</span><span class="sxs-lookup"><span data-stu-id="913fd-119">When you use the <xref:System.EventArgs> class, you should never require developers to cast the result.</span></span>  
  
     <span data-ttu-id="913fd-120">Nell'esempio di codice seguente vengono illustrate rispettivamente un'implementazione valida e non valida del requisito di progettazione in questione.</span><span class="sxs-lookup"><span data-stu-id="913fd-120">The following code example shows good and bad implementation of this design requirement respectively.</span></span>  
  
```csharp  
// Good design  
private void Form1_MethodNameCompleted(object sender, xxxCompletedEventArgs e)
{
    DemoType result = e.Result;  
}  
  
// Bad design  
private void Form1_MethodNameCompleted(object sender, MethodNameCompletedEventArgs e)
{
    DemoType result = (DemoType)(e.Result);  
}  
```  
  
- <span data-ttu-id="913fd-121">Non definire una classe <xref:System.EventArgs> per restituire metodi che restituiscono `void`.</span><span class="sxs-lookup"><span data-stu-id="913fd-121">Do not define an <xref:System.EventArgs> class for returning methods that return `void`.</span></span> <span data-ttu-id="913fd-122">Usare invece un'istanza della classe <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="913fd-122">Instead, use an instance of the <xref:System.ComponentModel.AsyncCompletedEventArgs> class.</span></span>  
  
- <span data-ttu-id="913fd-123">Assicurarsi di generare sempre l'evento <em>NomeMetodo</em>**completato.**</span><span class="sxs-lookup"><span data-stu-id="913fd-123">Ensure that you always raise the <em>MethodName</em>**Completed** event.</span></span> <span data-ttu-id="913fd-124">Questo evento deve essere generato in caso di corretto completamento, errore o annullamento.</span><span class="sxs-lookup"><span data-stu-id="913fd-124">This event should be raised on successful completion, on an error, or on cancellation.</span></span> <span data-ttu-id="913fd-125">È infatti consigliabile che le applicazioni non si trovino mai in una situazione permanente di inattività nella quale il completamento non si verifica mai.</span><span class="sxs-lookup"><span data-stu-id="913fd-125">Applications should never encounter a situation where they remain idle and completion never occurs.</span></span>  
  
- <span data-ttu-id="913fd-126">Assicurarsi di intercettare le eccezioni che si verificano nell'operazione asincrona e assegnare l'eccezione intercettata alla proprietà <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="913fd-126">Ensure that you catch any exceptions that occur in the asynchronous operation and assign the caught exception to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="913fd-127">Se si è verificato un errore durante il completamento dell'attività, è possibile che i risultati non siano accessibili.</span><span class="sxs-lookup"><span data-stu-id="913fd-127">If there was an error completing the task, the results should not be accessible.</span></span> <span data-ttu-id="913fd-128">Quando la proprietà <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> non è `null`, assicurarsi che l'accesso a qualsiasi proprietà nella struttura <xref:System.EventArgs> generi un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="913fd-128">When the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property is not `null`, ensure that accessing any property in the <xref:System.EventArgs> structure raises an exception.</span></span> <span data-ttu-id="913fd-129">Usare il metodo <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> per eseguire questa verifica.</span><span class="sxs-lookup"><span data-stu-id="913fd-129">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method to perform this verification.</span></span>  
  
- <span data-ttu-id="913fd-130">Modellare un timeout come errore.</span><span class="sxs-lookup"><span data-stu-id="913fd-130">Model a time out as an error.</span></span> <span data-ttu-id="913fd-131">Quando si verifica un timeout, generare il <xref:System.TimeoutException> <em>NomeMetodo</em>**Completed** evento e assegnare un alla <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> proprietà.</span><span class="sxs-lookup"><span data-stu-id="913fd-131">When a time out occurs, raise the <em>MethodName</em>**Completed** event and assign a <xref:System.TimeoutException> to the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> property.</span></span>  
  
- <span data-ttu-id="913fd-132">Se la classe supporta più chiamate simultanee, assicurarsi che l'evento <em>NomeMetodo</em>**Completato** contenga l'oggetto appropriato. `userSuppliedState`</span><span class="sxs-lookup"><span data-stu-id="913fd-132">If your class supports multiple concurrent invocations, ensure that the <em>MethodName</em>**Completed** event contains the appropriate `userSuppliedState` object.</span></span>  
  
- <span data-ttu-id="913fd-133">Assicurarsi che l'evento <em>NomeMetodo</em>**Completed** venga generato nel thread appropriato e nel momento appropriato del ciclo di vita dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-133">Ensure that the <em>MethodName</em>**Completed** event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="913fd-134">Per altre informazioni, vedere la sezione Thread e contesti.</span><span class="sxs-lookup"><span data-stu-id="913fd-134">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="simultaneously-executing-operations"></a><span data-ttu-id="913fd-135">Esecuzione simultanea di operazioni</span><span class="sxs-lookup"><span data-stu-id="913fd-135">Simultaneously Executing Operations</span></span>  
  
- <span data-ttu-id="913fd-136">Se la classe supporta più chiamate simultanee, consentire allo sviluppatore di tenere traccia di ogni chiamata separatamente definendo l'overload <em>MethodName</em>**Async** che accetta un parametro di stato con valori di oggetto, o ID attività, denominato `userSuppliedState`.</span><span class="sxs-lookup"><span data-stu-id="913fd-136">If your class supports multiple concurrent invocations, enable the developer to track each invocation separately by defining the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, called `userSuppliedState`.</span></span> <span data-ttu-id="913fd-137">Questo parametro deve essere sempre l'ultimo parametro nella firma del metodo <em>MethodName</em>**Async.**</span><span class="sxs-lookup"><span data-stu-id="913fd-137">This parameter should always be the last parameter in the <em>MethodName</em>**Async** method's signature.</span></span>  
  
- <span data-ttu-id="913fd-138">Se la classe definisce l'overload <em>MethodName</em>**Async** che accetta un parametro di stato con valori di oggetto o un ID attività, assicurarsi di tenere traccia della durata dell'operazione con tale ID attività e di fornirlo nuovamente nel gestore di completamento.</span><span class="sxs-lookup"><span data-stu-id="913fd-138">If your class defines the <em>MethodName</em>**Async** overload that takes an object-valued state parameter, or task ID, be sure to track the lifetime of the operation with that task ID, and be sure to provide it back into the completion handler.</span></span> <span data-ttu-id="913fd-139">Per l'esecuzione di tali operazioni sono disponibili classi di supporto specifiche.</span><span class="sxs-lookup"><span data-stu-id="913fd-139">There are helper classes available to assist.</span></span> <span data-ttu-id="913fd-140">Per altre informazioni sulla gestione della concorrenza, vedere [Procedura: implementare un componente che supporta il modello asincrono basato su eventi](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="913fd-140">For more information on concurrency management, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
- <span data-ttu-id="913fd-141">Se la classe**Async** definisce il metodo <em>MethodName</em>**Async** senza il parametro state e non supporta più chiamate simultanee, assicurarsi che qualsiasi tentativo di richiamare <em>MethodName</em>**Async** prima del completamento della chiamata <em>asincrona MethodName</em>precedente generi un oggetto <xref:System.InvalidOperationException>.</span><span class="sxs-lookup"><span data-stu-id="913fd-141">If your class defines the <em>MethodName</em>**Async** method without the state parameter, and it does not support multiple concurrent invocations, ensure that any attempt to invoke <em>MethodName</em>**Async** before the prior <em>MethodName</em>**Async** invocation has completed raises an <xref:System.InvalidOperationException>.</span></span>  
  
- <span data-ttu-id="913fd-142">In generale, non generare un'eccezione se `userSuppliedState` il <em>metodo MethodName</em>**Async** senza il parametro viene richiamato più volte in modo che siano presenti più operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="913fd-142">In general, do not raise an exception if the <em>MethodName</em>**Async** method without the `userSuppliedState` parameter is invoked multiple times so that there are multiple outstanding operations.</span></span> <span data-ttu-id="913fd-143">È possibile generare un'eccezione quando la classe non può gestire questa situazione, ma si presuppone che gli sviluppatori possano gestire i diversi callback indistinguibili in corso.</span><span class="sxs-lookup"><span data-stu-id="913fd-143">You can raise an exception when your class explicitly cannot handle that situation, but assume that developers can handle these multiple indistinguishable callbacks</span></span>  
  
### <a name="accessing-results"></a><span data-ttu-id="913fd-144">Accesso ai risultati</span><span class="sxs-lookup"><span data-stu-id="913fd-144">Accessing Results</span></span>  
  
- <span data-ttu-id="913fd-145">Se durante l'esecuzione dell'operazione asincrona si è verificato un errore, è possibile che i risultati non siano accessibili.</span><span class="sxs-lookup"><span data-stu-id="913fd-145">If there was an error during execution of the asynchronous operation, the results should not be accessible.</span></span> <span data-ttu-id="913fd-146">Verificare che l'accesso a qualsiasi proprietà in <xref:System.ComponentModel.AsyncCompletedEventArgs> quando <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> non è `null` generi l'eccezione a cui fa riferimento <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span><span class="sxs-lookup"><span data-stu-id="913fd-146">Ensure that accessing any property in the <xref:System.ComponentModel.AsyncCompletedEventArgs> when <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A> is not `null` raises the exception referenced by <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A>.</span></span> <span data-ttu-id="913fd-147">La classe <xref:System.ComponentModel.AsyncCompletedEventArgs> fornisce il metodo <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> a questo scopo.</span><span class="sxs-lookup"><span data-stu-id="913fd-147">The <xref:System.ComponentModel.AsyncCompletedEventArgs> class provides the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A> method for this purpose.</span></span>  
  
- <span data-ttu-id="913fd-148">Assicurarsi che i tentativi di accesso al risultato generino un'eccezione di tipo <xref:System.InvalidOperationException> che segnala l'avvenuto annullamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-148">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="913fd-149">Usare il metodo <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> per eseguire questa verifica.</span><span class="sxs-lookup"><span data-stu-id="913fd-149">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
### <a name="progress-reporting"></a><span data-ttu-id="913fd-150">Report di stato</span><span class="sxs-lookup"><span data-stu-id="913fd-150">Progress Reporting</span></span>  
  
- <span data-ttu-id="913fd-151">Garantire il supporto della generazione di report sullo stato di avanzamento, se possibile,</span><span class="sxs-lookup"><span data-stu-id="913fd-151">Support progress reporting, if possible.</span></span> <span data-ttu-id="913fd-152">per consentire agli sviluppatori di offrire prestazioni ottimali dell'applicazione durante l'utilizzo della classe.</span><span class="sxs-lookup"><span data-stu-id="913fd-152">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="913fd-153">Se si implementa un **ProgressChanged** o <em>NomeMetodo</em>**ProgressChanged** evento, assicurarsi che non sono presenti tali eventi generati per una particolare operazione asincrona dopo che l'operazione <em>MethodName</em>**Completed** evento è stato generato.</span><span class="sxs-lookup"><span data-stu-id="913fd-153">If you implement a **ProgressChanged** or <em>MethodName</em>**ProgressChanged** event, ensure that there are no such events raised for a particular asynchronous operation after that operation's <em>MethodName</em>**Completed** event has been raised.</span></span>  
  
- <span data-ttu-id="913fd-154">In caso di popolamento della classe <xref:System.ComponentModel.ProgressChangedEventArgs> standard, accertarsi che la proprietà <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> possa essere sempre interpretata come percentuale.</span><span class="sxs-lookup"><span data-stu-id="913fd-154">If the standard <xref:System.ComponentModel.ProgressChangedEventArgs> is being populated, ensure that the <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> can always be interpreted as a percentage.</span></span> <span data-ttu-id="913fd-155">Non è necessario che il valore di percentuale sia preciso, purché si tratti di un valore di percentuale.</span><span class="sxs-lookup"><span data-stu-id="913fd-155">The percentage does not need to be accurate, but it should represent a percentage.</span></span> <span data-ttu-id="913fd-156">Se l'unità di misura dei report sullo stato di avanzamento deve essere diversa da una percentuale, derivare una classe dalla classe <xref:System.ComponentModel.ProgressChangedEventArgs> e lasciare impostato su 0 il valore di <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A>.</span><span class="sxs-lookup"><span data-stu-id="913fd-156">If your progress reporting metric must be something other than a percentage, derive a class from the <xref:System.ComponentModel.ProgressChangedEventArgs> class and leave <xref:System.ComponentModel.ProgressChangedEventArgs.ProgressPercentage%2A> at 0.</span></span> <span data-ttu-id="913fd-157">Evitare di usare unità di misura dei report diverse dalla percentuale.</span><span class="sxs-lookup"><span data-stu-id="913fd-157">Avoid using a reporting metric other than a percentage.</span></span>  
  
- <span data-ttu-id="913fd-158">Verificare che l'evento `ProgressChanged` venga generato sul thread appropriato nel momento adeguato del ciclo di vita dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-158">Ensure that the `ProgressChanged` event is raised on the appropriate thread and at the appropriate time in the application lifecycle.</span></span> <span data-ttu-id="913fd-159">Per altre informazioni, vedere la sezione Thread e contesti.</span><span class="sxs-lookup"><span data-stu-id="913fd-159">For more information, see the Threading and Contexts section.</span></span>  
  
### <a name="isbusy-implementation"></a><span data-ttu-id="913fd-160">Implementazione della proprietà IsBusy</span><span class="sxs-lookup"><span data-stu-id="913fd-160">IsBusy Implementation</span></span>  
  
- <span data-ttu-id="913fd-161">Non esporre una proprietà `IsBusy` se la classe supporta più chiamate simultanee.</span><span class="sxs-lookup"><span data-stu-id="913fd-161">Do not expose an `IsBusy` property if your class supports multiple concurrent invocations.</span></span> <span data-ttu-id="913fd-162">I proxy dei servizi Web XML, ad esempio, non espongono una proprietà `IsBusy` in quanto supportano più chiamate simultanee dei metodi asincroni.</span><span class="sxs-lookup"><span data-stu-id="913fd-162">For example, XML Web service proxies do not expose an `IsBusy` property because they support multiple concurrent invocations of asynchronous methods.</span></span>  
  
- <span data-ttu-id="913fd-163">La `IsBusy` proprietà `true` deve essere restituita dopo che il <em>MethodName</em>**Async** metodo è stato chiamato e prima di <em>MethodName</em>**Completed** evento è stato generato.</span><span class="sxs-lookup"><span data-stu-id="913fd-163">The `IsBusy` property should return `true` after the <em>MethodName</em>**Async** method has been called and before the <em>MethodName</em>**Completed** event has been raised.</span></span> <span data-ttu-id="913fd-164">In caso contrario, deve restituire `false`.</span><span class="sxs-lookup"><span data-stu-id="913fd-164">Otherwise it should return `false`.</span></span> <span data-ttu-id="913fd-165">I componenti <xref:System.ComponentModel.BackgroundWorker> e <xref:System.Net.WebClient> sono esempi di classi che espongono una proprietà `IsBusy`.</span><span class="sxs-lookup"><span data-stu-id="913fd-165">The <xref:System.ComponentModel.BackgroundWorker> and <xref:System.Net.WebClient> components are examples of classes that expose an `IsBusy` property.</span></span>  
  
### <a name="cancellation"></a><span data-ttu-id="913fd-166">Annullamento</span><span class="sxs-lookup"><span data-stu-id="913fd-166">Cancellation</span></span>  
  
- <span data-ttu-id="913fd-167">Garantire il supporto dell'annullamento, se possibile,</span><span class="sxs-lookup"><span data-stu-id="913fd-167">Support cancellation, if possible.</span></span> <span data-ttu-id="913fd-168">per consentire agli sviluppatori di offrire prestazioni ottimali dell'applicazione durante l'utilizzo della classe.</span><span class="sxs-lookup"><span data-stu-id="913fd-168">This enables developers to provide a better application user experience when they use your class.</span></span>  
  
- <span data-ttu-id="913fd-169">In caso di annullamento, impostare il flag <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> nell'oggetto <xref:System.ComponentModel.AsyncCompletedEventArgs>.</span><span class="sxs-lookup"><span data-stu-id="913fd-169">In the case of cancellation, set the <xref:System.ComponentModel.AsyncCompletedEventArgs.Cancelled%2A> flag in the <xref:System.ComponentModel.AsyncCompletedEventArgs> object.</span></span>  
  
- <span data-ttu-id="913fd-170">Assicurarsi che i tentativi di accesso al risultato generino un'eccezione di tipo <xref:System.InvalidOperationException> che segnala l'avvenuto annullamento dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-170">Ensure that any attempt to access the result raises an <xref:System.InvalidOperationException> stating that the operation was canceled.</span></span> <span data-ttu-id="913fd-171">Usare il metodo <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> per eseguire questa verifica.</span><span class="sxs-lookup"><span data-stu-id="913fd-171">Use the <xref:System.ComponentModel.AsyncCompletedEventArgs.RaiseExceptionIfNecessary%2A?displayProperty=nameWithType> method to perform this verification.</span></span>  
  
- <span data-ttu-id="913fd-172">Verificare che le chiamate a un metodo di annullamento vengano eseguite correttamente senza mai generare un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="913fd-172">Ensure that calls to a cancellation method always return successfully, and never raise an exception.</span></span> <span data-ttu-id="913fd-173">Generalmente, a un client viene notificato se un'operazione è realmente annullabile in qualsiasi momento mentre non viene notificato se un annullamento già avviato ha avuto esito positivo.</span><span class="sxs-lookup"><span data-stu-id="913fd-173">In general, a client is not notified as to whether an operation is truly cancelable at any given time, and is not notified as to whether a previously issued cancellation has succeeded.</span></span> <span data-ttu-id="913fd-174">All'applicazione viene invece sempre notificato l'avvenuto annullamento, poiché lo stato di completamento dipende anche dall'applicazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-174">However, the application will always be given notification when a cancellation succeeded, because the application takes part in the completion status.</span></span>  
  
- <span data-ttu-id="913fd-175">Generare l'evento <em>NomeMetodo</em>**Completed** quando l'operazione viene annullata.</span><span class="sxs-lookup"><span data-stu-id="913fd-175">Raise the <em>MethodName</em>**Completed** event when the operation is canceled.</span></span>  
  
### <a name="errors-and-exceptions"></a><span data-ttu-id="913fd-176">Errori ed eccezioni</span><span class="sxs-lookup"><span data-stu-id="913fd-176">Errors and Exceptions</span></span>  
  
- <span data-ttu-id="913fd-177">Intercettare le eccezioni che si verificano nell'operazione asincrona e impostare il valore della proprietà <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> su tali eccezioni.</span><span class="sxs-lookup"><span data-stu-id="913fd-177">Catch any exceptions that occur in the asynchronous operation and set the value of the <xref:System.ComponentModel.AsyncCompletedEventArgs.Error%2A?displayProperty=nameWithType> property to that exception.</span></span>  
  
### <a name="threading-and-contexts"></a><span data-ttu-id="913fd-178">Thread e contesti</span><span class="sxs-lookup"><span data-stu-id="913fd-178">Threading and Contexts</span></span>  
 <span data-ttu-id="913fd-179">Per un corretto funzionamento della classe, è fondamentale che i gestori eventi del client siano chiamati sul thread o sul contesto appropriato per il modello di applicazione specifico, incluse le applicazioni ASP.NET e Windows Forms.</span><span class="sxs-lookup"><span data-stu-id="913fd-179">For correct operation of your class, it is critical that the client's event handlers are invoked on the proper thread or context for the given application model, including ASP.NET and Windows Forms applications.</span></span> <span data-ttu-id="913fd-180">Per garantire il comportamento corretto della classe asincrona con qualsiasi modello di applicazione sono disponibili due classi di supporto, <xref:System.ComponentModel.AsyncOperation> e <xref:System.ComponentModel.AsyncOperationManager>.</span><span class="sxs-lookup"><span data-stu-id="913fd-180">Two important helper classes are provided to ensure that your asynchronous class behaves correctly under any application model: <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager>.</span></span>  
  
 <span data-ttu-id="913fd-181"><xref:System.ComponentModel.AsyncOperationManager> fornisce un metodo, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, che restituisce un oggetto <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="913fd-181"><xref:System.ComponentModel.AsyncOperationManager> provides one method, <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A>, which returns an <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="913fd-182"><xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> Le chiamate al metodo <em>MethodName</em>**Async** e la classe utilizza l'oggetto restituito per tenere traccia della durata dell'attività asincrona. <xref:System.ComponentModel.AsyncOperation></span><span class="sxs-lookup"><span data-stu-id="913fd-182">Your <em>MethodName</em>**Async** method calls <xref:System.ComponentModel.AsyncOperationManager.CreateOperation%2A> and your class uses the returned <xref:System.ComponentModel.AsyncOperation> to track the lifetime of the asynchronous task.</span></span>  
  
 <span data-ttu-id="913fd-183">Per generare report destinati al client sullo stato di avanzamento, sui risultati incrementali e sul completamento, chiamare i metodi <xref:System.ComponentModel.AsyncOperation.Post%2A> e <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> sull'oggetto <xref:System.ComponentModel.AsyncOperation>.</span><span class="sxs-lookup"><span data-stu-id="913fd-183">To report progress, incremental results, and completion to the client, call the <xref:System.ComponentModel.AsyncOperation.Post%2A> and <xref:System.ComponentModel.AsyncOperation.OperationCompleted%2A> methods on the <xref:System.ComponentModel.AsyncOperation>.</span></span> <span data-ttu-id="913fd-184"><xref:System.ComponentModel.AsyncOperation> è responsabile del marshalling delle chiamate sui gestori eventi del client al thread o al contesto appropriato.</span><span class="sxs-lookup"><span data-stu-id="913fd-184"><xref:System.ComponentModel.AsyncOperation> is responsible for marshaling calls to the client's event handlers to the proper thread or context.</span></span>  
  
> [!NOTE]
> <span data-ttu-id="913fd-185">È possibile aggirare queste regole se si vuole esplicitamente evitare l'uso dei criteri del modello di applicazione, pur usufruendo degli altri vantaggi derivanti dal modello asincrono basato su eventi.</span><span class="sxs-lookup"><span data-stu-id="913fd-185">You can circumvent these rules if you explicitly want to go against the policy of the application model, but still benefit from the other advantages of using the Event-based Asynchronous Pattern.</span></span> <span data-ttu-id="913fd-186">È ad esempio possibile creare una classe threading Free operante in Windows Form,</span><span class="sxs-lookup"><span data-stu-id="913fd-186">For example, you may want a class operating in Windows Forms to be free threaded.</span></span> <span data-ttu-id="913fd-187">purché agli sviluppatori siano chiare le restrizioni implicate.</span><span class="sxs-lookup"><span data-stu-id="913fd-187">You can create a free threaded class, as long as developers understand the implied restrictions.</span></span> <span data-ttu-id="913fd-188">Le applicazioni console non sincronizzano l'esecuzione delle chiamate del metodo <xref:System.ComponentModel.AsyncOperation.Post%2A>.</span><span class="sxs-lookup"><span data-stu-id="913fd-188">Console applications do not synchronize the execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls.</span></span> <span data-ttu-id="913fd-189">L'ordine di generazione degli eventi `ProgressChanged` potrebbe quindi non essere corretto.</span><span class="sxs-lookup"><span data-stu-id="913fd-189">This can cause `ProgressChanged` events to be raised out of order.</span></span> <span data-ttu-id="913fd-190">Se si vuole l'esecuzione serializzata delle chiamate al metodo <xref:System.ComponentModel.AsyncOperation.Post%2A>, implementare e installare una classe <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="913fd-190">If you wish to have serialized execution of <xref:System.ComponentModel.AsyncOperation.Post%2A> calls, implement and install a <xref:System.Threading.SynchronizationContext?displayProperty=nameWithType> class.</span></span>  
  
 <span data-ttu-id="913fd-191">Per altre informazioni sull'uso di <xref:System.ComponentModel.AsyncOperation> e <xref:System.ComponentModel.AsyncOperationManager> per abilitare le operazioni asincrone, vedere [Procedura: implementare un componente che supporta il modello asincrono basato su eventi](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="913fd-191">For more information about using <xref:System.ComponentModel.AsyncOperation> and <xref:System.ComponentModel.AsyncOperationManager> to enable your asynchronous operations, see [How to: Implement a Component That Supports the Event-based Asynchronous Pattern](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md).</span></span>  
  
## <a name="guidelines"></a><span data-ttu-id="913fd-192">Indicazioni</span><span class="sxs-lookup"><span data-stu-id="913fd-192">Guidelines</span></span>  
  
- <span data-ttu-id="913fd-193">È preferibile che ogni chiamata a un metodo sia indipendente dalle altre.</span><span class="sxs-lookup"><span data-stu-id="913fd-193">Ideally, each method invocation should be independent of others.</span></span> <span data-ttu-id="913fd-194">Si consiglia di evitare di associare chiamate a risorse condivise.</span><span class="sxs-lookup"><span data-stu-id="913fd-194">You should avoid coupling invocations with shared resources.</span></span> <span data-ttu-id="913fd-195">Se le risorse devono essere condivise tra le chiamate, è necessario fornire un meccanismo di sincronizzazione adeguato nell'implementazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-195">If resources are to be shared among invocations, you will need to provide a proper synchronization mechanism in your implementation.</span></span>  
  
- <span data-ttu-id="913fd-196">Non sono consigliati progetti in cui al client sia richiesta l'implementazione della funzionalità di sincronizzazione.</span><span class="sxs-lookup"><span data-stu-id="913fd-196">Designs that require the client to implement synchronization are discouraged.</span></span> <span data-ttu-id="913fd-197">Si supponga il caso di un metodo asincrono che riceve un oggetto statico globale come parametro. Più chiamate simultanee a tale metodo potrebbero determinare il danneggiamento dei dati o deadlock.</span><span class="sxs-lookup"><span data-stu-id="913fd-197">For example, you could have an asynchronous method that receives a global static object as a parameter; multiple concurrent invocations of such a method could result in data corruption or deadlocks.</span></span>  
  
- <span data-ttu-id="913fd-198">Se si implementa un metodo con l'overload a più chiamate (`userState` nella firma), la classe dovrà gestire un insieme di stati utente, o ID attività, e le relative operazioni in sospeso.</span><span class="sxs-lookup"><span data-stu-id="913fd-198">If you implement a method with the multiple-invocation overload (`userState` in the signature), your class will need to manage a collection of user states, or task IDs, and their corresponding pending operations.</span></span> <span data-ttu-id="913fd-199">Questa raccolta deve essere protetta con aree `lock`, in quanto le varie chiamate aggiungono e rimuovono gli oggetti `userState` presenti al suo interno.</span><span class="sxs-lookup"><span data-stu-id="913fd-199">This collection should be protected with `lock` regions, because the various invocations add and remove `userState` objects in the collection.</span></span>  
  
- <span data-ttu-id="913fd-200">Riutilizzare le classi `CompletedEventArgs`, quando possibile e appropriato.</span><span class="sxs-lookup"><span data-stu-id="913fd-200">Consider reusing `CompletedEventArgs` classes where feasible and appropriate.</span></span> <span data-ttu-id="913fd-201">In tal caso, la denominazione non sarà coerente con il nome del metodo, poiché un determinato delegato e il tipo <xref:System.EventArgs> non saranno collegati a un unico metodo.</span><span class="sxs-lookup"><span data-stu-id="913fd-201">In this case, the naming is not consistent with the method name, because a given delegate and <xref:System.EventArgs> type are not tied to a single method.</span></span> <span data-ttu-id="913fd-202">Non è tuttavia accettabile imporre agli sviluppatori di eseguire il cast del valore recuperato da una proprietà sull'oggetto <xref:System.EventArgs>.</span><span class="sxs-lookup"><span data-stu-id="913fd-202">However, forcing developers to cast the value retrieved from a property on the <xref:System.EventArgs> is never acceptable.</span></span>  
  
- <span data-ttu-id="913fd-203">Se si sta creando una classe che deriva da <xref:System.ComponentModel.Component>, non implementare e installare la propria classe <xref:System.Threading.SynchronizationContext>.</span><span class="sxs-lookup"><span data-stu-id="913fd-203">If you are authoring a class that derives from <xref:System.ComponentModel.Component>, do not implement and install your own <xref:System.Threading.SynchronizationContext> class.</span></span> <span data-ttu-id="913fd-204">Sono i modelli di applicazione e non i componenti a controllare l'oggetto <xref:System.Threading.SynchronizationContext> usato.</span><span class="sxs-lookup"><span data-stu-id="913fd-204">Application models, not components, control the <xref:System.Threading.SynchronizationContext> that is used.</span></span>  
  
- <span data-ttu-id="913fd-205">L'uso di qualsiasi tipo di multithreading determina la potenziale esposizione a bug seri e complessi.</span><span class="sxs-lookup"><span data-stu-id="913fd-205">When you use multithreading of any sort, you potentially expose yourself to very serious and complex bugs.</span></span> <span data-ttu-id="913fd-206">Prima di implementare una soluzione che preveda l'uso del multithreading, vedere [Procedure consigliate per l'uso del threading gestito](../../../docs/standard/threading/managed-threading-best-practices.md).</span><span class="sxs-lookup"><span data-stu-id="913fd-206">Before implementing any solution that uses multithreading, see [Managed Threading Best Practices](../../../docs/standard/threading/managed-threading-best-practices.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="913fd-207">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="913fd-207">See also</span></span>

- <xref:System.ComponentModel.AsyncOperation>
- <xref:System.ComponentModel.AsyncOperationManager>
- <xref:System.ComponentModel.AsyncCompletedEventArgs>
- <xref:System.ComponentModel.ProgressChangedEventArgs>
- <xref:System.ComponentModel.BackgroundWorker>
- [<span data-ttu-id="913fd-208">Implementazione del modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-208">Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/implementing-the-event-based-asynchronous-pattern.md)
- <span data-ttu-id="913fd-209">[Event-based Asynchronous Pattern (EAP)](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md) (Modello asincrono basato su eventi, EAP)</span><span class="sxs-lookup"><span data-stu-id="913fd-209">[Event-based Asynchronous Pattern (EAP)](../../../docs/standard/asynchronous-programming-patterns/event-based-asynchronous-pattern-eap.md)</span></span>
- [<span data-ttu-id="913fd-210">Quando implementare il modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-210">Deciding When to Implement the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/deciding-when-to-implement-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="913fd-211">Suggerimenti per l'implementazione del modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-211">Best Practices for Implementing the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/best-practices-for-implementing-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="913fd-212">Procedura: usare componenti che supportano il modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-212">How to: Use Components That Support the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/how-to-use-components-that-support-the-event-based-asynchronous-pattern.md)
- [<span data-ttu-id="913fd-213">Procedura: implementare un componente che supporta il modello asincrono basato su eventi</span><span class="sxs-lookup"><span data-stu-id="913fd-213">How to: Implement a Component That Supports the Event-based Asynchronous Pattern</span></span>](../../../docs/standard/asynchronous-programming-patterns/component-that-supports-the-event-based-asynchronous-pattern.md)
