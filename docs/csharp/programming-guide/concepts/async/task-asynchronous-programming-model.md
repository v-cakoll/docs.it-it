---
title: Modello di programmazione asincrona dell'attività con async e await (C#)
description: Informazioni su quando e come usare la programmazione asincrona basata su attività, un approccio semplificato alla programmazione asincrona in C#.
ms.date: 05/22/2017
ms.assetid: 9bcf896a-5826-4189-8c1a-3e35fa08243a
ms.openlocfilehash: ddda97e9c77473120ed32b0e224b07d7c4d71b1e
ms.sourcegitcommit: 40de8df14289e1e05b40d6e5c1daabd3c286d70c
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/22/2020
ms.locfileid: "86925137"
---
# <a name="task-asynchronous-programming-model"></a><span data-ttu-id="63fda-103">Modello di programmazione asincrona attività</span><span class="sxs-lookup"><span data-stu-id="63fda-103">Task asynchronous programming model</span></span>

<span data-ttu-id="63fda-104">È possibile evitare colli di bottiglia nelle prestazioni e migliorare la risposta generale dell'applicazione utilizzando la programmazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="63fda-104">You can avoid performance bottlenecks and enhance the overall responsiveness of your application by using asynchronous programming.</span></span> <span data-ttu-id="63fda-105">Le tecniche tradizionali per la scrittura di applicazioni asincrone, tuttavia, possono essere complesse, rendendone difficile la scrittura, il debug e la gestione.</span><span class="sxs-lookup"><span data-stu-id="63fda-105">However, traditional techniques for writing asynchronous applications can be complicated, making them difficult to write, debug, and maintain.</span></span>

<span data-ttu-id="63fda-106">[C# 5](../../../whats-new/csharp-version-history.md#c-version-50) introduce un approccio semplificato, la programmazione asincrona, che sfrutta il supporto asincrono in .NET Framework 4.5 e versioni successive, .NET Core e Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="63fda-106">[C# 5](../../../whats-new/csharp-version-history.md#c-version-50) introduced a simplified approach, async programming, that leverages asynchronous support in the .NET Framework 4.5 and higher, .NET Core, and the Windows Runtime.</span></span> <span data-ttu-id="63fda-107">Il compilatore esegue il lavoro difficile che prima veniva svolto dallo sviluppatore e l'applicazione mantiene una struttura logica simile al codice sincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-107">The compiler does the difficult work that the developer used to do, and your application retains a logical structure that resembles synchronous code.</span></span> <span data-ttu-id="63fda-108">Di conseguenza, si ottengono tutti i vantaggi della programmazione asincrona con meno lavoro richiesto.</span><span class="sxs-lookup"><span data-stu-id="63fda-108">As a result, you get all the advantages of asynchronous programming with a fraction of the effort.</span></span>

<span data-ttu-id="63fda-109">In questo argomento viene fornita una panoramica di come e quando utilizzare la programmazione asincrona e vengono forniti collegamenti per supportare gli argomenti contenenti informazioni dettagliate ed esempi.</span><span class="sxs-lookup"><span data-stu-id="63fda-109">This topic provides an overview of when and how to use async programming and includes links to support topics that contain details and examples.</span></span>

## <a name="async-improves-responsiveness"></a><a name="BKMK_WhentoUseAsynchrony"></a><span data-ttu-id="63fda-110">Async migliora la velocità di risposta</span><span class="sxs-lookup"><span data-stu-id="63fda-110">Async improves responsiveness</span></span>

<span data-ttu-id="63fda-111">La modalità asincrona è essenziale per le attività che potenzialmente bloccano l'esecuzione, ad esempio l'accesso al Web.</span><span class="sxs-lookup"><span data-stu-id="63fda-111">Asynchrony is essential for activities that are potentially blocking, such as web access.</span></span> <span data-ttu-id="63fda-112">L'accesso a una risorsa Web può essere talvolta lento o ritardato.</span><span class="sxs-lookup"><span data-stu-id="63fda-112">Access to a web resource sometimes is slow or delayed.</span></span> <span data-ttu-id="63fda-113">Se questa attività viene bloccata in un processo sincrono, l'intera applicazione deve attendere.</span><span class="sxs-lookup"><span data-stu-id="63fda-113">If such an activity is blocked in a synchronous process, the entire application must wait.</span></span> <span data-ttu-id="63fda-114">In un processo asincrono l'applicazione può invece continuare con un altro lavoro che non dipende dalla risorsa Web finché l'attività di blocco non termina.</span><span class="sxs-lookup"><span data-stu-id="63fda-114">In an asynchronous process, the application can continue with other work that doesn't depend on the web resource until the potentially blocking task finishes.</span></span>

<span data-ttu-id="63fda-115">Nella tabella seguente sono mostrate le aree tipiche in cui la programmazione asincrona migliora la risposta.</span><span class="sxs-lookup"><span data-stu-id="63fda-115">The following table shows typical areas where asynchronous programming improves responsiveness.</span></span> <span data-ttu-id="63fda-116">Le API elencate da .NET e Windows Runtime contengono metodi che supportano la programmazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="63fda-116">The listed APIs from .NET and the Windows Runtime contain methods that support async programming.</span></span>

| <span data-ttu-id="63fda-117">Area dell'applicazione</span><span class="sxs-lookup"><span data-stu-id="63fda-117">Application area</span></span>    | <span data-ttu-id="63fda-118">Tipi .NET con metodi asincroni</span><span class="sxs-lookup"><span data-stu-id="63fda-118">.NET types with async methods</span></span>     | <span data-ttu-id="63fda-119">Tipi Windows Runtime con metodi asincroni</span><span class="sxs-lookup"><span data-stu-id="63fda-119">Windows Runtime types with async methods</span></span>  |
|---------------------|-----------------------------------|-------------------------------------------|
|<span data-ttu-id="63fda-120">Accesso Web</span><span class="sxs-lookup"><span data-stu-id="63fda-120">Web access</span></span>|<xref:System.Net.Http.HttpClient>|<xref:Windows.Web.Syndication.SyndicationClient>|
|<span data-ttu-id="63fda-121">Utilizzo dei file</span><span class="sxs-lookup"><span data-stu-id="63fda-121">Working with files</span></span>|<span data-ttu-id="63fda-122"><xref:System.IO.StreamWriter>, <xref:System.IO.StreamReader>, <xref:System.Xml.XmlReader></span><span class="sxs-lookup"><span data-stu-id="63fda-122"><xref:System.IO.StreamWriter>, <xref:System.IO.StreamReader>, <xref:System.Xml.XmlReader></span></span>|<xref:Windows.Storage.StorageFile>|
|<span data-ttu-id="63fda-123">Utilizzo di immagini</span><span class="sxs-lookup"><span data-stu-id="63fda-123">Working with images</span></span>||<span data-ttu-id="63fda-124"><xref:Windows.Media.Capture.MediaCapture>, <xref:Windows.Graphics.Imaging.BitmapEncoder>, <xref:Windows.Graphics.Imaging.BitmapDecoder></span><span class="sxs-lookup"><span data-stu-id="63fda-124"><xref:Windows.Media.Capture.MediaCapture>, <xref:Windows.Graphics.Imaging.BitmapEncoder>, <xref:Windows.Graphics.Imaging.BitmapDecoder></span></span>|
|<span data-ttu-id="63fda-125">Programmazione WCF</span><span class="sxs-lookup"><span data-stu-id="63fda-125">WCF programming</span></span>|[<span data-ttu-id="63fda-126">Operazioni sincrone e asincrone</span><span class="sxs-lookup"><span data-stu-id="63fda-126">Synchronous and Asynchronous Operations</span></span>](../../../../framework/wcf/synchronous-and-asynchronous-operations.md)||

<span data-ttu-id="63fda-127">La modalità asincrona è particolarmente importante per le applicazioni che accedono al thread dell'interfaccia utente poiché tutte le attività correlate all'interfaccia utente in genere condividono un thread.</span><span class="sxs-lookup"><span data-stu-id="63fda-127">Asynchrony proves especially valuable for applications that access the UI thread because all UI-related activity usually shares one thread.</span></span> <span data-ttu-id="63fda-128">Se un processo è bloccato in un'applicazione sincrona, tutte le attività saranno bloccate.</span><span class="sxs-lookup"><span data-stu-id="63fda-128">If any process is blocked in a synchronous application, all are blocked.</span></span> <span data-ttu-id="63fda-129">L'applicazione non risponde e si potrebbe pensare che si sia verificato un errore mentre si tratta solo di un'applicazione attesa.</span><span class="sxs-lookup"><span data-stu-id="63fda-129">Your application stops responding, and you might conclude that it has failed when instead it's just waiting.</span></span>

<span data-ttu-id="63fda-130">Quando si utilizzano i metodi asincroni, l'applicazione continua a rispondere all'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="63fda-130">When you use asynchronous methods, the application continues to respond to the UI.</span></span> <span data-ttu-id="63fda-131">È possibile ad esempio ridimensionare o ridurre a icona una finestra oppure è possibile chiudere l'applicazione se non si desidera attendere il completamento.</span><span class="sxs-lookup"><span data-stu-id="63fda-131">You can resize or minimize a window, for example, or you can close the application if you don't want to wait for it to finish.</span></span>

<span data-ttu-id="63fda-132">L'approccio basato su modalità asincrona aggiunge l'equivalente di una trasmissione automatica all'elenco di opzioni da cui è possibile scegliere quando si progettano operazioni asincrone.</span><span class="sxs-lookup"><span data-stu-id="63fda-132">The async-based approach adds the equivalent of an automatic transmission to the list of options that you can choose from when designing asynchronous operations.</span></span> <span data-ttu-id="63fda-133">In questo modo si ottengono tutti i vantaggi della programmazione asincrona tradizionale con meno lavoro richiesto allo sviluppatore.</span><span class="sxs-lookup"><span data-stu-id="63fda-133">That is, you get all the benefits of traditional asynchronous programming but with much less effort from the developer.</span></span>

## <a name="async-methods-are-easier-to-write"></a><a name="BKMK_HowtoWriteanAsyncMethod"></a><span data-ttu-id="63fda-134">I metodi asincroni sono più semplici da scrivere</span><span class="sxs-lookup"><span data-stu-id="63fda-134">Async methods are easier to write</span></span>

<span data-ttu-id="63fda-135">Le parole chiave [async](../../../language-reference/keywords/async.md) e [await](../../../language-reference/operators/await.md) in C# sono il punto centrale della programmazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="63fda-135">The [async](../../../language-reference/keywords/async.md) and [await](../../../language-reference/operators/await.md) keywords in C# are the heart of async programming.</span></span> <span data-ttu-id="63fda-136">Usando queste due parole chiave, è possibile usare le risorse in .NET Framework, .NET Core o i Windows Runtime per creare un metodo asincrono con la stessa facilità con cui si crea un metodo sincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-136">By using those two keywords, you can use resources in .NET Framework, .NET Core, or the Windows Runtime to create an asynchronous method almost as easily as you create a synchronous method.</span></span> <span data-ttu-id="63fda-137">I metodi asincroni definiti con la parola chiave `async` sono denominati *metodi asincroni*.</span><span class="sxs-lookup"><span data-stu-id="63fda-137">Asynchronous methods that you define by using the `async` keyword are referred to as *async methods*.</span></span>

<span data-ttu-id="63fda-138">Nell'esempio seguente viene illustrato un metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-138">The following example shows an async method.</span></span> <span data-ttu-id="63fda-139">Quasi tutti gli elementi del codice dovrebbero avere un aspetto familiare.</span><span class="sxs-lookup"><span data-stu-id="63fda-139">Almost everything in the code should look familiar to you.</span></span>

<span data-ttu-id="63fda-140">È possibile trovare il file di esempio completo Windows Presentation Foundation (WPF) alla fine di questo argomento e scaricare l'esempio dalla pagina [Async Sample: Example from "Asynchronous Programming with Async and Await"](https://docs.microsoft.com/samples/dotnet/samples/async-and-await-cs/) (Esempio di attività asincrona: Programmazione asincrona con async e await).</span><span class="sxs-lookup"><span data-stu-id="63fda-140">You can find a complete Windows Presentation Foundation (WPF) example file at the end of this topic, and you can download the sample from [Async Sample: Example from "Asynchronous Programming with Async and Await"](https://docs.microsoft.com/samples/dotnet/samples/async-and-await-cs/).</span></span>

```csharp
async Task<int> AccessTheWebAsync()
{
    // You need to add a reference to System.Net.Http to declare client.
    var client = new HttpClient();

    // GetStringAsync returns a Task<string>. That means that when you await the
    // task you'll get a string (urlContents).
    Task<string> getStringTask = client.GetStringAsync("https://docs.microsoft.com/dotnet");

    // You can do work here that doesn't rely on the string from GetStringAsync.
    DoIndependentWork();

    // The await operator suspends AccessTheWebAsync.
    //  - AccessTheWebAsync can't continue until getStringTask is complete.
    //  - Meanwhile, control returns to the caller of AccessTheWebAsync.
    //  - Control resumes here when getStringTask is complete.
    //  - The await operator then retrieves the string result from getStringTask.
    string urlContents = await getStringTask;

    // The return statement specifies an integer result.
    // Any methods that are awaiting AccessTheWebAsync retrieve the length value.
    return urlContents.Length;
}
```

<span data-ttu-id="63fda-141">Dall'esempio precedente è possibile dedurre diverse cose.</span><span class="sxs-lookup"><span data-stu-id="63fda-141">You can learn several practices from the preceding sample.</span></span> <span data-ttu-id="63fda-142">Partiamo, ad esempio, dalla firma del metodo</span><span class="sxs-lookup"><span data-stu-id="63fda-142">Start with the method signature.</span></span> <span data-ttu-id="63fda-143">che include il modificatore `async`.</span><span class="sxs-lookup"><span data-stu-id="63fda-143">It includes the `async` modifier.</span></span> <span data-ttu-id="63fda-144">Il tipo restituito è `Task<int>` (Per altre opzioni vedere la sezione "Tipi restituiti e parametri").</span><span class="sxs-lookup"><span data-stu-id="63fda-144">The return type is `Task<int>` (See "Return Types" section for more options).</span></span> <span data-ttu-id="63fda-145">Il nome del metodo finisce con `Async`.</span><span class="sxs-lookup"><span data-stu-id="63fda-145">The method name ends in `Async`.</span></span> <span data-ttu-id="63fda-146">Nel corpo del metodo `GetStringAsync` restituisce un oggetto `Task<string>`.</span><span class="sxs-lookup"><span data-stu-id="63fda-146">In the body of the method, `GetStringAsync` returns a `Task<string>`.</span></span> <span data-ttu-id="63fda-147">Ciò significa che quando si esegue `await` sull'attività si ottiene un oggetto `string` (`urlContents`).</span><span class="sxs-lookup"><span data-stu-id="63fda-147">That means that when you `await` the task you'll get a `string` (`urlContents`).</span></span>  <span data-ttu-id="63fda-148">Prima di mettere in attesa l'attività, è possibile eseguire operazioni che non si basano sull'oggetto `string` da `GetStringAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-148">Before awaiting the task, you can do work that doesn't rely on the `string` from `GetStringAsync`.</span></span>

<span data-ttu-id="63fda-149">Prestare attenzione all'operatore `await`</span><span class="sxs-lookup"><span data-stu-id="63fda-149">Pay close attention to the `await` operator.</span></span> <span data-ttu-id="63fda-150">che sospende `AccessTheWebAsync`;</span><span class="sxs-lookup"><span data-stu-id="63fda-150">It suspends `AccessTheWebAsync`;</span></span>

- <span data-ttu-id="63fda-151">`AccessTheWebAsync` non può continuare finché l'operazione `getStringTask` non è stata completata.</span><span class="sxs-lookup"><span data-stu-id="63fda-151">`AccessTheWebAsync` can't continue until `getStringTask` is complete.</span></span>
- <span data-ttu-id="63fda-152">Nel frattempo il controllo viene restituito al chiamante di `AccessTheWebAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-152">Meanwhile, control returns to the caller of `AccessTheWebAsync`.</span></span>
- <span data-ttu-id="63fda-153">Il controllo riprende qui quando l'operazione `getStringTask` è stata completata.</span><span class="sxs-lookup"><span data-stu-id="63fda-153">Control resumes here when `getStringTask` is complete.</span></span>
- <span data-ttu-id="63fda-154">In seguito l'operatore `await` recupera il risultato di `string` da `getStringTask`.</span><span class="sxs-lookup"><span data-stu-id="63fda-154">The `await` operator then retrieves the `string` result from `getStringTask`.</span></span>

<span data-ttu-id="63fda-155">L'istruzione return specifica un risultato intero.</span><span class="sxs-lookup"><span data-stu-id="63fda-155">The return statement specifies an integer result.</span></span> <span data-ttu-id="63fda-156">Tutti i metodi che mettono `AccessTheWebAsync` in attesa recuperano il valore della lunghezza.</span><span class="sxs-lookup"><span data-stu-id="63fda-156">Any methods that are awaiting `AccessTheWebAsync` retrieve the length value.</span></span>

<span data-ttu-id="63fda-157">Se `AccessTheWebAsync` non ha alcuna operazione da eseguire tra la chiamata di `GetStringAsync` e il relativo completamento, è possibile semplificare il codice chiamando l'istruzione singola seguente e rimanendo in attesa.</span><span class="sxs-lookup"><span data-stu-id="63fda-157">If `AccessTheWebAsync` doesn't have any work that it can do between calling `GetStringAsync` and awaiting its completion, you can simplify your code by calling and awaiting in the following single statement.</span></span>

```csharp
string urlContents = await client.GetStringAsync("https://docs.microsoft.com/dotnet");
```

<span data-ttu-id="63fda-158">Le seguenti caratteristiche riepilogano gli elementi che rendono l'esempio precedente un metodo asincrono:</span><span class="sxs-lookup"><span data-stu-id="63fda-158">The following characteristics summarize what makes the previous example an async method:</span></span>

- <span data-ttu-id="63fda-159">La firma del metodo include un modificatore `async`.</span><span class="sxs-lookup"><span data-stu-id="63fda-159">The method signature includes an `async` modifier.</span></span>
- <span data-ttu-id="63fda-160">Il nome di un metodo asincrono termina per convenzione con un suffisso "Async".</span><span class="sxs-lookup"><span data-stu-id="63fda-160">The name of an async method, by convention, ends with an "Async" suffix.</span></span>
- <span data-ttu-id="63fda-161">Il tipo restituito è uno dei seguenti:</span><span class="sxs-lookup"><span data-stu-id="63fda-161">The return type is one of the following types:</span></span>

  - <span data-ttu-id="63fda-162"><xref:System.Threading.Tasks.Task%601> se nel metodo è presente un'istruzione return in cui l'operando è di tipo `TResult`.</span><span class="sxs-lookup"><span data-stu-id="63fda-162"><xref:System.Threading.Tasks.Task%601> if your method has a return statement in which the operand has type `TResult`.</span></span>
  - <span data-ttu-id="63fda-163"><xref:System.Threading.Tasks.Task> se nel metodo non è presente un'istruzione return oppure è presente un'istruzione return senza l'operando.</span><span class="sxs-lookup"><span data-stu-id="63fda-163"><xref:System.Threading.Tasks.Task> if your method has no return statement or has a return statement with no operand.</span></span>
  - <span data-ttu-id="63fda-164">`void` se si sta scrivendo un gestore eventi asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-164">`void` if you're writing an async event handler.</span></span>
  - <span data-ttu-id="63fda-165">Qualsiasi altro tipo che ha un metodo `GetAwaiter` (a partire da C# 7.0).</span><span class="sxs-lookup"><span data-stu-id="63fda-165">Any other type that has a `GetAwaiter` method (starting with C# 7.0).</span></span>

  <span data-ttu-id="63fda-166">Per altre informazioni, vedere la sezione [Tipi restituiti e parametri](#BKMK_ReturnTypesandParameters).</span><span class="sxs-lookup"><span data-stu-id="63fda-166">For more information, see the [Return Types and Parameters](#BKMK_ReturnTypesandParameters) section.</span></span>

- <span data-ttu-id="63fda-167">Il metodo include in genere almeno un'espressione `await`, che contrassegna un punto in cui il metodo non può continuare fino a quando l'operazione asincrona in attesa non è stata completata.</span><span class="sxs-lookup"><span data-stu-id="63fda-167">The method usually includes at least one `await` expression, which marks a point where the method can't continue until the awaited asynchronous operation is complete.</span></span> <span data-ttu-id="63fda-168">Nel frattempo, il metodo viene sospeso e il controllo ritorna al chiamante del metodo.</span><span class="sxs-lookup"><span data-stu-id="63fda-168">In the meantime, the method is suspended, and control returns to the method's caller.</span></span> <span data-ttu-id="63fda-169">Nella sezione successiva di questo argomento viene illustrato quello che accade in corrispondenza del punto di sospensione.</span><span class="sxs-lookup"><span data-stu-id="63fda-169">The next section of this topic illustrates what happens at the suspension point.</span></span>

<span data-ttu-id="63fda-170">Nei metodi asincroni utilizzare le parole chiave e i tipi forniti per indicare l'operazione da eseguire e il compilatore esegue il resto dell'operazione, inclusa la traccia di cosa deve verificarsi quando il controllo viene restituito a un punto di attesa in un metodo sospeso.</span><span class="sxs-lookup"><span data-stu-id="63fda-170">In async methods, you use the provided keywords and types to indicate what you want to do, and the compiler does the rest, including keeping track of what must happen when control returns to an await point in a suspended method.</span></span> <span data-ttu-id="63fda-171">Alcuni processi di routine, come cicli e gestione delle eccezioni, possono essere difficili da gestire nel codice asincrono tradizionale.</span><span class="sxs-lookup"><span data-stu-id="63fda-171">Some routine processes, such as loops and exception handling, can be difficult to handle in traditional asynchronous code.</span></span> <span data-ttu-id="63fda-172">In un metodo asincrono scrivere questi elementi come in una soluzione sincrona e il problema viene risolto.</span><span class="sxs-lookup"><span data-stu-id="63fda-172">In an async method, you write these elements much as you would in a synchronous solution, and the problem is solved.</span></span>

<span data-ttu-id="63fda-173">Per altre informazioni su modalità asincrona nelle versioni precedenti di .NET Framework, vedere [TPL e la programmazione asincrona .NET Framework tradizionale](../../../../standard/parallel-programming/tpl-and-traditional-async-programming.md).</span><span class="sxs-lookup"><span data-stu-id="63fda-173">For more information about asynchrony in previous versions of .NET Framework, see [TPL and Traditional .NET Framework Asynchronous Programming](../../../../standard/parallel-programming/tpl-and-traditional-async-programming.md).</span></span>

## <a name="what-happens-in-an-async-method"></a><a name="BKMK_WhatHappensUnderstandinganAsyncMethod"></a><span data-ttu-id="63fda-174">Cosa accade in un metodo asincrono</span><span class="sxs-lookup"><span data-stu-id="63fda-174">What happens in an async method</span></span>

<span data-ttu-id="63fda-175">La cosa più importante da capire nella programmazione asincrona è il modo in cui il flusso del controllo si sposta da un metodo all'altro.</span><span class="sxs-lookup"><span data-stu-id="63fda-175">The most important thing to understand in asynchronous programming is how the control flow moves from method to method.</span></span> <span data-ttu-id="63fda-176">Nel diagramma seguente viene descritto il processo:</span><span class="sxs-lookup"><span data-stu-id="63fda-176">The following diagram leads you through the process:</span></span>

<span data-ttu-id="63fda-177">![Tracciare un programma asincrono](./media/task-asynchronous-programming-model/navigation-trace-async-program.png "NavigationTrace")</span><span class="sxs-lookup"><span data-stu-id="63fda-177">![Trace an async program](./media/task-asynchronous-programming-model/navigation-trace-async-program.png "NavigationTrace")</span></span>

<span data-ttu-id="63fda-178">I numeri nel diagramma corrispondono ai passaggi seguenti, avviati quando l'utente fa clic sul pulsante di avvio.</span><span class="sxs-lookup"><span data-stu-id="63fda-178">The numbers in the diagram correspond to the following steps, initiated when the user clicks the "start" button.</span></span>

1. <span data-ttu-id="63fda-179">Un gestore eventi chiama e attende il `AccessTheWebAsync` metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-179">An event handler calls and awaits the `AccessTheWebAsync` async method.</span></span>

2. <span data-ttu-id="63fda-180">`AccessTheWebAsync` crea un'istanza di <xref:System.Net.Http.HttpClient> e chiama il metodo asincrono <xref:System.Net.Http.HttpClient.GetStringAsync%2A> per scaricare il contenuto di un sito Web come stringa.</span><span class="sxs-lookup"><span data-stu-id="63fda-180">`AccessTheWebAsync` creates an <xref:System.Net.Http.HttpClient> instance and calls the <xref:System.Net.Http.HttpClient.GetStringAsync%2A> asynchronous method to download the contents of a website as a string.</span></span>

3. <span data-ttu-id="63fda-181">Si verifica un evento in `GetStringAsync` che ne sospende lo stato di avanzamento</span><span class="sxs-lookup"><span data-stu-id="63fda-181">Something happens in `GetStringAsync` that suspends its progress.</span></span> <span data-ttu-id="63fda-182">forse perché deve attendere il termine dello scaricamento di un sito Web o un'altra attività di blocco.</span><span class="sxs-lookup"><span data-stu-id="63fda-182">Perhaps it must wait for a website to download or some other blocking activity.</span></span> <span data-ttu-id="63fda-183">Per evitare di bloccare le risorse, `GetStringAsync` restituisce il controllo al chiamante `AccessTheWebAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-183">To avoid blocking resources, `GetStringAsync` yields control to its caller, `AccessTheWebAsync`.</span></span>

     <span data-ttu-id="63fda-184">`GetStringAsync` restituisce <xref:System.Threading.Tasks.Task%601>, dove `TResult` è una stringa e `AccessTheWebAsync` assegna l'attività alla variabile `getStringTask`.</span><span class="sxs-lookup"><span data-stu-id="63fda-184">`GetStringAsync` returns a <xref:System.Threading.Tasks.Task%601>, where `TResult` is a string, and `AccessTheWebAsync` assigns the task to the `getStringTask` variable.</span></span> <span data-ttu-id="63fda-185">L'attività rappresenta il processo in corso per la chiamata a `GetStringAsync`, con l'impegno di produrre un valore stringa effettivo a completamento del lavoro.</span><span class="sxs-lookup"><span data-stu-id="63fda-185">The task represents the ongoing process for the call to `GetStringAsync`, with a commitment to produce an actual string value when the work is complete.</span></span>

4. <span data-ttu-id="63fda-186">Poiché `getStringTask` non è stata ancora attesa, `AccessTheWebAsync` può continuare con altro lavoro che non dipende dal risultato finale ottenuto da `GetStringAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-186">Because `getStringTask` hasn't been awaited yet, `AccessTheWebAsync` can continue with other work that doesn't depend on the final result from `GetStringAsync`.</span></span> <span data-ttu-id="63fda-187">Tale lavoro è rappresentato da una chiamata al metodo sincrono `DoIndependentWork`.</span><span class="sxs-lookup"><span data-stu-id="63fda-187">That work is represented by a call to the synchronous method `DoIndependentWork`.</span></span>

5. <span data-ttu-id="63fda-188">`DoIndependentWork` è un metodo sincrono che esegue il proprio lavoro e lo restituisce al chiamante.</span><span class="sxs-lookup"><span data-stu-id="63fda-188">`DoIndependentWork` is a synchronous method that does its work and returns to its caller.</span></span>

6. <span data-ttu-id="63fda-189">`AccessTheWebAsync` ha esaurito il lavoro che può eseguire senza un risultato da `getStringTask`.</span><span class="sxs-lookup"><span data-stu-id="63fda-189">`AccessTheWebAsync` has run out of work that it can do without a result from `getStringTask`.</span></span> <span data-ttu-id="63fda-190">`AccessTheWebAsync` deve quindi calcolare e restituire la lunghezza della stringa scaricata, ma il metodo non può calcolare il valore finché quest'ultimo non contiene la stringa.</span><span class="sxs-lookup"><span data-stu-id="63fda-190">`AccessTheWebAsync` next wants to calculate and return the length of the downloaded string, but the method can't calculate that value until the method has the string.</span></span>

     <span data-ttu-id="63fda-191">Di conseguenza, `AccessTheWebAsync` utilizza un operatore await per sospendere lo stato di avanzamento e restituire il controllo al metodo che ha chiamato `AccessTheWebAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-191">Therefore, `AccessTheWebAsync` uses an await operator to suspend its progress and to yield control to the method that called `AccessTheWebAsync`.</span></span> <span data-ttu-id="63fda-192">`AccessTheWebAsync` restituisce `Task<int>` al chiamante.</span><span class="sxs-lookup"><span data-stu-id="63fda-192">`AccessTheWebAsync` returns a `Task<int>` to the caller.</span></span> <span data-ttu-id="63fda-193">L'attività rappresenta l'intenzione di produrre un risultato di tipo Integer che è la lunghezza della stringa scaricata.</span><span class="sxs-lookup"><span data-stu-id="63fda-193">The task represents a promise to produce an integer result that's the length of the downloaded string.</span></span>

    > [!NOTE]
    > <span data-ttu-id="63fda-194">Se l'operazione `GetStringAsync` (e quindi `getStringTask`) viene completata prima che `AccessTheWebAsync` la metta in attesa, il controllo resta a `AccessTheWebAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-194">If `GetStringAsync` (and therefore `getStringTask`) completes before `AccessTheWebAsync` awaits it, control remains in `AccessTheWebAsync`.</span></span> <span data-ttu-id="63fda-195">I costi per sospendere e tornare a `AccessTheWebAsync` sarebbero sprecati se il processo asincrono chiamato (`getStringTask`) fosse già completato e `AccessTheWebAsync` non dovesse attendere il risultato finale.</span><span class="sxs-lookup"><span data-stu-id="63fda-195">The expense of suspending and then returning to `AccessTheWebAsync` would be wasted if the called asynchronous process (`getStringTask`) has already completed and `AccessTheWebAsync` doesn't have to wait for the final result.</span></span>

     <span data-ttu-id="63fda-196">Nel chiamante (in questo esempio il gestore eventi), il modello di elaborazione continua.</span><span class="sxs-lookup"><span data-stu-id="63fda-196">Inside the caller (the event handler in this example), the processing pattern continues.</span></span> <span data-ttu-id="63fda-197">Il chiamante può eseguire altre attività che non dipendono dal risultato di `AccessTheWebAsync` prima di attendere tale risultato oppure può mettersi immediatamente in attesa.</span><span class="sxs-lookup"><span data-stu-id="63fda-197">The caller might do other work that doesn't depend on the result from `AccessTheWebAsync` before awaiting that result, or the caller might await immediately.</span></span>   <span data-ttu-id="63fda-198">Il gestore eventi è in attesa di `AccessTheWebAsync` e `AccessTheWebAsync` è in attesa di `GetStringAsync`.</span><span class="sxs-lookup"><span data-stu-id="63fda-198">The event handler is waiting for `AccessTheWebAsync`, and `AccessTheWebAsync` is waiting for `GetStringAsync`.</span></span>

7. <span data-ttu-id="63fda-199">`GetStringAsync` termina e produce un risultato di stringa.</span><span class="sxs-lookup"><span data-stu-id="63fda-199">`GetStringAsync` completes and produces a string result.</span></span> <span data-ttu-id="63fda-200">Il risultato di stringa non viene restituito dalla chiamata a `GetStringAsync` nel modo previsto.</span><span class="sxs-lookup"><span data-stu-id="63fda-200">The string result isn't returned by the call to `GetStringAsync` in the way that you might expect.</span></span> <span data-ttu-id="63fda-201">Tenere presente che il metodo non ha restituito un'attività al passaggio 3. Il risultato di stringa viene invece memorizzato nell'attività che rappresenta il completamento del metodo, ovvero `getStringTask`.</span><span class="sxs-lookup"><span data-stu-id="63fda-201">(Remember that the method already returned a task in step 3.) Instead, the string result is stored in the task that represents the completion of the method, `getStringTask`.</span></span> <span data-ttu-id="63fda-202">L'operatore await recupera il risultato da `getStringTask`.</span><span class="sxs-lookup"><span data-stu-id="63fda-202">The await operator retrieves the result from `getStringTask`.</span></span> <span data-ttu-id="63fda-203">L'istruzione di assegnazione assegna il risultato recuperato a `urlContents`.</span><span class="sxs-lookup"><span data-stu-id="63fda-203">The assignment statement assigns the retrieved result to `urlContents`.</span></span>

8. <span data-ttu-id="63fda-204">Quando `AccessTheWebAsync` ha il risultato di stringa, il metodo può calcolare la lunghezza della stringa.</span><span class="sxs-lookup"><span data-stu-id="63fda-204">When `AccessTheWebAsync` has the string result, the method can calculate the length of the string.</span></span> <span data-ttu-id="63fda-205">Il lavoro di `AccessTheWebAsync` è quindi completo e il gestore eventi in attesa può riprendere l'attività.</span><span class="sxs-lookup"><span data-stu-id="63fda-205">Then the work of `AccessTheWebAsync` is also complete, and the waiting event handler can resume.</span></span> <span data-ttu-id="63fda-206">Nell'esempio completo alla fine dell'argomento è possibile confermare che il gestore eventi recupera e stampa il valore del risultato di lunghezza.</span><span class="sxs-lookup"><span data-stu-id="63fda-206">In the full example at the end of the topic, you can confirm that the event handler retrieves and prints the value of the length result.</span></span>
<span data-ttu-id="63fda-207">Se non si ha familiarità con la programmazione asincrona, valutare la differenza tra il comportamento sincrono e asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-207">If you are new to asynchronous programming, take a minute to consider the difference between synchronous and asynchronous behavior.</span></span> <span data-ttu-id="63fda-208">Viene restituito un metodo sincrono quando il lavoro è completato (passaggio 5), ma un metodo asincrono restituisce un valore di attività quando il relativo lavoro viene sospeso (passaggi 3 e 6).</span><span class="sxs-lookup"><span data-stu-id="63fda-208">A synchronous method returns when its work is complete (step 5), but an async method returns a task value when its work is suspended (steps 3 and 6).</span></span> <span data-ttu-id="63fda-209">Una volta che il metodo asincrono completa l'operazione, l'attività viene contrassegnata come completata e il risultato, se disponibile, viene archiviato nell'attività.</span><span class="sxs-lookup"><span data-stu-id="63fda-209">When the async method eventually completes its work, the task is marked as completed and the result, if any, is stored in the task.</span></span>

<span data-ttu-id="63fda-210">Per altre informazioni sul flusso di controllo, vedere [Flusso di controllo in programmi asincroni (C#)](control-flow-in-async-programs.md).</span><span class="sxs-lookup"><span data-stu-id="63fda-210">For more information about control flow, see [Control Flow in Async Programs (C#)](control-flow-in-async-programs.md).</span></span>

## <a name="api-async-methods"></a><a name="BKMK_APIAsyncMethods"></a><span data-ttu-id="63fda-211">Metodi asincroni API</span><span class="sxs-lookup"><span data-stu-id="63fda-211">API async methods</span></span>

<span data-ttu-id="63fda-212">Metodi come `GetStringAsync` che supportano la programmazione asincrona</span><span class="sxs-lookup"><span data-stu-id="63fda-212">You might be wondering where to find methods such as `GetStringAsync` that support async programming.</span></span> <span data-ttu-id="63fda-213">.NET Framework 4,5 o versione successiva e .NET Core contengono molti membri che funzionano con `async` e `await` .</span><span class="sxs-lookup"><span data-stu-id="63fda-213">.NET Framework 4.5 or higher and .NET Core contain many members that work with `async` and `await`.</span></span> <span data-ttu-id="63fda-214">È possibile riconoscerli dal suffisso "Async" aggiunto al nome del membro e dal tipo restituito di <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601> .</span><span class="sxs-lookup"><span data-stu-id="63fda-214">You can recognize them by the "Async" suffix that's appended to the member name, and by their return type of <xref:System.Threading.Tasks.Task> or <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="63fda-215">Ad esempio, la classe `System.IO.Stream` contiene metodi come <xref:System.IO.Stream.CopyToAsync%2A>, <xref:System.IO.Stream.ReadAsync%2A> e <xref:System.IO.Stream.WriteAsync%2A> insieme ai metodi sincroni <xref:System.IO.Stream.CopyTo%2A>, <xref:System.IO.Stream.Read%2A> e <xref:System.IO.Stream.Write%2A>.</span><span class="sxs-lookup"><span data-stu-id="63fda-215">For example, the `System.IO.Stream` class contains methods such as <xref:System.IO.Stream.CopyToAsync%2A>, <xref:System.IO.Stream.ReadAsync%2A>, and <xref:System.IO.Stream.WriteAsync%2A> alongside the synchronous methods <xref:System.IO.Stream.CopyTo%2A>, <xref:System.IO.Stream.Read%2A>, and <xref:System.IO.Stream.Write%2A>.</span></span>

<span data-ttu-id="63fda-216">Windows Runtime contiene inoltre molti metodi che è possibile usare con `async` e `await` in app Windows.</span><span class="sxs-lookup"><span data-stu-id="63fda-216">The Windows Runtime also contains many methods that you can use with `async` and `await` in Windows apps.</span></span> <span data-ttu-id="63fda-217">Per altre informazioni, vedere [Threading e programmazione asincrona](/windows/uwp/threading-async/) per lo sviluppo UWP e [Programmazione asincrona (app Windows Store)](https://docs.microsoft.com/previous-versions/windows/apps/hh464924(v=win.10)) e [Quickstart: Calling asynchronous APIs in C# or Visual Basic](https://docs.microsoft.com/previous-versions/windows/apps/hh452713(v=win.10)) (Guida introduttiva: Chiamata di API asincrone in C# o Visual Basic) se si usano versioni precedenti di Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="63fda-217">For more information, see [Threading and async programming](/windows/uwp/threading-async/) for UWP development, and [Asynchronous programming (Windows Store apps)](https://docs.microsoft.com/previous-versions/windows/apps/hh464924(v=win.10)) and [Quickstart: Calling asynchronous APIs in C# or Visual Basic](https://docs.microsoft.com/previous-versions/windows/apps/hh452713(v=win.10)) if you use earlier versions of the Windows Runtime.</span></span>

## <a name="threads"></a><a name="BKMK_Threads"></a><span data-ttu-id="63fda-218">Thread</span><span class="sxs-lookup"><span data-stu-id="63fda-218">Threads</span></span>

<span data-ttu-id="63fda-219">I metodi asincroni vengono considerati operazioni non bloccanti.</span><span class="sxs-lookup"><span data-stu-id="63fda-219">Async methods are intended to be non-blocking operations.</span></span> <span data-ttu-id="63fda-220">Un' `await` espressione in un metodo asincrono non blocca il thread corrente quando l'attività attesa è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="63fda-220">An `await` expression in an async method doesn't block the current thread while the awaited task is running.</span></span> <span data-ttu-id="63fda-221">Al contrario, l'espressione registra il resto del metodo come continuazione e restituisce il controllo al chiamante del metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-221">Instead, the expression signs up the rest of the method as a continuation and returns control to the caller of the async method.</span></span>

<span data-ttu-id="63fda-222">Le parole chiave `async` e `await` non determinano la creazione di thread aggiuntivi.</span><span class="sxs-lookup"><span data-stu-id="63fda-222">The `async` and `await` keywords don't cause additional threads to be created.</span></span> <span data-ttu-id="63fda-223">I metodi asincroni non richiedono multithreading perché un metodo asincrono non viene eseguito nel proprio thread.</span><span class="sxs-lookup"><span data-stu-id="63fda-223">Async methods don't require multithreading because an async method doesn't run on its own thread.</span></span> <span data-ttu-id="63fda-224">Il metodo viene eseguito nel contesto di sincronizzazione corrente e utilizza il tempo sul thread solo se il metodo è attivo.</span><span class="sxs-lookup"><span data-stu-id="63fda-224">The method runs on the current synchronization context and uses time on the thread only when the method is active.</span></span> <span data-ttu-id="63fda-225">È possibile utilizzare <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> per spostare un lavoro associato alla CPU in un thread in background. Quest'ultimo tuttavia non è di alcun ausilio in un processo che attende solo che i risultati diventino disponibili.</span><span class="sxs-lookup"><span data-stu-id="63fda-225">You can use <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> to move CPU-bound work to a background thread, but a background thread doesn't help with a process that's just waiting for results to become available.</span></span>

<span data-ttu-id="63fda-226">L'approccio alla programmazione asincrona basato su async è quasi sempre preferibile agli approcci esistenti.</span><span class="sxs-lookup"><span data-stu-id="63fda-226">The async-based approach to asynchronous programming is preferable to existing approaches in almost every case.</span></span> <span data-ttu-id="63fda-227">In particolare, questo approccio è preferibile alla classe <xref:System.ComponentModel.BackgroundWorker> per le operazioni di I/O poiché il codice è più semplice e non è necessario proteggersi da situazioni di race condition.</span><span class="sxs-lookup"><span data-stu-id="63fda-227">In particular, this approach is better than the <xref:System.ComponentModel.BackgroundWorker> class for I/O-bound operations because the code is simpler and you don't have to guard against race conditions.</span></span> <span data-ttu-id="63fda-228">Insieme al metodo <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType>, la programmazione asincrona è migliore di <xref:System.ComponentModel.BackgroundWorker> per le operazioni associate alla CPU perché separa i dettagli di coordinamento per l'esecuzione del codice dal lavoro che `Task.Run` trasferisce al pool di thread.</span><span class="sxs-lookup"><span data-stu-id="63fda-228">In combination with the <xref:System.Threading.Tasks.Task.Run%2A?displayProperty=nameWithType> method, async programming is better than <xref:System.ComponentModel.BackgroundWorker> for CPU-bound operations because async programming separates the coordination details of running your code from the work that `Task.Run` transfers to the threadpool.</span></span>

## <a name="async-and-await"></a><a name="BKMK_AsyncandAwait"></a><span data-ttu-id="63fda-229">Async e await</span><span class="sxs-lookup"><span data-stu-id="63fda-229">async and await</span></span>

<span data-ttu-id="63fda-230">Se si specifica che un metodo è asincrono usando il modificatore [async](../../../language-reference/keywords/async.md), vengono attivate le due funzionalità seguenti.</span><span class="sxs-lookup"><span data-stu-id="63fda-230">If you specify that a method is an async method by using the [async](../../../language-reference/keywords/async.md) modifier, you enable the following two capabilities.</span></span>

- <span data-ttu-id="63fda-231">Il metodo asincrono contrassegnato può usare [await](../../../language-reference/operators/await.md) per definire i punti di sospensione.</span><span class="sxs-lookup"><span data-stu-id="63fda-231">The marked async method can use [await](../../../language-reference/operators/await.md) to designate suspension points.</span></span> <span data-ttu-id="63fda-232">L'operatore `await` indica al compilatore che il metodo asincrono non può continuare oltre un dato punto prima del completamento del processo asincrono in attesa.</span><span class="sxs-lookup"><span data-stu-id="63fda-232">The `await` operator tells the compiler that the async method can't continue past that point until the awaited asynchronous process is complete.</span></span> <span data-ttu-id="63fda-233">Nel frattempo il controllo viene restituito al chiamante del metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-233">In the meantime, control returns to the caller of the async method.</span></span>

     <span data-ttu-id="63fda-234">La sospensione di un metodo asincrono in un' `await` espressione non costituisce un'uscita dal metodo e i `finally` blocchi non vengono eseguiti.</span><span class="sxs-lookup"><span data-stu-id="63fda-234">The suspension of an async method at an `await` expression doesn't constitute an exit from the method, and `finally` blocks don't run.</span></span>

- <span data-ttu-id="63fda-235">Il metodo asincrono contrassegnato può essere atteso da metodi che lo chiamano.</span><span class="sxs-lookup"><span data-stu-id="63fda-235">The marked async method can itself be awaited by methods that call it.</span></span>

<span data-ttu-id="63fda-236">Un metodo asincrono contiene in genere una o più occorrenze di un `await` operatore, ma l'assenza di `await` espressioni non provoca un errore del compilatore.</span><span class="sxs-lookup"><span data-stu-id="63fda-236">An async method typically contains one or more occurrences of an `await` operator, but the absence of `await` expressions doesn't cause a compiler error.</span></span> <span data-ttu-id="63fda-237">Se un metodo asincrono non usa un `await` operatore per contrassegnare un punto di sospensione, il metodo viene eseguito come metodo sincrono, nonostante il `async` modificatore.</span><span class="sxs-lookup"><span data-stu-id="63fda-237">If an async method doesn't use an `await` operator to mark a suspension point, the method executes as a synchronous method does, despite the `async` modifier.</span></span> <span data-ttu-id="63fda-238">Il compilatore genera un avviso per tali metodi.</span><span class="sxs-lookup"><span data-stu-id="63fda-238">The compiler issues a warning for such methods.</span></span>

<span data-ttu-id="63fda-239">`async` e `await` sono parole chiave contestuali.</span><span class="sxs-lookup"><span data-stu-id="63fda-239">`async` and `await` are contextual keywords.</span></span> <span data-ttu-id="63fda-240">Per ulteriori informazioni ed esempi, vedere gli argomenti seguenti:</span><span class="sxs-lookup"><span data-stu-id="63fda-240">For more information and examples, see the following topics:</span></span>

- [<span data-ttu-id="63fda-241">Async</span><span class="sxs-lookup"><span data-stu-id="63fda-241">async</span></span>](../../../language-reference/keywords/async.md)
- [<span data-ttu-id="63fda-242">await</span><span class="sxs-lookup"><span data-stu-id="63fda-242">await</span></span>](../../../language-reference/operators/await.md)

## <a name="return-types-and-parameters"></a><a name="BKMK_ReturnTypesandParameters"></a><span data-ttu-id="63fda-243">Tipi restituiti e parametri</span><span class="sxs-lookup"><span data-stu-id="63fda-243">Return types and parameters</span></span>

<span data-ttu-id="63fda-244">Un metodo asincrono restituisce in genere <xref:System.Threading.Tasks.Task> o <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="63fda-244">An async method typically returns a <xref:System.Threading.Tasks.Task> or a <xref:System.Threading.Tasks.Task%601>.</span></span> <span data-ttu-id="63fda-245">In un metodo asincrono un operatore `await` viene applicato a un'attività restituita da una chiamata a un altro metodo asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-245">Inside an async method, an `await` operator is applied to a task that's returned from a call to another async method.</span></span>

<span data-ttu-id="63fda-246">Specificare <xref:System.Threading.Tasks.Task%601> come tipo restituito se il metodo contiene un' [`return`](../../../language-reference/keywords/return.md) istruzione che specifica un operando di tipo `TResult` .</span><span class="sxs-lookup"><span data-stu-id="63fda-246">You specify <xref:System.Threading.Tasks.Task%601> as the return type if the method contains a [`return`](../../../language-reference/keywords/return.md) statement that specifies an operand of type `TResult`.</span></span>

<span data-ttu-id="63fda-247">Usare <xref:System.Threading.Tasks.Task> come tipo restituito se il metodo non include un'istruzione return o contiene un'istruzione return che non restituisce un operando.</span><span class="sxs-lookup"><span data-stu-id="63fda-247">You use <xref:System.Threading.Tasks.Task>  as the return type if the method has no return statement or has a return statement that doesn't return an operand.</span></span>

<span data-ttu-id="63fda-248">A partire da C# 7.0, è possibile specificare anche altri tipi restituiti, a condizione che il tipo includa un metodo `GetAwaiter`.</span><span class="sxs-lookup"><span data-stu-id="63fda-248">Starting with C# 7.0, you can also specify any other return type, provided that the type includes a `GetAwaiter` method.</span></span> <span data-ttu-id="63fda-249">Un esempio dei tipi in questione è <xref:System.Threading.Tasks.ValueTask%601>.</span><span class="sxs-lookup"><span data-stu-id="63fda-249"><xref:System.Threading.Tasks.ValueTask%601> is an example of such a type.</span></span> <span data-ttu-id="63fda-250">disponibile nel pacchetto NuGet [System.Threading.Tasks.Extension](https://www.nuget.org/packages/System.Threading.Tasks.Extensions/).</span><span class="sxs-lookup"><span data-stu-id="63fda-250">It is available in the [System.Threading.Tasks.Extension](https://www.nuget.org/packages/System.Threading.Tasks.Extensions/) NuGet package.</span></span>

<span data-ttu-id="63fda-251">Nell'esempio seguente viene illustrato come dichiarare e chiamare un metodo che restituisce un oggetto <xref:System.Threading.Tasks.Task%601> o un oggetto <xref:System.Threading.Tasks.Task> :</span><span class="sxs-lookup"><span data-stu-id="63fda-251">The following example shows how you declare and call a method that returns a <xref:System.Threading.Tasks.Task%601> or a <xref:System.Threading.Tasks.Task>:</span></span>

```csharp
// Signature specifies Task<TResult>
async Task<int> GetTaskOfTResultAsync()
{
    int hours = 0;
    await Task.Delay(0);
    // Return statement specifies an integer result.
    return hours;
}

// Calls to GetTaskOfTResultAsync
Task<int> returnedTaskTResult = GetTaskOfTResultAsync();
int intResult = await returnedTaskTResult;
// or, in a single statement
int intResult = await GetTaskOfTResultAsync();

// Signature specifies Task
async Task GetTaskAsync()
{
    await Task.Delay(0);
    // The method has no return statement.
}

// Calls to GetTaskAsync
Task returnedTask = GetTaskAsync();
await returnedTask;
// or, in a single statement
await GetTaskAsync();
```

<span data-ttu-id="63fda-252">Ogni attività restituita rappresenta il lavoro attualmente in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="63fda-252">Each returned task represents ongoing work.</span></span> <span data-ttu-id="63fda-253">Un'attività include le informazioni sullo stato del processo asincrono e, infine, il risultato finale del processo o l'eccezione che il processo genera se non viene completato.</span><span class="sxs-lookup"><span data-stu-id="63fda-253">A task encapsulates information about the state of the asynchronous process and, eventually, either the final result from the process or the exception that the process raises if it doesn't succeed.</span></span>

<span data-ttu-id="63fda-254">Un metodo asincrono può avere un tipo restituito `void`.</span><span class="sxs-lookup"><span data-stu-id="63fda-254">An async method can also have a `void` return type.</span></span> <span data-ttu-id="63fda-255">Il tipo restituito viene utilizzato principalmente per definire i gestori eventi, dove un tipo restituito `void` è necessario.</span><span class="sxs-lookup"><span data-stu-id="63fda-255">This return type is used primarily to define event handlers, where a `void` return type is required.</span></span> <span data-ttu-id="63fda-256">I gestori eventi asincroni fungono spesso da punto di partenza per i programmi asincroni.</span><span class="sxs-lookup"><span data-stu-id="63fda-256">Async event handlers often serve as the starting point for async programs.</span></span>

<span data-ttu-id="63fda-257">Un metodo asincrono che ha un `void` tipo restituito non può essere atteso e il chiamante di un metodo che restituisce void non può intercettare le eccezioni generate dal metodo.</span><span class="sxs-lookup"><span data-stu-id="63fda-257">An async method that has a `void` return type can't be awaited, and the caller of a void-returning method can't catch any exceptions that the method throws.</span></span>

<span data-ttu-id="63fda-258">Un metodo asincrono non può dichiarare parametri [in](../../../language-reference/keywords/in-parameter-modifier.md), [ref](../../../language-reference/keywords/ref.md) o [out](../../../language-reference/keywords/out-parameter-modifier.md), ma può chiamare metodi con tali parametri.</span><span class="sxs-lookup"><span data-stu-id="63fda-258">An async method can't declare [in](../../../language-reference/keywords/in-parameter-modifier.md), [ref](../../../language-reference/keywords/ref.md) or [out](../../../language-reference/keywords/out-parameter-modifier.md) parameters, but the method can call methods that have such parameters.</span></span> <span data-ttu-id="63fda-259">Analogamente, un metodo asincrono non può restituire un valore tramite riferimento, sebbene possa chiamare metodi con valori restituiti di riferimento.</span><span class="sxs-lookup"><span data-stu-id="63fda-259">Similarly, an async method can't return a value by reference, although it can call methods with ref return values.</span></span>

<span data-ttu-id="63fda-260">Per altre informazioni ed esempi, vedere [Tipi restituiti asincroni (C#)](./async-return-types.md).</span><span class="sxs-lookup"><span data-stu-id="63fda-260">For more information and examples, see [Async Return Types (C#)](./async-return-types.md).</span></span> <span data-ttu-id="63fda-261">Per altre informazioni su come intercettare eccezioni nei metodi asincroni, vedere [try-catch](../../../language-reference/keywords/try-catch.md).</span><span class="sxs-lookup"><span data-stu-id="63fda-261">For more information about how to catch exceptions in async methods, see [try-catch](../../../language-reference/keywords/try-catch.md).</span></span>

<span data-ttu-id="63fda-262">Nella programmazione Windows Runtime le API asincrone hanno uno dei tipi restituiti seguenti, che sono simili alle attività:</span><span class="sxs-lookup"><span data-stu-id="63fda-262">Asynchronous APIs in Windows Runtime programming have one of the following return types, which are similar to tasks:</span></span>

- <span data-ttu-id="63fda-263"><xref:Windows.Foundation.IAsyncOperation%601>, che corrisponde a <xref:System.Threading.Tasks.Task%601></span><span class="sxs-lookup"><span data-stu-id="63fda-263"><xref:Windows.Foundation.IAsyncOperation%601>, which corresponds to <xref:System.Threading.Tasks.Task%601></span></span>
- <span data-ttu-id="63fda-264"><xref:Windows.Foundation.IAsyncAction>, che corrisponde a <xref:System.Threading.Tasks.Task></span><span class="sxs-lookup"><span data-stu-id="63fda-264"><xref:Windows.Foundation.IAsyncAction>, which corresponds to <xref:System.Threading.Tasks.Task></span></span>
- <xref:Windows.Foundation.IAsyncActionWithProgress%601>
- <xref:Windows.Foundation.IAsyncOperationWithProgress%602>

## <a name="naming-convention"></a><a name="BKMK_NamingConvention"></a><span data-ttu-id="63fda-265">Convenzione di denominazione</span><span class="sxs-lookup"><span data-stu-id="63fda-265">Naming convention</span></span>

<span data-ttu-id="63fda-266">Per convenzione, i metodi che restituiscono tipi comunemente awaitable, ad esempio,,, `Task` `Task<T>` `ValueTask` `ValueTask<T>` devono avere nomi che terminano con "Async".</span><span class="sxs-lookup"><span data-stu-id="63fda-266">By convention, methods that return commonly awaitable types (for example, `Task`, `Task<T>`, `ValueTask`, `ValueTask<T>`) should have names that end with "Async".</span></span> <span data-ttu-id="63fda-267">I metodi che avviano un'operazione asincrona, ma non restituiscono un tipo awaitable, non devono avere nomi che terminano con "Async", ma possono iniziare con "Begin", "Start" o altri verbi per suggerire che questo metodo non restituisce o genera il risultato dell'operazione.</span><span class="sxs-lookup"><span data-stu-id="63fda-267">Methods that start an asynchronous operation but do not return an awaitable type should not have names that end with "Async", but may start with "Begin", "Start", or some other verb to suggest this method does not return or throw the result of the operation.</span></span>

<span data-ttu-id="63fda-268">È possibile ignorare la convenzione se un evento, una classe base o un contratto di interfaccia suggerisce un nome diverso.</span><span class="sxs-lookup"><span data-stu-id="63fda-268">You can ignore the convention where an event, base class, or interface contract suggests a different name.</span></span> <span data-ttu-id="63fda-269">Ad esempio, non è necessario rinominare i gestori eventi comuni, ad esempio `Button1_Click` .</span><span class="sxs-lookup"><span data-stu-id="63fda-269">For example, you shouldn't rename common event handlers, such as `Button1_Click`.</span></span>

## <a name="related-topics-and-samples-visual-studio"></a><a name="BKMK_RelatedTopics"></a><span data-ttu-id="63fda-270">Argomenti correlati ed esempi (Visual Studio)</span><span class="sxs-lookup"><span data-stu-id="63fda-270">Related topics and samples (Visual Studio)</span></span>

|<span data-ttu-id="63fda-271">Titolo</span><span class="sxs-lookup"><span data-stu-id="63fda-271">Title</span></span>|<span data-ttu-id="63fda-272">Descrizione</span><span class="sxs-lookup"><span data-stu-id="63fda-272">Description</span></span>|<span data-ttu-id="63fda-273">Esempio</span><span class="sxs-lookup"><span data-stu-id="63fda-273">Sample</span></span>|
|-----------|-----------------|------------|
|[<span data-ttu-id="63fda-274">Procedura dettagliata: accesso al Web tramite async e await (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-274">Walkthrough: Accessing the Web by Using async and await (C#)</span></span>](./walkthrough-accessing-the-web-by-using-async-and-await.md)|<span data-ttu-id="63fda-275">Mostra come convertire una soluzione WPF sincrona in una soluzione WPF asincrona.</span><span class="sxs-lookup"><span data-stu-id="63fda-275">Shows how to convert a synchronous WPF solution to an asynchronous WPF solution.</span></span> <span data-ttu-id="63fda-276">L'applicazione scarica una serie di siti Web.</span><span class="sxs-lookup"><span data-stu-id="63fda-276">The application downloads a series of websites.</span></span>|<span data-ttu-id="63fda-277">[Async Sample: Accessing the Web Walkthrough](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f) (Esempio di attività asincrona: Accesso alla procedura dettagliata Web)</span><span class="sxs-lookup"><span data-stu-id="63fda-277">[Async Sample: Accessing the Web Walkthrough](https://code.msdn.microsoft.com/Async-Sample-Accessing-the-9c10497f)</span></span>|
|[<span data-ttu-id="63fda-278">Come estendere la procedura dettagliata asincrona tramite Task. WhenAll (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-278">How to extend the async walkthrough by using Task.WhenAll (C#)</span></span>](./how-to-extend-the-async-walkthrough-by-using-task-whenall.md)|<span data-ttu-id="63fda-279">Aggiunge <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> alla procedura dettagliata precedente.</span><span class="sxs-lookup"><span data-stu-id="63fda-279">Adds <xref:System.Threading.Tasks.Task.WhenAll%2A?displayProperty=nameWithType> to the previous walkthrough.</span></span> <span data-ttu-id="63fda-280">L'utilizzo di `WhenAll` consente di avviare tutti i download contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="63fda-280">The use of `WhenAll` starts all the downloads at the same time.</span></span>||
|[<span data-ttu-id="63fda-281">Come eseguire più richieste Web in parallelo tramite Async e await (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-281">How to make multiple web requests in parallel by using async and await (C#)</span></span>](./how-to-make-multiple-web-requests-in-parallel-by-using-async-and-await.md)|<span data-ttu-id="63fda-282">Viene illustrato come avviare contemporaneamente diverse attività.</span><span class="sxs-lookup"><span data-stu-id="63fda-282">Demonstrates how to start several tasks at the same time.</span></span>|<span data-ttu-id="63fda-283">[Async Sample: Make Multiple Web Requests in Parallel](https://code.msdn.microsoft.com/Async-Make-Multiple-Web-49adb82e) (Esempio di attività asincrona: Esecuzione di più richieste Web in parallelo)</span><span class="sxs-lookup"><span data-stu-id="63fda-283">[Async Sample: Make Multiple Web Requests in Parallel](https://code.msdn.microsoft.com/Async-Make-Multiple-Web-49adb82e)</span></span>|
|[<span data-ttu-id="63fda-284">Tipi restituiti async (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-284">Async Return Types (C#)</span></span>](./async-return-types.md)|<span data-ttu-id="63fda-285">Vengono illustrati i tipi che i metodi asincroni possono restituire e viene spiegato quando ogni tipo è appropriato.</span><span class="sxs-lookup"><span data-stu-id="63fda-285">Illustrates the types that async methods can return, and explains when each type is appropriate.</span></span>||
|[<span data-ttu-id="63fda-286">Flusso di controllo nei programmi asincroni (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-286">Control Flow in Async Programs (C#)</span></span>](./control-flow-in-async-programs.md)|<span data-ttu-id="63fda-287">Traccia in dettaglio il flusso di controllo con una successione di espressioni await in un programma asincrono.</span><span class="sxs-lookup"><span data-stu-id="63fda-287">Traces in detail the flow of control through a succession of await expressions in an asynchronous program.</span></span>|<span data-ttu-id="63fda-288">[Async Sample: Control Flow in Async Programs](https://code.msdn.microsoft.com/Async-Sample-Control-Flow-5c804fc0) (Esempio di attività asincrona: Flusso di controllo in programmi asincroni)</span><span class="sxs-lookup"><span data-stu-id="63fda-288">[Async Sample: Control Flow in Async Programs](https://code.msdn.microsoft.com/Async-Sample-Control-Flow-5c804fc0)</span></span>|
|[<span data-ttu-id="63fda-289">Ottimizzazione dell'applicazione asincrona (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-289">Fine-Tuning Your Async Application (C#)</span></span>](./fine-tuning-your-async-application.md)|<span data-ttu-id="63fda-290">Mostra come aggiungere la seguente funzionalità alla soluzione asincrono:</span><span class="sxs-lookup"><span data-stu-id="63fda-290">Shows how to add the following functionality to your async solution:</span></span><br /><br /> <span data-ttu-id="63fda-291">- [Annullare un'attività asincrona o un elenco di attività (C#)](./cancel-an-async-task-or-a-list-of-tasks.md)</span><span class="sxs-lookup"><span data-stu-id="63fda-291">- [Cancel an Async Task or a List of Tasks (C#)](./cancel-an-async-task-or-a-list-of-tasks.md)</span></span><br /><span data-ttu-id="63fda-292">- [Annulla attività asincrone dopo un periodo di tempo (C#)](./cancel-async-tasks-after-a-period-of-time.md)</span><span class="sxs-lookup"><span data-stu-id="63fda-292">- [Cancel Async Tasks after a Period of Time (C#)](./cancel-async-tasks-after-a-period-of-time.md)</span></span><br /><span data-ttu-id="63fda-293">- [Annulla le attività asincrone rimanenti dopo che ne è stata completata una (C#)](./cancel-remaining-async-tasks-after-one-is-complete.md)</span><span class="sxs-lookup"><span data-stu-id="63fda-293">- [Cancel Remaining Async Tasks after One Is Complete (C#)](./cancel-remaining-async-tasks-after-one-is-complete.md)</span></span><br /><span data-ttu-id="63fda-294">- [Avviare più attività asincrone ed elaborarle quando vengono completate (C#)](./start-multiple-async-tasks-and-process-them-as-they-complete.md)</span><span class="sxs-lookup"><span data-stu-id="63fda-294">- [Start Multiple Async Tasks and Process Them As They Complete (C#)](./start-multiple-async-tasks-and-process-them-as-they-complete.md)</span></span>|<span data-ttu-id="63fda-295">[Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea) (Esempio di attività asincrona: Ottimizzazione dell'applicazione)</span><span class="sxs-lookup"><span data-stu-id="63fda-295">[Async Sample: Fine Tuning Your Application](https://code.msdn.microsoft.com/Async-Fine-Tuning-Your-a676abea)</span></span>|
|[<span data-ttu-id="63fda-296">Gestione della reentrancy nelle app asincrone (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-296">Handling Reentrancy in Async Apps (C#)</span></span>](./handling-reentrancy-in-async-apps.md)|<span data-ttu-id="63fda-297">Viene illustrato come gestire i casi in cui un'operazione asincrona attiva viene riavviata mentre è in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="63fda-297">Shows how to handle cases in which an active asynchronous operation is restarted while it's running.</span></span>||
|<span data-ttu-id="63fda-298">[WhenAny: bridging tra .NET Framework e Windows Runtime](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/jj635140(v=vs.120))</span><span class="sxs-lookup"><span data-stu-id="63fda-298">[WhenAny: Bridging between the .NET Framework and the Windows Runtime](https://docs.microsoft.com/previous-versions/visualstudio/visual-studio-2013/jj635140(v=vs.120))</span></span>|<span data-ttu-id="63fda-299">Descrive come integrare i tipi di attività in .NET Framework e IAsyncOperations in Windows Runtime per usare <xref:System.Threading.Tasks.Task.WhenAny%2A> con un metodo di Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="63fda-299">Shows how to bridge between Task types in the .NET Framework and IAsyncOperations in the Windows Runtime so that you can use <xref:System.Threading.Tasks.Task.WhenAny%2A> with a Windows Runtime method.</span></span>|<span data-ttu-id="63fda-300">[Async Sample: Bridging between .NET and Windows Runtime (AsTask and WhenAny)](https://code.msdn.microsoft.com/Async-Sample-Bridging-d6a2f739) (Esempio di attività asincrona: Bridging tra .NET e Windows Runtime (AsTask e WhenAny))</span><span class="sxs-lookup"><span data-stu-id="63fda-300">[Async Sample: Bridging between .NET and Windows Runtime (AsTask and WhenAny)](https://code.msdn.microsoft.com/Async-Sample-Bridging-d6a2f739)</span></span>|
|<span data-ttu-id="63fda-301">Annullamento asincrono: bridging tra .NET Framework e Windows Runtime</span><span class="sxs-lookup"><span data-stu-id="63fda-301">Async Cancellation: Bridging between the .NET Framework and the Windows Runtime</span></span>|<span data-ttu-id="63fda-302">Descrive come integrare i tipi di attività in .NET Framework e IAsyncOperations in Windows Runtime per usare <xref:System.Threading.CancellationTokenSource> con un metodo di Windows Runtime.</span><span class="sxs-lookup"><span data-stu-id="63fda-302">Shows how to bridge between Task types in the .NET Framework and IAsyncOperations in the Windows Runtime so that you can use <xref:System.Threading.CancellationTokenSource> with a Windows Runtime method.</span></span>|<span data-ttu-id="63fda-303">[Async Sample: Bridging between .NET and Windows Runtime (AsTask & Cancellation)](https://code.msdn.microsoft.com/Async-Sample-Bridging-9479eca3) (Esempio di attività asincrona: Bridging tra .NET e Windows Runtime (AsTask e Cancellation))</span><span class="sxs-lookup"><span data-stu-id="63fda-303">[Async Sample: Bridging between .NET and Windows Runtime (AsTask & Cancellation)](https://code.msdn.microsoft.com/Async-Sample-Bridging-9479eca3)</span></span>|
|[<span data-ttu-id="63fda-304">Uso della funzionalità Async per l'accesso ai file (C#)</span><span class="sxs-lookup"><span data-stu-id="63fda-304">Using Async for File Access (C#)</span></span>](./using-async-for-file-access.md)|<span data-ttu-id="63fda-305">Vengono elencati e illustrati i vantaggi dell'utilizzo di async e await per accedere ai file.</span><span class="sxs-lookup"><span data-stu-id="63fda-305">Lists and demonstrates the benefits of using async and await to access files.</span></span>||
|[<span data-ttu-id="63fda-306">Modello asincrono basato su attività (TAP)</span><span class="sxs-lookup"><span data-stu-id="63fda-306">Task-based Asynchronous Pattern (TAP)</span></span>](../../../../standard/asynchronous-programming-patterns/task-based-asynchronous-pattern-tap.md)|<span data-ttu-id="63fda-307">Descrive un nuovo modello per la modalità asincrona in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="63fda-307">Describes a new pattern for asynchrony in the .NET Framework.</span></span> <span data-ttu-id="63fda-308">Il modello è basato sui tipi <xref:System.Threading.Tasks.Task> e <xref:System.Threading.Tasks.Task%601>.</span><span class="sxs-lookup"><span data-stu-id="63fda-308">The pattern is based on the <xref:System.Threading.Tasks.Task> and <xref:System.Threading.Tasks.Task%601> types.</span></span>||
|[<span data-ttu-id="63fda-309">Video sulla modalità asincrona su Channel 9</span><span class="sxs-lookup"><span data-stu-id="63fda-309">Async Videos on Channel 9</span></span>](https://channel9.msdn.com/search?term=async%20&type=All#pubDate=year&ch9Search&lang-en=en)|<span data-ttu-id="63fda-310">Vengono forniti collegamenti a una serie di video sulla programmazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="63fda-310">Provides links to a variety of videos about async programming.</span></span>||

## <a name="complete-example"></a><a name="BKMK_CompleteExample"></a><span data-ttu-id="63fda-311">Esempio completo</span><span class="sxs-lookup"><span data-stu-id="63fda-311">Complete example</span></span>

<span data-ttu-id="63fda-312">Il codice seguente è il file *MainWindow.XAML.cs* dell'applicazione WPF descritta in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="63fda-312">The following code is the *MainWindow.xaml.cs* file from the WPF application that this article discusses.</span></span> <span data-ttu-id="63fda-313">È possibile scaricare l'esempio dalla pagina [Async Sample: Example from "Asynchronous Programming with Async and Await"](https://docs.microsoft.com/samples/dotnet/samples/async-and-await-cs/) (Esempio di attività asincrona: Programmazione asincrona con async e await).</span><span class="sxs-lookup"><span data-stu-id="63fda-313">You can download the sample from [Async Sample: Example from "Asynchronous Programming with Async and Await"](https://docs.microsoft.com/samples/dotnet/samples/async-and-await-cs/).</span></span>

[!code-csharp[async](~/samples/snippets/standard/async/async-and-await/cs/MainWindow.xaml.cs)]

## <a name="see-also"></a><span data-ttu-id="63fda-314">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="63fda-314">See also</span></span>

- [<span data-ttu-id="63fda-315">Async</span><span class="sxs-lookup"><span data-stu-id="63fda-315">async</span></span>](../../../language-reference/keywords/async.md)
- [<span data-ttu-id="63fda-316">await</span><span class="sxs-lookup"><span data-stu-id="63fda-316">await</span></span>](../../../language-reference/operators/await.md)
- [<span data-ttu-id="63fda-317">Programmazione asincrona</span><span class="sxs-lookup"><span data-stu-id="63fda-317">Asynchronous programming</span></span>](../../../async.md)
- [<span data-ttu-id="63fda-318">Panoramica asincrona</span><span class="sxs-lookup"><span data-stu-id="63fda-318">Async overview</span></span>](../../../../standard/async.md)
