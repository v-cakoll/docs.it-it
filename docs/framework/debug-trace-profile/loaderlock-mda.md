---
title: MDA loaderLock
ms.date: 03/30/2017
helpviewer_keywords:
- deadlocks [.NET Framework]
- LoaderLock MDA
- MDAs (managed debugging assistants), loader locks
- managed debugging assistants (MDAs), loader locks
- operating system loader locks
- loader locks
- locks, threads
ms.assetid: 8c10fa02-1b9c-4be5-ab03-451d943ac1ee
author: mairaw
ms.author: mairaw
ms.openlocfilehash: 9a70b8c3509b785d70b041b449c759e7994e5984
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/23/2019
ms.locfileid: "61754232"
---
# <a name="loaderlock-mda"></a><span data-ttu-id="6c9e6-102">MDA loaderLock</span><span class="sxs-lookup"><span data-stu-id="6c9e6-102">loaderLock MDA</span></span>
<span data-ttu-id="6c9e6-103">L'assistente al debug gestito `loaderLock` rileva i tentativi di esecuzione di codice gestito in un thread che contiene il blocco del caricatore del sistema operativo Microsoft Windows.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-103">The `loaderLock` managed debugging assistant (MDA) detects attempts to execute managed code on a thread that holds the Microsoft Windows operating system loader lock.</span></span>  <span data-ttu-id="6c9e6-104">Qualsiasi esecuzione di questo tipo non è valida perché può comportare il verificarsi di deadlock e l'uso di DLL prima che siano state inizializzate dal caricatore del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-104">Any such execution is illegal because it can lead to deadlocks and to use of DLLs before they have been initialized by the operating system's loader.</span></span>  
  
## <a name="symptoms"></a><span data-ttu-id="6c9e6-105">Sintomi</span><span class="sxs-lookup"><span data-stu-id="6c9e6-105">Symptoms</span></span>  
 <span data-ttu-id="6c9e6-106">L'errore più comune durante l'esecuzione di codice all'interno del blocco di caricamento del sistema operativo consiste nel deadlock dei thread durante il tentativo di chiamare altre funzioni Win32 che richiedono anch'esse il blocco del caricatore.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-106">The most common failure when executing code inside the operating system's loader lock is that threads will deadlock when attempting to call other Win32 functions that also require the loader lock.</span></span>  <span data-ttu-id="6c9e6-107">Alcuni esempi di queste funzioni includono `LoadLibrary`, `GetProcAddress`, `FreeLibrary` e `GetModuleHandle`.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-107">Examples of such functions are `LoadLibrary`, `GetProcAddress`, `FreeLibrary`, and `GetModuleHandle`.</span></span>  <span data-ttu-id="6c9e6-108">L'applicazione potrebbe non chiamare direttamente queste funzioni. Common Language Runtime (CLR) può chiamare queste funzioni come risultato di una chiamata di livello superiore come <xref:System.Reflection.Assembly.Load%2A> o la prima chiamata a un metodo di platform invoke.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-108">The application might not directly call these functions; the common language runtime (CLR) might call these functions as the result of a higher level call like <xref:System.Reflection.Assembly.Load%2A> or the first call to a platform invoke method.</span></span>  
  
 <span data-ttu-id="6c9e6-109">Possono verificarsi deadlock anche se un thread è in attesa dell'avvio o del completamento di un altro thread.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-109">Deadlocks can also occur if a thread is waiting for another thread to start or finish.</span></span>  <span data-ttu-id="6c9e6-110">Quando l'esecuzione di un thread viene avviata o completata, il thread deve acquisire il blocco del caricatore del sistema operativo per recapitare gli eventi alle DLL interessate.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-110">When a thread starts or finishes executing, it must acquire the operating system's loader lock to deliver events to affected DLLs.</span></span>  
  
 <span data-ttu-id="6c9e6-111">Infine, vi sono casi in cui possono verificarsi chiamate nelle DLL prima che le DLL siano state inizializzate correttamente dal caricatore del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-111">Finally, there are cases where calls into DLLs can occur before those DLLs have been properly initialized by the operating system's loader.</span></span>  <span data-ttu-id="6c9e6-112">Diversamente dagli errori di deadlock, che possono essere diagnosticati esaminando gli stack di tutti i thread inclusi nel deadlock, è molto difficile diagnosticare l'uso di DLL non inizializzate con questo assistente al debug gestito.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-112">Unlike the deadlock failures, which can be diagnosed by examining the stacks of all the threads involved in the deadlock, it is very difficult to diagnose the use of uninitialized DLLs without using this MDA.</span></span>  
  
## <a name="cause"></a><span data-ttu-id="6c9e6-113">Causa</span><span class="sxs-lookup"><span data-stu-id="6c9e6-113">Cause</span></span>  
 <span data-ttu-id="6c9e6-114">Assembly C++ gestiti/non gestiti misti creati per .NET Framework versione 1.0 o 1.1 tentano in genere di eseguire codice gestito all'interno del blocco del caricatore, se non è stata adottata particolare attenzione, ad esempio tramite il collegamento a **/NOENTRY**.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-114">Mixed managed/unmanaged C++ assemblies built for .NET Framework versions 1.0 or 1.1 generally attempt to execute managed code inside the loader lock unless special care has been taken, for example, linking with **/NOENTRY**.</span></span>
  
 <span data-ttu-id="6c9e6-115">Gli assembly C++ gestiti/non gestiti misti creati per .NET Framework versione 2.0 sono meno soggetti a questi problemi, in quanto sono associati allo stesso rischio minimo delle applicazioni che usano DLL non gestite che violano le regole del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-115">Mixed managed/unmanaged C++ assemblies built for .NET Framework version 2.0 are less susceptible to these problems, having the same reduced risk as applications using unmanaged DLLs that violate the operating system's rules.</span></span>  <span data-ttu-id="6c9e6-116">Ad esempio, se un punto di ingresso `DllMain` di una DLL non gestita chiama `CoCreateInstance` per ottenere un oggetto gestito che è stato esposto a COM, il risultato è un tentativo di eseguire codice gestito all'interno del blocco del caricatore.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-116">For example, if an unmanaged DLL's `DllMain` entry point calls `CoCreateInstance` to obtain a managed object that has been exposed to COM, the result is an attempt to execute managed code inside the loader lock.</span></span> <span data-ttu-id="6c9e6-117">Per altre informazioni sui problemi relativi al blocco del caricatore in .NET Framework 2.0 e versioni successive, vedere [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies) (Inizializzazione di assembly misti).</span><span class="sxs-lookup"><span data-stu-id="6c9e6-117">For more information about loader lock issues in the .NET Framework version 2.0 and later, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span>  
  
## <a name="resolution"></a><span data-ttu-id="6c9e6-118">Risoluzione</span><span class="sxs-lookup"><span data-stu-id="6c9e6-118">Resolution</span></span>  
 <span data-ttu-id="6c9e6-119">In Visual C++ .NET 2002 e Visual C++ .NET 2003 le DLL compilate con l'opzione del compilatore `/clr` non possono causare un deadlock in modo non deterministico durante il caricamento. Questo problema è noto come blocco del caricatore o problema di caricamento di DLL miste.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-119">In Visual C++ .NET 2002 and Visual C++ .NET 2003, DLLs compiled with the `/clr` compiler option could non-deterministically deadlock when loaded; this issue was called the mixed DLL loading or loader lock issue.</span></span> <span data-ttu-id="6c9e6-120">In Visual C++ 2005 e versioni successive sono stato rimossi quasi tutti gli aspetti non deterministici dal processo di caricamento di DLL miste.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-120">In Visual C++ 2005 and later, almost all non-determinism has been removed from the mixed DLL loading process.</span></span> <span data-ttu-id="6c9e6-121">Tuttavia, esistono ancora alcuni scenari nei quali il blocco del caricatore può ancora verificarsi in modo deterministico.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-121">However, there are a few remaining scenarios for which loader lock can (deterministically) occur.</span></span> <span data-ttu-id="6c9e6-122">Per una descrizione dettagliata delle cause e delle soluzioni per i problemi relativi al blocco del caricatore rimanenti, vedere [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies) (Inizializzazione di assembly misti).</span><span class="sxs-lookup"><span data-stu-id="6c9e6-122">For a detailed account of the causes and resolutions for the remaining loader lock issues, see [Initialization of Mixed Assemblies](/cpp/dotnet/initialization-of-mixed-assemblies).</span></span> <span data-ttu-id="6c9e6-123">Se l'argomento non comprende il problema specifico relativo al blocco del caricatore, è necessario esaminare lo stack del thread per determinare il motivo per cui si verifica il blocco del caricatore e come correggere il problema.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-123">If that topic does not identify your loader lock problem, you have to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span> <span data-ttu-id="6c9e6-124">Esaminare l'analisi dello stack per il thread che ha attivato questo assistente al debug gestito.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-124">Look at the stack trace for the thread that has activated this MDA.</span></span>  <span data-ttu-id="6c9e6-125">Il thread sta tentando di eseguire una chiamata non valida nel codice gestito mentre mantiene il blocco del caricatore del sistema operativo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-125">The thread is attempting to illegally call into managed code while holding the operating system's loader lock.</span></span>  <span data-ttu-id="6c9e6-126">Probabilmente si noterà un punto di ingresso `DllMain`, o uno equivalente, della DLL nello stack.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-126">You will probably see a DLL's `DllMain` or equivalent entry point on the stack.</span></span>  <span data-ttu-id="6c9e6-127">Le regole del sistema operativo per le attività valide all'interno di un punto di ingresso di questo tipo sono piuttosto limitate.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-127">The operating system's rules for what you can legally do from inside such an entry point are quite limited.</span></span>  <span data-ttu-id="6c9e6-128">Queste regole impediscono qualsiasi esecuzione di codice gestito.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-128">These rules preclude any managed execution.</span></span>  
  
## <a name="effect-on-the-runtime"></a><span data-ttu-id="6c9e6-129">Effetto sull'ambiente di esecuzione</span><span class="sxs-lookup"><span data-stu-id="6c9e6-129">Effect on the Runtime</span></span>  
 <span data-ttu-id="6c9e6-130">In genere, si verifica il deadlock di diversi thread all'interno del processo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-130">Typically, several threads inside the process will deadlock.</span></span>  <span data-ttu-id="6c9e6-131">Poiché è probabile che uno di questi thread sia responsabile dell'esecuzione di un'operazione di Garbage Collection, questo deadlock può avere un impatto notevole sull'intero processo.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-131">One of those threads is likely to be a thread responsible for performing a garbage collection, so this deadlock can have a major impact on the entire process.</span></span>  <span data-ttu-id="6c9e6-132">Inoltre, impedirà qualsiasi altra operazione che richiede il blocco del caricatore del sistema operativo, come il caricamento o lo scaricamento di assembly o DLL e l'avvio o l'arresto di thread.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-132">Furthermore, it will prevent any additional operations that require the operating system's loader lock, like loading and unloading assemblies or DLLs and starting or stopping threads.</span></span>  
  
 <span data-ttu-id="6c9e6-133">In alcuni rari casi, possono anche verificarsi violazioni di accesso o problemi simili nelle DLL chiamate prima di essere state inizializzate.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-133">In some unusual cases, it is also possible for access violations or similar problems to be triggered in DLLs which are called before they have been initialized.</span></span>  
  
## <a name="output"></a><span data-ttu-id="6c9e6-134">Output</span><span class="sxs-lookup"><span data-stu-id="6c9e6-134">Output</span></span>  
 <span data-ttu-id="6c9e6-135">Questo assistente al debug gestito segnala che è in corso un tentativo di esecuzione di codice gestito non valida.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-135">This MDA reports that an illegal managed execution is being attempted.</span></span>  <span data-ttu-id="6c9e6-136">È necessario esaminare lo stack del thread per determinare il motivo per cui si verifica il blocco del caricatore e come risolvere il problema.</span><span class="sxs-lookup"><span data-stu-id="6c9e6-136">You need to examine the thread's stack to determine why the loader lock is occurring and how to correct the problem.</span></span>  
  
## <a name="configuration"></a><span data-ttu-id="6c9e6-137">Configurazione</span><span class="sxs-lookup"><span data-stu-id="6c9e6-137">Configuration</span></span>  
  
```xml  
<mdaConfig>  
  <assistants>  
    <loaderLock/>  
  </assistants>  
</mdaConfig>  
```  
  
## <a name="see-also"></a><span data-ttu-id="6c9e6-138">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="6c9e6-138">See also</span></span>

- [<span data-ttu-id="6c9e6-139">Diagnostica degli errori tramite gli assistenti al debug gestito</span><span class="sxs-lookup"><span data-stu-id="6c9e6-139">Diagnosing Errors with Managed Debugging Assistants</span></span>](../../../docs/framework/debug-trace-profile/diagnosing-errors-with-managed-debugging-assistants.md)
