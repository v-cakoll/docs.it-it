---
title: Prestazioni di Windows Workflow Foundation 4
ms.date: 03/30/2017
ms.assetid: 67d2b3e8-3777-49f8-9084-abbb33b5a766
ms.openlocfilehash: 51cd5b248789c85ab06073f1bb41a83e5f97c139
ms.sourcegitcommit: 127343afce8422bfa944c8b0c4ecc8f79f653255
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 06/25/2019
ms.locfileid: "67348531"
---
# <a name="windows-workflow-foundation-4-performance"></a><span data-ttu-id="301d1-102">Prestazioni di Windows Workflow Foundation 4</span><span class="sxs-lookup"><span data-stu-id="301d1-102">Windows Workflow Foundation 4 Performance</span></span>

 <span data-ttu-id="301d1-103">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] include una revisione principale di Windows Workflow Foundation (WF) con notevoli investimenti per migliorarne le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-103">Microsoft [!INCLUDE[netfx40_long](../../../includes/netfx40-long-md.md)] includes a major revision of the Windows Workflow Foundation (WF) with heavy investments in performance.</span></span>  <span data-ttu-id="301d1-104">Questa nuova revisione introduce modifiche significative in termini di progettazione rispetto alle versioni precedenti di [!INCLUDE[wf1](../../../includes/wf1-md.md)], fornite insieme a .NET Framework 3.0 e [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span><span class="sxs-lookup"><span data-stu-id="301d1-104">This new revision introduces significant design changes from the previous versions of [!INCLUDE[wf1](../../../includes/wf1-md.md)] that shipped as part of .NET Framework 3.0 and [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)].</span></span> <span data-ttu-id="301d1-105">L'architettura del modello di programmazione, del runtime e degli strumenti è stata completamente riprogettata al fine di migliorare notevolmente prestazioni e usabilità.</span><span class="sxs-lookup"><span data-stu-id="301d1-105">It has been re-architected from the core of the programming model, runtime, and tooling to greatly improve performance and usability.</span></span> <span data-ttu-id="301d1-106">In questo argomento vengono illustrate le principali caratteristiche delle prestazioni di tali revisioni confrontandole con quelle della versione precedente.</span><span class="sxs-lookup"><span data-stu-id="301d1-106">This topic shows the important performance characteristics of these revisions and compares them against those of the previous version.</span></span>

 <span data-ttu-id="301d1-107">Le prestazioni dei singoli componenti del flusso di lavoro sono notevolmente aumentate in WF4 rispetto a WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-107">Individual workflow component performance has increased by orders of magnitude between WF3 and WF4.</span></span>  <span data-ttu-id="301d1-108">Pertanto il divario tra codificato manualmente i servizi Windows Communication Foundation (WCF) e servizi del flusso di lavoro WCF è minimo.</span><span class="sxs-lookup"><span data-stu-id="301d1-108">This leaves the gap between hand-coded Windows Communication Foundation (WCF) services and WCF workflow services to be quite small.</span></span>  <span data-ttu-id="301d1-109">La latenza del flusso di lavoro è stata notevolmente ridotta in WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-109">Workflow latency has been significantly reduced in WF4.</span></span>  <span data-ttu-id="301d1-110">Le prestazioni della persistenza sono aumentate di un fattore di 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="301d1-110">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="301d1-111">Il sovraccarico del monitoraggio dell'integrità tramite il rilevamento del flusso di lavoro è stato notevolmente ridotto.</span><span class="sxs-lookup"><span data-stu-id="301d1-111">Health monitoring by means of workflow tracking has significantly less overhead.</span></span>  <span data-ttu-id="301d1-112">Questi sono i principali motivi per cui è consigliabile eseguire la migrazione a WF4 o adottarlo nelle applicazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-112">These are compelling reasons to migrate to or adopt WF4 in your applications.</span></span>

## <a name="terminology"></a><span data-ttu-id="301d1-113">Terminologia</span><span class="sxs-lookup"><span data-stu-id="301d1-113">Terminology</span></span>
 <span data-ttu-id="301d1-114">La versione di [!INCLUDE[wf1](../../../includes/wf1-md.md)] introdotta in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] verrà denominata WF4 nella parte restante di questo argomento.</span><span class="sxs-lookup"><span data-stu-id="301d1-114">The version of [!INCLUDE[wf1](../../../includes/wf1-md.md)] introduced in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] will be referred to as WF4 for the rest of this topic.</span></span>  [!INCLUDE[wf1](../../../includes/wf1-md.md)] <span data-ttu-id="301d1-115">è stato introdotto in .NET 3.0 ed era stato alcune revisioni secondarie fino [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] SP1.</span><span class="sxs-lookup"><span data-stu-id="301d1-115">was introduced in .NET 3.0 and had a few minor revisions through [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] SP1.</span></span> <span data-ttu-id="301d1-116">La versione [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] di Workflow Foundation verrà denominata WF3 nella parte restante di questo argomento.</span><span class="sxs-lookup"><span data-stu-id="301d1-116">The [!INCLUDE[netfx35_short](../../../includes/netfx35-short-md.md)] version of Workflow Foundation will be referred to as WF3 for the rest of this topic.</span></span> <span data-ttu-id="301d1-117">WF3 viene fornito con [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] insieme a WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-117">WF3 is shipped in [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)] side-by-side with WF4.</span></span> <span data-ttu-id="301d1-118">Per altre informazioni sulla migrazione degli elementi WF3 in WF4, vedere: [Guida alla migrazione di Windows Workflow Foundation 4](https://go.microsoft.com/fwlink/?LinkID=153313)</span><span class="sxs-lookup"><span data-stu-id="301d1-118">For more information about migrating WF3 artifacts to WF4 see: [Windows Workflow Foundation 4 Migration Guide](https://go.microsoft.com/fwlink/?LinkID=153313)</span></span>

 <span data-ttu-id="301d1-119">Windows Communication Foundation (WCF) è modello di programmazione unificato di Microsoft per la compilazione di applicazioni orientate ai servizi.</span><span class="sxs-lookup"><span data-stu-id="301d1-119">Windows Communication Foundation (WCF) is Microsoft’s unified programming model for building service-oriented applications.</span></span> <span data-ttu-id="301d1-120">È stata introdotta come parte di .NET 3.0 insieme a WF3 e ora è uno dei componenti principali di .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="301d1-120">It was first introduced as part of .NET 3.0 together with WF3 and now is one of the key components of the .NET Framework.</span></span>

 <span data-ttu-id="301d1-121">Windows Server AppFabric è un set di tecnologie integrate che facilitano la compilazione, il dimensionamento e la gestione di applicazioni Web e composite destinate all'esecuzione su IIS (Internet Information Services).</span><span class="sxs-lookup"><span data-stu-id="301d1-121">Windows Server AppFabric is a set of integrated technologies that make it easier to build, scale and manage Web and composite applications that run on IIS.</span></span> <span data-ttu-id="301d1-122">Fornisce gli strumenti per monitorare e gestire servizi e flussi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-122">It provides tools for monitoring and managing services and workflows.</span></span> <span data-ttu-id="301d1-123">Per altre informazioni, vedere [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span><span class="sxs-lookup"><span data-stu-id="301d1-123">For more information, see [Windows Server AppFabric 1.0](https://docs.microsoft.com/previous-versions/appfabric/ff384253(v=azure.10)).</span></span>

## <a name="goals"></a><span data-ttu-id="301d1-124">Obiettivi</span><span class="sxs-lookup"><span data-stu-id="301d1-124">Goals</span></span>
 <span data-ttu-id="301d1-125">L'obiettivo di questo argomento è mostrare le caratteristiche delle prestazioni di WF4 con dati misurati per scenari diversi.</span><span class="sxs-lookup"><span data-stu-id="301d1-125">The goal of this topic is to show the performance characteristics of WF4 with data measured for different scenarios.</span></span> <span data-ttu-id="301d1-126">L'argomento fornisce inoltre confronti dettagliati tra WF4 e WF3 e pertanto evidenzia i notevoli miglioramenti di questa nuova revisione.</span><span class="sxs-lookup"><span data-stu-id="301d1-126">It also provides detailed comparisons between WF4 and WF3, and thus shows the great improvements that have been made in this new revision.</span></span> <span data-ttu-id="301d1-127">Gli scenari e i dati presentati in questo articolo quantificano il costo sottostante dei diversi aspetti di WF4 e WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-127">The scenarios and data presented in this article quantify the underlying cost of different aspects of WF4 and WF3.</span></span> <span data-ttu-id="301d1-128">Questi dati sono utili per capire le caratteristiche delle prestazioni di WF4 e per pianificare le migrazioni da WF3 a WF4 o per usare WF4 nello sviluppo di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-128">This data is useful in understanding the performance characteristics of WF4 and can be helpful in planning migrations from WF3 to WF4 or using WF4 in application development.</span></span> <span data-ttu-id="301d1-129">È bene, tuttavia, non trarre conclusioni affrettate dai dati presentati in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-129">However, care should be taken in the conclusions drawn from the data presented in this article.</span></span> <span data-ttu-id="301d1-130">Le prestazioni di un'applicazione composita per la gestione di flussi di lavoro dipendono notevolmente dalla modalità di implementazione del flusso di lavoro e dall'integrazione dei vari componenti.</span><span class="sxs-lookup"><span data-stu-id="301d1-130">The performance of a composite workflow application is highly dependent on how the workflow is implemented and how different components are integrated.</span></span> <span data-ttu-id="301d1-131">Per determinare le caratteristiche delle prestazioni, è necessario misurare ogni singola applicazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-131">One must measure each application to determine the performance characteristics of that application.</span></span>

## <a name="overview-of-wf4-performance-enhancements"></a><span data-ttu-id="301d1-132">Panoramica dei miglioramenti delle prestazioni di WF4</span><span class="sxs-lookup"><span data-stu-id="301d1-132">Overview of WF4 Performance Enhancements</span></span>
 <span data-ttu-id="301d1-133">WF4 è stato progettato con estrema cura e implementato in modo da garantire prestazioni elevate e scalabilità, come descritto nelle sezioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="301d1-133">WF4 was carefully designed and implemented with high performance and scalability which are described in the following sections.</span></span>

### <a name="wf-runtime"></a><span data-ttu-id="301d1-134">Runtime di WF</span><span class="sxs-lookup"><span data-stu-id="301d1-134">WF Runtime</span></span>
 <span data-ttu-id="301d1-135">L'elemento di base del runtime di [!INCLUDE[wf1](../../../includes/wf1-md.md)] è un'utilità di pianificazione asincrona che controlla l'esecuzione delle attività in un flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-135">At the core of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime is an asynchronous scheduler that drives the execution of the activities in a workflow.</span></span> <span data-ttu-id="301d1-136">Fornisce un ambiente di esecuzione prevedibile e con prestazioni elevate per le attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-136">It provides a performant, predictable execution environment for activities.</span></span> <span data-ttu-id="301d1-137">L'ambiente dispone di un contratto ben definito per l'esecuzione, la continuazione, il completamento, l'annullamento, le eccezioni e un modello di threading prevedibile.</span><span class="sxs-lookup"><span data-stu-id="301d1-137">The environment has a well-defined contract for execution, continuation, completion, cancellation, exceptions, and a predictable threading model.</span></span>

 <span data-ttu-id="301d1-138">Rispetto a WF3, il runtime di WF4 dispone di un'utilità di pianificazione più efficiente.</span><span class="sxs-lookup"><span data-stu-id="301d1-138">In comparison to WF3, the WF4 runtime has a more efficient scheduler.</span></span> <span data-ttu-id="301d1-139">Sfrutta il pool di thread i/o stesso utilizzato per WCF, che è molto efficiente nell'esecuzione degli elementi di lavoro in batch.</span><span class="sxs-lookup"><span data-stu-id="301d1-139">It leverages the same I/O thread pool that is used for WCF, which is very efficient at executing batched work items.</span></span> <span data-ttu-id="301d1-140">La coda interna dell'utilità di pianificazione degli elementi di lavoro è ottimizzata per la maggior parte dei modelli di utilizzo più comuni.</span><span class="sxs-lookup"><span data-stu-id="301d1-140">The internal work item scheduler queue is optimized for most common usage patterns.</span></span> <span data-ttu-id="301d1-141">Il runtime di WF4 gestisce anche gli stati di esecuzione in un modo molto semplice con sincronizzazione minima e di gestione per la logica, mentre WF3 dipende con intensa attività di registrazione e la chiamata per eseguire la sincronizzazione complessa per le transizioni di stato di eventi.</span><span class="sxs-lookup"><span data-stu-id="301d1-141">The WF4 runtime also manages the execution states in a very lightweight way with minimal synchronization and event handling logic, while WF3 depends on heavy-weight event registration and invocation to perform complex synchronization for state transitions.</span></span>

### <a name="data-storage-and-flow"></a><span data-ttu-id="301d1-142">Archiviazione e flusso dei dati</span><span class="sxs-lookup"><span data-stu-id="301d1-142">Data Storage and Flow</span></span>
 <span data-ttu-id="301d1-143">In WF3 i dati associati a un'attività vengono modellati tramite le proprietà di dipendenza implementate dal tipo <xref:System.Windows.DependencyProperty>.</span><span class="sxs-lookup"><span data-stu-id="301d1-143">In WF3, data associated with an activity is modeled through dependency properties implemented by the type <xref:System.Windows.DependencyProperty>.</span></span> <span data-ttu-id="301d1-144">Il modello di proprietà di dipendenza è stata introdotta in Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="301d1-144">The dependency property pattern was introduced in Windows Presentation Foundation (WPF).</span></span> <span data-ttu-id="301d1-145">In generale, questo modello è molto flessibile per supportare data binding di facile utilizzo e altre funzionalità dell'interfaccia utente.</span><span class="sxs-lookup"><span data-stu-id="301d1-145">In general, this pattern is very flexible to support easy data binding and other UI features.</span></span> <span data-ttu-id="301d1-146">Le proprietà devono, tuttavia, essere definite come campi statici nella definizione di flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-146">However, the pattern requires the properties to be defined as static fields in the workflow definition.</span></span> <span data-ttu-id="301d1-147">Ogni volta che il runtime di [!INCLUDE[wf1](../../../includes/wf1-md.md)] imposta o ottiene i valori delle proprietà, comporta l'uso di una logica di ricerca molto complessa.</span><span class="sxs-lookup"><span data-stu-id="301d1-147">Whenever the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime sets or gets the property values, it involves heavily-weighted look-up logic.</span></span>

 <span data-ttu-id="301d1-148">WF4 usa una logica di ambito dei dati ben definita per migliorare notevolmente la gestione dei dati in un flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-148">WF4 uses clear data scoping logic to greatly improve how data is handled in a workflow.</span></span> <span data-ttu-id="301d1-149">Per separare i dati archiviati in un'attività dai dati che superano i limiti dell'attività, usa due concetti diversi: variabili e argomenti.</span><span class="sxs-lookup"><span data-stu-id="301d1-149">It separates the data stored in an activity from the data that is flowing across the activity boundaries by using two different concepts: variables and arguments.</span></span> <span data-ttu-id="301d1-150">Con un ambito gerarchico ben per variabili e argomenti "In/Out/InOut", si riduce notevolmente la complessità di utilizzo dei dati per le attività e la durata dei dati è definito anche automaticamente l'ambito.</span><span class="sxs-lookup"><span data-stu-id="301d1-150">By using a clear hierarchical scope for variables and "In/Out/InOut" arguments, the data usage complexity for activities is dramatically reduced and the lifetime of the data is also automatically scoped.</span></span> <span data-ttu-id="301d1-151">Le attività dispongono di una firma ben definita descritta dagli argomenti.</span><span class="sxs-lookup"><span data-stu-id="301d1-151">Activities have a well-defined signature described by its arguments.</span></span> <span data-ttu-id="301d1-152">Controllando semplicemente un'attività, è possibile determinare quali dati prevede di ricevere e quali dati verranno da essa prodotti come risultato dell'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="301d1-152">By simply inspecting an activity you can determine what data it expects to receive and what data will be produced by it as the result of its execution.</span></span>

 <span data-ttu-id="301d1-153">In WF3 le attività venivano inizializzate al momento della creazione di un flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-153">In WF3 activities were initialized when a workflow was created.</span></span> <span data-ttu-id="301d1-154">In WF 4 le attività vengono inizializzate solo nel momento in cui vengono eseguite le attività corrispondenti.</span><span class="sxs-lookup"><span data-stu-id="301d1-154">In WF 4 activities are initialized only when the corresponding activities are executing.</span></span> <span data-ttu-id="301d1-155">Dato che non è necessario eseguire le operazioni Initialize/Uninitialize quando viene creata una nuova istanza del flusso di lavoro, il ciclo di vita delle attività risulta più semplice e più efficiente.</span><span class="sxs-lookup"><span data-stu-id="301d1-155">This allows a simpler activity lifecycle without performing Initialize/Uninitialize operations when a new workflow instance is created, and thus has achieved more efficiency</span></span>

### <a name="control-flow"></a><span data-ttu-id="301d1-156">Flusso di controllo</span><span class="sxs-lookup"><span data-stu-id="301d1-156">Control Flow</span></span>
 <span data-ttu-id="301d1-157">In modo analogo a quanto avviene con qualsiasi linguaggio di programmazione, [!INCLUDE[wf1](../../../includes/wf1-md.md)] fornisce il supporto per i flussi di controllo per le definizioni dei flussi di lavoro introducendo un set di attività del flusso di controllo per l'ordinamento in sequenza, l'esecuzione in ciclo, la creazione di rami e altri modelli.</span><span class="sxs-lookup"><span data-stu-id="301d1-157">Just as in any programming language, [!INCLUDE[wf1](../../../includes/wf1-md.md)] provides support for control flows for workflow definitions by introducing a set of control flow activities for sequencing, looping, branching and other patterns.</span></span> <span data-ttu-id="301d1-158">In WF3, quando è necessario eseguire di nuovo la stessa attività, viene creato un nuovo oggetto <xref:System.Workflow.ComponentModel.ActivityExecutionContext> e l'attività viene duplicata usando una logica di serializzazione e deserializzazione complessa basata su <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span><span class="sxs-lookup"><span data-stu-id="301d1-158">In WF3, when the same activity needs to be re-executed, a new <xref:System.Workflow.ComponentModel.ActivityExecutionContext> is created and the activity is cloned through a heavy-weight serialization and deserialization logic based on <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>.</span></span> <span data-ttu-id="301d1-159">Generalmente i flussi di controllo iterativi hanno prestazioni più rallentate rispetto all'esecuzione di una sequenza di attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-159">Usually the performance for iterative control flows is much slower than executing a sequence of activities.</span></span>

 <span data-ttu-id="301d1-160">WF4 li gestisce in modo molto diverso.</span><span class="sxs-lookup"><span data-stu-id="301d1-160">WF4 handles this quite differently.</span></span> <span data-ttu-id="301d1-161">Prende il modello di attività, crea un nuovo oggetto ActivityInstance e lo aggiunge alla coda dell'utilità di pianificazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-161">It takes the activity template, creates a new ActivityInstance object, and adds it to the scheduler queue.</span></span> <span data-ttu-id="301d1-162">L'intero processo solo comporta la creazione di oggetti espliciti e non è molto leggero.</span><span class="sxs-lookup"><span data-stu-id="301d1-162">This whole process only involves explicit object creation and is very lightweight.</span></span>

### <a name="asynchronous-programming"></a><span data-ttu-id="301d1-163">Programmazione asincrona</span><span class="sxs-lookup"><span data-stu-id="301d1-163">Asynchronous Programming</span></span>
 <span data-ttu-id="301d1-164">In genere le applicazioni offrono prestazioni migliori e una maggiore scalabilità con la programmazione asincrona per le operazioni di blocco a esecuzione prolungata, quali ad esempio le operazioni di calcolo distribuite o I/O.</span><span class="sxs-lookup"><span data-stu-id="301d1-164">Applications usually have better performance and scalability with asynchronous programming for long running blocking operations such as I/O or distributed computing operations.</span></span> <span data-ttu-id="301d1-165">WF4 fornisce il supporto asincrono tramite tipi di attività di base <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span><span class="sxs-lookup"><span data-stu-id="301d1-165">WF4 provides asynchronous support through base activity types <xref:System.Activities.AsyncCodeActivity>, <xref:System.Activities.AsyncCodeActivity%601>.</span></span> <span data-ttu-id="301d1-166">Il runtime supporta in modo nativo le attività asincrone e pertanto può inserire automaticamente l'istanza in un'area di non persistenza mentre è in sospeso il lavoro asincrono.</span><span class="sxs-lookup"><span data-stu-id="301d1-166">The runtime natively understands asynchronous activities and therefore can automatically put the instance in a no-persist zone while the asynchronous work is outstanding.</span></span> <span data-ttu-id="301d1-167">Le attività personalizzate possono derivare da questi tipi per eseguire un lavoro asincrono senza contenere il thread dell'utilità di pianificazione del flusso di lavoro e senza bloccare alcuna delle attività che possono essere eseguite in parallelo.</span><span class="sxs-lookup"><span data-stu-id="301d1-167">Custom activities can derive from these types to perform asynchronous work without holding the workflow scheduler thread and blocking any activities that may be able to run in parallel.</span></span>

### <a name="messaging"></a><span data-ttu-id="301d1-168">Messaggistica</span><span class="sxs-lookup"><span data-stu-id="301d1-168">Messaging</span></span>
 <span data-ttu-id="301d1-169">Inizialmente WF3 disponeva di un supporto molto limitato della messaggistica tramite eventi esterni o chiamate di servizi Web.</span><span class="sxs-lookup"><span data-stu-id="301d1-169">Initially WF3 had very limited messaging support through external events or web services invocations.</span></span> <span data-ttu-id="301d1-170">In .NET 3.5, i flussi di lavoro potrebbero essere implementati come i client WCF o esposte come servizi WCF tramite <xref:System.Workflow.Activities.SendActivity> e <xref:System.Workflow.Activities.ReceiveActivity>.</span><span class="sxs-lookup"><span data-stu-id="301d1-170">In .NET 3.5, workflows could be implemented as WCF clients or exposed as WCF services through <xref:System.Workflow.Activities.SendActivity> and <xref:System.Workflow.Activities.ReceiveActivity>.</span></span> <span data-ttu-id="301d1-171">In WF4 il concetto di programmazione della messaggistica basato sul flusso di lavoro è stato ulteriormente rafforzato la stretta integrazione di WCF per la logica di messaggistica in WF.</span><span class="sxs-lookup"><span data-stu-id="301d1-171">In WF4, the concept of workflow-based messaging programming has been further strengthened through the tight integration of WCF messaging logic into WF.</span></span>

 <span data-ttu-id="301d1-172">La pipeline di elaborazione dei messaggi unificata disponibile in WCF in .NET 4 consente servizi WF4 di offrire prestazioni nettamente migliori e scalabilità rispetto a WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-172">The unified message processing pipeline provided in WCF in .NET 4 helps WF4 services to have significantly better performance and scalability than WF3.</span></span> <span data-ttu-id="301d1-173">WF4 fornisce anche un supporto più completo alla programmazione della messaggistica, in grado di definire modelli di scambio dei messaggi (MEP, Message Exchange Pattern) più complessi.</span><span class="sxs-lookup"><span data-stu-id="301d1-173">WF4 also provides richer messaging programming support that can model complex Message Exchange Patterns (MEPs).</span></span> <span data-ttu-id="301d1-174">Gli sviluppatori possono usare contratti di servizio tipizzati per semplificare la programmazione oppure contratti di servizio non tipizzati per ottenere prestazioni migliori senza sostenere i costi della serializzazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-174">Developers can use either typed service contracts to achieve easy programming or un-typed service contracts to achieve better performance without paying serialization costs.</span></span> <span data-ttu-id="301d1-175">In WF4 il supporto alla memorizzazione canali nella cache lato client tramite la classe <xref:System.ServiceModel.Activities.SendMessageChannelCache> consente agli sviluppatori di compilare applicazioni veloci con il minimo sforzo.</span><span class="sxs-lookup"><span data-stu-id="301d1-175">The client-side channel caching support through the <xref:System.ServiceModel.Activities.SendMessageChannelCache> class in WF4 helps developers build fast applications with minimal effort.</span></span> <span data-ttu-id="301d1-176">Per altre informazioni, vedere [modifica dei livelli di condivisione della Cache per le attività Send](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span><span class="sxs-lookup"><span data-stu-id="301d1-176">For more information, see [Changing the Cache Sharing Levels for Send Activities](../wcf/feature-details/changing-the-cache-sharing-levels-for-send-activities.md).</span></span>

### <a name="declarative-programming"></a><span data-ttu-id="301d1-177">Programmazione dichiarativa</span><span class="sxs-lookup"><span data-stu-id="301d1-177">Declarative Programming</span></span>
 <span data-ttu-id="301d1-178">WF4 fornisce un framework di programmazione dichiarativa semplice e ben definito per modellare i processi e i servizi aziendali.</span><span class="sxs-lookup"><span data-stu-id="301d1-178">WF4 provides a clean and simple declarative programming framework to model business processes and services.</span></span> <span data-ttu-id="301d1-179">Il modello di programmazione supporta la composizione completamente dichiarativa delle attività, senza code-beside, semplificando notevolmente la creazione dei flussi di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-179">The programming model supports fully declarative composition of activities, with no code-beside, greatly simplifying workflow authoring.</span></span> <span data-ttu-id="301d1-180">In [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], il framework di programmazione dichiarativa basato su XAML è stato unificato in un singolo assembly System.Xaml.dll per supportare sia WPF sia WF.</span><span class="sxs-lookup"><span data-stu-id="301d1-180">In [!INCLUDE[netfx40_short](../../../includes/netfx40-short-md.md)], the XAML-based declarative programming framework has been unified into the single assembly System.Xaml.dll to support both WPF and WF.</span></span>

 <span data-ttu-id="301d1-181">In WF4 il linguaggio XAML fornisce un'esperienza realmente dichiarativa e consente di definire completamente il flusso di lavoro nel markup XML, facendo riferimento alle attività e ai tipi compilati tramite .NET.</span><span class="sxs-lookup"><span data-stu-id="301d1-181">In WF4, XAML provides a truly declarative experience and allows for the entire definition of the workflow to be defined in XML markup, referencing activities and types built using .NET.</span></span> <span data-ttu-id="301d1-182">Questa operazione risultava difficile in WF3 con il formato XOML senza usare una logica code-behind personalizzata.</span><span class="sxs-lookup"><span data-stu-id="301d1-182">This was difficult to do in WF3 with XOML format without involving custom code-behind logic.</span></span> <span data-ttu-id="301d1-183">Nuovo stack di XAML in .NET 4 offre prestazioni notevolmente migliori nella serializzazione/deserializzazione degli elementi del flusso di lavoro e rende la programmazione dichiarativa più interessante e affidabile.</span><span class="sxs-lookup"><span data-stu-id="301d1-183">The new XAML-stack in .NET 4 has much better performance in serializing/deserializing workflow artifacts and makes declarative programming more attractive and solid.</span></span>

### <a name="workflow-designer"></a><span data-ttu-id="301d1-184">Progettazione flussi di lavoro</span><span class="sxs-lookup"><span data-stu-id="301d1-184">Workflow Designer</span></span>
 <span data-ttu-id="301d1-185">Il supporto alla programmazione completamente dichiarativa di WF4 impone in modo esplicito requisiti superiori per le prestazioni in fase di progettazione dei flussi di lavoro di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-185">Fully declarative programming support for WF4 explicitly imposes higher requirements for design time performance for large workflows.</span></span> <span data-ttu-id="301d1-186">In WF4 la progettazione flussi di lavoro offre una maggiore scalabilità per i flussi di lavoro di grandi dimensioni rispetto a WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-186">The Workflow designer in WF4 has much better scalability for large workflows than that for WF3.</span></span> <span data-ttu-id="301d1-187">Grazie al supporto per la virtualizzazione dell'interfaccia utente, è in grado di caricare facilmente un flusso di 1000 attività in pochi secondi, mentre è quasi impossibile caricare un flusso di lavoro di poche centinaia di attività con la finestra di progettazione di WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-187">With UI virtualization support, the designer can easily load a large workflow of 1000 activities in a few seconds, while it is almost impossible to load a workflow of a few hundred activities with the WF3 designer.</span></span>

## <a name="component-level-performance-comparisons"></a><span data-ttu-id="301d1-188">Confronto delle prestazioni a livello di componente</span><span class="sxs-lookup"><span data-stu-id="301d1-188">Component-level Performance Comparisons</span></span>
 <span data-ttu-id="301d1-189">Questa sezione contiene i dati sui confronti diretti tra le singole attività nei flussi di lavoro di WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-189">This section contains data on direct comparisons between individual activities in WF3 and WF4 workflows.</span></span>  <span data-ttu-id="301d1-190">Le aree principali quali la persistenza hanno un impatto maggiore sulle prestazioni rispetto ai componenti delle singole attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-190">Key areas like persistence have a more profound impact on performance than the individual activity components.</span></span>  <span data-ttu-id="301d1-191">Tuttavia, in WF4 i miglioramenti delle prestazioni nei singoli componenti sono significativi perché ora i componenti sono sufficientemente veloci per essere confrontati in base alla logica di orchestrazione codificata manualmente.</span><span class="sxs-lookup"><span data-stu-id="301d1-191">The performance improvements in individual components in WF4 are important though because the components are now fast enough to be compared against hand-coded orchestration logic.</span></span>  <span data-ttu-id="301d1-192">Un esempio di cui è descritta nella sezione successiva: "Scenario di composizione Service".</span><span class="sxs-lookup"><span data-stu-id="301d1-192">An example of which is covered in the next section: "Service Composition Scenario."</span></span>

### <a name="environment-setup"></a><span data-ttu-id="301d1-193">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-193">Environment Setup</span></span>
 ![Configurazione dell'ambiente per la misurazione delle prestazioni del flusso di lavoro](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="301d1-195">Nella figura sopra riportata è illustrata la configurazione del computer usata per la misurazione della prestazione a livello di componente:</span><span class="sxs-lookup"><span data-stu-id="301d1-195">The above figure shows the machine configuration used for component-level performance measurement.</span></span> <span data-ttu-id="301d1-196">un unico server e cinque client connessi tramite un'interfaccia di rete Ethernet da 1 Gbps.</span><span class="sxs-lookup"><span data-stu-id="301d1-196">A single server and five clients connected over one 1-Gbps Ethernet network interface.</span></span> <span data-ttu-id="301d1-197">Per facilitare le misurazioni, il server è configurato per l'uso di un singolo core di un server dual-proc/quad-core in cui viene eseguito Windows Server 2008 x86.</span><span class="sxs-lookup"><span data-stu-id="301d1-197">For easy measurements, the server is configured to use a single core of a dual-proc/quad-core server  running Windows Server 2008 x86.</span></span> <span data-ttu-id="301d1-198">L'utilizzo della CPU del sistema viene mantenuto quasi al 100%.</span><span class="sxs-lookup"><span data-stu-id="301d1-198">The system CPU utilization is maintained at nearly 100%.</span></span>

### <a name="test-details"></a><span data-ttu-id="301d1-199">Dettagli test</span><span class="sxs-lookup"><span data-stu-id="301d1-199">Test Details</span></span>
 <span data-ttu-id="301d1-200">In WF3 <xref:System.Workflow.Activities.CodeActivity> è probabilmente l'attività più semplice utilizzabile in un flusso di lavoro di WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-200">The WF3 <xref:System.Workflow.Activities.CodeActivity> is likely the simplest activity that can be used in a WF3 workflow.</span></span>  <span data-ttu-id="301d1-201">L'attività chiama un metodo nel code-behind in cui il programmatore del flusso di lavoro può inserire del codice personalizzato.</span><span class="sxs-lookup"><span data-stu-id="301d1-201">The activity calls a method in the code-behind that the workflow programmer can put custom code into.</span></span>  <span data-ttu-id="301d1-202">In WF4 non esiste nulla di analogo all'attività <xref:System.Workflow.Activities.CodeActivity> di WF3 che fornisca la stessa funzionalità.</span><span class="sxs-lookup"><span data-stu-id="301d1-202">In WF4, there is no direct analog to the WF3 <xref:System.Workflow.Activities.CodeActivity> that provides the same functionality.</span></span>  <span data-ttu-id="301d1-203">Occorre tenere presente che in WF4 esiste una classe base <xref:System.Activities.CodeActivity> che non è correlata a <xref:System.Workflow.Activities.CodeActivity> in WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-203">Note that there is a <xref:System.Activities.CodeActivity> base class in WF4 that is not related to the WF3 <xref:System.Workflow.Activities.CodeActivity>.</span></span>  <span data-ttu-id="301d1-204">È consigliabile che gli autori dei flussi di lavoro creino attività personalizzate e compilino flussi di lavoro solo XAML.</span><span class="sxs-lookup"><span data-stu-id="301d1-204">Workflow authors are encouraged to create custom activities and build XAML-only workflows.</span></span>  <span data-ttu-id="301d1-205">Nei test riportati di seguito, nei flussi di lavoro WF4 viene usata un'attività denominata `Comment` al posto di una attività <xref:System.Workflow.Activities.CodeActivity> vuota.</span><span class="sxs-lookup"><span data-stu-id="301d1-205">In the tests below, an activity called `Comment` is used in place of an empty <xref:System.Workflow.Activities.CodeActivity> in WF4 workflows.</span></span>  <span data-ttu-id="301d1-206">Il codice dell'attività `Comment` è il seguente:</span><span class="sxs-lookup"><span data-stu-id="301d1-206">The code in the `Comment` activity is as follows:</span></span>

```csharp
[ContentProperty("Body")]
    public sealed class Comment : CodeActivity
    {
        public Comment()
            : base()
        {
        }

        [DefaultValue(null)]
        public Activity Body
        {
            get;
            set;
        }

        protected override void Execute(CodeActivityContext context)
        {
        }
    }
```

### <a name="empty-workflow"></a><span data-ttu-id="301d1-207">Flusso di lavoro vuoto</span><span class="sxs-lookup"><span data-stu-id="301d1-207">Empty Workflow</span></span>
 <span data-ttu-id="301d1-208">In questo test viene usato un flusso di lavoro in sequenza senza attività figlio.</span><span class="sxs-lookup"><span data-stu-id="301d1-208">This test uses a sequence workflow with no child activities.</span></span>

### <a name="single-activity"></a><span data-ttu-id="301d1-209">Singola attività</span><span class="sxs-lookup"><span data-stu-id="301d1-209">Single Activity</span></span>
 <span data-ttu-id="301d1-210">Il flusso di lavoro è un flusso di lavoro in sequenza che contiene un'attività figlio.</span><span class="sxs-lookup"><span data-stu-id="301d1-210">The workflow is a sequence workflow containing one child activity.</span></span>  <span data-ttu-id="301d1-211">Si tratta di un'attività <xref:System.Workflow.Activities.CodeActivity> senza codice nel caso di WF3 e di un'attività `Comment` nel caso di WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-211">The activity is a <xref:System.Workflow.Activities.CodeActivity> with no code in the WF3 case and a `Comment` activity in the WF4 case.</span></span>

### <a name="while-with-1000-iterations"></a><span data-ttu-id="301d1-212">While con 1000 iterazioni</span><span class="sxs-lookup"><span data-stu-id="301d1-212">While with 1000 Iterations</span></span>
 <span data-ttu-id="301d1-213">Il flusso di lavoro in sequenza contiene un'attività <xref:System.Activities.Statements.While> con un'attività figlio nel ciclo che non esegue alcun lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-213">The sequence workflow contains one <xref:System.Activities.Statements.While> activity with one child activity in the loop that does not perform any work.</span></span>

### <a name="replicator-compared-to-parallelforeach"></a><span data-ttu-id="301d1-214">Confronto tra Replicator e ParallelForEach</span><span class="sxs-lookup"><span data-stu-id="301d1-214">Replicator compared to ParallelForEach</span></span>
 <span data-ttu-id="301d1-215">In WF3 <xref:System.Workflow.Activities.ReplicatorActivity> offre modalità di esecuzione sequenziali e parallele.</span><span class="sxs-lookup"><span data-stu-id="301d1-215"><xref:System.Workflow.Activities.ReplicatorActivity> in WF3 has sequential and parallel execution modes.</span></span>  <span data-ttu-id="301d1-216">In modalità sequenziale, le prestazioni dell'attività sono simili a <xref:System.Workflow.Activities.WhileActivity>.</span><span class="sxs-lookup"><span data-stu-id="301d1-216">In sequential mode, the activity’s performance is similar to the <xref:System.Workflow.Activities.WhileActivity>.</span></span>  <span data-ttu-id="301d1-217"><xref:System.Workflow.Activities.ReplicatorActivity> è più utile per l'esecuzione parallela.</span><span class="sxs-lookup"><span data-stu-id="301d1-217">The <xref:System.Workflow.Activities.ReplicatorActivity> is most useful for parallel execution.</span></span>  <span data-ttu-id="301d1-218">In WF4 l'attività analoga è <xref:System.Activities.Statements.ParallelForEach%601>.</span><span class="sxs-lookup"><span data-stu-id="301d1-218">The WF4 analog for this is the <xref:System.Activities.Statements.ParallelForEach%601> activity.</span></span>

 <span data-ttu-id="301d1-219">Nel diagramma seguente vengono mostrati i flussi di lavoro usati per questo test.</span><span class="sxs-lookup"><span data-stu-id="301d1-219">The following diagram shows the workflows used for this test.</span></span> <span data-ttu-id="301d1-220">Il flusso di lavoro di WF3 è a sinistra e il flusso di lavoro di WF4 è a destra.</span><span class="sxs-lookup"><span data-stu-id="301d1-220">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

 ![WF3 ReplicatorActivity e WF4 ParallelForEach](./media/performance/replicator-parallel-wf3-wf4.gif)

### <a name="sequential-workflow-with-five-activities"></a><span data-ttu-id="301d1-222">Flusso di lavoro sequenziale con cinque attività</span><span class="sxs-lookup"><span data-stu-id="301d1-222">Sequential Workflow with Five Activities</span></span>
 <span data-ttu-id="301d1-223">Questo test intende mostrare l'effetto dell'esecuzione in sequenza di più attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-223">This test is meant to show the effect of having several activities execute in sequence.</span></span>  <span data-ttu-id="301d1-224">La sequenza è composta da 5 attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-224">There are five activities in the sequence.</span></span>

### <a name="transaction-scope"></a><span data-ttu-id="301d1-225">Ambito della transazione</span><span class="sxs-lookup"><span data-stu-id="301d1-225">Transaction Scope</span></span>
 <span data-ttu-id="301d1-226">Il test dell'ambito della transazione è leggermente diverso da altri test in quanto non viene creata una nuova istanza del flusso di lavoro per ogni iterazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-226">The transaction scope test differs from the other tests slightly in that a new workflow instance is not created for every iteration.</span></span>  <span data-ttu-id="301d1-227">Al contrario, il flusso di lavoro viene strutturato con un ciclo while contenente un'attività <xref:System.Activities.Statements.TransactionScope> che contiene una sola attività che non funziona.</span><span class="sxs-lookup"><span data-stu-id="301d1-227">Instead, the workflow is structured with a while loop containing a <xref:System.Activities.Statements.TransactionScope> activity containing a single activity that does no work.</span></span>  <span data-ttu-id="301d1-228">Ogni esecuzione di un batch di 50 iterazioni tramite il ciclo while viene contata come un'unica operazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-228">Each run of a batch of 50 iterations through the while loop is counted as a single operation.</span></span>

### <a name="compensation"></a><span data-ttu-id="301d1-229">Compensazione</span><span class="sxs-lookup"><span data-stu-id="301d1-229">Compensation</span></span>
 <span data-ttu-id="301d1-230">Il flusso di lavoro di WF3 dispone di una sola attività compensabile denominata `WorkScope`.</span><span class="sxs-lookup"><span data-stu-id="301d1-230">The WF3 workflow has a single compensatable activity named `WorkScope`.</span></span>  <span data-ttu-id="301d1-231">L'attività implementa l'interfaccia <xref:System.Workflow.ComponentModel.ICompensatableActivity>:</span><span class="sxs-lookup"><span data-stu-id="301d1-231">The activity simply implements the <xref:System.Workflow.ComponentModel.ICompensatableActivity> interface:</span></span>

```csharp
class WorkScope :
        CompositeActivity, ICompensatableActivity
    {
        public WorkScope() : base() { }

        public WorkScope(string name)
        {
            this.Name = name;
        }

        public ActivityExecutionStatus Compensate(
            ActivityExecutionContext executionContext)
        {
            return ActivityExecutionStatus.Closed;
        }
    }
```

 <span data-ttu-id="301d1-232">Il gestore fault è destinato all'attività `WorkScope`. Il flusso di lavoro di WF4 è altrettanto semplicistico.</span><span class="sxs-lookup"><span data-stu-id="301d1-232">The fault handler targets the `WorkScope` activity.The WF4 workflow is equally simplistic.</span></span>  <span data-ttu-id="301d1-233">Un'attività <xref:System.Activities.Statements.CompensableActivity> dispone di un corpo e di un gestore di compensazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-233">A <xref:System.Activities.Statements.CompensableActivity> has a body and a compensation handler.</span></span>  <span data-ttu-id="301d1-234">Successivamente è presente nella sequenza una compensazione esplicita.</span><span class="sxs-lookup"><span data-stu-id="301d1-234">An explicit compensate is next in the sequence.</span></span>  <span data-ttu-id="301d1-235">L'attività Body e l'attività del gestore di compensazione sono entrambe implementazioni vuote:</span><span class="sxs-lookup"><span data-stu-id="301d1-235">The body activity and compensation handler activity are both empty implementations:</span></span>

```
public sealed class CompensableActivityEmptyCompensation : CodeActivity
    {
        public CompensableActivityEmptyCompensation()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
    public sealed class CompensableActivityEmptyBody : CodeActivity
    {
        public CompensableActivityEmptyBody()
            : base() { }

        public Activity Body { get; set; }

        protected override void Execute(CodeActivityContext context) { }
    }
```

<span data-ttu-id="301d1-236">Il diagramma seguente illustra il flusso di lavoro di compensazione base.</span><span class="sxs-lookup"><span data-stu-id="301d1-236">The following diagram shows the basic compensation workflow.</span></span> <span data-ttu-id="301d1-237">Il flusso di lavoro di WF3 è a sinistra e il flusso di lavoro di WF4 è a destra.</span><span class="sxs-lookup"><span data-stu-id="301d1-237">The WF3 workflow is on the left and the WF4 workflow is on the right.</span></span>

![Flussi di lavoro di compensazione base di WF3 e WF4](./media/performance/basic-compensation-workflows-wf3-wf4.gif)

### <a name="performance-test-results"></a><span data-ttu-id="301d1-239">Risultati test delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="301d1-239">Performance Test Results</span></span>

 ![Tabella che mostra i dati dei risultati di test sulle prestazioni](./media/performance/performance-test-data.gif)

 ![Istogramma a colonne confronto tra WF3 e WF4 dati di test delle prestazioni](./media/performance/performance-test-chart.gif)

 <span data-ttu-id="301d1-242">Tutti i test sono misurati in flussi di lavoro al secondo, fatta eccezione per il test dell'ambito della transazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-242">All tests are measured in workflows per second with the exception of the transaction scope test.</span></span>  <span data-ttu-id="301d1-243">Come è possibile osservare nell'esempio sopra riportato, in generale le prestazioni del runtime di [!INCLUDE[wf1](../../../includes/wf1-md.md)] sono migliorate, specialmente nelle aree che richiedono più esecuzioni della stessa attività come il ciclo while.</span><span class="sxs-lookup"><span data-stu-id="301d1-243">As can be seen above, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime performance has improved across the board, especially in areas that require multiple executions of the same activity like the while loop.</span></span>

## <a name="service-composition-scenario"></a><span data-ttu-id="301d1-244">Scenario relativo alla composizione dei servizi</span><span class="sxs-lookup"><span data-stu-id="301d1-244">Service Composition Scenario</span></span>
 <span data-ttu-id="301d1-245">Come illustrato nella sezione precedente "confronto delle prestazioni a livello di componente" si è verificato una riduzione significativa nel sovraccarico tra WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-245">As is shown in the previous section, "Component-level Performance Comparisons," there has been a significant reduction in overhead between WF3 and WF4.</span></span>  <span data-ttu-id="301d1-246">Servizi flusso di lavoro WCF possono ora corrispondono quasi le prestazioni dei servizi codificati manualmente WCF ma non è stato tutti i vantaggi del [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span><span class="sxs-lookup"><span data-stu-id="301d1-246">WCF workflow services can now almost match the performance of hand-coded WCF services but still have all the benefits of the [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="301d1-247">Questo scenario di test Confronta un servizio WCF in un servizio di flusso di lavoro WCF in WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-247">This test scenario compares a WCF service against a WCF workflow service in WF4.</span></span>

### <a name="online-store-service"></a><span data-ttu-id="301d1-248">Servizio di negozio online</span><span class="sxs-lookup"><span data-stu-id="301d1-248">Online Store Service</span></span>
 <span data-ttu-id="301d1-249">Uno dei punti di forza di Windows Workflow Foundation è la possibilità di comporre i processi usando più servizi.</span><span class="sxs-lookup"><span data-stu-id="301d1-249">One of the strengths of Windows Workflow Foundation is the ability to compose processes using several services.</span></span>  <span data-ttu-id="301d1-250">Per questo esempio, supponiamo che ci sia un servizio di negozio online che orchestra due chiamate del servizio per l'acquisto di un ordine.</span><span class="sxs-lookup"><span data-stu-id="301d1-250">For this example, there is an online store service that orchestrates two service calls to purchase an order.</span></span>  <span data-ttu-id="301d1-251">Il primo passaggio è convalidare l'ordine usando un servizio di convalida dell'ordine.</span><span class="sxs-lookup"><span data-stu-id="301d1-251">The first step is to validate the order using an Order Validating Service.</span></span>  <span data-ttu-id="301d1-252">Il secondo passaggio è compilare l'ordine usando un servizio magazzino.</span><span class="sxs-lookup"><span data-stu-id="301d1-252">The second step is to fill the order using a Warehouse Service.</span></span>

 <span data-ttu-id="301d1-253">I due servizi di back-end, ovvero il servizio di convalida dell'ordine e il servizio magazzino, rimangono invariati per entrambi i test.</span><span class="sxs-lookup"><span data-stu-id="301d1-253">The two backend services, Order Validating Service and Warehouse Service, remain the same for both tests.</span></span>  <span data-ttu-id="301d1-254">La parte che cambia è il servizio di negozio online che esegue l'orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-254">The part that changes is the Online Store Service that performs the orchestration.</span></span>  <span data-ttu-id="301d1-255">In un caso, il servizio è codificato manualmente come un servizio WCF.</span><span class="sxs-lookup"><span data-stu-id="301d1-255">In one case, the service is hand-coded as a WCF service.</span></span>  <span data-ttu-id="301d1-256">Per gli altri casi, il servizio viene scritto come un servizio di flusso di lavoro WCF in WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-256">For the other case, the service is written as a WCF workflow service in WF4.</span></span> <span data-ttu-id="301d1-257">Durante l'esecuzione del test, le funzionalità specifiche di [!INCLUDE[wf1](../../../includes/wf1-md.md)], ad esempio il rilevamento e la persistenza, sono disattivate.</span><span class="sxs-lookup"><span data-stu-id="301d1-257">[!INCLUDE[wf1](../../../includes/wf1-md.md)]-specific features like tracking and persistence are turned off for this test.</span></span>

### <a name="environment"></a><span data-ttu-id="301d1-258">Ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-258">Environment</span></span>
![Configurazione dell'ambiente per la misurazione delle prestazioni](./media/performance/performance-test-environment.gif)

 <span data-ttu-id="301d1-260">Le richieste del client vengono inviate al servizio di negozio online tramite HTTP da più computer.</span><span class="sxs-lookup"><span data-stu-id="301d1-260">Client requests are made to the Online Store Service via HTTP from multiple computers.</span></span>  <span data-ttu-id="301d1-261">Un unico computer ospita tutti e tre i servizi.</span><span class="sxs-lookup"><span data-stu-id="301d1-261">A single computer hosts all three services.</span></span>  <span data-ttu-id="301d1-262">Il livello di trasporto tra il servizio di negozio online e i servizi di back-end è TCP o HTTP.</span><span class="sxs-lookup"><span data-stu-id="301d1-262">The transport layer between the Online Store Service and the backend services is TCP or HTTP.</span></span>  <span data-ttu-id="301d1-263">La misurazione di operazioni/secondo è basata sul numero di chiamate `PurchaseOrder` completate inviate al servizio di negozio online.</span><span class="sxs-lookup"><span data-stu-id="301d1-263">The measurement of operations/second is based on the number of completed `PurchaseOrder` calls made to the Online Store Service.</span></span>  <span data-ttu-id="301d1-264">Il pool di canali è una nuova funzionalità disponibile in WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-264">Channel pooling is a new feature available in WF4.</span></span>  <span data-ttu-id="301d1-265">In WCF parte di questo pool di canali di test non viene fornito automaticamente la casella in modo che è stata utilizzata un'implementazione codificati manualmente di una semplice tecnica di pool nel servizio di Store Online.</span><span class="sxs-lookup"><span data-stu-id="301d1-265">In the WCF portion of this test channel pooling is not provided out of the box so a hand-coded implementation of a simple pooling technique was used in the Online Store Service.</span></span>

### <a name="performance"></a><span data-ttu-id="301d1-266">Prestazioni</span><span class="sxs-lookup"><span data-stu-id="301d1-266">Performance</span></span>
![Istogramma che mostra le prestazioni del servizio Store online](./media/performance/online-store-performance-graph.gif)

 <span data-ttu-id="301d1-268">Se si collegano i servizi TCP di back-end senza il pool di canali, il servizio di [!INCLUDE[wf1](../../../includes/wf1-md.md)] ha un impatto del 17,2% sulla velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="301d1-268">Connecting to backend TCP services without channel pooling, the [!INCLUDE[wf1](../../../includes/wf1-md.md)] service has a 17.2% impact on throughput.</span></span>  <span data-ttu-id="301d1-269">Con il pool di canali, la riduzione delle prestazioni è di circa il 23,8%.</span><span class="sxs-lookup"><span data-stu-id="301d1-269">With channel pooling, the penalty is about 23.8%.</span></span>  <span data-ttu-id="301d1-270">Per il protocollo HTTP, l'impatto è decisamente inferiore: 4,3% senza il pool e 8,1% con il pool.</span><span class="sxs-lookup"><span data-stu-id="301d1-270">For HTTP, the impact is much less: 4.3% without pooling and 8.1% with pooling.</span></span>  <span data-ttu-id="301d1-271">È anche importante notare che il pool di canali non risulta particolarmente vantaggioso quando si usa HTTP.</span><span class="sxs-lookup"><span data-stu-id="301d1-271">It is also important to note that the channel pooling provides very little benefit when using HTTP.</span></span>

 <span data-ttu-id="301d1-272">Se è presente un sovraccarico del runtime di WF4 rispetto a un servizio WCF codificato manualmente in questo test, può essere considerato uno scenario peggiore.</span><span class="sxs-lookup"><span data-stu-id="301d1-272">While there is overhead from the WF4 runtime compared with a hand-coded WCF service in this test, it could be considered a worst-case scenario.</span></span>  <span data-ttu-id="301d1-273">I due servizi di back-end in questo test svolgono una quantità minima di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-273">The two backend services in this test do very little work.</span></span>  <span data-ttu-id="301d1-274">In uno scenario end-to-end reale, questi servizi eseguirebbero operazioni più costose, quali chiamate al database, minimizzando l'impatto sulle prestazioni del livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="301d1-274">In a real end-to-end scenario, these services would perform more expensive operations like database calls, making the performance impact of the transport layer less important.</span></span>  <span data-ttu-id="301d1-275">Tutte queste funzionalità, insieme ai vantaggi offerti dalle funzionalità di WF4, rendono Workflow Foundation una scelta valida per la creazione di servizi di orchestrazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-275">This plus the benefits of the features available in WF4 makes Workflow Foundation a viable choice for creating orchestration services.</span></span>

## <a name="key-performance-considerations"></a><span data-ttu-id="301d1-276">Considerazioni sulle prestazioni principali</span><span class="sxs-lookup"><span data-stu-id="301d1-276">Key Performance Considerations</span></span>
 <span data-ttu-id="301d1-277">Le aree funzionali di questa sezione, fatta eccezione per l'interoperabilità, sono notevolmente cambiate in WF4 rispetto a WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-277">The feature areas in this section, with the exception of interop, have dramatically changed between WF3 and WF4.</span></span>  <span data-ttu-id="301d1-278">Queste differenze influiscono sulla progettazione delle applicazioni flusso di lavoro nonché sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-278">This affects the design of workflow applications as well as the performance.</span></span>

#### <a name="workflow-activation-latency"></a><span data-ttu-id="301d1-279">Latenza di attivazione del flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="301d1-279">Workflow Activation Latency</span></span>
 <span data-ttu-id="301d1-280">In un'applicazione di servizio del flusso di lavoro WCF, la latenza per l'avvio di un nuovo flusso di lavoro o il caricamento di un flusso di lavoro esistente è importante in quanto quest'ultimo può essere blocchi.</span><span class="sxs-lookup"><span data-stu-id="301d1-280">In a WCF workflow service application, the latency for starting a new workflow or loading an existing workflow is important as it can be blocking.</span></span>  <span data-ttu-id="301d1-281">Questo test case misura un host XOML di WF3 rispetto a un host XAMLX di WF4 in un scenario tipico.</span><span class="sxs-lookup"><span data-stu-id="301d1-281">This test case measures a WF3 XOML host against a WF4 XAMLX host in a typical scenario.</span></span>

##### <a name="environment-setup"></a><span data-ttu-id="301d1-282">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-282">Environment Setup</span></span>
 ![Impostazione dell'ambiente per i test di latenza e velocità effettiva](./media/performance/latency-throughput-environment-setup.gif)

##### <a name="test-setup"></a><span data-ttu-id="301d1-284">Impostazione del test</span><span class="sxs-lookup"><span data-stu-id="301d1-284">Test Setup</span></span>
 <span data-ttu-id="301d1-285">Nello scenario, un computer client contatta un servizio del flusso di lavoro WCF usando la correlazione basata sul contesto.</span><span class="sxs-lookup"><span data-stu-id="301d1-285">In the scenario, a client computer contacts a WCF workflow service using context-based correlation.</span></span>  <span data-ttu-id="301d1-286">La correlazione del contesto richiede una speciale associazione del contesto e usa un'intestazione del contesto o un cookie per mettere in relazione i messaggi con l'istanza di flusso di lavoro corretta.</span><span class="sxs-lookup"><span data-stu-id="301d1-286">Context correlation requires a special context binding and uses a context header or cookie to relate messages to the correct workflow instance.</span></span>  <span data-ttu-id="301d1-287">Ciò garantisce migliori prestazioni in quanto non è necessario analizzare il corpo del messaggio, dato che l'ID della correlazione si trova nell'intestazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="301d1-287">It has a performance benefit in that the correlation Id is located in the message header so the message body does not need to be parsed.</span></span>

 <span data-ttu-id="301d1-288">Il servizio creerà un nuovo flusso di lavoro con la richiesta e invierà una risposta immediata in modo che la misura della latenza non includa il tempo impiegato per eseguire il flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-288">The service will create a new workflow with the request and send an immediate response so that the measurement of latency does not include the time spent running the workflow.</span></span>  <span data-ttu-id="301d1-289">Il flusso di lavoro di WF3 è XOML con un code-behind e il flusso di lavoro di WF4 è completamente XAML.</span><span class="sxs-lookup"><span data-stu-id="301d1-289">The WF3 workflow is XOML with a code-behind and the WF4 workflow is entirely XAML.</span></span>  <span data-ttu-id="301d1-290">Un flusso di lavoro di WF4 è simile al seguente:</span><span class="sxs-lookup"><span data-stu-id="301d1-290">The WF4 workflow looks like this:</span></span>

 ![Flusso di lavoro di WF4 correlazione ambito](./media/performance/wf4-correlationscope-workflow.gif)

 <span data-ttu-id="301d1-292">L'attività <xref:System.ServiceModel.Activities.Receive> crea l'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-292">The <xref:System.ServiceModel.Activities.Receive> activity creates the workflow instance.</span></span>  <span data-ttu-id="301d1-293">Un valore passato nel messaggio ricevuto viene restituito nel messaggio di risposta.</span><span class="sxs-lookup"><span data-stu-id="301d1-293">A value passed in the received message is echoed in the reply message.</span></span>  <span data-ttu-id="301d1-294">Una sequenza che segue la risposta contiene il resto del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-294">A sequence following the reply contains the rest of the workflow.</span></span>  <span data-ttu-id="301d1-295">Nel caso sopra menzionato, viene mostrata solo un'attività di commento.</span><span class="sxs-lookup"><span data-stu-id="301d1-295">In the above case, only one comment activity is shown.</span></span>  <span data-ttu-id="301d1-296">Il numero di attività di commento è stato modificato per simulare la complessità del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-296">The number of comment activities is changed to simulate workflow complexity.</span></span>  <span data-ttu-id="301d1-297">Un'attività di commento equivale a un'attività <xref:System.Workflow.Activities.CodeActivity> di WF3 che non esegue alcun lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-297">A comment activity is equivalent to a WF3 <xref:System.Workflow.Activities.CodeActivity> that performs no work.</span></span> <span data-ttu-id="301d1-298">Per altre informazioni sull'attività di commento, vedere la sezione "confronto delle prestazioni a livello di componente" più indietro in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-298">For more information about the comment activity, see the "Component-level Performance Comparison" section earlier in this article.</span></span>

##### <a name="test-results"></a><span data-ttu-id="301d1-299">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-299">Test Results</span></span>

 <span data-ttu-id="301d1-300">Latenza fredda e calda per i servizi del flusso di lavoro WCF:</span><span class="sxs-lookup"><span data-stu-id="301d1-300">Cold and warm latency for WCF workflow services:</span></span>

 ![Istogramma che mostra la latenza fredda e calda per i servizi del flusso di lavoro WCF usando WF3 e WF4](./media/performance/latency-results-graph.gif)

 <span data-ttu-id="301d1-302">Nel grafico precedente, latenza fredda si riferisce al caso in cui è non presente <xref:System.ServiceModel.WorkflowServiceHost> per il flusso di lavoro specificato.</span><span class="sxs-lookup"><span data-stu-id="301d1-302">In the previous chart, cold refers to the case where there is not an existing <xref:System.ServiceModel.WorkflowServiceHost> for the given workflow.</span></span>  <span data-ttu-id="301d1-303">In altre parole, la latenza fredda si verifica quando il flusso di lavoro viene usato per la prima volta ed è necessario compilare XOML o XAML.</span><span class="sxs-lookup"><span data-stu-id="301d1-303">In other words, cold latency is when the workflow is being used for the first time and the XOML or XAML needs to be compiled.</span></span>  <span data-ttu-id="301d1-304">La latenza calda è il tempo necessario per creare una nuova istanza del flusso di lavoro quando il tipo di flusso di lavoro è già stato compilato.</span><span class="sxs-lookup"><span data-stu-id="301d1-304">Warm latency is the time to create a new workflow instance when the workflow type has already been compiled.</span></span>  <span data-ttu-id="301d1-305">La complessità del flusso di lavoro non fa molta differenza nel test case di WF4, mentre ha una progressione lineare nel test case di WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-305">The complexity of the workflow makes very little difference in the WF4 case but has a linear progression in the WF3 case.</span></span>

#### <a name="correlation-throughput"></a><span data-ttu-id="301d1-306">Velocità effettiva della correlazione</span><span class="sxs-lookup"><span data-stu-id="301d1-306">Correlation Throughput</span></span>
 <span data-ttu-id="301d1-307">WF4 offre una nuova funzionalità di correlazione basata sul contenuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-307">WF4 introduces a new content-based correlation feature.</span></span>  <span data-ttu-id="301d1-308">WF3 offriva solo la correlazione basata sul contesto.</span><span class="sxs-lookup"><span data-stu-id="301d1-308">WF3 provided only context-based correlation.</span></span>  <span data-ttu-id="301d1-309">Correlazione basata sul contesto poteva essere eseguita solo su specifiche associazioni di canale WCF.</span><span class="sxs-lookup"><span data-stu-id="301d1-309">Context-based correlation could only be done over specific WCF channel bindings.</span></span>  <span data-ttu-id="301d1-310">Quando vengono usate queste associazioni, l'ID del flusso di lavoro viene inserito nell'intestazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="301d1-310">The workflow Id is inserted into the message header when using these bindings.</span></span>  <span data-ttu-id="301d1-311">Il runtime di WF3 poteva identificare un flusso di lavoro solo dall'ID.  Grazie alla correlazione basata sul contenuto, l'autore del flusso di lavoro può creare una chiave di correlazione da un dato pertinente, come un numero di conto o un ID cliente.</span><span class="sxs-lookup"><span data-stu-id="301d1-311">The WF3 runtime could only identify a workflow by its Id.  With content-based correlation, the workflow author can create a correlation key out of a relevant piece of data like an account number or customer Id.</span></span>

 <span data-ttu-id="301d1-312">La correlazione basata sul contesto risulta vantaggiosa in termini di prestazioni in quanto la chiave di correlazione si trova nell'intestazione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="301d1-312">Context-based correlation has a performance advantage in that the correlation key is located in the message header.</span></span>  <span data-ttu-id="301d1-313">La chiave può essere letta dal messaggio senza deserializzare/copiare il messaggio.</span><span class="sxs-lookup"><span data-stu-id="301d1-313">The key can be read from the message without de-serialization/message-copying.</span></span>  <span data-ttu-id="301d1-314">Nella correlazione basata sul contenuto, la chiave di correlazione viene archiviata nel corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="301d1-314">In content-based correlation, the correlation key is stored in the message body.</span></span>  <span data-ttu-id="301d1-315">Per individuare la chiave, viene usata un'espressione XPath.</span><span class="sxs-lookup"><span data-stu-id="301d1-315">An XPath expression is used to locate the key.</span></span>  <span data-ttu-id="301d1-316">Il costo di questa elaborazione aggiuntiva dipende dalla dimensione del messaggio, dalla profondità della chiave nel corpo del messaggio e dal numero di chiavi.</span><span class="sxs-lookup"><span data-stu-id="301d1-316">The cost of this extra processing depends on the size of the message, depth of the key in the body, and the number of keys.</span></span>  <span data-ttu-id="301d1-317">Questo test confronta la correlazione basata sul contesto con quella basata sul contenuto ed evidenzia la riduzione del livello delle prestazioni in caso di utilizzo di più chiavi.</span><span class="sxs-lookup"><span data-stu-id="301d1-317">This test compares context- and content-based correlation and also shows the performance degradation when using multiple keys.</span></span>

#### <a name="environment-setup"></a><span data-ttu-id="301d1-318">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-318">Environment Setup</span></span>
![Configurazione dell'ambiente per test delle prestazioni del flusso di lavoro](./media/performance/performance-test-environment.gif)

#### <a name="test-setup"></a><span data-ttu-id="301d1-320">Impostazione del test</span><span class="sxs-lookup"><span data-stu-id="301d1-320">Test Setup</span></span>
<span data-ttu-id="301d1-321">![Test del flusso di lavoro di correlazione della velocità effettiva](./media/performance/correlation-throughput-workflow.gif "configurazione test di correlazione della velocità effettiva del flusso di lavoro")</span><span class="sxs-lookup"><span data-stu-id="301d1-321">![Correlation Throughput Workflow Test](./media/performance/correlation-throughput-workflow.gif "Correlation throughput workflow test setup")</span></span>

 <span data-ttu-id="301d1-322">Il flusso di lavoro precedente è uguale a quella usata nel [persistenza](#persistence) sezione.</span><span class="sxs-lookup"><span data-stu-id="301d1-322">The previous workflow is the same one used in the [Persistence](#persistence) section.</span></span> <span data-ttu-id="301d1-323">Per i test di correlazione senza persistenza, non è disponibile alcun provider di persistenza nel runtime installato.</span><span class="sxs-lookup"><span data-stu-id="301d1-323">For the correlation tests without persistence, there is no persistence provider installed in the runtime.</span></span> <span data-ttu-id="301d1-324">Correlazione si verifica in due posizioni: CreateOrder e CompleteOrder.</span><span class="sxs-lookup"><span data-stu-id="301d1-324">Correlation occurs in two places: CreateOrder and CompleteOrder.</span></span>

#### <a name="test-results"></a><span data-ttu-id="301d1-325">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-325">Test Results</span></span>
<span data-ttu-id="301d1-326">![Velocità effettiva della correlazione](./media/performance/correlation-throughput-graph.gif "grafico della velocità effettiva di correlazione")</span><span class="sxs-lookup"><span data-stu-id="301d1-326">![Correlation Throughput](./media/performance/correlation-throughput-graph.gif "Correlation throughput graph")</span></span>

 <span data-ttu-id="301d1-327">Questo grafico mostra una diminuzione delle prestazioni man mano che aumenta il numero di chiavi usate nella correlazione basata sul contenuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-327">This graph shows a decrease in performance as the number of keys used in content-based correlation increases.</span></span>  <span data-ttu-id="301d1-328">La somiglianza delle curve di TCP e HTTP indica il sovraccarico associato a questi protocolli.</span><span class="sxs-lookup"><span data-stu-id="301d1-328">The similarity in the curves between TCP and HTTP indicates the overhead associated with these protocols.</span></span>

#### <a name="correlation-with-persistence"></a><span data-ttu-id="301d1-329">Correlazione con persistenza</span><span class="sxs-lookup"><span data-stu-id="301d1-329">Correlation with Persistence</span></span>
 <span data-ttu-id="301d1-330">Con un flusso di lavoro persistente, la pressione della CPU derivante dalla correlazione basata sul contenuto passa dal runtime del flusso di lavoro al database SQL.</span><span class="sxs-lookup"><span data-stu-id="301d1-330">With a persisted workflow, the CPU pressure from content-based correlation shifts from the workflow runtime to the SQL database.</span></span>  <span data-ttu-id="301d1-331">Le stored procedure nel provider di persistenza SQL trovano la corrispondenza delle chiavi per individuare il flusso di lavoro adatto.</span><span class="sxs-lookup"><span data-stu-id="301d1-331">The stored procedures in the SQL persistence provider do the work of matching the keys to locate the appropriate workflow.</span></span>

 ![Grafico a linee che mostra i risultati di correlazione e persistenza](./media/performance/correlation-persistence-graph.gif)

 <span data-ttu-id="301d1-333">La correlazione basata sul contesto è ancora più veloce della correlazione basata sul contenuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-333">Context-based correlation is still faster than content-based correlation.</span></span>  <span data-ttu-id="301d1-334">Tuttavia, la differenza è minore in quanto la persistenza ha un impatto maggiore sulle prestazioni rispetto alla correlazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-334">However, the difference is less pronounced as persistence has more impact on performance than correlation.</span></span>

### <a name="complex-workflow-throughput"></a><span data-ttu-id="301d1-335">Velocità effettiva di un flusso di lavoro complesso</span><span class="sxs-lookup"><span data-stu-id="301d1-335">Complex Workflow Throughput</span></span>
 <span data-ttu-id="301d1-336">La complessità di un flusso di lavoro non viene misurata solo in base al numero di attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-336">The complexity of a workflow is not measured only by the number of activities.</span></span>  <span data-ttu-id="301d1-337">Le attività composte possono contenere molti figli, che a loro volta possono anche essere attività composte.</span><span class="sxs-lookup"><span data-stu-id="301d1-337">Composite activities can contain many children and those children can also be composite activities.</span></span>  <span data-ttu-id="301d1-338">Man mano che aumenta il numero di livelli di annidamento, aumenta anche il numero di attività che possono essere contemporaneamente in stato di esecuzione e il numero di variabili nello stato.</span><span class="sxs-lookup"><span data-stu-id="301d1-338">As the number of levels of nesting increases, so does the number of activities that can be currently in the executing state and the number of variables that can be in state.</span></span>  <span data-ttu-id="301d1-339">Questo test confronta la velocità effettiva di WF3 e WF4 in caso di esecuzione di flussi di lavoro complessi.</span><span class="sxs-lookup"><span data-stu-id="301d1-339">This test compares throughput between WF3 and WF4 when executing complex workflows.</span></span>

### <a name="test-setup"></a><span data-ttu-id="301d1-340">Impostazione del test</span><span class="sxs-lookup"><span data-stu-id="301d1-340">Test Setup</span></span>
 <span data-ttu-id="301d1-341">Questi test sono stati eseguiti su un computer a 4 vie con processore Intel Xeon X5355 da 2,66 GHz con 4 GB di RAM in cui è eseguito Windows Server 2008 x64.</span><span class="sxs-lookup"><span data-stu-id="301d1-341">These tests were executed on an Intel Xeon X5355 @ 2.66GHz 4-way computer with 4GB RAM running Windows Server 2008 x64.</span></span>  <span data-ttu-id="301d1-342">Il codice del test viene eseguito in un solo processo con un thread per core per il 100% di utilizzo della CPU.</span><span class="sxs-lookup"><span data-stu-id="301d1-342">The test code runs in a single process with one thread per core to reach 100% CPU utilization.</span></span>

 <span data-ttu-id="301d1-343">I flussi di lavoro generati per questo test contengono due variabili principali: profondità e numero di attività in ogni sequenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-343">The workflows generated for this test have two main variables: depth and number of activities in each sequence.</span></span>  <span data-ttu-id="301d1-344">Ogni livello di profondità include un'attività parallela, un ciclo while, decisioni, assegnazioni e sequenze.</span><span class="sxs-lookup"><span data-stu-id="301d1-344">Each depth level includes a parallel activity, while loop, decisions, assignments, and sequences.</span></span>  <span data-ttu-id="301d1-345">Nella finestra di progettazione di WF4 illustrata di seguito, è raffigurato il diagramma di flusso di livello superiore.</span><span class="sxs-lookup"><span data-stu-id="301d1-345">In the WF4 designer pictured below, the top-level flow chart is pictured.</span></span>  <span data-ttu-id="301d1-346">Ogni attività del diagramma di flusso assomiglia al diagramma di flusso principale.</span><span class="sxs-lookup"><span data-stu-id="301d1-346">Each flowchart activity resembles the main flowchart.</span></span>  <span data-ttu-id="301d1-347">Quando si rappresenta questo flusso di lavoro, può essere utile pensare a un frattale, dove la profondità è limitata ai parametri del test.</span><span class="sxs-lookup"><span data-stu-id="301d1-347">It may be helpful to think of a fractal when picturing this workflow, where the depth is limited to the parameters of the test.</span></span>

 <span data-ttu-id="301d1-348">Il numero di attività in un determinato test dipende dalla profondità e dal numero di attività per sequenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-348">The number of activities in a given test is determined by the depth and number of activities per sequence.</span></span>  <span data-ttu-id="301d1-349">Nell'equazione seguente viene calcolato il numero di attività per il test di WF4:</span><span class="sxs-lookup"><span data-stu-id="301d1-349">The following equation computes the number of activities in the WF4 test:</span></span>

 ![Equazione per calcolare il numero delle attività](./media/performance/number-activities-equation.gif)

 <span data-ttu-id="301d1-351">Il numero di attività per il test di WF3 può essere calcolato con un'equazione leggermente diversa a causa di una sequenza aggiuntiva:</span><span class="sxs-lookup"><span data-stu-id="301d1-351">The WF3 test’s activity count can be computed with a slightly different equation due to an extra sequence:</span></span>

 ![Equazione per calcolare il numero di attività di WF3](./media/performance/wf3-number-activities-equation.gif)

 <span data-ttu-id="301d1-353">Dove d è la profondità e a è il numero di attività per sequenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-353">Where d is the depth and a is the number of activities per sequence.</span></span>  <span data-ttu-id="301d1-354">La logica alla base di queste equazioni è che la prima costante, moltiplicata per a, è il numero di sequenze e la seconda costante è il numero statico di attività nel livello corrente.</span><span class="sxs-lookup"><span data-stu-id="301d1-354">The logic behind these equations is that the first constant, multiplied by a, is the number of sequences and the second constant is the static number of activities in the current level.</span></span>  <span data-ttu-id="301d1-355">In ogni diagramma di flusso sono presenti tre attività figlio.</span><span class="sxs-lookup"><span data-stu-id="301d1-355">There are three flowchart child activities in each flowchart.</span></span>  <span data-ttu-id="301d1-356">Al livello di profondità inferiore, questi diagrammi di flusso sono vuoti, ma agli altri livelli sono copie del diagramma di flusso principale.</span><span class="sxs-lookup"><span data-stu-id="301d1-356">At the bottom depth level, these flowcharts are empty but at the other levels they are copies of the main flowchart.</span></span>  <span data-ttu-id="301d1-357">Il numero di attività nella definizione di flusso di lavoro di ogni variazione del test viene indicato nella tabella seguente:</span><span class="sxs-lookup"><span data-stu-id="301d1-357">The number of activities in each test variation’s workflow definition is indicated in the following table:</span></span>

 ![Una tabella che mostra il numero di attività utilizzate in ogni test](./media/performance/workflow-variation-compare-table.gif)

 <span data-ttu-id="301d1-359">Il numero di attività nella definizione del flusso di lavoro aumenta in modo significativo ad ogni livello di profondità.</span><span class="sxs-lookup"><span data-stu-id="301d1-359">The number of activities in the workflow definition increases sharply with each depth level.</span></span>  <span data-ttu-id="301d1-360">Dal momento che in una determinata istanza del flusso di lavoro viene eseguito solo un percorso per punto di decisione, verrà eseguito solo un piccolo subset delle attività effettive.</span><span class="sxs-lookup"><span data-stu-id="301d1-360">But only one path per decision point is executed in a given workflow instance, so only a small subset of the actual activities are executed.</span></span>

 ![Diagramma di flusso del flusso di lavoro complessi della velocità effettiva](./media/performance/complex-workflow-throughput-workflow.gif)

 <span data-ttu-id="301d1-362">Per WF3 era stato creato un flusso di lavoro equivalente.</span><span class="sxs-lookup"><span data-stu-id="301d1-362">An equivalent workflow was created for WF3.</span></span> <span data-ttu-id="301d1-363">La finestra di progettazione di WF3 mostra il flusso di lavoro completo nell'area di progettazione anziché l'annidamento, pertanto è troppo grande per essere visualizzato in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="301d1-363">The WF3 designer shows the entire workflow in the design area instead of nesting, therefore it is too big to display in this topic.</span></span> <span data-ttu-id="301d1-364">Di seguito viene illustrato un frammento del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-364">A snippet of the workflow is shown below.</span></span>

 ![Frammento di diagramma di flusso del flusso di lavoro di WF3](./media/performance/wf3-workflow-snippet.gif)

 <span data-ttu-id="301d1-366">Per esercitare l'annidamento in un caso estremo, un altro flusso di lavoro che fa parte di questo test usa 100 sequenze annidate.</span><span class="sxs-lookup"><span data-stu-id="301d1-366">To exercise nesting in an extreme case, another workflow that is part of this test uses 100 nested sequences.</span></span>  <span data-ttu-id="301d1-367">Nella sequenza più interna è presente un solo `Comment` o una sola <xref:System.Workflow.Activities.CodeActivity>.</span><span class="sxs-lookup"><span data-stu-id="301d1-367">In the innermost sequence is a single `Comment` or <xref:System.Workflow.Activities.CodeActivity>.</span></span>

 ![Diagramma di flusso di una sequenza annidata](./media/performance/nested-sequence-workflow.gif)

 <span data-ttu-id="301d1-369">Il rilevamento e la persistenza non vengono usati in questo test.</span><span class="sxs-lookup"><span data-stu-id="301d1-369">Tracking and persistence are not used as part of this test.</span></span>

### <a name="test-results"></a><span data-ttu-id="301d1-370">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-370">Test Results</span></span>
 ![Istogramma che mostra la velocità effettiva i risultati delle prestazioni](./media/performance/throughput-performance-results.gif)

 <span data-ttu-id="301d1-372">Anche con flussi di lavoro complessi con molta profondità e un numero elevato di attività, i risultati delle prestazioni sono coerenti con altri dati relativi alla velocità effettiva mostrati in precedenza in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-372">Even with complex workflows with lots of depth and a high number of activities, the performance results are consistent with other throughput numbers shown earlier in this article.</span></span>  <span data-ttu-id="301d1-373">La velocità effettiva di WF4 è notevolmente maggiore e deve essere confrontata su scala logaritmica.</span><span class="sxs-lookup"><span data-stu-id="301d1-373">WF4’s throughput is orders of magnitude faster and has to be compared on a logarithmic scale.</span></span>

### <a name="memory"></a><span data-ttu-id="301d1-374">Memoria</span><span class="sxs-lookup"><span data-stu-id="301d1-374">Memory</span></span>
 <span data-ttu-id="301d1-375">Il sovraccarico della memoria di Windows Workflow Foundation viene misurato in due aree principali: complessità del flusso di lavoro e numero di definizioni del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-375">The memory overhead of Windows Workflow Foundation is measured in two key areas: workflow complexity and number of workflow definitions.</span></span>  <span data-ttu-id="301d1-376">Le misurazioni della memoria sono state effettuate su una workstation Windows 7 a 64 bit.</span><span class="sxs-lookup"><span data-stu-id="301d1-376">Memory measurements were taken on a Windows 7 64-bit workstation.</span></span>  <span data-ttu-id="301d1-377">Esistono diversi modi per misurare la dimensione del working set, ad esempio i contatori delle prestazioni di monitoraggio, il polling di Environment. WorkingSet o usando uno strumento come VMMap di [VMMap](/sysinternals/downloads/vmmap).</span><span class="sxs-lookup"><span data-stu-id="301d1-377">There are many ways to obtain the measurement of working set size such as monitoring performance counters, polling Environment.WorkingSet, or using a tool like VMMap available from [VMMap](/sysinternals/downloads/vmmap).</span></span> <span data-ttu-id="301d1-378">Per ottenere e verificare i risultati di ogni test, è stata usata una combinazione di metodi.</span><span class="sxs-lookup"><span data-stu-id="301d1-378">A combination of methods was used to obtain and verify the results of each test.</span></span>

### <a name="workflow-complexity-test"></a><span data-ttu-id="301d1-379">Test di complessità del flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="301d1-379">Workflow Complexity Test</span></span>
 <span data-ttu-id="301d1-380">Il test di complessità del flusso di lavoro misura la differenza del working set in base alla complessità del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-380">The workflow complexity test measures the working set difference based on the complexity of the workflow.</span></span>  <span data-ttu-id="301d1-381">Oltre ai flussi di lavoro complessi usati nella sezione precedente, sono state aggiunte nuove varianti per analizzare due casi di base: un flusso di lavoro costituito da una singola attività e una sequenza con 1000 attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-381">In addition to the complex workflows used in the previous section, new variations are added to cover two basic cases: a single activity workflow and a sequence with 1000 activities.</span></span>  <span data-ttu-id="301d1-382">Per questi test i flussi di lavoro vengono inizializzati ed eseguiti fino al completamento in un unico ciclo seriale per un periodo di un minuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-382">For these tests the workflows are initialized and executed to completion in a single serial loop for a period of one minute.</span></span>  <span data-ttu-id="301d1-383">Ogni variante del test viene eseguita tre volte e i dati registrati rappresentano la media delle tre esecuzioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-383">Each test variation is run three times and the data recorded is the average of those three runs.</span></span>

 <span data-ttu-id="301d1-384">I due nuovi test di base dispongono di flussi di lavoro simili a quelli mostrati di seguito:</span><span class="sxs-lookup"><span data-stu-id="301d1-384">The two new basic tests have workflows that look like those shown below:</span></span>

 ![Flusso di lavoro complesso per WF3 e WF4](./media/performance/complex-workflow-wf3-wf4.gif)

 <span data-ttu-id="301d1-386">Nel flusso di lavoro di WF3 sopra riportato, vengono usate attività <xref:System.Workflow.Activities.CodeActivity> vuote.</span><span class="sxs-lookup"><span data-stu-id="301d1-386">In the WF3 workflow shown above, empty <xref:System.Workflow.Activities.CodeActivity> activities are used.</span></span>  <span data-ttu-id="301d1-387">Nel flusso di lavoro di WF4 sopra riportato, vengono usate attività `Comment`.</span><span class="sxs-lookup"><span data-stu-id="301d1-387">The WF4 workflow above uses `Comment` activities.</span></span>  <span data-ttu-id="301d1-388">L'attività `Comment` era stata descritta in precedenza nella sezione "Confronto delle prestazioni a livello di componente" di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-388">The `Comment` activity was described in the Component-level Performance Comparisons section earlier in this article.</span></span>

 ![Istogramma che mostra l'utilizzo della memoria del flusso di lavoro complesso per i flussi di lavoro di WF3 e WF4](./media/performance/complex-memory-usage-wf3-wf4.gif)

 <span data-ttu-id="301d1-390">Una delle tendenze chiare da notare in questo grafico è l'impatto relativamente minimo dell'annidamento sull'utilizzo della memoria sia in WF3 sia in WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-390">One of the clear trends to notice in this graph is that nesting has relatively minimal impact on memory usage in both WF3 and WF4.</span></span>  <span data-ttu-id="301d1-391">L'impatto più significativo sulla memoria è dovuto al numero di attività in un determinato flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-391">The most significant memory impact comes from the number of activities in a given workflow.</span></span>  <span data-ttu-id="301d1-392">Presupponendo come varianti sequenza 1000, profondità complessa 5 sequenza 5 e profondità complessa 7 sequenza 1, è evidente che nel momento in cui il numero di attività supera le migliaia, l'uso della memoria aumenta in modo più significativo.</span><span class="sxs-lookup"><span data-stu-id="301d1-392">Given the data from the sequence 1000, complex depth 5 sequence 5, and complex depth 7 sequence 1 variations, it is clear that as the number of activities enters the thousands, the memory usage increase becomes more noticeable.</span></span>  <span data-ttu-id="301d1-393">Nel caso estremo (profondità 7 sequenza 1), con circa 29.000 attività, WF4 usa quasi il 79% in meno di memoria rispetto a WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-393">In the extreme case (depth 7 sequence 1) where there are ~29K activities, WF4 is using almost 79% less memory than WF3.</span></span>

### <a name="multiple-workflow-definitions-test"></a><span data-ttu-id="301d1-394">Test delle definizioni multiple di un flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="301d1-394">Multiple Workflow Definitions Test</span></span>
 <span data-ttu-id="301d1-395">La misurazione della memoria per definizione del flusso di lavoro è suddivisa in due test diversi a causa delle opzioni disponibili per l'hosting dei flussi di lavoro in WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-395">Measuring memory per workflow definition is divided into two different tests because of the available options for hosting workflows in WF3 and WF4.</span></span>  <span data-ttu-id="301d1-396">I test vengono eseguiti in modo diverso rispetto al test di complessità del flusso di lavoro: viene generata l'istanza di un determinato flusso di lavoro, che viene poi eseguita solo una volta per definizione.</span><span class="sxs-lookup"><span data-stu-id="301d1-396">The tests are run in a different manner than the workflow complexity test in that a given workflow is instanced and executed only once per definition.</span></span>  <span data-ttu-id="301d1-397">Questo comportamento è dovuto al fatto che la definizione di flusso di lavoro e il suo host rimangono in memoria per tutta la durata dell'AppDomain.</span><span class="sxs-lookup"><span data-stu-id="301d1-397">This is because the workflow definition and its host remain in memory for the lifetime of the AppDomain.</span></span>  <span data-ttu-id="301d1-398">La memoria usata durante l'esecuzione di una determinata istanza del flusso di lavoro deve essere pulita durante la procedura di Garbage Collection.</span><span class="sxs-lookup"><span data-stu-id="301d1-398">The memory used by running a given workflow instance should be cleaned up during garbage collection.</span></span>  <span data-ttu-id="301d1-399">Il materiale sussidiario sulla migrazione di WF4 contiene informazioni più dettagliate sulle opzioni di hosting.</span><span class="sxs-lookup"><span data-stu-id="301d1-399">The migration guidance for WF4 contains more detailed information on the hosting options.</span></span> <span data-ttu-id="301d1-400">Per altre informazioni, vedere [indicazioni sulla migrazione di WF: Hosting del flusso di lavoro](https://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="301d1-400">For more information, see [WF Migration Cookbook: Workflow Hosting](https://go.microsoft.com/fwlink/?LinkID=153313).</span></span>

 <span data-ttu-id="301d1-401">È possibile creare le diverse definizioni di un flusso di lavoro per un test della definizione del flusso di lavoro in vari modi.</span><span class="sxs-lookup"><span data-stu-id="301d1-401">Creating many workflow definitions for a workflow definition test can be done in several ways.</span></span>  <span data-ttu-id="301d1-402">Ad esempio, è possibile usare la generazione di codice per creare un set di 1000 flussi di lavoro identici tranne che per il nome e salvarli ognuno in file distinti.</span><span class="sxs-lookup"><span data-stu-id="301d1-402">For instance, one could use code generation to create a set of 1000 workflows that are identical except in name and save each of those workflows into separate files.</span></span>  <span data-ttu-id="301d1-403">Questo è l'approccio seguito per il test ospitato dalla console.</span><span class="sxs-lookup"><span data-stu-id="301d1-403">This approach was taken for the console-hosted test.</span></span>  <span data-ttu-id="301d1-404">In WF3 è stata usata la classe <xref:System.Workflow.Runtime.WorkflowRuntime> per eseguire le definizioni del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-404">In WF3, the <xref:System.Workflow.Runtime.WorkflowRuntime> class was used to run the workflow definitions.</span></span>  <span data-ttu-id="301d1-405">In WF4 è possibile usare <xref:System.Activities.WorkflowApplication> per creare una singola istanza del flusso di lavoro o usare direttamente <xref:System.Activities.WorkflowInvoker> per eseguire l'attività come se fosse una chiamata al metodo.</span><span class="sxs-lookup"><span data-stu-id="301d1-405">WF4 can either use <xref:System.Activities.WorkflowApplication> to create a single workflow instance or directly use <xref:System.Activities.WorkflowInvoker> to run the activity as if it were a method call.</span></span>  <span data-ttu-id="301d1-406"><xref:System.Activities.WorkflowApplication> è un host di una singola istanza del flusso di lavoro e ha una maggiore analogia funzionale con <xref:System.Workflow.Runtime.WorkflowRuntime> nel modo in cui è stato usato nel test.</span><span class="sxs-lookup"><span data-stu-id="301d1-406"><xref:System.Activities.WorkflowApplication> is a host of a single workflow instance and has closer feature parity to <xref:System.Workflow.Runtime.WorkflowRuntime> so that was used in this test.</span></span>

 <span data-ttu-id="301d1-407">Quando si ospitano i flussi di lavoro in IIS, è possibile usare un <xref:System.Web.Hosting.VirtualPathProvider> per creare un nuovo <xref:System.ServiceModel.WorkflowServiceHost> anziché generare tutti i file XAMLX o XOML.</span><span class="sxs-lookup"><span data-stu-id="301d1-407">When hosting workflows in IIS it is possible to use a <xref:System.Web.Hosting.VirtualPathProvider> to create a new <xref:System.ServiceModel.WorkflowServiceHost> instead of generating all of the XAMLX or XOML files.</span></span>  <span data-ttu-id="301d1-408">Il <xref:System.Web.Hosting.VirtualPathProvider> gestisce la richiesta in ingresso e risponde con un "file virtuale" che può essere caricato da un database o, in questo caso, generato in tempo reale.</span><span class="sxs-lookup"><span data-stu-id="301d1-408">The <xref:System.Web.Hosting.VirtualPathProvider> handles the incoming request and responds with a "virtual file" that can be loaded from a database or, in this case, generated on the fly.</span></span>  <span data-ttu-id="301d1-409">Non è quindi necessario creare 1000 file fisici.</span><span class="sxs-lookup"><span data-stu-id="301d1-409">It is therefore unnecessary to create 1000 physical files.</span></span>

 <span data-ttu-id="301d1-410">Le definizioni del flusso di lavoro usate nel test della console erano semplici flussi di lavoro sequenziali con una sola attività.</span><span class="sxs-lookup"><span data-stu-id="301d1-410">The workflow definitions used in the console test were simple sequential workflows with a single activity.</span></span>  <span data-ttu-id="301d1-411">Per il test case di WF3 si trattava di un'attività <xref:System.Workflow.Activities.CodeActivity> vuota, mentre per il test case di WF4 era un'attività `Comment`.</span><span class="sxs-lookup"><span data-stu-id="301d1-411">The single activity was an empty <xref:System.Workflow.Activities.CodeActivity> for the WF3 case and a `Comment` activity for the WF4 case.</span></span>  <span data-ttu-id="301d1-412">Il test case ospitato da IIS utilizzava flussi di lavoro che si avviavano al ricevimento di un messaggio e terminavano nel momento in cui veniva inviata una risposta:</span><span class="sxs-lookup"><span data-stu-id="301d1-412">The IIS-hosted case used workflows that start on receiving a message and end on sending a reply:</span></span>

<span data-ttu-id="301d1-413">L'immagine seguente mostra un flusso di lavoro di WF3 con ReceiveActivity e un flusso di lavoro di WF4 con modello richiesta/risposta:</span><span class="sxs-lookup"><span data-stu-id="301d1-413">The following image shows a WF3 workflow with ReceiveActivity and a WF4 workflow with request/response pattern:</span></span>

 ![Servizi flusso di lavoro in WF3 e WF4](./media/performance/workflow-receive-activity.gif)

 <span data-ttu-id="301d1-415">La tabella seguente illustra il delta del working set tra una definizione del singolo flusso di lavoro e 1001 definizioni:</span><span class="sxs-lookup"><span data-stu-id="301d1-415">The following table shows the delta in working set between a single workflow definition and 1001 definitions:</span></span>

|<span data-ttu-id="301d1-416">Opzioni di hosting</span><span class="sxs-lookup"><span data-stu-id="301d1-416">Hosting Options</span></span>|<span data-ttu-id="301d1-417">Delta del working set di WF3</span><span class="sxs-lookup"><span data-stu-id="301d1-417">WF3 Working Set Delta</span></span>|<span data-ttu-id="301d1-418">Delta del working set di WF4</span><span class="sxs-lookup"><span data-stu-id="301d1-418">WF4 Working Set Delta</span></span>|
|---------------------|---------------------------|---------------------------|
|<span data-ttu-id="301d1-419">Flussi di lavoro ospitati dell'applicazione console</span><span class="sxs-lookup"><span data-stu-id="301d1-419">Console Application Hosted Workflows</span></span>|<span data-ttu-id="301d1-420">18 MB</span><span class="sxs-lookup"><span data-stu-id="301d1-420">18 MB</span></span>|<span data-ttu-id="301d1-421">9 MB</span><span class="sxs-lookup"><span data-stu-id="301d1-421">9 MB</span></span>|
|<span data-ttu-id="301d1-422">Servizi flussi di lavoro ospitati di IIS</span><span class="sxs-lookup"><span data-stu-id="301d1-422">IIS Hosted Workflow Services</span></span>|<span data-ttu-id="301d1-423">446 MB</span><span class="sxs-lookup"><span data-stu-id="301d1-423">446 MB</span></span>|<span data-ttu-id="301d1-424">364 MB</span><span class="sxs-lookup"><span data-stu-id="301d1-424">364 MB</span></span>|

 <span data-ttu-id="301d1-425">Hosting di definizioni di flusso di lavoro in IIS Usa molta più memoria a causa dell'errore di <xref:System.ServiceModel.WorkflowServiceHost>, dettagliati elementi del servizio WCF e il messaggio associata all'host per la logica di elaborazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-425">Hosting workflow definitions in IIS consumes much more memory due to the <xref:System.ServiceModel.WorkflowServiceHost>, detailed WCF service artifacts, and the message processing logic associated with the host.</span></span>

 <span data-ttu-id="301d1-426">Per l'hosting della console in WF3, i flussi di lavoro sono stati implementati in codice anziché in linguaggio XOML.</span><span class="sxs-lookup"><span data-stu-id="301d1-426">For console hosting in WF3 the workflows were implemented in code instead of XOML.</span></span>  <span data-ttu-id="301d1-427">In WF4 il valore predefinito da usare è XAML.</span><span class="sxs-lookup"><span data-stu-id="301d1-427">In WF4 the default is to use XAML.</span></span>  <span data-ttu-id="301d1-428">XAML viene memorizzato nell'assembly come risorsa incorporata e compilato durante il runtime per consentire l'implementazione del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-428">The XAML is stored as an embedded resource in the assembly and compiled during runtime to provide the implementation of the workflow.</span></span>  <span data-ttu-id="301d1-429">Questo processo determina del sovraccarico.</span><span class="sxs-lookup"><span data-stu-id="301d1-429">There is some overhead associated with this process.</span></span>  <span data-ttu-id="301d1-430">Per eseguire un confronto equo tra WF3 e WF4, sono stati usati flussi di lavoro codificati anziché il linguaggio XAML.</span><span class="sxs-lookup"><span data-stu-id="301d1-430">In order to make a fair comparison between WF3 and WF4, coded workflows were used instead of XAML.</span></span>  <span data-ttu-id="301d1-431">Di seguito è riportato uno dei quattro flussi di lavoro di WF4:</span><span class="sxs-lookup"><span data-stu-id="301d1-431">An example of one of the WF4 workflows is shown below:</span></span>

```csharp
public class Workflow1 : Activity
{
    protected override Func<Activity> Implementation
    {
        get
        {
            return new Func<Activity>(() =>
            {
                return new Sequence
                {
                    Activities = {
                        new Comment()
                    }
                };
            });
        }
        set
        {
            base.Implementation = value;
        }
    }
}
```

 <span data-ttu-id="301d1-432">L'utilizzo della memoria è influenzato da numerosi altri fattori.</span><span class="sxs-lookup"><span data-stu-id="301d1-432">There are many other factors that can affect memory consumption.</span></span> <span data-ttu-id="301d1-433">Per tutti i programmi gestiti vale comunque lo stesso consiglio.</span><span class="sxs-lookup"><span data-stu-id="301d1-433">The same advice for all managed programs still applies.</span></span>  <span data-ttu-id="301d1-434">Negli ambienti ospitati da IIS, l'oggetto <xref:System.ServiceModel.WorkflowServiceHost> creato per una definizione del flusso di lavoro rimane in memoria fino a quando non viene riciclato il pool di applicazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-434">In IIS-hosted environments, the <xref:System.ServiceModel.WorkflowServiceHost> object created for a workflow definition stays in memory until the application pool is recycled.</span></span>  <span data-ttu-id="301d1-435">Ciò è da tenere ben presente in caso di scrittura di estensioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-435">This should be kept in mind when writing extensions.</span></span>  <span data-ttu-id="301d1-436">Inoltre, è consigliabile evitare variabili "globali" (variabili il cui ambito l'intero flusso di lavoro) e di limitare l'ambito delle variabili, laddove possibile.</span><span class="sxs-lookup"><span data-stu-id="301d1-436">Also, it is best to avoid "global" variables (variables scoped to the whole workflow) and limit the scope of variables wherever possible.</span></span>

## <a name="workflow-runtime-services"></a><span data-ttu-id="301d1-437">Servizi di runtime del flusso di lavoro</span><span class="sxs-lookup"><span data-stu-id="301d1-437">Workflow Runtime Services</span></span>

### <a name="persistence"></a><span data-ttu-id="301d1-438">Persistenza</span><span class="sxs-lookup"><span data-stu-id="301d1-438">Persistence</span></span>
 <span data-ttu-id="301d1-439">WF3 e WF4 sono entrambi dotati di un provider di persistenza SQL.</span><span class="sxs-lookup"><span data-stu-id="301d1-439">WF3 and WF4 both ship with a SQL persistence provider.</span></span>  <span data-ttu-id="301d1-440">Il provider di persistenza SQL di WF3 è un'implementazione semplice che serializza l'istanza del flusso di lavoro e l'archivia in un blob.</span><span class="sxs-lookup"><span data-stu-id="301d1-440">The WF3 SQL persistence provider is a simple implementation that serializes the workflow instance and stores it in a blob.</span></span>  <span data-ttu-id="301d1-441">Per questo motivo, le prestazioni di questo provider sono notevolmente influenzate dalla dimensione dell'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-441">For this reason, the performance of this provider depends heavily on the size of the workflow instance.</span></span>  <span data-ttu-id="301d1-442">In WF3 la dimensione dell'istanza potrebbe aumentare per vari motivi, come spiegato in precedenza in questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-442">In WF3, the instance size could increase for many reasons, as is discussed previously in this paper.</span></span>  <span data-ttu-id="301d1-443">Molti clienti scelgono di non usare il provider di persistenza SQL predefinito perché l'archiviazione di un'istanza serializzata in un database non fornisce visibilità nello stato del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-443">Many customers choose not to use the default SQL persistence provider because storing a serialized instance in a database gives no visibility into the state of the workflow.</span></span>  <span data-ttu-id="301d1-444">Per trovare un determinato flusso di lavoro senza conoscere l'ID del flusso di lavoro, sarebbe necessario deserializzare ogni istanza persistente ed esaminarne il contenuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-444">In order to find a particular workflow without knowing the workflow id, one would have to deserialize each persisted instance and examine the contents.</span></span>  <span data-ttu-id="301d1-445">Per superare questo problema, molti sviluppatori preferiscono scrivere il proprio provider di persistenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-445">Many developers prefer to write their own persistence providers to overcome this obstacle.</span></span>

 <span data-ttu-id="301d1-446">Il provider di persistenza SQL di WF4 ha cercato di risolvere alcune di queste problematiche.</span><span class="sxs-lookup"><span data-stu-id="301d1-446">The WF4 SQL persistence provider has tried to address some of these concerns.</span></span>  <span data-ttu-id="301d1-447">Le tabelle di persistenza espongono determinate informazioni, quali i segnalibri attivi e le proprietà promuovibili.</span><span class="sxs-lookup"><span data-stu-id="301d1-447">The persistence tables expose certain information such as the active bookmarks and promotable properties.</span></span>  <span data-ttu-id="301d1-448">Se si utilizzasse l'approccio di persistenza SQL di WF3, che ha comportato alcune modifiche nell'organizzazione dell'istanza del flusso di lavoro persistente, la nuova funzione di correlazione basata sul contenuto di WF4 non funzionerebbe correttamente.</span><span class="sxs-lookup"><span data-stu-id="301d1-448">The new content-based correlation feature in WF4 would not perform well using the WF3 SQL persistence approach, which has driven some change in the organization of the persisted workflow instance.</span></span>  <span data-ttu-id="301d1-449">Ciò rende più complesso il compito del provider di persistenza e incide ulteriormente sul database.</span><span class="sxs-lookup"><span data-stu-id="301d1-449">This makes the job of the persistence provider more complex and puts extra stress on the database.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="301d1-450">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-450">Environment Setup</span></span>
![Configurazione dell'ambiente per test delle prestazioni del flusso di lavoro](./media/performance/performance-test-environment.gif)

### <a name="test-setup"></a><span data-ttu-id="301d1-452">Impostazione del test</span><span class="sxs-lookup"><span data-stu-id="301d1-452">Test Setup</span></span>
 <span data-ttu-id="301d1-453">Anche con un set di funzionalità migliorate e una gestione delle concorrenze migliorata, il provider di persistenza SQL di WF4 è più veloce del provider di WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-453">Even with an improved feature set and better concurrency handling, the SQL persistence provider in WF4 is faster than the provider in WF3.</span></span>  <span data-ttu-id="301d1-454">Per dimostrarlo, di seguito vengono confrontati due flussi di lavoro che eseguono sostanzialmente le stesse operazioni in WF3 e WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-454">To showcase this, two workflows that perform essentially the same operations in WF3 and WF4 are compared below.</span></span>

 ![Persistenza flusso di lavoro in WF3 a sinistra e di WF4 a destra](./media/performance/persist-workflow-wf3-wf4.gif)

 <span data-ttu-id="301d1-456">I due flussi di lavoro vengono entrambi creati da un messaggio ricevuto.</span><span class="sxs-lookup"><span data-stu-id="301d1-456">The two workflows are both created by a received message.</span></span>  <span data-ttu-id="301d1-457">Dopo avere inviato una risposta iniziale, il flusso di lavoro viene reso persistente.</span><span class="sxs-lookup"><span data-stu-id="301d1-457">After sending an initial reply, the workflow is persisted.</span></span>  <span data-ttu-id="301d1-458">Nel caso di WF3, viene usato un oggetto <xref:System.Workflow.ComponentModel.TransactionScopeActivity> vuoto per iniziare la persistenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-458">In the WF3 case, an empty <xref:System.Workflow.ComponentModel.TransactionScopeActivity> is used to initiate the persistence.</span></span>  <span data-ttu-id="301d1-459">Lo stesso può essere raggiunto in WF3, contrassegnando un'attività come "persistente in chiusura".</span><span class="sxs-lookup"><span data-stu-id="301d1-459">The same could be achieved in WF3 by marking an activity as "persist on close."</span></span>  <span data-ttu-id="301d1-460">Il flusso di lavoro viene completato da un secondo messaggio correlato.</span><span class="sxs-lookup"><span data-stu-id="301d1-460">A second, correlated message completes the workflow.</span></span>  <span data-ttu-id="301d1-461">I flussi di lavoro vengono resi persistenti, ma non vengono scaricati.</span><span class="sxs-lookup"><span data-stu-id="301d1-461">The workflows are persisted but not unloaded.</span></span>

### <a name="test-results"></a><span data-ttu-id="301d1-462">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-462">Test Results</span></span>
 ![Persistenza della colonna del grafico che mostra la velocità effettiva](./media/performance/throughput-persistence-graph.gif)

 <span data-ttu-id="301d1-464">Quando il trasporto tra client e il livello intermedio è HTTP, la persistenza in WF4 migliora di 2,6 volte.</span><span class="sxs-lookup"><span data-stu-id="301d1-464">When the transport between client and middle tier is HTTP, persistence in WF4 shows an improvement of 2.6 times.</span></span>  <span data-ttu-id="301d1-465">Il trasporto TCP aumenta questo fattore fino a 3,0 volte.</span><span class="sxs-lookup"><span data-stu-id="301d1-465">The TCP transport increases that factor to 3.0 times.</span></span>  <span data-ttu-id="301d1-466">In tutti i casi, l'uso della CPU nel livello intermedio è del 98% o superiore.</span><span class="sxs-lookup"><span data-stu-id="301d1-466">In all cases, CPU utilization on the middle tier is 98% or higher.</span></span>  <span data-ttu-id="301d1-467">Il motivo della maggiore velocità effettiva in WF4 è il runtime più veloce del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-467">The reason that WF4 throughput is greater is due to the faster workflow runtime.</span></span>  <span data-ttu-id="301d1-468">La dimensione dell'istanza serializzata è contenuta in entrambi i casi e non è un elemento determinante in questa situazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-468">The size of the serialized instance is low for both cases and is not a major contributing element in this situation.</span></span>

 <span data-ttu-id="301d1-469">In questo test sia i flussi di lavoro di WF3 che di WF4 usano un'attività per indicare in modo esplicito quando deve verificarsi la persistenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-469">Both the WF3 and WF4 workflows in this test use an activity to explicitly indicate when persistence should occur.</span></span>  <span data-ttu-id="301d1-470">In questo modo, si ottiene il vantaggio di rendere persistente il flusso di lavoro senza scaricarlo.</span><span class="sxs-lookup"><span data-stu-id="301d1-470">This has the benefit of persisting the workflow without unloading it.</span></span>  <span data-ttu-id="301d1-471">In WF3, è anche possibile rendere persistente il flusso di lavoro usando la funzionalità <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>, ma in questo caso l'istanza del flusso di lavoro viene scaricata dalla memoria.</span><span class="sxs-lookup"><span data-stu-id="301d1-471">In WF3, it is also possible to persist using the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> feature, but this unloads the workflow instance from memory.</span></span>  <span data-ttu-id="301d1-472">Se uno sviluppatore che usa WF3 desidera essere certo che un flusso di lavoro venga reso persistente in determinati punti, deve modificare la definizione del flusso di lavoro oppure farsi carico dello scaricamento e del ricaricamento dell'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-472">If a developer using WF3 wants to make sure a workflow persists at certain points, they either have to alter the workflow definition or pay the cost for unloading and re-loading the workflow instance.</span></span>  <span data-ttu-id="301d1-473">Grazie a una nuova funzionalità di WF4, <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>, è possibile rendere persistente un flusso di lavoro senza scaricarlo.</span><span class="sxs-lookup"><span data-stu-id="301d1-473">A new feature in WF4 makes it possible to persist without unloading: <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>.</span></span>  <span data-ttu-id="301d1-474">Questa funzionalità consente di rendere persistente l'istanza del flusso di lavoro in caso di inattività, ma di rimanere in memoria fino a quando non viene raggiunta la soglia di <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> o ripresa l'esecuzione.</span><span class="sxs-lookup"><span data-stu-id="301d1-474">This feature allows the workflow instance to be persisted on idle but stay in memory until the <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> threshold is met or execution is resumed.</span></span>

 <span data-ttu-id="301d1-475">Notare che il provider di persistenza SQL di WF4 esegue più lavoro nel livello del database.</span><span class="sxs-lookup"><span data-stu-id="301d1-475">Note that the WF4 SQL persistence provider performs more work in the database tier.</span></span>  <span data-ttu-id="301d1-476">Il database SQL può diventare un collo di bottiglia, quindi è importante esaminare la CPU e l'uso del disco.</span><span class="sxs-lookup"><span data-stu-id="301d1-476">The SQL database can become a bottleneck so it is important to monitor the CPU and disk usage there.</span></span>  <span data-ttu-id="301d1-477">Quando si esegue il test delle prestazioni delle applicazioni flusso di lavoro, verificare che vengano inclusi i seguenti contatori delle prestazioni:</span><span class="sxs-lookup"><span data-stu-id="301d1-477">Be sure to include the following performance counters from the SQL database when performance testing workflow applications:</span></span>

- <span data-ttu-id="301d1-478">PhysicalDisk\\tempo lettura disco %</span><span class="sxs-lookup"><span data-stu-id="301d1-478">PhysicalDisk\\%Disk Read Time</span></span>

- <span data-ttu-id="301d1-479">PhysicalDisk\\% tempo disco</span><span class="sxs-lookup"><span data-stu-id="301d1-479">PhysicalDisk\\% Disk Time</span></span>

- <span data-ttu-id="301d1-480">PhysicalDisk\\ora di scrittura disco %</span><span class="sxs-lookup"><span data-stu-id="301d1-480">PhysicalDisk\\% Disk Write Time</span></span>

- <span data-ttu-id="301d1-481">PhysicalDisk\\% Media Lunghezza coda del disco</span><span class="sxs-lookup"><span data-stu-id="301d1-481">PhysicalDisk\\% Avg. Disk Queue Length</span></span>

- <span data-ttu-id="301d1-482">PhysicalDisk\ Lunghezza media lettura coda del disco</span><span class="sxs-lookup"><span data-stu-id="301d1-482">PhysicalDisk\Avg. Disk Read Queue Length</span></span>

- <span data-ttu-id="301d1-483">PhysicalDisk\ Lunghezza media scrittura coda del disco</span><span class="sxs-lookup"><span data-stu-id="301d1-483">PhysicalDisk\Avg. Disk Write Queue Length</span></span>

- <span data-ttu-id="301d1-484">PhysicalDisk\Lunghezza corrente coda su disco</span><span class="sxs-lookup"><span data-stu-id="301d1-484">PhysicalDisk\Current Disk Queue Length</span></span>

- <span data-ttu-id="301d1-485">Informazioni sul processore\\% tempo processore</span><span class="sxs-lookup"><span data-stu-id="301d1-485">Processor Information\\% Processor Time</span></span>

- <span data-ttu-id="301d1-486">SQLServer:Latch\Tempo medio attesa latch (ms)</span><span class="sxs-lookup"><span data-stu-id="301d1-486">SQLServer:Latches\Average Latch Wait Time (ms)</span></span>

- <span data-ttu-id="301d1-487">SQLServer:Latch\Attese latch/sec</span><span class="sxs-lookup"><span data-stu-id="301d1-487">SQLServer:Latches\Latch Waits/sec</span></span>

### <a name="tracking"></a><span data-ttu-id="301d1-488">Rilevamento</span><span class="sxs-lookup"><span data-stu-id="301d1-488">Tracking</span></span>
 <span data-ttu-id="301d1-489">È possibile usare il rilevamento del flusso di lavoro per tener traccia dello stato di avanzamento di un flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-489">Workflow tracking can be used to track the progress of a workflow.</span></span>  <span data-ttu-id="301d1-490">Le informazioni incluse negli eventi di rilevamento sono determinate da un profilo di rilevamento.</span><span class="sxs-lookup"><span data-stu-id="301d1-490">The information that is included in the tracking events is determined by a tracking profile.</span></span>  <span data-ttu-id="301d1-491">Più è complesso il profilo di rilevamento, più diventa oneroso il rilevamento.</span><span class="sxs-lookup"><span data-stu-id="301d1-491">The more complex the tracking profile, the more expensive tracking becomes.</span></span>

 <span data-ttu-id="301d1-492">WF3 era dotato di un servizio di rilevamento basato su SQL.</span><span class="sxs-lookup"><span data-stu-id="301d1-492">WF3 shipped with a SQL-based tracking service.</span></span>  <span data-ttu-id="301d1-493">Il servizio poteva funzionare in modalità batch e non batch.</span><span class="sxs-lookup"><span data-stu-id="301d1-493">This service could work in batched and non-batched modes.</span></span>  <span data-ttu-id="301d1-494">In modalità non batch, gli eventi di rilevamento vengono scritti direttamente nel database.</span><span class="sxs-lookup"><span data-stu-id="301d1-494">In non-batched mode, tracking events are written directly to the database.</span></span>  <span data-ttu-id="301d1-495">In modalità batch, gli eventi di rilevamento vengono raccolti nello stesso batch dello stato dell'istanza del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-495">In batched mode, tracking events are collected into the same batch as the workflow instance state.</span></span>  <span data-ttu-id="301d1-496">La modalità batch offre le prestazioni migliori per la tipologia più ampia di progettazioni del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="301d1-496">The batched mode has the best performance for the widest range of workflow designs.</span></span>  <span data-ttu-id="301d1-497">Tuttavia, se il flusso di lavoro esegue molte attività senza renderle persistenti e tali attività vengono rilevate, l'invio in batch può influire negativamente sulle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-497">However, batching can have a negative performance impact if the workflow runs many activities without persisting and those activities are tracked.</span></span>  <span data-ttu-id="301d1-498">Ciò si verificherebbe solitamente nei cicli e il modo migliore per evitare questo scenario è progettare cicli di grandi dimensioni per contenere un punto di persistenza.</span><span class="sxs-lookup"><span data-stu-id="301d1-498">This would commonly happen in loops and the best way to avoid this scenario is to design large loops to contain a persistence point.</span></span>  <span data-ttu-id="301d1-499">L'introduzione di un punto di persistenza in un ciclo può influire negativamente sulle prestazioni, quindi è importante valutare l'onere di ciascuno di essi e trovare un equilibrio ottimale.</span><span class="sxs-lookup"><span data-stu-id="301d1-499">Introducing a persistence point into a loop can negatively affect performance as well so it is important to measure the costs of each and come up with a balance.</span></span>

 <span data-ttu-id="301d1-500">WF4 non è dotato di un servizio di rilevamento basato su SQL.</span><span class="sxs-lookup"><span data-stu-id="301d1-500">WF4 is not shipped with a SQL tracking service.</span></span>  <span data-ttu-id="301d1-501">Registrazione delle informazioni di rilevamento in un database SQL può essere gestita meglio da un server applicazioni anziché incorporate in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="301d1-501">Recording tracking information to a SQL database can be handled better from an application server rather than built into the .NET Framework.</span></span> <span data-ttu-id="301d1-502">Pertanto il rilevamento SQL viene ora gestito da AppFabric.</span><span class="sxs-lookup"><span data-stu-id="301d1-502">Therefore SQL tracking is now handled by AppFabric.</span></span>  <span data-ttu-id="301d1-503">Il provider di rilevamento predefinito di WF4 si basa su ETW (Event Tracing for Windows).</span><span class="sxs-lookup"><span data-stu-id="301d1-503">The out-of-the-box tracking provider in WF4 is based on Event Tracing for Windows (ETW).</span></span>

 <span data-ttu-id="301d1-504">ETW è un sistema di eventi a livello del kernel con bassa latenza integrato in Windows.</span><span class="sxs-lookup"><span data-stu-id="301d1-504">ETW is a kernel-level, low-latency event system built into Windows.</span></span>  <span data-ttu-id="301d1-505">Usa un modello provider/consumer che penalizza il sistema per il rilevamento degli eventi solo quando è presente realmente un consumer.</span><span class="sxs-lookup"><span data-stu-id="301d1-505">It uses a provider/consumer model that makes it possible to only incur the penalty for event tracing when there is actually a consumer.</span></span>  <span data-ttu-id="301d1-506">Oltre agli eventi del kernel, quali utilizzo del processore, del disco, della memoria e della rete, molte applicazioni sfruttano anche ETW.</span><span class="sxs-lookup"><span data-stu-id="301d1-506">In addition to kernel events such as processor, disk, memory, and network usage, many applications leverage ETW as well.</span></span>  <span data-ttu-id="301d1-507">Gli eventi ETW sono più potenti dei contatori delle prestazioni poiché è possibile personalizzarli in base all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-507">ETW events are more powerful than performance counters in that events can be customized to the application.</span></span>  <span data-ttu-id="301d1-508">Un evento può contenere del testo, quale un ID del flusso di lavoro o un messaggio informativo.</span><span class="sxs-lookup"><span data-stu-id="301d1-508">An event can contain text such as a workflow ID or an informational message.</span></span>  <span data-ttu-id="301d1-509">Inoltre, gli eventi sono suddivisi in categorie con le maschere di bit in modo che l'impatto sulle prestazioni derivante dall'utilizzo di un determinato subset di eventi sia minore rispetto all'acquisizione di tutti gli eventi.</span><span class="sxs-lookup"><span data-stu-id="301d1-509">Also, events are categorized with bitmasks so that consuming a certain subset of events will have less performance impact than capturing all events.</span></span>

 <span data-ttu-id="301d1-510">I vantaggi dell'approccio che prevede l'uso di ETW per il rilevamento invece di SQL sono i seguenti:</span><span class="sxs-lookup"><span data-stu-id="301d1-510">Benefits to the approach of using ETW for tracking instead of SQL include:</span></span>

- <span data-ttu-id="301d1-511">È possibile tenere la raccolta degli eventi di rilevamento separata da un altro processo.</span><span class="sxs-lookup"><span data-stu-id="301d1-511">Collection of tracking events can be separated to another process.</span></span>  <span data-ttu-id="301d1-512">Ciò offre una maggiore flessibilità nella registrazione degli eventi.</span><span class="sxs-lookup"><span data-stu-id="301d1-512">This gives greater flexibility in how the events are recorded.</span></span>

- <span data-ttu-id="301d1-513">Gli eventi di rilevamento ETW vengono combinati facilmente con gli eventi ETW di WCF o altri provider ETW, ad esempio un provider di SQL Server o del kernel.</span><span class="sxs-lookup"><span data-stu-id="301d1-513">ETW tracking events are easily combined with the WCF ETW events or other ETW providers such as a SQL Server or kernel provider.</span></span>

- <span data-ttu-id="301d1-514">Gli autori del flusso di lavoro non devono modificarlo perché funzioni meglio con una determinata implementazione del rilevamento di rilevamento, quale la modalità batch del servizio di rilevamento SQL di WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-514">Workflow authors do not need to alter a workflow to work better with a particular tracking implementation, such as the WF3 SQL tracking service’s batch mode.</span></span>

- <span data-ttu-id="301d1-515">Un amministratore può attivare o disattivare il rilevamento senza riciclare il processo host.</span><span class="sxs-lookup"><span data-stu-id="301d1-515">An administrator can turn tracking on or off without recycling the host process.</span></span>

 <span data-ttu-id="301d1-516">I vantaggi del rilevamento ETW in termini di prestazioni presentano comunque un inconveniente.</span><span class="sxs-lookup"><span data-stu-id="301d1-516">The performance benefits to ETW tracking come with a drawback.</span></span>  <span data-ttu-id="301d1-517">Se le risorse del sistema sono molto sotto pressione, gli eventi ETW potrebbero andare persi.</span><span class="sxs-lookup"><span data-stu-id="301d1-517">ETW events can be lost if the system is under intense resource pressure.</span></span>  <span data-ttu-id="301d1-518">Poiché l'elaborazione degli eventi non prevede il blocco della normale esecuzione dei programmi, non è garantita la trasmissione di tutti gli eventi ETW ai sottoscrittori.</span><span class="sxs-lookup"><span data-stu-id="301d1-518">The processing of events is not meant to block normal program execution and therefore it is not guaranteed that all ETW events will be broadcast to their subscribers.</span></span>  <span data-ttu-id="301d1-519">Ciò rende ETW adatto per il monitoraggio dell'integrità ma non per il controllo.</span><span class="sxs-lookup"><span data-stu-id="301d1-519">This makes ETW tracking great for health monitoring but not suitable for auditing.</span></span>

 <span data-ttu-id="301d1-520">Contrariamente a WF4, AppFabric dispone di un provider di rilevamento SQL.</span><span class="sxs-lookup"><span data-stu-id="301d1-520">While WF4 does not have a SQL tracking provider, AppFabric does.</span></span>  <span data-ttu-id="301d1-521">L'approccio del rilevamento SQL di AppFabric prevede la sottoscrizione di eventi ETW con un servizio Windows che invia gli eventi in batch e li scrive in una tabella SQL progettata per inserimenti rapidi.</span><span class="sxs-lookup"><span data-stu-id="301d1-521">AppFabric’s SQL tracking approach is to subscribe to ETW events with a Windows Service that batches the events and writes them to a SQL table designed for quick inserts.</span></span>  <span data-ttu-id="301d1-522">Un processo distinto scarica i dati dalla tabella e li riforma in tabelle di report visualizzabili sul dashboard di AppFabric.</span><span class="sxs-lookup"><span data-stu-id="301d1-522">A separate job drains the data from this table and reforms it into reporting tables that can be viewed on the AppFabric dashboard.</span></span>  <span data-ttu-id="301d1-523">Ciò significa che un batch di eventi di rilevamento viene gestito indipendentemente dal flusso di lavoro di origine e pertanto non deve attendere un punto di persistenza prima essere registrato.</span><span class="sxs-lookup"><span data-stu-id="301d1-523">This means that a batch of tracking events is handled independent of the workflow it came from and therefore does not have to wait for a persistence point before being recorded.</span></span>

 <span data-ttu-id="301d1-524">È possibile registrare gli eventi ETW con strumenti quali logman o xperf.</span><span class="sxs-lookup"><span data-stu-id="301d1-524">ETW events can be recorded with tools such as logman or xperf.</span></span>  <span data-ttu-id="301d1-525">Per visualizzare i file ETL compressi, è possibile usare uno strumento quale xperfview oppure convertirli con tracerpt in un formato più leggibile, ad esempio XML.</span><span class="sxs-lookup"><span data-stu-id="301d1-525">The compact ETL file can be viewed with a tool like xperfview or converted to a more readable format, such as XML, with tracerpt.</span></span>  <span data-ttu-id="301d1-526">In WF3 l'unico modo per avere eventi di rilevamento senza un database SQL è creare un servizio di rilevamento personalizzato.</span><span class="sxs-lookup"><span data-stu-id="301d1-526">In WF3, the only option for getting tracking events without a SQL database is to create a custom tracking service.</span></span> <span data-ttu-id="301d1-527">Per altre informazioni su ETW, vedere [i servizi WCF e traccia eventi per Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) e [Event Tracing - applicazioni Windows](/windows/desktop/etw/event-tracing-portal).</span><span class="sxs-lookup"><span data-stu-id="301d1-527">For more information about ETW, see [WCF Services and Event Tracing for Windows](../wcf/samples/wcf-services-and-event-tracing-for-windows.md) and [Event Tracing - Windows applications](/windows/desktop/etw/event-tracing-portal).</span></span>

 <span data-ttu-id="301d1-528">Se è attivo, il rilevamento del flusso di lavoro, influisce sulle prestazioni a vari livelli.</span><span class="sxs-lookup"><span data-stu-id="301d1-528">Enabling workflow tracking will impact performance in varying degrees.</span></span>  <span data-ttu-id="301d1-529">Nel test di efficienza riportato di seguito viene usato lo strumento logman per usare gli eventi di rilevamento ETW e registrarli in un file ETL.</span><span class="sxs-lookup"><span data-stu-id="301d1-529">The benchmark below uses the logman tool to consume the ETW tracking events and record them to an ETL file.</span></span>  <span data-ttu-id="301d1-530">Il costo del rilevamento SQL in AppFabric non rientra nell'ambito di questo articolo.</span><span class="sxs-lookup"><span data-stu-id="301d1-530">The cost of the SQL tracking in AppFabric is not in the scope of this article.</span></span>  <span data-ttu-id="301d1-531">In questo test di efficienza viene mostrato il profilo di rilevamento di base, usato anche in AppFabric.</span><span class="sxs-lookup"><span data-stu-id="301d1-531">The basic tracking profile, also used in AppFabric, is shown in this benchmark.</span></span>  <span data-ttu-id="301d1-532">È inoltre incluso il costo del rilevamento solo degli eventi di monitoraggio dell'integrità.</span><span class="sxs-lookup"><span data-stu-id="301d1-532">Also included is the cost of tracking only health monitoring events.</span></span>  <span data-ttu-id="301d1-533">Questi eventi sono utili per risolvere i problemi e determinare la velocità effettiva media del sistema.</span><span class="sxs-lookup"><span data-stu-id="301d1-533">These events are useful for troubleshooting problems and determining the average throughput of the system.</span></span>

### <a name="environment-setup"></a><span data-ttu-id="301d1-534">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-534">Environment Setup</span></span>
 ![Configurazione dell'ambiente per test delle prestazioni del flusso di lavoro](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="301d1-536">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-536">Test Results</span></span>

 ![Istogramma che mostra il costi di rilevamento flusso di lavoro](./media/performance/workflow-tracking-costs.gif)

 <span data-ttu-id="301d1-538">Il monitoraggio dell'integrità ha un impatto di circa il 3% sulla velocità effettiva.</span><span class="sxs-lookup"><span data-stu-id="301d1-538">Health monitoring has roughly a 3% impact on throughput.</span></span>  <span data-ttu-id="301d1-539">Il costo del profilo di base corrisponde a circa l'8%.</span><span class="sxs-lookup"><span data-stu-id="301d1-539">The basic profile’s cost is around 8%.</span></span>

## <a name="interop"></a><span data-ttu-id="301d1-540">Interoperabilità</span><span class="sxs-lookup"><span data-stu-id="301d1-540">Interop</span></span>
 <span data-ttu-id="301d1-541">WF4 è una riscrittura pressoché completa di [!INCLUDE[wf1](../../../includes/wf1-md.md)] e pertanto i flussi di lavoro e le attività di WF3 non sono direttamente compatibili con WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-541">WF4 is almost a complete rewrite of [!INCLUDE[wf1](../../../includes/wf1-md.md)] and therefore WF3 workflows and activities are not directly compatible with WF4.</span></span>  <span data-ttu-id="301d1-542">Molti clienti che hanno adottato Windows Workflow Foundation presto saranno possibile le definizioni del flusso di lavoro interne o di terze parti e le attività personalizzate per WF3.</span><span class="sxs-lookup"><span data-stu-id="301d1-542">Many customers that adopted Windows Workflow Foundation early will have in-house or third-party workflow definitions and custom activities for WF3.</span></span>  <span data-ttu-id="301d1-543">Un modo per facilitare la transizione a WF4 è usare l'attività Interop, che è in grado di eseguire le attività di WF3 da un flusso di lavoro di WF4.</span><span class="sxs-lookup"><span data-stu-id="301d1-543">One way to ease the transition to WF4 is to use the Interop activity, which can execute WF3 activities from within a WF4 workflow.</span></span>  <span data-ttu-id="301d1-544">Si consiglia di usare l'attività <xref:System.Activities.Statements.Interop> solo quando necessario.</span><span class="sxs-lookup"><span data-stu-id="301d1-544">It is recommended that the <xref:System.Activities.Statements.Interop> activity only be used when necessary.</span></span> <span data-ttu-id="301d1-545">Per altre informazioni sulla migrazione a WF4 consultare il [linee guida sulla migrazione di WF4](https://go.microsoft.com/fwlink/?LinkID=153313).</span><span class="sxs-lookup"><span data-stu-id="301d1-545">For more information about migrating to WF4 check out the [WF4 Migration Guidance](https://go.microsoft.com/fwlink/?LinkID=153313).</span></span>

### <a name="environment-setup"></a><span data-ttu-id="301d1-546">Impostazione dell'ambiente</span><span class="sxs-lookup"><span data-stu-id="301d1-546">Environment Setup</span></span>
 ![Configurazione dell'ambiente per test delle prestazioni del flusso di lavoro](./media/performance/performance-test-environment.gif)

### <a name="test-results"></a><span data-ttu-id="301d1-548">Risultati dei test</span><span class="sxs-lookup"><span data-stu-id="301d1-548">Test Results</span></span>
 
<span data-ttu-id="301d1-549">Nella tabella seguente vengono illustrati i risultati dell'esecuzione di un flusso di lavoro che contiene cinque attività in una sequenza in varie configurazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-549">The following table shows the results of running a workflow containing five activities in a sequence in various configurations.</span></span>

|<span data-ttu-id="301d1-550">Test</span><span class="sxs-lookup"><span data-stu-id="301d1-550">Test</span></span>|<span data-ttu-id="301d1-551">Velocità effettiva (flussi di lavoro/sec)</span><span class="sxs-lookup"><span data-stu-id="301d1-551">Throughput (workflows/sec)</span></span>|
|----------|-----------------------------------|
|<span data-ttu-id="301d1-552">Sequenza di WF3 nel runtime di WF3</span><span class="sxs-lookup"><span data-stu-id="301d1-552">WF3 Sequence in WF3 runtime</span></span>|<span data-ttu-id="301d1-553">1\.576</span><span class="sxs-lookup"><span data-stu-id="301d1-553">1,576</span></span>|
|<span data-ttu-id="301d1-554">Sequenza di WF3 nel runtime di WF4 usando Interop</span><span class="sxs-lookup"><span data-stu-id="301d1-554">WF3 Sequence in WF4 runtime using Interop</span></span>|<span data-ttu-id="301d1-555">2\.745</span><span class="sxs-lookup"><span data-stu-id="301d1-555">2,745</span></span>|
|<span data-ttu-id="301d1-556">Sequenza di WF4</span><span class="sxs-lookup"><span data-stu-id="301d1-556">WF4 Sequence</span></span>|<span data-ttu-id="301d1-557">153.582</span><span class="sxs-lookup"><span data-stu-id="301d1-557">153,582</span></span>|

 <span data-ttu-id="301d1-558">L'utilizzo dell'attività Interop in WF3 migliora notevolmente le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="301d1-558">There is a notable performance increase to using Interop over straight WF3.</span></span>  <span data-ttu-id="301d1-559">Tuttavia, se confrontato con le attività di WF4, l'aumento è trascurabile.</span><span class="sxs-lookup"><span data-stu-id="301d1-559">However, when compared against WF4 activities, the increase is negligible.</span></span>

## <a name="summary"></a><span data-ttu-id="301d1-560">Riepilogo</span><span class="sxs-lookup"><span data-stu-id="301d1-560">Summary</span></span>
 <span data-ttu-id="301d1-561">I notevoli investimenti fatti per migliorare le prestazioni di WF4 hanno dato buoni risultati in molte aree critiche.</span><span class="sxs-lookup"><span data-stu-id="301d1-561">Heavy investments in performance for WF4 have paid off in many crucial areas.</span></span>  <span data-ttu-id="301d1-562">In alcuni casi le prestazioni dei singoli componenti del flusso di lavoro sono centinaia di volte più veloci in WF4 rispetto a WF3 grazie alla maggiore efficienza del runtime di [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="301d1-562">Individual workflow component performance is in some cases hundreds of times faster in WF4 compared to WF3 due to a leaner [!INCLUDE[wf1](../../../includes/wf1-md.md)] runtime.</span></span>  <span data-ttu-id="301d1-563">I valori relativi alla latenza sono anch'essi notevolmente migliorati.</span><span class="sxs-lookup"><span data-stu-id="301d1-563">Latency numbers are significantly better as well.</span></span>  <span data-ttu-id="301d1-564">Ciò significa che la riduzione delle prestazioni per l'utilizzo [!INCLUDE[wf1](../../../includes/wf1-md.md)] invece di orchestrazione WCF codificati manualmente è minima considerando il vantaggio dell'uso di servizi [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span><span class="sxs-lookup"><span data-stu-id="301d1-564">This means the performance penalty for using [!INCLUDE[wf1](../../../includes/wf1-md.md)] as opposed to hand-coding WCF orchestration services is very small considering the added benefits of using [!INCLUDE[wf1](../../../includes/wf1-md.md)].</span></span>  <span data-ttu-id="301d1-565">Le prestazioni della persistenza sono aumentate di un fattore di 2,5 - 3,0.</span><span class="sxs-lookup"><span data-stu-id="301d1-565">Persistence performance has increased by a factor of 2.5 - 3.0.</span></span>  <span data-ttu-id="301d1-566">Il sovraccarico del monitoraggio dell'integrità tramite il rilevamento del flusso di lavoro ora ha un impatto minimo.</span><span class="sxs-lookup"><span data-stu-id="301d1-566">Health monitoring by means of workflow tracking now has very little overhead.</span></span>  <span data-ttu-id="301d1-567">Per coloro che stanno valutando il passaggio da WF3 a WF4, è disponibile un set completo di guide alla migrazione.</span><span class="sxs-lookup"><span data-stu-id="301d1-567">A comprehensive set of migration guides are available for those that are considering moving from WF3 to WF4.</span></span>  <span data-ttu-id="301d1-568">Le considerazioni precedenti renderanno WF4 un'opzione attraente per la scrittura di applicazioni complesse.</span><span class="sxs-lookup"><span data-stu-id="301d1-568">All of this should make WF4 an attractive option for writing complex applications.</span></span>
