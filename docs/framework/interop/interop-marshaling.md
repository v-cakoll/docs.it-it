---
title: "Marshalling di interoperabilità"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- marshaling, COM interop
- interop marshaling
- interop marshaling, about interop marshaling
ms.assetid: 115f7a2f-d422-4605-ab36-13a8dd28142a
caps.latest.revision: "22"
author: rpetrusha
ms.author: ronpet
manager: wpickett
ms.openlocfilehash: 381eccc42d5abb85cde618f4710f044f172295d5
ms.sourcegitcommit: bd1ef61f4bb794b25383d3d72e71041a5ced172e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/18/2017
---
# <a name="interop-marshaling"></a><span data-ttu-id="1cc61-102">Marshalling di interoperabilità</span><span class="sxs-lookup"><span data-stu-id="1cc61-102">Interop Marshaling</span></span>
<a name="top"></a> <span data-ttu-id="1cc61-103">Il marshalling di interoperabilità determina il passaggio di dati in argomenti di metodo e i valori restituiti tra memoria gestita e non gestita durante le chiamate.</span><span class="sxs-lookup"><span data-stu-id="1cc61-103">Interop marshaling governs how data is passed in method arguments and return values between managed and unmanaged memory during calls.</span></span> <span data-ttu-id="1cc61-104">Il marshalling di interoperabilità è un'attività di run-time eseguita dal servizio di marshalling di Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="1cc61-104">Interop marshaling is a run-time activity performed by the common language runtime's marshaling service.</span></span>  
  
 <span data-ttu-id="1cc61-105">La maggior parte dei tipi di dati hanno rappresentazioni comuni nella memoria gestita e non gestita.</span><span class="sxs-lookup"><span data-stu-id="1cc61-105">Most data types have common representations in both managed and unmanaged memory.</span></span> <span data-ttu-id="1cc61-106">Il gestore di marshalling di interoperabilità gestisce questi tipi per conto dell'utente.</span><span class="sxs-lookup"><span data-stu-id="1cc61-106">The interop marshaler handles these types for you.</span></span> <span data-ttu-id="1cc61-107">Altri tipi possono essere ambigui o non essere rappresentati nella memoria gestita.</span><span class="sxs-lookup"><span data-stu-id="1cc61-107">Other types can be ambiguous or not represented at all in managed memory.</span></span>  
  
 <span data-ttu-id="1cc61-108">Un tipo ambiguo può avere più rappresentazioni non gestite che eseguono il mapping a un singolo tipo gestito o informazioni sul tipo mancante, ad esempio le dimensioni della matrice.</span><span class="sxs-lookup"><span data-stu-id="1cc61-108">An ambiguous type can have either multiple unmanaged representations that map to a single managed type, or missing type information, such as the size of an array.</span></span> <span data-ttu-id="1cc61-109">Per i tipi ambigui, il gestore del marshalling fornisce una rappresentazione predefinita e rappresentazioni alternative in cui sono presenti più rappresentazioni.</span><span class="sxs-lookup"><span data-stu-id="1cc61-109">For ambiguous types, the marshaler provides a default representation and alternative representations where multiple representations exist.</span></span> <span data-ttu-id="1cc61-110">È possibile fornire istruzioni esplicite al gestore del marshalling su come eseguire il marshalling di un tipo ambiguo.</span><span class="sxs-lookup"><span data-stu-id="1cc61-110">You can supply explicit instructions to the marshaler on how it is to marshal an ambiguous type.</span></span>  
  
 <span data-ttu-id="1cc61-111">In questa panoramica sono incluse le sezioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="1cc61-111">This overview contains the following sections:</span></span>  
  
-   [<span data-ttu-id="1cc61-112">Modelli basati su platform invoke e sull'interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-112">Platform Invoke and COM Interop Models</span></span>](#platform_invoke_and_com_interop_models)  
  
-   [<span data-ttu-id="1cc61-113">Marshalling e apartment COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-113">Marshaling and COM Apartments</span></span>](#marshaling_and_com_apartments)  
  
-   [<span data-ttu-id="1cc61-114">Marshalling di chiamate remote</span><span class="sxs-lookup"><span data-stu-id="1cc61-114">Marshaling Remote Calls</span></span>](#marshaling_remote_calls)  
  
-   [<span data-ttu-id="1cc61-115">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="1cc61-115">Related Topics</span></span>](#related_topics)  
  
-   [<span data-ttu-id="1cc61-116">Riferimento</span><span class="sxs-lookup"><span data-stu-id="1cc61-116">Reference</span></span>](#reference)  
  
<a name="platform_invoke_and_com_interop_models"></a>   
## <a name="platform-invoke-and-com-interop-models"></a><span data-ttu-id="1cc61-117">Modelli basati su platform invoke e sull'interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-117">Platform Invoke and COM Interop Models</span></span>  
 <span data-ttu-id="1cc61-118">In Common Language Runtime vengono forniti due meccanismi per l'interoperabilità con il codice non gestito:</span><span class="sxs-lookup"><span data-stu-id="1cc61-118">The common language runtime provides two mechanisms for interoperating with unmanaged code:</span></span>  
  
-   <span data-ttu-id="1cc61-119">Platform invoke, che consente la chiamata di funzioni esportate da una libreria non gestita da parte del codice gestito.</span><span class="sxs-lookup"><span data-stu-id="1cc61-119">Platform invoke, which enables managed code to call functions exported from an unmanaged library.</span></span>  
  
-   <span data-ttu-id="1cc61-120">L'interoperabilità COM, che consente l'interazione del codice gestito con oggetti COM (Component Object Model) mediante interfacce.</span><span class="sxs-lookup"><span data-stu-id="1cc61-120">COM interop, which enables managed code to interact with Component Object Model (COM) objects through interfaces.</span></span>  
  
 <span data-ttu-id="1cc61-121">Il marshalling di interoperabilità viene usato sia da platform invoke che dall'interoperabilità COM per spostare con precisione gli argomenti dei metodi tra chiamante e chiamato e viceversa, se necessario.</span><span class="sxs-lookup"><span data-stu-id="1cc61-121">Both platform invoke and COM interop use interop marshaling to accurately move method arguments between caller and callee and back, if required.</span></span> <span data-ttu-id="1cc61-122">Come mostrato nella figura seguente, una chiamata al metodo di platform invoke viene effettuata dal codice gestito al codice non gestito e mai viceversa, ad eccezione del caso in cui sono coinvolte [funzioni di callback](../../../docs/framework/interop/callback-functions.md).</span><span class="sxs-lookup"><span data-stu-id="1cc61-122">As the following illustration shows, a platform invoke method call flows from managed to unmanaged code and never the other way, except when [callback functions](../../../docs/framework/interop/callback-functions.md) are involved.</span></span> <span data-ttu-id="1cc61-123">Benché il flusso delle chiamate platform invoke possa andare solo dal codice gestito a quello non gestito, il flusso dei dati può essere in entrambe le direzioni, come parametri di input o di output.</span><span class="sxs-lookup"><span data-stu-id="1cc61-123">Even though platform invoke calls can flow only from managed to unmanaged code, data can flow in both directions as input or output parameters.</span></span> <span data-ttu-id="1cc61-124">Le chiamate al metodo di interoperabilità COM possono scorrere in entrambe le direzioni.</span><span class="sxs-lookup"><span data-stu-id="1cc61-124">COM interop method calls can flow in either direction.</span></span>  
  
 <span data-ttu-id="1cc61-125">![Platform invoke](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span><span class="sxs-lookup"><span data-stu-id="1cc61-125">![Platform invoke](../../../docs/framework/interop/media/interopmarshaling.png "interopmarshaling")</span></span>  
<span data-ttu-id="1cc61-126">Flusso delle chiamate con i metodi di platform invoke e di interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-126">Platform invoke and COM interop call flow</span></span>  
  
 <span data-ttu-id="1cc61-127">Al livello inferiore, lo stesso servizio di marshalling di interoperabilità viene usato da entrambi i meccanismi. Alcuni tipi di dati sono tuttavia supportati esclusivamente dall'interoperabilità COM o da platform invoke.</span><span class="sxs-lookup"><span data-stu-id="1cc61-127">At the lowest level, both mechanisms use the same interop marshaling service; however, certain data types are supported exclusively by COM interop or platform invoke.</span></span> <span data-ttu-id="1cc61-128">Per informazioni dettagliate, vedere [Comportamento di marshalling predefinito](../../../docs/framework/interop/default-marshaling-behavior.md).</span><span class="sxs-lookup"><span data-stu-id="1cc61-128">For details, see [Default Marshaling Behavior](../../../docs/framework/interop/default-marshaling-behavior.md).</span></span>  
  
 [<span data-ttu-id="1cc61-129">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="1cc61-129">Back to top</span></span>](#top)  
  
<a name="marshaling_and_com_apartments"></a>   
## <a name="marshaling-and-com-apartments"></a><span data-ttu-id="1cc61-130">Marshalling e apartment COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-130">Marshaling and COM Apartments</span></span>  
 <span data-ttu-id="1cc61-131">Il gestore di marshalling di interoperabilità esegue il marshalling dei dati tra l'heap di Common Language Runtime e quello non gestito.</span><span class="sxs-lookup"><span data-stu-id="1cc61-131">The interop marshaler marshals data between the common language runtime heap and the unmanaged heap.</span></span> <span data-ttu-id="1cc61-132">Il marshalling ha luogo ogni volta che il chiamante e il chiamato non possono operare sulla stessa istanza di dati.</span><span class="sxs-lookup"><span data-stu-id="1cc61-132">Marshaling occurs whenever the caller and callee cannot operate on the same instance of data.</span></span> <span data-ttu-id="1cc61-133">Il gestore di marshalling di interoperabilità fa sì che il chiamante e il chiamato sembrino operare sugli stessi dati benché dispongano ognuno della propria copia dei dati.</span><span class="sxs-lookup"><span data-stu-id="1cc61-133">The interop marshaler makes it possible for the caller and callee to appear to be operating on the same data even if they have their own copy of the data.</span></span>  
  
 <span data-ttu-id="1cc61-134">In COM è anche disponibile un gestore che esegue il marshalling dei dati tra apartment COM o diversi processi COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-134">COM also has a marshaler that marshals data between COM apartments or different COM processes.</span></span> <span data-ttu-id="1cc61-135">Quando le chiamate tra codice gestito e non gestito sono effettuate all'interno dello stesso apartment COM, il gestore di marshalling di interoperabilità è il solo a essere coinvolto.</span><span class="sxs-lookup"><span data-stu-id="1cc61-135">When calling between managed and unmanaged code within the same COM apartment, the interop marshaler is the only marshaler involved.</span></span> <span data-ttu-id="1cc61-136">Quando si effettuano chiamate tra codice gestito e non gestito in un diverso apartment COM o processo, sono coinvolti sia il gestore di marshalling COM che quello di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="1cc61-136">When calling between managed code and unmanaged code in a different COM apartment or a different process, both the interop marshaler and the COM marshaler are involved.</span></span>  
  
### <a name="com-clients-and-managed-servers"></a><span data-ttu-id="1cc61-137">Server gestiti e client COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-137">COM Clients and Managed Servers</span></span>  
 <span data-ttu-id="1cc61-138">Un server gestito esportato con una libreria dei tipi registrata da [Regasm.exe (strumento di registrazione di assembly)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) include una voce `ThreadingModel` del Registro di sistema impostata su `Both`.</span><span class="sxs-lookup"><span data-stu-id="1cc61-138">An exported managed server with a type library registered by the [Regasm.exe (Assembly Registration Tool)](../../../docs/framework/tools/regasm-exe-assembly-registration-tool.md) has a `ThreadingModel` registry entry set to `Both`.</span></span> <span data-ttu-id="1cc61-139">Questo valore indica che il server può essere attivato in un apartment a thread singolo (Single-Threaded Apartment, STA) o in un apartment con multithreading (Multithreaded Apartment, MTA).</span><span class="sxs-lookup"><span data-stu-id="1cc61-139">This value indicates that the server can be activated in a single-threaded apartment (STA) or a multithreaded apartment (MTA).</span></span> <span data-ttu-id="1cc61-140">L'oggetto server viene creato nello stesso apartment del chiamante, come indicato nella tabella riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="1cc61-140">The server object is created in the same apartment as its caller, as shown in the following table.</span></span>  
  
|<span data-ttu-id="1cc61-141">Client COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-141">COM client</span></span>|<span data-ttu-id="1cc61-142">Server .NET</span><span class="sxs-lookup"><span data-stu-id="1cc61-142">.NET server</span></span>|<span data-ttu-id="1cc61-143">Requisiti di marshalling</span><span class="sxs-lookup"><span data-stu-id="1cc61-143">Marshaling requirements</span></span>|  
|----------------|-----------------|-----------------------------|  
|<span data-ttu-id="1cc61-144">STA</span><span class="sxs-lookup"><span data-stu-id="1cc61-144">STA</span></span>|<span data-ttu-id="1cc61-145">`Both` diventa STA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-145">`Both` becomes STA.</span></span>|<span data-ttu-id="1cc61-146">Marshalling nello stesso apartment.</span><span class="sxs-lookup"><span data-stu-id="1cc61-146">Same-apartment marshaling.</span></span>|  
|<span data-ttu-id="1cc61-147">MTA</span><span class="sxs-lookup"><span data-stu-id="1cc61-147">MTA</span></span>|<span data-ttu-id="1cc61-148">`Both` diventa MTA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-148">`Both` becomes MTA.</span></span>|<span data-ttu-id="1cc61-149">Marshalling nello stesso apartment.</span><span class="sxs-lookup"><span data-stu-id="1cc61-149">Same-apartment marshaling.</span></span>|  
  
 <span data-ttu-id="1cc61-150">Poiché il client e il server si trovano nello stesso apartment, tutto il marshalling dei dati viene gestito automaticamente dal servizio di marshalling di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="1cc61-150">Because the client and server are in the same apartment, the interop marshaling service automatically handles all data marshaling.</span></span> <span data-ttu-id="1cc61-151">L'illustrazione seguente mostra il servizio di marshalling di interoperabilità tra gli heap gestiti e non gestiti all'interno dello stesso apartment di tipo COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-151">The following illustration shows the interop marshaling service operating between managed and unmanaged heaps within the same COM-style apartment.</span></span>  
  
 <span data-ttu-id="1cc61-152">![Marshalling di interoperabilità](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span><span class="sxs-lookup"><span data-stu-id="1cc61-152">![Interop marshaling](../../../docs/framework/interop/media/interopheap.gif "interopheap")</span></span>  
<span data-ttu-id="1cc61-153">Processo di marshalling nello stesso apartment</span><span class="sxs-lookup"><span data-stu-id="1cc61-153">Same-apartment marshaling process</span></span>  
  
 <span data-ttu-id="1cc61-154">Se si intende esportare un server gestito, ricordare che il client COM determina l'apartment del server.</span><span class="sxs-lookup"><span data-stu-id="1cc61-154">If you plan to export a managed server, be aware that the COM client determines the apartment of the server.</span></span> <span data-ttu-id="1cc61-155">Un server gestito chiamato da un client COM inizializzato in un MTA deve garantire la thread safety.</span><span class="sxs-lookup"><span data-stu-id="1cc61-155">A managed server called by a COM client initialized in an MTA must ensure thread safety.</span></span>  
  
### <a name="managed-clients-and-com-servers"></a><span data-ttu-id="1cc61-156">Client gestiti e server COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-156">Managed Clients and COM Servers</span></span>  
 <span data-ttu-id="1cc61-157">Benché l'impostazione predefinita per gli apartment dei client gestiti sia MTA, è possibile che essa venga modificata dal tipo di applicazione del client .NET.</span><span class="sxs-lookup"><span data-stu-id="1cc61-157">The default setting for managed client apartments is MTA; however, the application type of the .NET client can change the default setting.</span></span> <span data-ttu-id="1cc61-158">L'impostazione di apartment per i client di [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)], ad esempio, è STA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-158">For example, a [!INCLUDE[vbprvblong](../../../includes/vbprvblong-md.md)] client apartment setting is STA.</span></span> <span data-ttu-id="1cc61-159">Per esaminare e modificare l'impostazione di apartment di un client gestito, è possibile usare l'oggetto <xref:System.STAThreadAttribute?displayProperty=nameWithType>, l'oggetto <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, la proprietà <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> o la proprietà <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType>.</span><span class="sxs-lookup"><span data-stu-id="1cc61-159">You can use the <xref:System.STAThreadAttribute?displayProperty=nameWithType>, the <xref:System.MTAThreadAttribute?displayProperty=nameWithType>, the <xref:System.Threading.Thread.ApartmentState%2A?displayProperty=nameWithType> property, or the <xref:System.Web.UI.Page.AspCompatMode%2A?displayProperty=nameWithType> property to examine and change the apartment setting of a managed client.</span></span>  
  
 <span data-ttu-id="1cc61-160">L'autore del componente imposta l'affinità di thread di un server COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-160">The author of the component sets the thread affinity of a COM server.</span></span> <span data-ttu-id="1cc61-161">La tabella riportata di seguito mostra le combinazioni delle impostazioni di apartment per i client .NET e i server COM,</span><span class="sxs-lookup"><span data-stu-id="1cc61-161">The following table shows the combinations of apartment settings for .NET clients and COM servers.</span></span> <span data-ttu-id="1cc61-162">nonché i requisiti di marshalling per le diverse combinazioni.</span><span class="sxs-lookup"><span data-stu-id="1cc61-162">It also shows the resulting marshaling requirements for the combinations.</span></span>  
  
|<span data-ttu-id="1cc61-163">Client .NET</span><span class="sxs-lookup"><span data-stu-id="1cc61-163">.NET client</span></span>|<span data-ttu-id="1cc61-164">Server COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-164">COM server</span></span>|<span data-ttu-id="1cc61-165">Requisiti di marshalling</span><span class="sxs-lookup"><span data-stu-id="1cc61-165">Marshaling requirements</span></span>|  
|-----------------|----------------|-----------------------------|  
|<span data-ttu-id="1cc61-166">MTA (predefinito)</span><span class="sxs-lookup"><span data-stu-id="1cc61-166">MTA (default)</span></span>|<span data-ttu-id="1cc61-167">MTA</span><span class="sxs-lookup"><span data-stu-id="1cc61-167">MTA</span></span><br /><br /> <span data-ttu-id="1cc61-168">STA</span><span class="sxs-lookup"><span data-stu-id="1cc61-168">STA</span></span>|<span data-ttu-id="1cc61-169">Marshalling di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="1cc61-169">Interop marshaling.</span></span><br /><br /> <span data-ttu-id="1cc61-170">Marshalling di interoperabilità e COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-170">Interop and COM marshaling.</span></span>|  
|<span data-ttu-id="1cc61-171">STA</span><span class="sxs-lookup"><span data-stu-id="1cc61-171">STA</span></span>|<span data-ttu-id="1cc61-172">MTA</span><span class="sxs-lookup"><span data-stu-id="1cc61-172">MTA</span></span><br /><br /> <span data-ttu-id="1cc61-173">STA</span><span class="sxs-lookup"><span data-stu-id="1cc61-173">STA</span></span>|<span data-ttu-id="1cc61-174">Marshalling di interoperabilità e COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-174">Interop and COM marshaling.</span></span><br /><br /> <span data-ttu-id="1cc61-175">Marshalling di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="1cc61-175">Interop marshaling.</span></span>|  
  
 <span data-ttu-id="1cc61-176">Quando un client gestito e un server non gestito si trovano nello stesso apartment, tutto il marshalling dei dati viene eseguito dal servizio di marshalling di interoperabilità.</span><span class="sxs-lookup"><span data-stu-id="1cc61-176">When a managed client and unmanaged server are in the same apartment, the interop marshaling service handles all data marshaling.</span></span> <span data-ttu-id="1cc61-177">Tuttavia, quando il client e il server vengono inizializzati in apartment diversi, è necessario anche il marshalling COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-177">However, when client and server are initialized in different apartments, COM marshaling is also required.</span></span> <span data-ttu-id="1cc61-178">L'illustrazione riportata di seguito mostra gli elementi di una chiamata su diversi apartment.</span><span class="sxs-lookup"><span data-stu-id="1cc61-178">The following illustration shows the elements of a cross-apartment call.</span></span>  
  
 <span data-ttu-id="1cc61-179">![Marshalling COM](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span><span class="sxs-lookup"><span data-stu-id="1cc61-179">![COM marshaling](../../../docs/framework/interop/media/singleprocessmultapt.gif "singleprocessmultapt")</span></span>  
<span data-ttu-id="1cc61-180">Chiamata su diversi apartment tra un client .NET e un oggetto COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-180">Cross-apartment call between a .NET client and COM object</span></span>  
  
 <span data-ttu-id="1cc61-181">Per effettuare il marshalling su diversi apartment, procedere come indicato di seguito:</span><span class="sxs-lookup"><span data-stu-id="1cc61-181">For cross-apartment marshaling, you can do the following:</span></span>  
  
-   <span data-ttu-id="1cc61-182">Accettare l'overhead del marshalling su diversi apartment, evidente solo quando sono presenti molte chiamate oltre il limite.</span><span class="sxs-lookup"><span data-stu-id="1cc61-182">Accept the overhead of the cross-apartment marshaling, which is noticeable only when there are many calls across the boundary.</span></span> <span data-ttu-id="1cc61-183">Registrare la libreria dei tipi del componente COM per consentire alle chiamate di attraversare correttamente il limite dell'apartment.</span><span class="sxs-lookup"><span data-stu-id="1cc61-183">You must register the type library of the COM component for calls to successfully cross the apartment boundary.</span></span>  
  
-   <span data-ttu-id="1cc61-184">Modificare il thread principale impostando il thread del client su STA o MTA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-184">Alter the main thread by setting the client thread to STA or MTA.</span></span> <span data-ttu-id="1cc61-185">Se il client C# chiama ad esempio molti componenti COM STA, è possibile evitare il marshalling su diversi apartment impostando il thread principale su STA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-185">For example, if your C# client calls many STA COM components, you can avoid cross-apartment marshaling by setting the main thread to STA.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="1cc61-186">Dopo avere impostato il thread di un client C# su STA, occorre effettuare il marshalling su diversi apartment per le chiamate ai componenti COM MTA.</span><span class="sxs-lookup"><span data-stu-id="1cc61-186">Once the thread of a C# client is set to STA, calls to MTA COM components will require cross-apartment marshaling.</span></span>  
  
 <span data-ttu-id="1cc61-187">Per istruzioni sulla selezione esplicita di un modello di apartment, vedere [Threading gestito e non gestito](http://msdn.microsoft.com/en-us/db425c20-4b2f-4433-bf96-76071c7881e5).</span><span class="sxs-lookup"><span data-stu-id="1cc61-187">For instructions on explicitly selecting an apartment model, see [Managed and Unmanaged Threading](http://msdn.microsoft.com/en-us/db425c20-4b2f-4433-bf96-76071c7881e5).</span></span>  
  
 [<span data-ttu-id="1cc61-188">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="1cc61-188">Back to top</span></span>](#top)  
  
<a name="marshaling_remote_calls"></a>   
## <a name="marshaling-remote-calls"></a><span data-ttu-id="1cc61-189">Marshalling di chiamate remote</span><span class="sxs-lookup"><span data-stu-id="1cc61-189">Marshaling Remote Calls</span></span>  
 <span data-ttu-id="1cc61-190">Come per il marshalling su diversi apartment, si ricorre al marshalling COM nelle chiamate tra il codice gestito e non gestito ogni volta che gli oggetti si trovano in processi separati.</span><span class="sxs-lookup"><span data-stu-id="1cc61-190">As with cross-apartment marshaling, COM marshaling is involved in each call between managed and unmanaged code whenever the objects reside in separate processes.</span></span> <span data-ttu-id="1cc61-191">Ad esempio:</span><span class="sxs-lookup"><span data-stu-id="1cc61-191">For example:</span></span>  
  
-   <span data-ttu-id="1cc61-192">Un client COM che richiama un server gestito in un host remoto usa DCOM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-192">A COM client that invokes a managed server on a remote host uses distributed COM (DCOM).</span></span>  
  
-   <span data-ttu-id="1cc61-193">Un client gestito che richiama un server COM su un host remoto usa DCOM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-193">A managed client that invokes a COM server on a remote host uses DCOM.</span></span>  
  
 <span data-ttu-id="1cc61-194">Nell'illustrazione seguente viene mostrato come il marshalling di interoperabilità e il marshalling COM forniscano canali di comunicazione attraverso i limiti dell'host e del processo.</span><span class="sxs-lookup"><span data-stu-id="1cc61-194">The following illustration shows how interop marshaling and COM marshaling provide communications channels across process and host boundaries.</span></span>  
  
 <span data-ttu-id="1cc61-195">![Marshalling COM](../../../docs/framework/interop/media/interophost.gif "interophost")</span><span class="sxs-lookup"><span data-stu-id="1cc61-195">![COM marshaling](../../../docs/framework/interop/media/interophost.gif "interophost")</span></span>  
<span data-ttu-id="1cc61-196">Marshalling su diversi processi</span><span class="sxs-lookup"><span data-stu-id="1cc61-196">Cross-process marshaling</span></span>  
  
### <a name="preserving-identity"></a><span data-ttu-id="1cc61-197">Mantenimento dell'identità</span><span class="sxs-lookup"><span data-stu-id="1cc61-197">Preserving Identity</span></span>  
 <span data-ttu-id="1cc61-198">In Common Language Runtime l'identità di riferimenti gestiti e non gestiti viene mantenuta.</span><span class="sxs-lookup"><span data-stu-id="1cc61-198">The common language runtime preserves the identity of managed and unmanaged references.</span></span> <span data-ttu-id="1cc61-199">L'illustrazione riportata di seguito mostra il flusso di riferimenti non gestiti diretti (prima riga) e di riferimenti gestiti diretti (ultima riga) attraverso i limiti dell'host e del processo.</span><span class="sxs-lookup"><span data-stu-id="1cc61-199">The following illustration shows the flow of direct unmanaged references (top row) and direct managed references (bottom row) across process and host boundaries.</span></span>  
  
 <span data-ttu-id="1cc61-200">![COM callable wrapper e runtime callable wrapper](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span><span class="sxs-lookup"><span data-stu-id="1cc61-200">![COM callable wrapper and runtime callable wrapper](../../../docs/framework/interop/media/interopdirectref.gif "interopdirectref")</span></span>  
<span data-ttu-id="1cc61-201">Passaggio dei riferimenti attraverso i limiti dell'host e del processo</span><span class="sxs-lookup"><span data-stu-id="1cc61-201">Reference passing across process and host boundaries</span></span>  
  
 <span data-ttu-id="1cc61-202">In questa illustrazione:</span><span class="sxs-lookup"><span data-stu-id="1cc61-202">In this illustration:</span></span>  
  
-   <span data-ttu-id="1cc61-203">Un client non gestito recupera un riferimento a un oggetto COM da un oggetto gestito che lo recupera da un host remoto.</span><span class="sxs-lookup"><span data-stu-id="1cc61-203">An unmanaged client gets a reference to a COM object from a managed object that gets this reference from a remote host.</span></span> <span data-ttu-id="1cc61-204">Il meccanismo dei servizi remoti è DCOM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-204">The remoting mechanism is DCOM.</span></span>  
  
-   <span data-ttu-id="1cc61-205">Un client gestito recupera un riferimento a un oggetto gestito da un oggetto COM che lo recupera da un host remoto.</span><span class="sxs-lookup"><span data-stu-id="1cc61-205">A managed client gets a reference to a managed object from a COM object that gets this reference from a remote host.</span></span> <span data-ttu-id="1cc61-206">Il meccanismo dei servizi remoti è DCOM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-206">The remoting mechanism is DCOM.</span></span>  
  
    > [!NOTE]
    >  <span data-ttu-id="1cc61-207">La libreria dei tipi esportata del server gestito deve essere registrata.</span><span class="sxs-lookup"><span data-stu-id="1cc61-207">The exported type library of the managed server must be registered.</span></span>  
  
 <span data-ttu-id="1cc61-208">Il numero di limiti di processo tra chiamante e chiamato non è rilevante. La creazione di riferimenti diretti è identica per le chiamate in-process e per quelle out-of-process.</span><span class="sxs-lookup"><span data-stu-id="1cc61-208">The number of process boundaries between caller and callee is irrelevant; the same direct referencing occurs for in-process and out-of-process calls.</span></span>  
  
### <a name="managed-remoting"></a><span data-ttu-id="1cc61-209">Servizi remoti gestiti</span><span class="sxs-lookup"><span data-stu-id="1cc61-209">Managed Remoting</span></span>  
 <span data-ttu-id="1cc61-210">Tra i servizi di runtime vengono inoltre forniti servizi remoti gestiti, utilizzabili per stabilire un canale di comunicazione tra gli oggetti gestiti attraverso i limiti dell'host e del processo.</span><span class="sxs-lookup"><span data-stu-id="1cc61-210">The runtime also provides managed remoting, which you can use to establish a communications channel between managed objects across process and host boundaries.</span></span> <span data-ttu-id="1cc61-211">I servizi remoti gestiti possono contenere un firewall tra i componenti di comunicazione, come mostrato nell'illustrazione riportata di seguito.</span><span class="sxs-lookup"><span data-stu-id="1cc61-211">Managed remoting can accommodate a firewall between the communicating components, as the following illustration shows.</span></span>  
  
 <span data-ttu-id="1cc61-212">![SOAP o TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span><span class="sxs-lookup"><span data-stu-id="1cc61-212">![SOAP or TcpChannel](../../../docs/framework/interop/media/interopremotesoap.gif "interopremotesoap")</span></span>  
<span data-ttu-id="1cc61-213">Chiamate remote attraverso i firewall mediante SOAP o la classe TcpChannel</span><span class="sxs-lookup"><span data-stu-id="1cc61-213">Remote calls across firewalls using SOAP or the TcpChannel class</span></span>  
  
 <span data-ttu-id="1cc61-214">È possibile incanalare tramite SOAP alcune chiamate non gestite, ad esempio quelle tra i [componenti serviti](http://msdn.microsoft.com/en-us/f109ee24-81ad-4d99-9892-51ac6f34978c) e COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-214">Some unmanaged calls can be channeled through SOAP, such as the calls between [serviced components](http://msdn.microsoft.com/en-us/f109ee24-81ad-4d99-9892-51ac6f34978c) and COM.</span></span>  
  
 [<span data-ttu-id="1cc61-215">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="1cc61-215">Back to top</span></span>](#top)  
  
<a name="related_topics"></a>   
## <a name="related-topics"></a><span data-ttu-id="1cc61-216">Argomenti correlati</span><span class="sxs-lookup"><span data-stu-id="1cc61-216">Related Topics</span></span>  
  
|<span data-ttu-id="1cc61-217">Titolo</span><span class="sxs-lookup"><span data-stu-id="1cc61-217">Title</span></span>|<span data-ttu-id="1cc61-218">Descrizione</span><span class="sxs-lookup"><span data-stu-id="1cc61-218">Description</span></span>|  
|-----------|-----------------|  
|[<span data-ttu-id="1cc61-219">Comportamento di marshalling predefinito</span><span class="sxs-lookup"><span data-stu-id="1cc61-219">Default Marshaling Behavior</span></span>](../../../docs/framework/interop/default-marshaling-behavior.md)|<span data-ttu-id="1cc61-220">Descrive le regole usate dal servizio di marshalling di interoperabilità per effettuare il marshalling dei dati.</span><span class="sxs-lookup"><span data-stu-id="1cc61-220">Describes the rules that the interop marshaling service uses to marshal data.</span></span>|  
|[<span data-ttu-id="1cc61-221">Marshalling dei dati con platform invoke</span><span class="sxs-lookup"><span data-stu-id="1cc61-221">Marshaling Data with Platform Invoke</span></span>](../../../docs/framework/interop/marshaling-data-with-platform-invoke.md)|<span data-ttu-id="1cc61-222">Descrive come dichiarare i parametri dei metodi e passare gli argomenti alle funzioni esportate dalle librerie non gestite.</span><span class="sxs-lookup"><span data-stu-id="1cc61-222">Describes how to declare method parameters and pass arguments to functions exported by unmanaged libraries.</span></span>|  
|[<span data-ttu-id="1cc61-223">Dati di marshalling con interoperabilità COM</span><span class="sxs-lookup"><span data-stu-id="1cc61-223">Marshaling Data with COM Interop</span></span>](../../../docs/framework/interop/marshaling-data-with-com-interop.md)|<span data-ttu-id="1cc61-224">Descrive come personalizzare i wrapper COM per modificare il comportamento di marshalling.</span><span class="sxs-lookup"><span data-stu-id="1cc61-224">Describes how to customize COM wrappers to alter marshaling behavior.</span></span>|  
|[<span data-ttu-id="1cc61-225">Procedura: Eseguire la migrazione di codice gestito da DCOM a WCF</span><span class="sxs-lookup"><span data-stu-id="1cc61-225">How to: Migrate Managed-Code DCOM to WCF</span></span>](../../../docs/framework/interop/how-to-migrate-managed-code-dcom-to-wcf.md)|<span data-ttu-id="1cc61-226">Descrive come eseguire la migrazione da DCOM a WCF.</span><span class="sxs-lookup"><span data-stu-id="1cc61-226">Describes how to migrate from DCOM to WCF.</span></span>|  
|[<span data-ttu-id="1cc61-227">Procedura: Eseguire il mapping di HRESULT ed eccezioni</span><span class="sxs-lookup"><span data-stu-id="1cc61-227">How to: Map HRESULTs and Exceptions</span></span>](../../../docs/framework/interop/how-to-map-hresults-and-exceptions.md)|<span data-ttu-id="1cc61-228">Descrive come mappare le eccezioni personalizzate agli oggetti HRESULT e illustra le relazioni di mapping tra ogni oggetto HRESULT e la classe di eccezioni corrispondente in .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="1cc61-228">Describes how to map custom exceptions to HRESULTs and provides the complete mapping from each HRESULT to its comparable exception class in the .NET Framework.</span></span>|  
|[<span data-ttu-id="1cc61-229">Interoperabilità tramite tipi generici</span><span class="sxs-lookup"><span data-stu-id="1cc61-229">Interoperating Using Generic Types</span></span>](http://msdn.microsoft.com/en-us/26b88e03-085b-4b53-94ba-a5a9c709ce58)|<span data-ttu-id="1cc61-230">Descrive le azioni supportate quando si usano tipi generici per l'interoperabilità COM.</span><span class="sxs-lookup"><span data-stu-id="1cc61-230">Describes which actions are supported when using generic types for COM interoperability.</span></span>|  
|[<span data-ttu-id="1cc61-231">Interoperabilità con codice non gestito</span><span class="sxs-lookup"><span data-stu-id="1cc61-231">Interoperating with Unmanaged Code</span></span>](../../../docs/framework/interop/index.md)|<span data-ttu-id="1cc61-232">Descrive i servizi di interoperabilità forniti da Common Language Runtime.</span><span class="sxs-lookup"><span data-stu-id="1cc61-232">Describes interoperability services provided by the common language runtime.</span></span>|  
|[<span data-ttu-id="1cc61-233">Interoperabilità COM avanzata</span><span class="sxs-lookup"><span data-stu-id="1cc61-233">Advanced COM Interoperability</span></span>](http://msdn.microsoft.com/en-us/3ada36e5-2390-4d70-b490-6ad8de92f2fb)|<span data-ttu-id="1cc61-234">Contiene collegamenti per accedere ad altre informazioni sull'inclusione di componenti COM nell'applicazione .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="1cc61-234">Provides links to more information about incorporating COM components into your .NET Framework application.</span></span>|  
|[<span data-ttu-id="1cc61-235">Considerazioni di progettazione per l'interoperabilità</span><span class="sxs-lookup"><span data-stu-id="1cc61-235">Design Considerations for Interoperation</span></span>](http://msdn.microsoft.com/en-us/b59637f6-fe35-40d6-ae72-901e7a707689)|<span data-ttu-id="1cc61-236">Fornisce suggerimenti per la scrittura di componenti COM integrati.</span><span class="sxs-lookup"><span data-stu-id="1cc61-236">Provides tips for writing integrated COM components.</span></span>|  
  
 [<span data-ttu-id="1cc61-237">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="1cc61-237">Back to top</span></span>](#top)  
  
<a name="reference"></a>   
## <a name="reference"></a><span data-ttu-id="1cc61-238">Riferimento</span><span class="sxs-lookup"><span data-stu-id="1cc61-238">Reference</span></span>  
 <xref:System.Runtime.InteropServices?displayProperty=nameWithType>  
  
 [<span data-ttu-id="1cc61-239">Torna all'inizio</span><span class="sxs-lookup"><span data-stu-id="1cc61-239">Back to top</span></span>](#top)
