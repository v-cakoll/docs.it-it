---
title: Cenni preliminari sul flusso di messaggi
ms.date: 03/30/2017
ms.assetid: fb0899e1-84cc-4d90-b45b-dc5a50063943
ms.openlocfilehash: 73ad66389d8458c0508c7a8cae28f54ca38ed574
ms.sourcegitcommit: 586dbdcaef9767642436b1e4efbe88fb15473d6f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 10/06/2018
ms.locfileid: "48841982"
---
# <a name="message-flow-overview"></a><span data-ttu-id="a0d49-102">Cenni preliminari sul flusso di messaggi</span><span class="sxs-lookup"><span data-stu-id="a0d49-102">Message Flow Overview</span></span>
<span data-ttu-id="a0d49-103">In un sistema distribuito che contiene servizi interconnessi è necessario determinare relazioni causali tra i servizi.</span><span class="sxs-lookup"><span data-stu-id="a0d49-103">In a distributed system containing interconnected services, it is necessary to determine causal relationships between the services.</span></span> <span data-ttu-id="a0d49-104">È importante comprendere i vari componenti che appartengono a un flusso di richiesta per supportare scenari critici, ad esempio monitoraggio dello stato, risoluzione dei problemi e analisi della causa radice.</span><span class="sxs-lookup"><span data-stu-id="a0d49-104">It is important to understand the various components that were part of a request flow to support critical scenarios such as health monitoring, troubleshooting, and root cause analysis.</span></span> <span data-ttu-id="a0d49-105">Per abilitare la correlazione di tracce tra i vari servizi, in .NET Framework 4 è stato aggiunto supporto tramite le funzionalità seguenti:</span><span class="sxs-lookup"><span data-stu-id="a0d49-105">To enable the correlation of traces between various services, in the .NET Framework 4 we added support through the following features:</span></span>

-   <span data-ttu-id="a0d49-106">Traccia analitica: funzionalità di traccia a prestazioni elevate e verbosità ridotta impostata in base a Event Tracing for Windows (ETW).</span><span class="sxs-lookup"><span data-stu-id="a0d49-106">Analytic tracing: A high performance and low verbosity tracing feature using Event Tracing for Windows (ETW).</span></span>

-   <span data-ttu-id="a0d49-107">Modello di attività end-to-end per i servizi WCF/WF: questa funzionalità supporta la correlazione di tracce generate dagli spazi dei nomi <xref:System.ServiceModel> e <xref:System.Workflow.ComponentModel>.</span><span class="sxs-lookup"><span data-stu-id="a0d49-107">End-to-end activity model for WCF/WF services: This feature supports correlation of traces generated by the <xref:System.ServiceModel> and <xref:System.Workflow.ComponentModel> namespaces.</span></span>

-   <span data-ttu-id="a0d49-108">Rilevamento ETW per WF: questa funzionalità usa record di rilevamento generati dai servizi WF per fornire visibilità nello stato corrente e in quello di avanzamento del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="a0d49-108">ETW tracking for WF: This feature uses tracking records generated by WF services to provide visibility into the workflow’s current state and progress.</span></span>

 <span data-ttu-id="a0d49-109">Gli errori registrati in un record di rilevamento o di traccia possono essere usati per individuare difetti del codice o messaggi in formato non corretto.</span><span class="sxs-lookup"><span data-stu-id="a0d49-109">Errors logged in a tracking or tracing record can be used to find code defects or incorrectly formed messages.</span></span> <span data-ttu-id="a0d49-110">La proprietà ActivityId del nodo relativo alla correlazione nell'intestazione del messaggio dell'evento può essere usata per determinare l'attività in cui si è verificato l'errore.</span><span class="sxs-lookup"><span data-stu-id="a0d49-110">The ActivityId property of the Correlation node in the event’s message header can be used to determine the faulting activity.</span></span> <span data-ttu-id="a0d49-111">Per abilitare la traccia del flusso di messaggi dall'ID attività, vedere [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span><span class="sxs-lookup"><span data-stu-id="a0d49-111">To enable message flow tracing by activity ID, see [Configuring Message Flow Tracing](../../../../docs/framework/wcf/diagnostics/etw/configuring-message-flow-tracing.md).</span></span> <span data-ttu-id="a0d49-112">In questo argomento viene illustrato come abilitare la traccia del flusso di messaggi nel progetto creato nell'Esercitazione introduttiva.</span><span class="sxs-lookup"><span data-stu-id="a0d49-112">This topic demonstrates how to enable message flow tracing in the project created in the Getting Started tutorial.</span></span>

### <a name="to-enable-message-flow-tracing-in-the-getting-started-tutorial"></a><span data-ttu-id="a0d49-113">Per abilitare la traccia del flusso di messaggi nell'Esercitazione introduttiva</span><span class="sxs-lookup"><span data-stu-id="a0d49-113">To enable message flow tracing in the Getting Started tutorial</span></span>

1.  <span data-ttu-id="a0d49-114">Aprire il Visualizzatore eventi facendo **avviare**, **eseguito**e l'immissione di `eventvwr.exe`.</span><span class="sxs-lookup"><span data-stu-id="a0d49-114">Open Event Viewer by clicking **Start**, **Run**, and entering `eventvwr.exe`.</span></span>

2.  <span data-ttu-id="a0d49-115">Se non è stata abilitata la traccia analitica, espandere **registri applicazioni e servizi**, **Microsoft**, **Windows**, **Server applicazioni-applicazioni** .</span><span class="sxs-lookup"><span data-stu-id="a0d49-115">If you haven’t enabled analytic tracing, expand **Applications and Services Logs**, **Microsoft**, **Windows**, **Application Server-Applications**.</span></span> <span data-ttu-id="a0d49-116">Selezionare **View**, **mostrano analitici e i registri Debug**.</span><span class="sxs-lookup"><span data-stu-id="a0d49-116">Select **View**, **Show Analytic and Debug Logs**.</span></span> <span data-ttu-id="a0d49-117">Fare doppio clic su **analitico** e selezionare **Attiva registro**.</span><span class="sxs-lookup"><span data-stu-id="a0d49-117">Right-click **Analytic** and select **Enable Log**.</span></span> <span data-ttu-id="a0d49-118">Lasciare aperto il Visualizzatore eventi in modo che sia possibile visualizzare le tracce.</span><span class="sxs-lookup"><span data-stu-id="a0d49-118">Leave Event Viewer open so that traces can be viewed.</span></span>

3.  <span data-ttu-id="a0d49-119">Aprire l'esempio creato nel [esercitazione introduttiva su](../../../../docs/framework/wcf/getting-started-tutorial.md) in Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="a0d49-119">Open the sample created in the [Getting Started Tutorial](../../../../docs/framework/wcf/getting-started-tutorial.md) in Visual Studio 2012.</span></span> <span data-ttu-id="a0d49-120">Si noti che è necessario eseguire Visual Studio 2012 come amministratore in modo che sia possibile creare il servizio.</span><span class="sxs-lookup"><span data-stu-id="a0d49-120">Note that you must run Visual Studio 2012 as an administrator so that the service can be created.</span></span> <span data-ttu-id="a0d49-121">Se si dispone di installare gli esempi WCF, è possibile aprire il [introduttiva](../../../../docs/framework/wcf/samples/getting-started-sample.md), che contiene il progetto completato creato nell'esercitazione.</span><span class="sxs-lookup"><span data-stu-id="a0d49-121">If you have the WCF samples installed, you can open the [Getting Started](../../../../docs/framework/wcf/samples/getting-started-sample.md), which contains the completed project created in the tutorial.</span></span>

4.  <span data-ttu-id="a0d49-122">Fare doppio clic sul **assistenza** del progetto e selezionare **Add**, **nuovo elemento**.</span><span class="sxs-lookup"><span data-stu-id="a0d49-122">Right-click the **Service** project and select **Add**, **New Item**.</span></span> <span data-ttu-id="a0d49-123">Selezionare **File di configurazione dell'applicazione** e fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="a0d49-123">Select **Application Configuration File** and click **OK**.</span></span>

5.  <span data-ttu-id="a0d49-124">Aggiungere il codice seguente al file App.Config creato nel passaggio precedente.</span><span class="sxs-lookup"><span data-stu-id="a0d49-124">Add the following code to the App.Config file created in the previous step.</span></span>

    ```xml
    <system.serviceModel>
      <diagnostics>
        <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
      </diagnostics>
    </system.serviceModel>
    ```

6.  <span data-ttu-id="a0d49-125">Premere CTRL+F5 per eseguire l'applicazione server senza debug.</span><span class="sxs-lookup"><span data-stu-id="a0d49-125">Execute the server application without debugging by pressing CTRL+F5.</span></span> <span data-ttu-id="a0d49-126">Eseguire il progetto client facendo clic con il **Client** progetto, quindi selezionando **Debug**, **Avvia nuova istanza**.</span><span class="sxs-lookup"><span data-stu-id="a0d49-126">Execute the client project by right-clicking the **Client** project and selecting **Debug**, **Start New Instance**.</span></span>

7.  <span data-ttu-id="a0d49-127">Per tracciare gli eventi dal client al server, aggiungere il codice seguente al file di configurazione dell'applicazione nel progetto Client.</span><span class="sxs-lookup"><span data-stu-id="a0d49-127">To trace the events from the client to the server, add the following to the application configuration file in the Client project.</span></span>

    ```xml
    <diagnostics>
      <endToEndTracing propagateActivity="true" messageFlowTracing="true"/>
    </diagnostics>
    ```

8.  <span data-ttu-id="a0d49-128">In Program.cs nel client aggiungere l'istruzione Using seguente.</span><span class="sxs-lookup"><span data-stu-id="a0d49-128">In Program.cs in the client, add the following Using statement.</span></span>

    ```
    using System.Diagnostics;
    ```

9. <span data-ttu-id="a0d49-129">Nel metodo Main presente nel file program.cs del progetto client impostare il GUID della traccia in modo che venga propagato nel registro eventi.</span><span class="sxs-lookup"><span data-stu-id="a0d49-129">In the Main method in the program.cs file in the client project, set the Trace GUID to be propagated in the event log.</span></span>

    ```
    Guid guid = Guid.NewGuid();
    Trace.CorrelationManager.ActivityId = guid;
    ```

10. <span data-ttu-id="a0d49-130">Aggiornare ed esaminare i **analitico** log.</span><span class="sxs-lookup"><span data-stu-id="a0d49-130">Refresh and examine the **Analytic**  log.</span></span>  <span data-ttu-id="a0d49-131">Cercare gli eventi con ID evento 220.</span><span class="sxs-lookup"><span data-stu-id="a0d49-131">Look for an event with Event ID 220.</span></span>  <span data-ttu-id="a0d49-132">Selezionare l'evento, quindi scegliere il **dettagli** scheda nel riquadro di anteprima.</span><span class="sxs-lookup"><span data-stu-id="a0d49-132">Select the event, and click the **Details** tab in the preview pane.</span></span> <span data-ttu-id="a0d49-133">Questo evento conterrà l'ID di correlazione per l'attività chiamante.</span><span class="sxs-lookup"><span data-stu-id="a0d49-133">This event will contain the correlation ID for the calling activity.</span></span>

    ```xml
    <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" />
    ```

    > [!NOTE]
    >  <span data-ttu-id="a0d49-134">Tutti gli eventi con stesso GUID in ActivityID sono correlati a una richiesta.</span><span class="sxs-lookup"><span data-stu-id="a0d49-134">All events with the same GUID in the ActivityID are related to one request.</span></span> <span data-ttu-id="a0d49-135">In questo modo è possibile correlare messaggi tra un client e un servizio specifici.</span><span class="sxs-lookup"><span data-stu-id="a0d49-135">This can be used to correlate messages from a specific client to a specific service.</span></span> <span data-ttu-id="a0d49-136">Se il client ha chiamato un altro servizio, lo stesso client potrebbe essere identificato da ActivityID.</span><span class="sxs-lookup"><span data-stu-id="a0d49-136">If the client called another service, then the same client could be identified by ActivityID.</span></span>

11. <span data-ttu-id="a0d49-137">In alcuni casi l'elemento ActivityID può essere modificato dal GUID originale in un nuovo ActivityID.</span><span class="sxs-lookup"><span data-stu-id="a0d49-137">In some cases, the ActivityID can change from the original GUID to a new ActivityID.</span></span> <span data-ttu-id="a0d49-138">In questo caso viene generato un evento di trasferimento.</span><span class="sxs-lookup"><span data-stu-id="a0d49-138">In that case, a transfer event is emitted.</span></span> <span data-ttu-id="a0d49-139">L'ID evento è 499 e l'evento conterrà i dati seguenti nell'intestazione.</span><span class="sxs-lookup"><span data-stu-id="a0d49-139">This event ID is 499, and the event will contain the following data in the header.</span></span>

    ```xml
    <Event xmlns="http://schemas.microsoft.com/win/2004/08/events/event">
        <System>
            <Provider Name="Microsoft-Windows-Application Server-Applications" Guid="{c651f5f6-1c0d-492e-8ae1-b4efd7c9d503}" />
            <EventID>499</EventID>
            ...
            <Correlation ActivityID="{A066CCF1-8AB3-459B-B62F-F79F957A5036}" RelatedActivityID="{85FC0930-9C49-42DA-804B-A7368104BD1B}" />
            ...
       </System>
    </Event>
    ```

    > [!NOTE]
    >  <span data-ttu-id="a0d49-140">L'evento di trasferimento registra la modifica dell'elemento ActivityID attivo dal GUID specificato come ActivityID al GUID specificato come RelatedActivityID.</span><span class="sxs-lookup"><span data-stu-id="a0d49-140">The transfer event records the change of the active ActivityID from the GUID specified as the ActivityID to the GUID specified as RelatedActivityID.</span></span> <span data-ttu-id="a0d49-141">Dopo che l'evento di trasferimento viene generato, tutti gli eventi conterranno il nuovo GUID come elemento ActivityID.</span><span class="sxs-lookup"><span data-stu-id="a0d49-141">After the transfer event is emitted, all events will contain the new GUID as the ActivityID.</span></span>
