---
title: Considerazioni sulla protezione per i dati
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a7eb98da-4a93-4692-8b59-9d670c79ffb2
ms.openlocfilehash: 530bb54936f97f1d7460d63cfa316c760cbd449d
ms.sourcegitcommit: 2543a78be6e246aa010a01decf58889de53d1636
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 07/17/2020
ms.locfileid: "86441817"
---
# <a name="security-considerations-for-data"></a><span data-ttu-id="037b7-102">Considerazioni sulla protezione per i dati</span><span class="sxs-lookup"><span data-stu-id="037b7-102">Security Considerations for Data</span></span>

<span data-ttu-id="037b7-103">Quando si gestiscono i dati in Windows Communication Foundation (WCF), è necessario considerare alcune categorie di minacce.</span><span class="sxs-lookup"><span data-stu-id="037b7-103">When dealing with data in Windows Communication Foundation (WCF), you must consider a number of threat categories.</span></span> <span data-ttu-id="037b7-104">Nella tabella seguente sono elencate le più importanti categorie di minacce correlate all'elaborazione dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-104">The following table lists the most important threat classes that relate to data processing.</span></span> <span data-ttu-id="037b7-105">WCF fornisce strumenti per attenuare queste minacce.</span><span class="sxs-lookup"><span data-stu-id="037b7-105">WCF provides tools to mitigate these threats.</span></span>

<span data-ttu-id="037b7-106">Attacco Denial of Service durante la ricezione di dati non attendibili, i dati possono fare in modo che il lato ricevente acceda a una quantità sproporzionata di risorse diverse, ad esempio memoria, thread, connessioni disponibili o cicli del processore, causando calcoli lunghi.</span><span class="sxs-lookup"><span data-stu-id="037b7-106">Denial of service When receiving untrusted data, the data may cause the receiving side to access a disproportionate amount of various resources, such as memory, threads, available connections, or processor cycles by causing lengthy computations.</span></span> <span data-ttu-id="037b7-107">Un attacco Denial of Service contro un server può causarne l'arresto anomalo e l'incapacità di elaborare messaggi provenienti da altri client legittimi.</span><span class="sxs-lookup"><span data-stu-id="037b7-107">A denial-of-service attack against a server may cause it to crash and be unable to process messages from other, legitimate clients.</span></span>

<span data-ttu-id="037b7-108">L'esecuzione di codice dannoso in ingresso dati non attendibili induce il lato ricevente a eseguire il codice non previsto.</span><span class="sxs-lookup"><span data-stu-id="037b7-108">Malicious code execution Incoming untrusted data causes the receiving side to run code it did not intend to.</span></span>

<span data-ttu-id="037b7-109">Divulgazione di informazioni l'autore dell'attacco remoto costringe l'entità ricevente a rispondere alle richieste in modo da divulgare più informazioni di quante ne sia intenzionale.</span><span class="sxs-lookup"><span data-stu-id="037b7-109">Information disclosure The remote attacker forces the receiving party to respond to its requests in such a way as to disclose more information than it intends to.</span></span>

## <a name="user-provided-code-and-code-access-security"></a><span data-ttu-id="037b7-110">Protezione da codice fornito dall'utente e dall'accesso di codice</span><span class="sxs-lookup"><span data-stu-id="037b7-110">User-Provided Code and Code Access Security</span></span>

<span data-ttu-id="037b7-111">Diverse posizioni nell'infrastruttura Windows Communication Foundation (WCF) eseguono il codice fornito dall'utente.</span><span class="sxs-lookup"><span data-stu-id="037b7-111">A number of places in the Windows Communication Foundation (WCF) infrastructure run code that is provided by the user.</span></span> <span data-ttu-id="037b7-112">Ad esempio, il motore di serializzazione <xref:System.Runtime.Serialization.DataContractSerializer> può chiamare funzioni di accesso fornite dall'utente `set` e funzioni di accesso `get` .</span><span class="sxs-lookup"><span data-stu-id="037b7-112">For example, the <xref:System.Runtime.Serialization.DataContractSerializer> serialization engine may call user-provided property `set` accessors and `get` accessors.</span></span> <span data-ttu-id="037b7-113">L'infrastruttura del canale WCF può inoltre chiamare le classi derivate fornite dall'utente della <xref:System.ServiceModel.Channels.Message> classe.</span><span class="sxs-lookup"><span data-stu-id="037b7-113">The WCF channel infrastructure may also call into user-provided derived classes of the <xref:System.ServiceModel.Channels.Message> class.</span></span>

<span data-ttu-id="037b7-114">L'autore del codice ha la responsabilità di assicurare che non esistano punti vulnerabili.</span><span class="sxs-lookup"><span data-stu-id="037b7-114">It is the responsibility of the code author to ensure that no security vulnerabilities exist.</span></span> <span data-ttu-id="037b7-115">Se si crea, ad esempio, un tipo di contratto dati con una proprietà del membro dati di tipo integer e nell'implementazione della funzione di accesso `set` si alloca una matrice in base al valore della proprietà, è possibile che si verifichi un attacco Denial of Service se un messaggio dannoso contiene un valore estremamente grande per questo membro dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-115">For example, if you create a data contract type with a data member property of type integer, and in the `set` accessor implementation allocate an array based on the property value, you expose the possibility of a denial-of-service attack if a malicious message contains an extremely large value for this data member.</span></span> <span data-ttu-id="037b7-116">In generale evitare le allocazioni basate su dati in arrivo o lunghe elaborazioni in codice fornito dall'utente, soprattutto se il prolungamento dei tempi di elaborazione può essere causato da una piccola quantità di dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-116">In general, avoid any allocations based on incoming data or lengthy processing in user-provided code (especially if lengthy processing can be caused by a small amount of incoming data).</span></span> <span data-ttu-id="037b7-117">Quando si esegue l'analisi di sicurezza di codice fornito dall'utente, assicurarsi di considerare anche tutti i casi di errore, ovvero tutti i branch del codice in cui vengono generate eccezioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-117">When performing security analysis of user-provided code, make sure to also consider all failure cases (that is, all code branches where exceptions are thrown).</span></span>

<span data-ttu-id="037b7-118">L'esempio più estremo di codice fornito dall'utente è il codice interno all'implementazione del servizio per ogni operazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-118">The ultimate example of user-provided code is the code inside your service implementation for each operation.</span></span> <span data-ttu-id="037b7-119">È responsabilità dello sviluppatore proteggere l'implementazione del servizio.</span><span class="sxs-lookup"><span data-stu-id="037b7-119">The security of your service implementation is your responsibility.</span></span> <span data-ttu-id="037b7-120">È facile creare inavvertitamente implementazioni dell'operazione non protette che possono indurre vulnerabilità agli attacchi Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-120">It is easy to inadvertently create insecure operation implementations that may result in denial-of-service vulnerabilities.</span></span> <span data-ttu-id="037b7-121">Ad esempio, un'operazione che utilizza una stringa e restituisce l'elenco dei clienti da un database il cui nome inizia con quella stringa.</span><span class="sxs-lookup"><span data-stu-id="037b7-121">For example, an operation that takes a string and returns the list of customers from a database whose name starts with that string.</span></span> <span data-ttu-id="037b7-122">Se il database è di grandi dimensioni e la stringa passata è di una sola lettera, il codice potrebbe tentare di creare un messaggio di dimensioni maggiori della memoria disponibile, paralizzando l'intero servizio.</span><span class="sxs-lookup"><span data-stu-id="037b7-122">If you are working with a large database and the string being passed is just a single letter, your code may attempt to create a message larger than all available memory, causing the entire service to fail.</span></span> <span data-ttu-id="037b7-123"><xref:System.OutOfMemoryException>Non è reversibile nell'.NET Framework e comporta sempre la chiusura dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-123">(An <xref:System.OutOfMemoryException> is not recoverable in the .NET Framework and always results in the termination of your application.)</span></span>

<span data-ttu-id="037b7-124">È necessario assicurarsi che non vi sia codice dannoso collegato ai vari punti di estendibilità.</span><span class="sxs-lookup"><span data-stu-id="037b7-124">You should ensure that no malicious code is plugged in to the various extensibility points.</span></span> <span data-ttu-id="037b7-125">Soprattutto in caso di esecuzione con attendibilità parziale, nella gestione di tipi provenienti da assembly parzialmente attendibili o nella creazione di componenti utilizzati da codici parzialmente attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-125">This is especially relevant when running under partial trust, dealing with types from partially-trusted assemblies, or creating components usable by partially-trusted code.</span></span> <span data-ttu-id="037b7-126">Per ulteriori informazioni, vedere "Minacce legate all'attendibilità parziale" in una sezione successiva .</span><span class="sxs-lookup"><span data-stu-id="037b7-126">For more information, see "Partial Trust Threats" in a later section.</span></span>

<span data-ttu-id="037b7-127">Si noti che in caso di esecuzione con attendibilità parziale, l'infrastruttura di serializzazione del contratto dati supporta solo un sottoinsieme limitato del modello di programmazione del contratto dati - ad esempio, tipi o membri dati privati che utilizzano l'attributo <xref:System.SerializableAttribute> non sono supportati.</span><span class="sxs-lookup"><span data-stu-id="037b7-127">Note that when running in partial trust, the data contract serialization infrastructure supports only a limited subset of the data contract programming model - for example, private data members or types using the <xref:System.SerializableAttribute> attribute are not supported.</span></span> <span data-ttu-id="037b7-128">Per ulteriori informazioni, vedere [attendibilità parziale](partial-trust.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-128">For more information, see [Partial Trust](partial-trust.md).</span></span>

## <a name="avoiding-unintentional-information-disclosure"></a><span data-ttu-id="037b7-129">Come evitare l'Information Disclosure (Rivelazione di informazioni) non intenzionale</span><span class="sxs-lookup"><span data-stu-id="037b7-129">Avoiding Unintentional Information Disclosure</span></span>

<span data-ttu-id="037b7-130">Quando si progettano tipi serializzabili tenendo conto della protezione, l'Information Disclosure può costituire un problema.</span><span class="sxs-lookup"><span data-stu-id="037b7-130">When designing serializable types with security in mind, information disclosure is a possible concern.</span></span>

<span data-ttu-id="037b7-131">Tenere presente quanto segue:</span><span class="sxs-lookup"><span data-stu-id="037b7-131">Consider the following points:</span></span>

- <span data-ttu-id="037b7-132">Il modello di programmazione <xref:System.Runtime.Serialization.DataContractSerializer> consente l'esposizione all'esterno del tipo o dell'assembly di dati riservati e interni durante la serializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-132">The <xref:System.Runtime.Serialization.DataContractSerializer> programming model allows the exposure of private and internal data outside of the type or assembly during serialization.</span></span> <span data-ttu-id="037b7-133">Durante l'esportazione dello schema è inoltre possibile che venga esposta la forma di un tipo.</span><span class="sxs-lookup"><span data-stu-id="037b7-133">Additionally, the shape of a type can be exposed during schema export.</span></span> <span data-ttu-id="037b7-134">È essenziale sapere come sarà la proiezione della serializzazione del tipo.</span><span class="sxs-lookup"><span data-stu-id="037b7-134">Be sure to understand your type's serialization projection.</span></span> <span data-ttu-id="037b7-135">Se non si desidera che vengano esposti elementi, disattivarne la serializzazione, ad esempio non applicando l'attributo <xref:System.Runtime.Serialization.DataMemberAttribute> nel caso di un contratto dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-135">If you do not want anything exposed, disable serializing it (for example, by not applying the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute in the case of a data contract).</span></span>

- <span data-ttu-id="037b7-136">Si osservi che possono esistere diverse proiezioni di serializzazione per lo stesso tipo, a seconda del serializzatore utilizzato.</span><span class="sxs-lookup"><span data-stu-id="037b7-136">Be aware that the same type may have multiple serialization projections, depending on the serializer in use.</span></span> <span data-ttu-id="037b7-137">Lo stesso tipo può esporre un set di dati quando viene utilizzato con il serializzatore <xref:System.Runtime.Serialization.DataContractSerializer> e un set di dati diverso quando viene utilizzato con il serializzatore <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="037b7-137">The same type may expose one set of data when used with the <xref:System.Runtime.Serialization.DataContractSerializer> and another set of data when used with the <xref:System.Xml.Serialization.XmlSerializer>.</span></span> <span data-ttu-id="037b7-138">L'utilizzo accidentale di un serializzatore errato può condurre all'Information Disclosure.</span><span class="sxs-lookup"><span data-stu-id="037b7-138">Accidentally using the wrong serializer may lead to information disclosure.</span></span>

- <span data-ttu-id="037b7-139">Utilizzando il serializzatore <xref:System.Xml.Serialization.XmlSerializer> in una chiamata a una procedura remota (RPC) in ambiente legacy/in modalità codificata è possibile esporre in maniera non intenzionale al lato ricevente la forma dell'oggetto grafico contenuto nel lato che invia.</span><span class="sxs-lookup"><span data-stu-id="037b7-139">Using the <xref:System.Xml.Serialization.XmlSerializer> in legacy remote procedure call (RPC)/encoded mode may unintentionally expose the shape of the object graph on the sending side to the receiving side.</span></span>

## <a name="preventing-denial-of-service-attacks"></a><span data-ttu-id="037b7-140">Prevenzione degli attacchi Denial of Service</span><span class="sxs-lookup"><span data-stu-id="037b7-140">Preventing Denial-of-Service Attacks</span></span>

### <a name="quotas"></a><span data-ttu-id="037b7-141">Quote</span><span class="sxs-lookup"><span data-stu-id="037b7-141">Quotas</span></span>

<span data-ttu-id="037b7-142">Fare in modo che il lato ricevente allochi un quantità di memoria significativa potenzialmente costituisce un attacco Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-142">Causing the receiving side to allocate a significant amount of memory is a potential denial-of-service attack.</span></span> <span data-ttu-id="037b7-143">Sebbene questa sezione verta essenzialmente sui problemi di utilizzo della memoria derivanti dai messaggi di grandi dimensioni, possono verificarsi altri attacchi.</span><span class="sxs-lookup"><span data-stu-id="037b7-143">While this section concentrates on memory consumption issues arising from large messages, other attacks may occur.</span></span> <span data-ttu-id="037b7-144">Ad esempio, i tempi di elaborazione dei messaggi possono prolungarsi intollerabilmente.</span><span class="sxs-lookup"><span data-stu-id="037b7-144">For example, messages may use a disproportionate amount of processing time.</span></span>

<span data-ttu-id="037b7-145">Gli attacchi Denial of Service vengono in genere mitigati utilizzando le quote.</span><span class="sxs-lookup"><span data-stu-id="037b7-145">Denial-of-service attacks are usually mitigated using quotas.</span></span> <span data-ttu-id="037b7-146">Al superamento di una quota viene di solito generata un'eccezione <xref:System.ServiceModel.QuotaExceededException> .</span><span class="sxs-lookup"><span data-stu-id="037b7-146">When a quota is exceeded, a <xref:System.ServiceModel.QuotaExceededException> exception is normally thrown.</span></span> <span data-ttu-id="037b7-147">In assenza di quote, un messaggio dannoso potrebbe causare l'utilizzo di tutta la memoria disponibile, provocando la generazione di un'eccezione <xref:System.OutOfMemoryException> o l'utilizzo di tutti gli stack disponibili, con la conseguente generazione di un'eccezione <xref:System.StackOverflowException>.</span><span class="sxs-lookup"><span data-stu-id="037b7-147">Without the quota, a malicious message may cause all available memory to be accessed, resulting in an <xref:System.OutOfMemoryException> exception, or all available stacks to be accessed, resulting in a <xref:System.StackOverflowException>.</span></span>

<span data-ttu-id="037b7-148">Il superamento di una quota è reversibile; se si verifica in un servizio in esecuzione, il messaggio al momento in fase di elaborazione viene ignorato e il servizio rimane in esecuzione e continua a elaborare messaggi.</span><span class="sxs-lookup"><span data-stu-id="037b7-148">The quota exceeded scenario is recoverable; if encountered in a running service, the message currently being processed is discarded and the service keeps running and processes further messages.</span></span> <span data-ttu-id="037b7-149">Gli scenari di memoria insufficiente e di overflow dello stack, tuttavia, non possono essere ripristinati in qualsiasi punto del .NET Framework; il servizio termina se incontra tali eccezioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-149">The out-of-memory and stack overflow scenarios, however, are not recoverable anywhere in the .NET Framework; the service terminates if it encounters such exceptions.</span></span>

<span data-ttu-id="037b7-150">Le quote in WCF non implicano alcuna pre-allocazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-150">Quotas in WCF do not involve any pre-allocation.</span></span> <span data-ttu-id="037b7-151">Se, ad esempio, la quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> (presente in varie classi) è impostata su 128 KB, non significa che vengano automaticamente allocati 128 KB per ogni messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-151">For example, if the <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> quota (found on various classes) is set to 128 KB, it does not mean that 128 KB is automatically allocated for each message.</span></span> <span data-ttu-id="037b7-152">La quantità realmente allocata dipende dalla dimensione effettiva del messaggio in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-152">The actual amount allocated depends on the actual incoming message size.</span></span>

<span data-ttu-id="037b7-153">Molte quote sono disponibili a livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="037b7-153">Many quotas are available at the transport layer.</span></span> <span data-ttu-id="037b7-154">Queste quote vengono applicate dal canale di trasporto specifico utilizzato (HTTP, TCP e così via).</span><span class="sxs-lookup"><span data-stu-id="037b7-154">These are quotas enforced by the specific transport channel in use (HTTP, TCP, and so on).</span></span> <span data-ttu-id="037b7-155">Benché alcune di queste quote siano descritte in questo argomento, per una descrizione dettagliata delle quote vedere [Transport Quotas](transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-155">While this topic discusses some of these quotas, these quotas are described in detail in [Transport Quotas](transport-quotas.md).</span></span>

### <a name="hashtable-vulnerability"></a><span data-ttu-id="037b7-156">Vulnerabilità delle tabelle hash</span><span class="sxs-lookup"><span data-stu-id="037b7-156">Hashtable Vulnerability</span></span>

<span data-ttu-id="037b7-157">Una vulnerabilità si verifica quando i contratti dati contengono tabelle hash o raccolte.</span><span class="sxs-lookup"><span data-stu-id="037b7-157">A vulnerability exists when data contracts contain hashtables or collections.</span></span> <span data-ttu-id="037b7-158">Il problema si verifica se un numero elevato di valori viene inserito in una tabella hash in cui gran parte di questi valori genera lo stesso valore hash.</span><span class="sxs-lookup"><span data-stu-id="037b7-158">The problem occurs if a large number of values are inserted into a hashtable where a large number of those values generate the same hash value.</span></span> <span data-ttu-id="037b7-159">Questa situazione può essere utilizzata come attacco di tipo Denial of Service (DoS).</span><span class="sxs-lookup"><span data-stu-id="037b7-159">This can be used as a DOS attack.</span></span>  <span data-ttu-id="037b7-160">Questa vulnerabilità può essere attenuata impostando la quota di binding MaxReceivedMessageSize.</span><span class="sxs-lookup"><span data-stu-id="037b7-160">This vulnerability can be mitigated by setting the MaxReceivedMessageSize binding quota.</span></span> <span data-ttu-id="037b7-161">Prestare attenzione durante l'impostazione di questa quota per evitare tali attacchi.</span><span class="sxs-lookup"><span data-stu-id="037b7-161">Care must be taken while setting this quota in order to prevent such attacks.</span></span> <span data-ttu-id="037b7-162">La quota definisce un limite superiore per la dimensione del messaggio WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-162">This quota puts an upper limit on the size of WCF message.</span></span> <span data-ttu-id="037b7-163">Inoltre, evitare di utilizzare tabelle hash o raccolte nei contratti dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-163">Additionally, avoid using hashtables or collections in your data contracts.</span></span>

## <a name="limiting-memory-consumption-without-streaming"></a><span data-ttu-id="037b7-164">Limitazione dell'utilizzo di memoria senza flusso</span><span class="sxs-lookup"><span data-stu-id="037b7-164">Limiting Memory Consumption Without Streaming</span></span>

<span data-ttu-id="037b7-165">Il modello di sicurezza da adottare per i messaggi di grandi dimensioni dipende dall'utilizzo del flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-165">The security model around large messages depends on whether streaming is in use.</span></span> <span data-ttu-id="037b7-166">Nel caso più semplice, quando il flusso non viene utilizzato, i messaggi vengono memorizzati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="037b7-166">In the basic, non-streamed case, messages are buffered into memory.</span></span> <span data-ttu-id="037b7-167">In questo caso, utilizzare la quota <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> per l'elemento <xref:System.ServiceModel.Channels.TransportBindingElement> o le associazioni fornite dal sistema per la protezione dai messaggi di grandi dimensioni limitando la dimensione massima utilizzabile per i messaggi.</span><span class="sxs-lookup"><span data-stu-id="037b7-167">In this case, use the <xref:System.ServiceModel.Channels.TransportBindingElement.MaxReceivedMessageSize%2A> quota on the <xref:System.ServiceModel.Channels.TransportBindingElement> or on the system-provided bindings to protect against large messages by limiting the maximum message size to access.</span></span> <span data-ttu-id="037b7-168">Si noti che un servizio può elaborare più messaggi contemporaneamente, nel qual caso sono inclusi tutti in memoria.</span><span class="sxs-lookup"><span data-stu-id="037b7-168">Note that a service may be processing multiple messages at the same time, in which case they are all in memory.</span></span> <span data-ttu-id="037b7-169">Utilizzare la funzionalità di limitazione per mitigare questa minaccia.</span><span class="sxs-lookup"><span data-stu-id="037b7-169">Use the throttling feature to mitigate this threat.</span></span>

<span data-ttu-id="037b7-170">Si osservi inoltre che `MaxReceivedMessageSize` non impone un limite superiore per l'utilizzo di memoria per messaggio, ma lo forza a rientrare un fattore costante.</span><span class="sxs-lookup"><span data-stu-id="037b7-170">Also note that `MaxReceivedMessageSize` does not place an upper bound on per-message memory consumption, but limits it to within a constant factor.</span></span> <span data-ttu-id="037b7-171">Ad esempio, se `MaxReceivedMessageSize` è 1 MB e si riceve un messaggio da 1 MB che viene deserializzato, è necessaria memoria aggiuntiva per contenere l'oggetto grafico deserializzato, comportando un utilizzo totale della memoria ben oltre 1 MB.</span><span class="sxs-lookup"><span data-stu-id="037b7-171">For example, if the `MaxReceivedMessageSize` is 1 MB and a 1-MB message is received and then deserialized, additional memory is required to contain the deserialized object graph, resulting in total memory consumption well over 1 MB.</span></span> <span data-ttu-id="037b7-172">Per questa ragione evitare di creare tipi serializzabili che potrebbero causare un utilizzo di memoria significativo pur in assenza di grandi quantità di dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-172">For this reason, avoid creating serializable types that could result in significant memory consumption without much incoming data.</span></span> <span data-ttu-id="037b7-173">Ad esempio, è possibile creare un'istanza di un contratto dati "contratto" con i campi dei membri dati facoltativi 50 e altri campi privati 100 con la costruzione XML " \<MyContract/> ".</span><span class="sxs-lookup"><span data-stu-id="037b7-173">For example, a data contract "MyContract" with 50 optional data member fields and an additional 100 private fields could be instantiated with the XML construction "\<MyContract/>".</span></span> <span data-ttu-id="037b7-174">Tale costrutto XML comporta un utilizzo della memoria per 150 campi.</span><span class="sxs-lookup"><span data-stu-id="037b7-174">This XML results in memory being accessed for 150 fields.</span></span> <span data-ttu-id="037b7-175">Si noti che i membri dati sono facoltativi per impostazione predefinita.</span><span class="sxs-lookup"><span data-stu-id="037b7-175">Note that data members are optional by default.</span></span> <span data-ttu-id="037b7-176">Il problema è maggiore quando il tipo fa parte di una matrice.</span><span class="sxs-lookup"><span data-stu-id="037b7-176">The problem is compounded when such a type is part of an array.</span></span>

<span data-ttu-id="037b7-177">La quota`MaxReceivedMessageSize` da sola non è sufficiente per impedire tutti gli attacchi Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-177">`MaxReceivedMessageSize` alone is not enough to prevent all denial-of-service attacks.</span></span> <span data-ttu-id="037b7-178">È ad esempio possibile forzare il deserializzatore a deserializzare un oggetto grafico profondamente annidato (ovvero un oggetto contenente un altro oggetto che a sua volta ne contiene un altro ancora e così via) da un messaggio in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-178">For example, the deserializer may be forced to deserialize a deeply-nested object graph (an object that contains another object that contains yet another one, and so on) by an incoming message.</span></span> <span data-ttu-id="037b7-179">Per deserializzare tali oggetti grafici, i serializzatori <xref:System.Runtime.Serialization.DataContractSerializer> e <xref:System.Xml.Serialization.XmlSerializer> chiamano entrambi metodi in base a una modalità annidata.</span><span class="sxs-lookup"><span data-stu-id="037b7-179">Both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Xml.Serialization.XmlSerializer> call methods in a nested way to deserialize such graphs.</span></span> <span data-ttu-id="037b7-180">L'annidamento profondo di chiamate ai metodi può causare la generazione di un'eccezione <xref:System.StackOverflowException>irreversibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-180">Deep nesting of method calls may result in an unrecoverable <xref:System.StackOverflowException>.</span></span> <span data-ttu-id="037b7-181">Questa minaccia viene mitigata impostando la quota <xref:System.ServiceModel.Configuration.XmlDictionaryReaderQuotasElement.MaxDepth%2A> per limitare il livello di annidamento XML, come descritto nella sezione "Utilizzo sicuro di XML" riportata più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="037b7-181">This threat is mitigated by setting the <xref:System.ServiceModel.Configuration.XmlDictionaryReaderQuotasElement.MaxDepth%2A> quota to limit the level of XML nesting, as discussed in the "Using XML Safely" section later in the topic.</span></span>

<span data-ttu-id="037b7-182">È particolarmente importante impostare quote aggiuntive su `MaxReceivedMessageSize` se si utilizza la codifica XML binaria.</span><span class="sxs-lookup"><span data-stu-id="037b7-182">Setting additional quotas to `MaxReceivedMessageSize` is especially important when using binary XML encoding.</span></span> <span data-ttu-id="037b7-183">L'utilizzo della codifica binaria è per qualche aspetto equivalente alla compressione: un piccolo gruppo di byte nel messaggio in arrivo può rappresentare molti dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-183">Using binary encoding is somewhat equivalent to compression: a small group of bytes in the incoming message may represent a lot of data.</span></span> <span data-ttu-id="037b7-184">Un messaggio che rientra nel limite stabilito da `MaxReceivedMessageSize` in formato completamente espanso può pertanto utilizzare più memoria.</span><span class="sxs-lookup"><span data-stu-id="037b7-184">Thus, even a message fitting into the `MaxReceivedMessageSize` limit may take up much more memory in fully expanded form.</span></span> <span data-ttu-id="037b7-185">Per mitigare queste minacce specifiche del codice XML tutte le quote di lettori XML devono essere impostate correttamente, come descritto nella sezione "Utilizzo sicuro di XML" più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="037b7-185">To mitigate such XML-specific threats, all of the XML reader quotas must be set correctly, as discussed in the "Using XML Safely" section later in this topic.</span></span>

## <a name="limiting-memory-consumption-with-streaming"></a><span data-ttu-id="037b7-186">Limitazione dell'utilizzo di memoria con flusso</span><span class="sxs-lookup"><span data-stu-id="037b7-186">Limiting Memory Consumption with Streaming</span></span>

<span data-ttu-id="037b7-187">Quando si utilizza il flusso è possibile utilizzare un numero basso come impostazione di `MaxReceivedMessageSize` per proteggersi da attacchi Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-187">When streaming, you may use a small `MaxReceivedMessageSize` setting to protect against denial-of-service attacks.</span></span> <span data-ttu-id="037b7-188">Utilizzando il flusso si possono tuttavia creare scenari più complessi.</span><span class="sxs-lookup"><span data-stu-id="037b7-188">However, more complicated scenarios are possible with streaming.</span></span> <span data-ttu-id="037b7-189">Si supponga, come esempio, che un servizio di caricamento di file accetti file con dimensioni maggiori di tutta la memoria disponibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-189">For example, a file upload service accepts files larger than all available memory.</span></span> <span data-ttu-id="037b7-190">In questo caso, la quota `MaxReceivedMessageSize` viene impostata su un valore molto grande, prevedendo che non vengono pressoché memorizzati dati nel buffer e che quindi il messaggio viene convogliato direttamente su disco dal flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-190">In this case, set the `MaxReceivedMessageSize` to an extremely large value, expecting that almost no data is buffered in memory and the message streams directly to disk.</span></span> <span data-ttu-id="037b7-191">Se un messaggio dannoso può in qualche modo forzare il buffering dei dati da parte di WCF anziché eseguire il flusso in questo caso, `MaxReceivedMessageSize` non protegge più dal messaggio che accede a tutta la memoria disponibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-191">If a malicious message can somehow force WCF to buffer data instead of streaming it in this case, `MaxReceivedMessageSize` no longer protects against the message accessing all available memory.</span></span>

<span data-ttu-id="037b7-192">Per attenuare questa minaccia, esistono impostazioni di quota specifiche nei vari componenti di elaborazione dati WCF che limitano il buffering.</span><span class="sxs-lookup"><span data-stu-id="037b7-192">To mitigate this threat, specific quota settings exist on various WCF data-processing components that limit buffering.</span></span> <span data-ttu-id="037b7-193">La più importante fra queste è la proprietà `MaxBufferSize` in vari elementi di associazione del trasporto e associazioni standard.</span><span class="sxs-lookup"><span data-stu-id="037b7-193">The most important of these is the `MaxBufferSize` property on various transport binding elements and standard bindings.</span></span> <span data-ttu-id="037b7-194">Quando si utilizza il flusso questa quota deve essere impostata tenendo conto dalla quantità massima di memoria che si è disposti ad allocare per messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-194">When streaming, this quota should be set taking into account the maximum amount of memory you are willing to allocate per message.</span></span> <span data-ttu-id="037b7-195">Come avviene con `MaxReceivedMessageSize`, questa impostazione non impone un limite massimo assoluto all'utilizzo della memoria ma lo forza esclusivamente a rientrare in fattore costante.</span><span class="sxs-lookup"><span data-stu-id="037b7-195">As with `MaxReceivedMessageSize`, the setting does not put an absolute maximum on memory consumption but only limits it to within a constant factor.</span></span> <span data-ttu-id="037b7-196">Con `MaxReceivedMessageSize`è inoltre necessario essere consapevoli della possibilità che più messaggi vengano elaborati contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-196">Also, as with `MaxReceivedMessageSize`, be aware of the possibility of multiple messages being processed simultaneously.</span></span>

### <a name="maxbuffersize-details"></a><span data-ttu-id="037b7-197">Informazioni dettagliate su MaxBufferSize</span><span class="sxs-lookup"><span data-stu-id="037b7-197">MaxBufferSize Details</span></span>

<span data-ttu-id="037b7-198">La `MaxBufferSize` proprietà limita il buffering bulk di WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-198">The `MaxBufferSize` property limits any bulk buffering WCF does.</span></span> <span data-ttu-id="037b7-199">Ad esempio, WCF memorizza sempre nel buffer le intestazioni SOAP e gli errori SOAP, nonché le parti MIME che non si trovano nell'ordine di lettura naturale in un messaggio MTOM (Message Transmission Optimization Mechanism).</span><span class="sxs-lookup"><span data-stu-id="037b7-199">For example, WCF always buffers SOAP headers and SOAP faults, as well as any MIME parts found to be not in the natural reading order in an Message Transmission Optimization Mechanism (MTOM) message.</span></span> <span data-ttu-id="037b7-200">Questa impostazione limita la quantità di dati memorizzati nel buffer in tutti i casi descritti.</span><span class="sxs-lookup"><span data-stu-id="037b7-200">This setting limits the amount of buffering in all these cases.</span></span>

<span data-ttu-id="037b7-201">A tale scopo, WCF passa il `MaxBufferSize` valore ai vari componenti che possono essere memorizzati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="037b7-201">WCF accomplishes this by passing the `MaxBufferSize` value to the various components that may buffer.</span></span> <span data-ttu-id="037b7-202">Ad esempio, alcuni overload <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> della classe <xref:System.ServiceModel.Channels.Message> accettano un parametro `maxSizeOfHeaders` .</span><span class="sxs-lookup"><span data-stu-id="037b7-202">For example, some <xref:System.ServiceModel.Channels.Message.CreateMessage%2A> overloads of the <xref:System.ServiceModel.Channels.Message> class take a `maxSizeOfHeaders` parameter.</span></span> <span data-ttu-id="037b7-203">WCF passa il `MaxBufferSize` valore a questo parametro per limitare la quantità di buffer dell'intestazione SOAP.</span><span class="sxs-lookup"><span data-stu-id="037b7-203">WCF passes the `MaxBufferSize` value to this parameter to limit the amount of SOAP header buffering.</span></span> <span data-ttu-id="037b7-204">È importante impostare questo parametro quando si utilizza direttamente la classe <xref:System.ServiceModel.Channels.Message> .</span><span class="sxs-lookup"><span data-stu-id="037b7-204">It is important to set this parameter when using the <xref:System.ServiceModel.Channels.Message> class directly.</span></span> <span data-ttu-id="037b7-205">In generale, quando si usa un componente in WCF che accetta parametri di quota, è importante comprendere le implicazioni di sicurezza di questi parametri e impostarli correttamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-205">In general, when using a component in WCF that takes quota parameters, it is important to understand the security implications of these parameters and set them correctly.</span></span>

<span data-ttu-id="037b7-206">Anche il codificatore dei messaggi MTOM dispone di un'impostazione `MaxBufferSize` .</span><span class="sxs-lookup"><span data-stu-id="037b7-206">The MTOM message encoder also has a `MaxBufferSize` setting.</span></span> <span data-ttu-id="037b7-207">Quando si utilizzano associazioni standard, questo elemento viene impostato automaticamente sul valore `MaxBufferSize` a livello di trasporto.</span><span class="sxs-lookup"><span data-stu-id="037b7-207">When using standard bindings, this is set automatically to the transport-level `MaxBufferSize` value.</span></span> <span data-ttu-id="037b7-208">Quando tuttavia si utilizza l'elemento di associazione del codificatore dei messaggi MTOM per costruire un'associazione personalizzata, è importante impostare la proprietà `MaxBufferSize` su un valore sicuro quando viene utilizzato il flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-208">However, when using the MTOM message encoder binding element to construct a custom binding, it is important to set the `MaxBufferSize` property to a safe value when streaming is used.</span></span>

## <a name="xml-based-streaming-attacks"></a><span data-ttu-id="037b7-209">Attacchi al flusso basati su XML</span><span class="sxs-lookup"><span data-stu-id="037b7-209">XML-Based Streaming Attacks</span></span>

<span data-ttu-id="037b7-210">`MaxBufferSize`da solo non è sufficiente assicurarsi che WCF non possa essere forzato nel buffer quando è previsto il flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-210">`MaxBufferSize` alone is not enough to ensure that WCF cannot be forced into buffering when streaming is expected.</span></span> <span data-ttu-id="037b7-211">Ad esempio, i lettori XML WCF memorizzano sempre nel buffer l'intero tag di inizio dell'elemento XML quando iniziano a leggere un nuovo elemento.</span><span class="sxs-lookup"><span data-stu-id="037b7-211">For example, the WCF XML readers always buffer the entire XML element start tag when starting to read a new element.</span></span> <span data-ttu-id="037b7-212">Questo avviene per fare in modo che spazi dei nomi e attributi vengano elaborati correttamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-212">This is done so that namespaces and attributes are properly processed.</span></span> <span data-ttu-id="037b7-213">Se la proprietà `MaxReceivedMessageSize` è impostata su un valore grande (ad esempio, in uno scenario caratterizzato dal flusso diretto di file di grandi dimensioni al disco), potrebbe essere costruito un messaggio dannoso il cui corpo intero sia costituito da un tag iniziale dell'elemento XML di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-213">If `MaxReceivedMessageSize` is configured to be large (for example, to enable a direct-to-disk large file streaming scenario), a malicious message may be constructed where the entire message body is a large XML element start tag.</span></span> <span data-ttu-id="037b7-214">Il tentativo di leggerlo comporterebbe la generazione di un'eccezione <xref:System.OutOfMemoryException>.</span><span class="sxs-lookup"><span data-stu-id="037b7-214">An attempt to read it results in an <xref:System.OutOfMemoryException>.</span></span> <span data-ttu-id="037b7-215">Si tratta di uno dei molti attacchi Denial of Service basati su XML possibili, che possono essere tutti mitigati utilizzando le quote di lettore XML descritte nella sezione "utilizzo sicuro di XML" più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="037b7-215">This is one of many possible XML-based denial-of-service attacks that can all be mitigated using XML reader quotas, discussed in the "Using XML Safely" section later in this topic.</span></span> <span data-ttu-id="037b7-216">Quando si utilizza il flusso, è particolarmente importante impostare tutte queste quote.</span><span class="sxs-lookup"><span data-stu-id="037b7-216">When streaming, it is especially important to set all of these quotas.</span></span>

### <a name="mixing-streaming-and-buffering-programming-models"></a><span data-ttu-id="037b7-217">Utilizzo congiunto del modello di programmazione basato sul flusso e del modello di programmazione basato sulla memorizzazione nel buffer</span><span class="sxs-lookup"><span data-stu-id="037b7-217">Mixing Streaming and Buffering Programming Models</span></span>

<span data-ttu-id="037b7-218">Molti potenziali attacchi derivano dall'utilizzo congiunto di modelli di programmazione basati e non basati sul flusso all'interno dello stesso servizio.</span><span class="sxs-lookup"><span data-stu-id="037b7-218">Many possible attacks arise from mixing streaming and non-streaming programming models in the same service.</span></span> <span data-ttu-id="037b7-219">Si prenda in considerazione ad esempio un contratto di servizio con due operazioni: una che utilizza la classe <xref:System.IO.Stream> e l'altra che utilizza una matrice di un tipo personalizzato.</span><span class="sxs-lookup"><span data-stu-id="037b7-219">Suppose there is a service contract with two operations: one takes a <xref:System.IO.Stream> and another takes an array of some custom type.</span></span> <span data-ttu-id="037b7-220">Si supponga inoltre che la proprietà `MaxReceivedMessageSize` sia impostata su un valore grande per consentire alla prima operazione di elaborare grandi flussi.</span><span class="sxs-lookup"><span data-stu-id="037b7-220">Suppose also that `MaxReceivedMessageSize` is set to a large value to enable the first operation to process large streams.</span></span> <span data-ttu-id="037b7-221">Purtroppo ciò significa che sarà possibile inviare messaggi di grandi dimensioni anche alla seconda operazione e il deserializzatore memorizza i dati nel buffer come matrice prima che venga chiamata l'operazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-221">Unfortunately, this means that large messages can now be sent to the second operation as well, and the deserializer buffers data in memory as an array before the operation is called.</span></span> <span data-ttu-id="037b7-222">Si tratta di un attacco Denial of Service potenziale: la quota `MaxBufferSize` non limita la dimensione del corpo del messaggio che è l'elemento sul quale agisce il deserializzatore.</span><span class="sxs-lookup"><span data-stu-id="037b7-222">This is a potential denial-of-service attack: the `MaxBufferSize` quota does not limit the size of the message body, which is what the deserializer works with.</span></span>

<span data-ttu-id="037b7-223">Per questa ragione, evitare di utilizzare congiuntamente operazioni basate sul flusso e operazioni non basate sul flusso nello stesso contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-223">For this reason, avoid mixing stream-based and non-streamed operations in the same contract.</span></span> <span data-ttu-id="037b7-224">Se è assolutamente necessario utilizzare entrambi i modelli di programmazione contemporaneamente, osservare le precauzioni seguenti:</span><span class="sxs-lookup"><span data-stu-id="037b7-224">If you absolutely must mix the two programming models, use the following precautions:</span></span>

- <span data-ttu-id="037b7-225">Disattivare la funzione <xref:System.Runtime.Serialization.IExtensibleDataObject> impostando la proprietà <xref:System.ServiceModel.ServiceBehaviorAttribute.IgnoreExtensionDataObject%2A> di <xref:System.ServiceModel.ServiceBehaviorAttribute> su `true`.</span><span class="sxs-lookup"><span data-stu-id="037b7-225">Turn off the <xref:System.Runtime.Serialization.IExtensibleDataObject> feature by setting the <xref:System.ServiceModel.ServiceBehaviorAttribute.IgnoreExtensionDataObject%2A> property of the <xref:System.ServiceModel.ServiceBehaviorAttribute> to `true`.</span></span> <span data-ttu-id="037b7-226">Così facendo si ha la certezza che vengano deserializzati solo i membri che fanno parte del contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-226">This ensures that only members that are a part of the contract are deserialized.</span></span>

- <span data-ttu-id="037b7-227">Impostare la proprietà <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> di <xref:System.Runtime.Serialization.DataContractSerializer> su un valore sicuro.</span><span class="sxs-lookup"><span data-stu-id="037b7-227">Set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> property of the <xref:System.Runtime.Serialization.DataContractSerializer> to a safe value.</span></span> <span data-ttu-id="037b7-228">Questa quota è disponibile anche per l'attributo <xref:System.ServiceModel.ServiceBehaviorAttribute> o tramite la configurazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-228">This quota is also available on the <xref:System.ServiceModel.ServiceBehaviorAttribute> attribute or through configuration.</span></span> <span data-ttu-id="037b7-229">Limita il numero di oggetti che vengono deserializzati in un episodio di deserializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-229">This quota limits the number of objects that are deserialized in one deserialization episode.</span></span> <span data-ttu-id="037b7-230">Normalmente ogni parametro dell'operazione o parte del corpo del messaggio in un contratto di messaggio viene deserializzato in un episodio.</span><span class="sxs-lookup"><span data-stu-id="037b7-230">Normally, each operation parameter or message body part in a message contract is deserialized in one episode.</span></span> <span data-ttu-id="037b7-231">In caso di deserializzazione di matrici, ogni voce della matrice viene considerata come un oggetto separato.</span><span class="sxs-lookup"><span data-stu-id="037b7-231">When deserializing arrays, each array entry is counted as a separate object.</span></span>

- <span data-ttu-id="037b7-232">Impostare tutte le quote di lettore XML su valori sicuri.</span><span class="sxs-lookup"><span data-stu-id="037b7-232">Set all of the XML reader quotas to safe values.</span></span> <span data-ttu-id="037b7-233">Prestare attenzione a <xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A>, <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>e <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A> ed evitare stringhe in operazioni non basate sul flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-233">Pay attention to <xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A>, <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, and <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A> and avoid strings in non-streaming operations.</span></span>

- <span data-ttu-id="037b7-234">Rivedere l'elenco dei tipi noti, ricordando che è possibile creare in ogni momento istanze di un tipo qualsiasi (vedere la sezione "Come impedire il caricamento di tipi non previsti" più avanti in questo argomento).</span><span class="sxs-lookup"><span data-stu-id="037b7-234">Review the list of known types, keeping in mind that any one of them can be instantiated at any time (see the "Preventing Unintended Types from Being Loaded" section later in this topic).</span></span>

- <span data-ttu-id="037b7-235">Non utilizzare tipi che implementano l'interfaccia <xref:System.Xml.Serialization.IXmlSerializable> e memorizzano molti dati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="037b7-235">Do not use any types that implement the <xref:System.Xml.Serialization.IXmlSerializable> interface that buffer a lot of data.</span></span> <span data-ttu-id="037b7-236">Non aggiungere tali tipi all'elenco dei tipi noti.</span><span class="sxs-lookup"><span data-stu-id="037b7-236">Do not add such types to the list of known types.</span></span>

- <span data-ttu-id="037b7-237">Non utilizzare matrici <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> , <xref:System.Byte> o tipi che implementano l'interfaccia <xref:System.Runtime.Serialization.ISerializable> in un contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-237">Do not use the <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> arrays, <xref:System.Byte> arrays, or types that implement <xref:System.Runtime.Serialization.ISerializable> in a contract.</span></span>

- <span data-ttu-id="037b7-238">Non utilizzare matrici <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> , <xref:System.Byte> o tipi che implementano l'interfaccia <xref:System.Runtime.Serialization.ISerializable> nell'elenco dei tipi noti.</span><span class="sxs-lookup"><span data-stu-id="037b7-238">Do not use the <xref:System.Xml.XmlElement>, <xref:System.Xml.XmlNode> arrays, <xref:System.Byte> arrays, or types that implement <xref:System.Runtime.Serialization.ISerializable> in the list of known types.</span></span>

<span data-ttu-id="037b7-239">Le precauzioni riportate in precedenza si applicano quando l'operazione non basata sul flusso utilizza <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="037b7-239">The preceding precautions apply when the non-streamed operation uses the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="037b7-240">Non utilizzare mai congiuntamente modelli di programmazione basati e non basati sul flusso nello stesso servizio se si utilizza la classe <xref:System.Xml.Serialization.XmlSerializer>, perché non si avvale della protezione data dalla quota <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.MaxItemsInObjectGraph%2A> .</span><span class="sxs-lookup"><span data-stu-id="037b7-240">Never mix streaming and non-streaming programming models on the same service if you are using the <xref:System.Xml.Serialization.XmlSerializer>, because it does not have the protection of the <xref:System.ServiceModel.Description.DataContractSerializerOperationBehavior.MaxItemsInObjectGraph%2A> quota.</span></span>

### <a name="slow-stream-attacks"></a><span data-ttu-id="037b7-241">Attacchi che rallentano il flusso</span><span class="sxs-lookup"><span data-stu-id="037b7-241">Slow Stream Attacks</span></span>

<span data-ttu-id="037b7-242">Una categoria di attacchi Denial of Service basati sul flusso non comporta l'utilizzo di memoria,</span><span class="sxs-lookup"><span data-stu-id="037b7-242">A class of streaming denial-of-service attacks does not involve memory consumption.</span></span> <span data-ttu-id="037b7-243">bensì un rallentamento del mittente o del destinatario dei dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-243">Instead, the attack involves a slow sender or receiver of data.</span></span> <span data-ttu-id="037b7-244">In attesa dell'invio o della ricezione dei dati si esauriscono risorse quali thread e connessioni disponibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-244">While waiting for the data to be sent or received, resources such as threads and available connections are exhausted.</span></span> <span data-ttu-id="037b7-245">Questa situazione può verificarsi in seguito a un attacco dannoso o per effetto di un mittente/destinatario legittimo su una connessione di rete lenta.</span><span class="sxs-lookup"><span data-stu-id="037b7-245">This situation could arise either as a result of a malicious attack or from a legitimate sender/receiver on a slow network connection.</span></span>

<span data-ttu-id="037b7-246">Per mitigare questi attacchi, impostare correttamente i timeout di trasporto.</span><span class="sxs-lookup"><span data-stu-id="037b7-246">To mitigate these attacks, set the transport time-outs correctly.</span></span> <span data-ttu-id="037b7-247">Per ulteriori informazioni, vedere [quote di trasporto](transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-247">For more information, see [Transport Quotas](transport-quotas.md).</span></span> <span data-ttu-id="037b7-248">In secondo luogo, non utilizzare mai `Read` operazioni o sincrone quando si utilizzano i `Write` flussi in WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-248">Secondly, never use synchronous `Read` or `Write` operations when working with streams in WCF.</span></span>

## <a name="using-xml-safely"></a><span data-ttu-id="037b7-249">Utilizzo sicuro di XML</span><span class="sxs-lookup"><span data-stu-id="037b7-249">Using XML Safely</span></span>

> [!NOTE]
> <span data-ttu-id="037b7-250">Sebbene questa sezione riguardi XML, le informazioni si riferiscono anche ai documenti JavaScript Object Notation (JSON).</span><span class="sxs-lookup"><span data-stu-id="037b7-250">Although this section is about XML, the information also applies to JavaScript Object Notation (JSON) documents.</span></span> <span data-ttu-id="037b7-251">Le quote funzionano in modo simile, usando [Mapping Between JSON and XML](mapping-between-json-and-xml.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-251">The quotas work similarly, using [Mapping Between JSON and XML](mapping-between-json-and-xml.md).</span></span>

### <a name="secure-xml-readers"></a><span data-ttu-id="037b7-252">Lettori XML sicuri</span><span class="sxs-lookup"><span data-stu-id="037b7-252">Secure XML Readers</span></span>

<span data-ttu-id="037b7-253">L'infoset XML costituisce la base di tutte le operazioni di elaborazione dei messaggi in WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-253">The XML Infoset forms the basis of all message processing in WCF.</span></span> <span data-ttu-id="037b7-254">Quando si accettano dati XML da un'origine non attendibile, esistono varie possibilità di attacco di tipo Denial of Service (DoS) da contrastare.</span><span class="sxs-lookup"><span data-stu-id="037b7-254">When accepting XML data from an untrusted source, a number of denial-of-service attack possibilities exist that must be mitigated.</span></span> <span data-ttu-id="037b7-255">WCF fornisce lettori XML speciali e sicuri.</span><span class="sxs-lookup"><span data-stu-id="037b7-255">WCF provides special, secure XML readers.</span></span> <span data-ttu-id="037b7-256">Questi lettori vengono creati automaticamente quando si utilizza una delle codifiche standard in WCF (text, Binary o MTOM).</span><span class="sxs-lookup"><span data-stu-id="037b7-256">These readers are created automatically when using one of the standard encodings in WCF (text, binary, or MTOM).</span></span>

<span data-ttu-id="037b7-257">Alcune delle funzionalità di sicurezza per questi lettori sono sempre attive.</span><span class="sxs-lookup"><span data-stu-id="037b7-257">Some of the security features on these readers are always active.</span></span> <span data-ttu-id="037b7-258">Ad esempio, i lettori non elaborano mai definizioni del tipo di documento (DTD) che sono un'origine potenziale di attacchi Denial of Service e non devono essere mai presenti nei messaggi SOAP legittimi.</span><span class="sxs-lookup"><span data-stu-id="037b7-258">For example, the readers never process document type definitions (DTDs), which are a potential source of denial-of-service attacks and should never appear in legitimate SOAP messages.</span></span> <span data-ttu-id="037b7-259">Fra le altre funzionalità di sicurezza sono incluse quote di lettore da configurare, descritte nella sezione seguente.</span><span class="sxs-lookup"><span data-stu-id="037b7-259">Other security features include reader quotas that must be configured, which are described in the following section.</span></span>

<span data-ttu-id="037b7-260">Quando si lavora direttamente con i lettori XML, ad esempio quando si scrive un codificatore personalizzato o quando si utilizza direttamente la <xref:System.ServiceModel.Channels.Message> classe, utilizzare sempre i lettori protetti WCF quando esiste la possibilità di lavorare con dati non attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-260">When working directly with XML readers (such as when writing your own custom encoder or when working directly with the <xref:System.ServiceModel.Channels.Message> class), always use the WCF secure readers when there is a chance of working with untrusted data.</span></span> <span data-ttu-id="037b7-261">Creare i lettori sicuri chiamando uno degli overload del metodo factory statici di <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>o <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> per la classe <xref:System.Xml.XmlDictionaryReader> .</span><span class="sxs-lookup"><span data-stu-id="037b7-261">Create the secure readers by calling one of the static factory method overloads of <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, or <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> on the <xref:System.Xml.XmlDictionaryReader> class.</span></span> <span data-ttu-id="037b7-262">Quando si crea un lettore, passare valori di quota sicuri.</span><span class="sxs-lookup"><span data-stu-id="037b7-262">When creating a reader, pass in secure quota values.</span></span> <span data-ttu-id="037b7-263">Non chiamare gli overload del metodo `Create` .</span><span class="sxs-lookup"><span data-stu-id="037b7-263">Do not call the `Create` method overloads.</span></span> <span data-ttu-id="037b7-264">Non creano un reader WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-264">These do not create a WCF reader.</span></span> <span data-ttu-id="037b7-265">Al contrario, viene creato un lettore non protetto dalle funzionalità descritte in questa sezione.</span><span class="sxs-lookup"><span data-stu-id="037b7-265">Instead, a reader is created that is not protected by the security features described in this section.</span></span>

### <a name="reader-quotas"></a><span data-ttu-id="037b7-266">Quote di lettore</span><span class="sxs-lookup"><span data-stu-id="037b7-266">Reader Quotas</span></span>

<span data-ttu-id="037b7-267">I lettori XML sicuri dispongono di cinque quote configurabili.</span><span class="sxs-lookup"><span data-stu-id="037b7-267">The secure XML readers have five configurable quotas.</span></span> <span data-ttu-id="037b7-268">Di norma vengono configurate utilizzando la proprietà `ReaderQuotas` negli elementi di associazione della codifica o nelle associazioni standard oppure utilizzando un oggetto <xref:System.Xml.XmlDictionaryReaderQuotas> passato quando si crea un lettore.</span><span class="sxs-lookup"><span data-stu-id="037b7-268">These are normally configured using the `ReaderQuotas` property on the encoding binding elements or standard bindings, or by using an <xref:System.Xml.XmlDictionaryReaderQuotas> object passed when creating a reader.</span></span>

#### <a name="maxbytesperread"></a><span data-ttu-id="037b7-269">MaxBytesPerRead</span><span class="sxs-lookup"><span data-stu-id="037b7-269">MaxBytesPerRead</span></span>

<span data-ttu-id="037b7-270">Questa quota limita il numero di byte letti in una sola operazione `Read` durante la lettura del tag iniziale dell'elemento e dei relativi attributi.</span><span class="sxs-lookup"><span data-stu-id="037b7-270">This quota limits the number of bytes that are read in a single `Read` operation when reading the element start tag and its attributes.</span></span> <span data-ttu-id="037b7-271">Nei casi in cui non viene usato il flusso, il nome dell'elemento stesso non viene conteggiato ai fini della quota. <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> è importante per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="037b7-271">(In non-streamed cases, the element name itself is not counted against the quota.) <xref:System.Xml.XmlDictionaryReaderQuotas.MaxBytesPerRead%2A> is important for the following reasons:</span></span>

- <span data-ttu-id="037b7-272">Il nome dell'elemento e i relativi attributi vengono sempre memorizzati nel buffer quando vengono letti,</span><span class="sxs-lookup"><span data-stu-id="037b7-272">The element name and its attributes are always buffered in memory when they are being read.</span></span> <span data-ttu-id="037b7-273">pertanto è importante impostare correttamente questa quota in modalità di flusso per impedire la memorizzazione di un'eccessiva quantità di dati nel buffer quando è previsto il flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-273">Therefore, it is important to set this quota correctly in streaming mode to prevent excessive buffering when streaming is expected.</span></span> <span data-ttu-id="037b7-274">Vedere la sezione quota `MaxDepth` per informazioni sulla quantità effettiva di dati che vengono memorizzati nel buffer.</span><span class="sxs-lookup"><span data-stu-id="037b7-274">See the `MaxDepth` quota section for information about the actual amount of buffering that takes place.</span></span>

- <span data-ttu-id="037b7-275">La presenza di troppi attributi XML può causare un prolungamento eccessivo dei tempi di elaborazione perché è necessario controllare che i nomi degli attributi siano univoci.</span><span class="sxs-lookup"><span data-stu-id="037b7-275">Having too many XML attributes may use up disproportionate processing time because attribute names have to be checked for uniqueness.</span></span> <span data-ttu-id="037b7-276">Utilizzando la proprietà`MaxBytesPerRead` la minaccia viene mitigata.</span><span class="sxs-lookup"><span data-stu-id="037b7-276">`MaxBytesPerRead` mitigates this threat.</span></span>

#### <a name="maxdepth"></a><span data-ttu-id="037b7-277">MaxDepth</span><span class="sxs-lookup"><span data-stu-id="037b7-277">MaxDepth</span></span>

<span data-ttu-id="037b7-278">Questa quota limita la profondità massima di annidamento degli elementi XML.</span><span class="sxs-lookup"><span data-stu-id="037b7-278">This quota limits the maximum nesting depth of XML elements.</span></span> <span data-ttu-id="037b7-279">Il documento "", ad esempio, \<A> \<B> \<C/> \</B> \</A> ha una profondità di annidamento di tre.</span><span class="sxs-lookup"><span data-stu-id="037b7-279">For example, the document "\<A>\<B>\<C/>\</B>\</A>" has a nesting depth of three.</span></span> <span data-ttu-id="037b7-280"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> è importante per i motivi seguenti:</span><span class="sxs-lookup"><span data-stu-id="037b7-280"><xref:System.Xml.XmlDictionaryReaderQuotas.MaxDepth%2A> is important for the following reasons:</span></span>

- <span data-ttu-id="037b7-281">`MaxDepth` interagisce con `MaxBytesPerRead`: il lettore mantiene sempre i dati in memoria per l'elemento corrente e tutti i suoi predecessori, pertanto l'utilizzo massimo di memoria da parte del lettore è proporzionale al prodotto di queste due impostazioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-281">`MaxDepth` interacts with `MaxBytesPerRead`: the reader always keeps data in memory for the current element and all of its ancestors, so the maximum memory consumption of the reader is proportional to the product of these two settings.</span></span>

- <span data-ttu-id="037b7-282">Quando un oggetto grafico profondamente annidato viene deserializzato, il deserializzatore deve utilizzare l'intero stack e generare un'eccezione <xref:System.StackOverflowException>irreversibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-282">When deserializing a deeply-nested object graph, the deserializer is forced to access the entire stack and throw an unrecoverable <xref:System.StackOverflowException>.</span></span> <span data-ttu-id="037b7-283">Esiste una correlazione diretta tra l'annidamento XML e l'annidamento di oggetti sia per la classe <xref:System.Runtime.Serialization.DataContractSerializer> sia per la classe <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="037b7-283">A direct correlation exists between XML nesting and object nesting for both the <xref:System.Runtime.Serialization.DataContractSerializer> and the <xref:System.Xml.Serialization.XmlSerializer>.</span></span> <span data-ttu-id="037b7-284">Utilizzare `MaxDepth` per mitigare questa minaccia.</span><span class="sxs-lookup"><span data-stu-id="037b7-284">Use `MaxDepth` to mitigate this threat.</span></span>

#### <a name="maxnametablecharcount"></a><span data-ttu-id="037b7-285">MaxNameTableCharCount</span><span class="sxs-lookup"><span data-stu-id="037b7-285">MaxNameTableCharCount</span></span>

<span data-ttu-id="037b7-286">Questa quota limita la dimensione della tabella *NameTable*del lettore.</span><span class="sxs-lookup"><span data-stu-id="037b7-286">This quota limits the size of the reader’s *nametable*.</span></span> <span data-ttu-id="037b7-287">La tabella NameTable contiene alcune stringhe (ad esempio spazi dei nomi e prefissi) incontrate durante l'elaborazione di un documento XML.</span><span class="sxs-lookup"><span data-stu-id="037b7-287">The nametable contains certain strings (such as namespaces and prefixes) that are encountered when processing an XML document.</span></span> <span data-ttu-id="037b7-288">Poiché tali stringhe vengono memorizzate nel buffer, impostare questa quota per impedire la memorizzazione di un'eccessiva quantità di dati nel buffer quando si prevede un flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-288">As these strings are buffered in memory, set this quota to prevent excessive buffering when streaming is expected.</span></span>

#### <a name="maxstringcontentlength"></a><span data-ttu-id="037b7-289">MaxStringContentLength</span><span class="sxs-lookup"><span data-stu-id="037b7-289">MaxStringContentLength</span></span>

<span data-ttu-id="037b7-290">Questa quota limita la dimensione massima della stringa restituita dal lettore XML</span><span class="sxs-lookup"><span data-stu-id="037b7-290">This quota limits the maximum string size that the XML reader returns.</span></span> <span data-ttu-id="037b7-291">e non l'utilizzo di memoria nel lettore XML stesso, bensì nel componente che utilizza il lettore.</span><span class="sxs-lookup"><span data-stu-id="037b7-291">This quota does not limit memory consumption in the XML reader itself, but in the component that is using the reader.</span></span> <span data-ttu-id="037b7-292">Ad esempio, quando la classe <xref:System.Runtime.Serialization.DataContractSerializer> utilizza un lettore protetto con <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, non deserializza stringhe che superano questa quota.</span><span class="sxs-lookup"><span data-stu-id="037b7-292">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>, it does not deserialize strings larger than this quota.</span></span> <span data-ttu-id="037b7-293">Quando si utilizza direttamente la classe <xref:System.Xml.XmlDictionaryReader> , la quota non viene rispettata da tutti i metodi, ma solo da quelli specificamente progettati per leggere stringhe, ad esempio il metodo <xref:System.Xml.XmlDictionaryReader.ReadContentAsString%2A> .</span><span class="sxs-lookup"><span data-stu-id="037b7-293">When using the <xref:System.Xml.XmlDictionaryReader> class directly, not all methods respect this quota, but only the methods that are specifically designed to read strings, such as the <xref:System.Xml.XmlDictionaryReader.ReadContentAsString%2A> method.</span></span> <span data-ttu-id="037b7-294">La quota non influisce sulla proprietà <xref:System.Xml.XmlReader.Value%2A> nel lettore e pertanto non deve essere utilizzata quando la protezione che questa fornisce è strettamente necessaria.</span><span class="sxs-lookup"><span data-stu-id="037b7-294">The <xref:System.Xml.XmlReader.Value%2A> property on the reader is not affected by this quota, and thus should not be used when the protection this quota provides is necessary.</span></span>

#### <a name="maxarraylength"></a><span data-ttu-id="037b7-295">MaxArrayLength</span><span class="sxs-lookup"><span data-stu-id="037b7-295">MaxArrayLength</span></span>

<span data-ttu-id="037b7-296">Questa quota limita la dimensione massima di una matrice di primitive che viene restituita dal lettore XML, incluse matrici di byte.</span><span class="sxs-lookup"><span data-stu-id="037b7-296">This quota limits the maximum size of an array of primitives that the XML reader returns, including byte arrays.</span></span> <span data-ttu-id="037b7-297">La quota non limita l'utilizzo di memoria nel lettore XML stesso, bensì in un qualsiasi componente che utilizza il lettore.</span><span class="sxs-lookup"><span data-stu-id="037b7-297">This quota does not limit memory consumption in the XML reader itself, but in whatever component that is using the reader.</span></span> <span data-ttu-id="037b7-298">Ad esempio, quando la classe <xref:System.Runtime.Serialization.DataContractSerializer> utilizza un lettore protetto con <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>, non deserializza matrici di byte che superano questa quota.</span><span class="sxs-lookup"><span data-stu-id="037b7-298">For example, when the <xref:System.Runtime.Serialization.DataContractSerializer> uses a reader secured with <xref:System.Xml.XmlDictionaryReaderQuotas.MaxArrayLength%2A>, it does not deserialize byte arrays larger than this quota.</span></span> <span data-ttu-id="037b7-299">È importante impostarla quando si tenta di utilizzare contemporaneamente modelli di programmazione basati sul flusso e sulla memorizzazione nel buffer nello stesso contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-299">It is important to set this quota when attempting to mix streaming and buffered programming models in a single contract.</span></span> <span data-ttu-id="037b7-300">Si tenga presente che, utilizzando direttamente la classe <xref:System.Xml.XmlDictionaryReader> , la quota viene rispettata solo dai metodi specificamente progettati per leggere matrici di dimensioni arbitrarie di alcuni tipi di primitive, ad esempio <xref:System.Xml.XmlDictionaryReader.ReadInt32Array%2A>.</span><span class="sxs-lookup"><span data-stu-id="037b7-300">Keep in mind that when using the <xref:System.Xml.XmlDictionaryReader> class directly, only the methods that are specifically designed to read arrays of arbitrary size of certain primitive types, such as <xref:System.Xml.XmlDictionaryReader.ReadInt32Array%2A>, respect this quota.</span></span>

## <a name="threats-specific-to-the-binary-encoding"></a><span data-ttu-id="037b7-301">Minacce specifiche della codifica binaria</span><span class="sxs-lookup"><span data-stu-id="037b7-301">Threats Specific to the Binary Encoding</span></span>

<span data-ttu-id="037b7-302">La codifica XML binaria supportata da WCF include una funzionalità per le *stringhe di dizionario* .</span><span class="sxs-lookup"><span data-stu-id="037b7-302">The binary XML encoding WCF supports includes a *dictionary strings* feature.</span></span> <span data-ttu-id="037b7-303">È possibile codificare una stringa di grandi dimensioni utilizzando solo pochi byte,</span><span class="sxs-lookup"><span data-stu-id="037b7-303">A large string may be encoded using only a few bytes.</span></span> <span data-ttu-id="037b7-304">con vantaggi significativi a livello di prestazioni, ma così facendo vengono introdotte nuove minacce Denial of Service che devono essere mitigate.</span><span class="sxs-lookup"><span data-stu-id="037b7-304">This enables significant performance gains, but introduces new denial-of-service threats that must be mitigated.</span></span>

<span data-ttu-id="037b7-305">Sono disponibili due tipi di dizionari: *statico* e *dinamico*.</span><span class="sxs-lookup"><span data-stu-id="037b7-305">There are two kinds of dictionaries: *static* and *dynamic*.</span></span> <span data-ttu-id="037b7-306">Il dizionario statico è un elenco incorporato di stringhe lunghe che possono essere rappresentate utilizzando un codice breve nella codifica binaria.</span><span class="sxs-lookup"><span data-stu-id="037b7-306">The static dictionary is a built-in list of long strings that may be represented using a short code in the binary encoding.</span></span> <span data-ttu-id="037b7-307">L'elenco di stringhe viene consolidato al momento della creazione del lettore e non può essere modificato.</span><span class="sxs-lookup"><span data-stu-id="037b7-307">This list of strings is fixed when the reader is created and cannot be modified.</span></span> <span data-ttu-id="037b7-308">Per impostazione predefinita, nessuna delle stringhe del dizionario statico utilizzato da WCF è sufficientemente grande per rappresentare una grave minaccia di tipo Denial of Service, sebbene sia comunque possibile utilizzarla in un attacco di espansione del dizionario.</span><span class="sxs-lookup"><span data-stu-id="037b7-308">None of the strings in the static dictionary that WCF uses by default are sufficiently large to pose a serious denial-of-service threat, although they may still be used in a dictionary expansion attack.</span></span> <span data-ttu-id="037b7-309">In scenari avanzati in cui si fornisce un proprio dizionario statico, prestare attenzione nell'inserire grandi stringhe.</span><span class="sxs-lookup"><span data-stu-id="037b7-309">In advanced scenarios where you supply your own static dictionary, be careful when introducing large dictionary strings.</span></span>

<span data-ttu-id="037b7-310">La funzionalità dinamica dei dizionari consente ai messaggi di definire stringhe proprie e di associarle a codici brevi.</span><span class="sxs-lookup"><span data-stu-id="037b7-310">The dynamic dictionaries feature allows messages to define their own strings and associate them with short codes.</span></span> <span data-ttu-id="037b7-311">Questi mapping da stringa a codice sono mantenuti in memoria durante l'intera sessione di comunicazione, in modo che i messaggi successivi non debbano inviare nuovamente le stringhe e possano utilizzare i codici già definiti.</span><span class="sxs-lookup"><span data-stu-id="037b7-311">These string-to-code mappings are kept in memory during the entire communication session, such that subsequent messages do not have to resend the strings and can utilize codes that are already defined.</span></span> <span data-ttu-id="037b7-312">Queste stringhe possono essere di lunghezza arbitraria e quindi costituire una minaccia più grave di quelle contenute nel dizionario statico.</span><span class="sxs-lookup"><span data-stu-id="037b7-312">These strings may be of arbitrary length and thus pose a more serious threat than those in the static dictionary.</span></span>

<span data-ttu-id="037b7-313">La prima minaccia che deve essere mitigata è la possibilità che il dizionario dinamico (tabella di mapping da stringa a codice) assuma dimensioni troppo grandi.</span><span class="sxs-lookup"><span data-stu-id="037b7-313">The first threat that must be mitigated is the possibility of the dynamic dictionary (the string-to-code mapping table) becoming too large.</span></span> <span data-ttu-id="037b7-314">Il dizionario può espandersi nel corso di molti messaggi, per cui la quota `MaxReceivedMessageSize` non offre protezione perché si applica separatamente a ogni singolo messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-314">This dictionary may be expanded over the course of several messages, and so the `MaxReceivedMessageSize` quota offers no protection because it applies only to each message separately.</span></span> <span data-ttu-id="037b7-315">È pertanto disponibile una proprietà distinta, <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> per l'elemento <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement> che limita la dimensione del dizionario.</span><span class="sxs-lookup"><span data-stu-id="037b7-315">Therefore, a separate <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> property exists on the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement> that limits the size of the dictionary.</span></span>

<span data-ttu-id="037b7-316">A differenza di altre quote, questa si applica anche alla scrittura dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="037b7-316">Unlike most other quotas, this quota also applies when writing messages.</span></span> <span data-ttu-id="037b7-317">Se viene superata durante la lettura di un messaggio, come al solito viene generata l'eccezione `QuotaExceededException` .</span><span class="sxs-lookup"><span data-stu-id="037b7-317">If it is exceeded when reading a message, the `QuotaExceededException` is thrown as usual.</span></span> <span data-ttu-id="037b7-318">Se viene superata durante la scrittura di un messaggio, le stringhe che causano il superamento della quota vengono scritte così come sono, senza utilizzare la funzionalità dinamica dei dizionari.</span><span class="sxs-lookup"><span data-stu-id="037b7-318">If it is exceeded when writing a message, any strings that cause the quota to be exceeded are written as-is, without using the dynamic dictionaries feature.</span></span>

### <a name="dictionary-expansion-threats"></a><span data-ttu-id="037b7-319">Minacce di espansione del dizionario</span><span class="sxs-lookup"><span data-stu-id="037b7-319">Dictionary Expansion Threats</span></span>

<span data-ttu-id="037b7-320">Una categoria significativa di attacchi specifici del codice binario riguarda l'espansione del dizionario.</span><span class="sxs-lookup"><span data-stu-id="037b7-320">A significant class of binary-specific attacks arises from dictionary expansion.</span></span> <span data-ttu-id="037b7-321">Un piccolo messaggio in formato binario può trasformarsi in un messaggio di dimensioni molto grandi quando viene espanso completamente in forma testuale se si avvale diffusamente della funzionalità dei dizionari di stringhe.</span><span class="sxs-lookup"><span data-stu-id="037b7-321">A small message in binary form may turn into a very large message in fully expanded textual form if it makes extensive use of the string dictionaries feature.</span></span> <span data-ttu-id="037b7-322">Il fattore di espansione per le stringhe del dizionario dinamiche è limitato dalla quota <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> , perché nessuna stringa di dizionario dinamica supera la dimensione massima del dizionario intero.</span><span class="sxs-lookup"><span data-stu-id="037b7-322">The expansion factor for dynamic dictionary strings is limited by the <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A> quota, because no dynamic dictionary string exceeds the maximum size of the entire dictionary.</span></span>

<span data-ttu-id="037b7-323">Le proprietà <xref:System.Xml.XmlDictionaryReaderQuotas.MaxNameTableCharCount%2A>, `MaxStringContentLength`, e `MaxArrayLength` limitano esclusivamente l'utilizzo della memoria.</span><span class="sxs-lookup"><span data-stu-id="037b7-323">The <xref:System.Xml.XmlDictionaryReaderQuotas.MaxNameTableCharCount%2A>, `MaxStringContentLength`, and `MaxArrayLength` properties only limit memory consumption.</span></span> <span data-ttu-id="037b7-324">Di solito non sono necessarie per mitigare eventuali minacce in scenari non basati sul flusso in quanto l'utilizzo della memoria è già limitato da `MaxReceivedMessageSize`.</span><span class="sxs-lookup"><span data-stu-id="037b7-324">They are normally not required to mitigate any threats in the non-streamed usage because memory usage is already limited by `MaxReceivedMessageSize`.</span></span> <span data-ttu-id="037b7-325">`MaxReceivedMessageSize` tuttavia conteggia i byte prima dell'espansione.</span><span class="sxs-lookup"><span data-stu-id="037b7-325">However, `MaxReceivedMessageSize` counts pre-expansion bytes.</span></span> <span data-ttu-id="037b7-326">Quando viene utilizzata la codifica binaria, l'utilizzo della memoria potrebbe superare la quota `MaxReceivedMessageSize`, essendo limitato solo da un fattore di <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A>.</span><span class="sxs-lookup"><span data-stu-id="037b7-326">When binary encoding is in use, memory consumption could potentially go beyond `MaxReceivedMessageSize`, limited only by a factor of <xref:System.ServiceModel.Channels.BinaryMessageEncodingBindingElement.MaxSessionSize%2A>.</span></span> <span data-ttu-id="037b7-327">Per questa ragione, è importante impostare sempre tutte le quote del lettore (specialmente <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>) quando si utilizza la codifica binaria.</span><span class="sxs-lookup"><span data-stu-id="037b7-327">For this reason, it is important to always set all of the reader quotas (especially <xref:System.Xml.XmlDictionaryReaderQuotas.MaxStringContentLength%2A>) when using the binary encoding.</span></span>

<span data-ttu-id="037b7-328">Se la codifica binaria viene utilizzata con <xref:System.Runtime.Serialization.DataContractSerializer>, è possibile abusare dell'interfaccia `IExtensibleDataObject` per sferrare un attacco di espansione del dizionario.</span><span class="sxs-lookup"><span data-stu-id="037b7-328">When using binary encoding together with the <xref:System.Runtime.Serialization.DataContractSerializer>, the `IExtensibleDataObject` interface can be misused to mount a dictionary expansion attack.</span></span> <span data-ttu-id="037b7-329">Questa interfaccia essenzialmente fornisce un'archiviazione illimitata per i dati arbitrari che non fanno parte del contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-329">This interface essentially provides unlimited storage for arbitrary data that is not a part of the contract.</span></span> <span data-ttu-id="037b7-330">Se non è possibile impostare quote sufficientemente basse perché `MaxSessionSize` moltiplicato per `MaxReceivedMessageSize` non crei problemi, disattivare la funzione `IExtensibleDataObject` se si utilizza la codifica binaria.</span><span class="sxs-lookup"><span data-stu-id="037b7-330">If quotas cannot be set low enough such that `MaxSessionSize` multiplied by `MaxReceivedMessageSize` does not pose a problem, disable the `IExtensibleDataObject` feature when using the binary encoding.</span></span> <span data-ttu-id="037b7-331">Impostare la proprietà `IgnoreExtensionDataObject` su `true` nell'attributo `ServiceBehaviorAttribute` .</span><span class="sxs-lookup"><span data-stu-id="037b7-331">Set the `IgnoreExtensionDataObject` property to `true` on the `ServiceBehaviorAttribute` attribute.</span></span> <span data-ttu-id="037b7-332">In alternativa, non implementare l'interfaccia `IExtensibleDataObject` .</span><span class="sxs-lookup"><span data-stu-id="037b7-332">Alternatively, do not implement the `IExtensibleDataObject` interface.</span></span> <span data-ttu-id="037b7-333">Per altre informazioni, vedere [Contratti di dati compatibili con versioni successive](forward-compatible-data-contracts.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-333">For more information, see [Forward-Compatible Data Contracts](forward-compatible-data-contracts.md).</span></span>

### <a name="quotas-summary"></a><span data-ttu-id="037b7-334">Riepilogo delle quote</span><span class="sxs-lookup"><span data-stu-id="037b7-334">Quotas Summary</span></span>

<span data-ttu-id="037b7-335">La tabella seguente contiene un riepilogo delle linee guida per le quote.</span><span class="sxs-lookup"><span data-stu-id="037b7-335">The following table summarizes the guidance about quotas.</span></span>

|<span data-ttu-id="037b7-336">Condizione</span><span class="sxs-lookup"><span data-stu-id="037b7-336">Condition</span></span>|<span data-ttu-id="037b7-337">Quote importanti da impostare</span><span class="sxs-lookup"><span data-stu-id="037b7-337">Important quotas to set</span></span>|
|---------------|-----------------------------|
|<span data-ttu-id="037b7-338">Niente flusso o flusso di messaggi di piccole dimensioni, testo o codifica MTOM</span><span class="sxs-lookup"><span data-stu-id="037b7-338">No streaming or streaming small messages, text, or MTOM encoding</span></span>|<span data-ttu-id="037b7-339">`MaxReceivedMessageSize`, `MaxBytesPerRead` e `MaxDepth`</span><span class="sxs-lookup"><span data-stu-id="037b7-339">`MaxReceivedMessageSize`, `MaxBytesPerRead`, and `MaxDepth`</span></span>|
|<span data-ttu-id="037b7-340">Niente flusso o flusso di messaggi di piccole dimensioni, codifica binaria</span><span class="sxs-lookup"><span data-stu-id="037b7-340">No streaming or streaming small messages, binary encoding</span></span>|<span data-ttu-id="037b7-341">`MaxReceivedMessageSize`, `MaxSessionSize`e tutte le `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="037b7-341">`MaxReceivedMessageSize`, `MaxSessionSize`, and all `ReaderQuotas`</span></span>|
|<span data-ttu-id="037b7-342">Flusso di messaggi di grandi dimensioni, testo o codifica MTOM</span><span class="sxs-lookup"><span data-stu-id="037b7-342">Streaming large messages, text, or MTOM encoding</span></span>|<span data-ttu-id="037b7-343">`MaxBufferSize` e tutte le `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="037b7-343">`MaxBufferSize` and all `ReaderQuotas`</span></span>|
|<span data-ttu-id="037b7-344">Flusso di messaggi di grandi dimensioni, codifica binaria</span><span class="sxs-lookup"><span data-stu-id="037b7-344">Streaming large messages, binary encoding</span></span>|<span data-ttu-id="037b7-345">`MaxBufferSize`, `MaxSessionSize`e tutte le `ReaderQuotas`</span><span class="sxs-lookup"><span data-stu-id="037b7-345">`MaxBufferSize`, `MaxSessionSize`, and all `ReaderQuotas`</span></span>|

- <span data-ttu-id="037b7-346">I timeout a livello di trasporto devono sempre essere impostati e non utilizzare mai letture/scritture sincrone quando si utilizza il flusso, indipendentemente dalle dimensioni dei messaggi.</span><span class="sxs-lookup"><span data-stu-id="037b7-346">Transport-level time-outs must always be set and never use synchronous reads/writes when streaming is in use, regardless of whether you are streaming large or small messages.</span></span>

- <span data-ttu-id="037b7-347">Quando si è incerti su una quota, impostarla su un valore sicuro anziché lasciarla aperta.</span><span class="sxs-lookup"><span data-stu-id="037b7-347">When in doubt about a quota, set it to a safe value rather than leaving it open.</span></span>

## <a name="preventing-malicious-code-execution"></a><span data-ttu-id="037b7-348">Prevenzione dell'esecuzione di codice dannoso</span><span class="sxs-lookup"><span data-stu-id="037b7-348">Preventing Malicious Code Execution</span></span>

<span data-ttu-id="037b7-349">Le seguenti categorie generali di minacce possono eseguire codice e avere effetti imprevisti:</span><span class="sxs-lookup"><span data-stu-id="037b7-349">The following general classes of threats can execute code and have unintended effects:</span></span>

- <span data-ttu-id="037b7-350">Il deserializzatore carica un tipo dannoso, non sicuro o dipendente dalla protezione.</span><span class="sxs-lookup"><span data-stu-id="037b7-350">The deserializer loads a malicious, unsafe, or security-sensitive type.</span></span>

- <span data-ttu-id="037b7-351">Un messaggio in arrivo fa in modo che il deserializzatore costruisca un'istanza di un tipo normalmente sicuro in modo da produrre conseguenze impreviste.</span><span class="sxs-lookup"><span data-stu-id="037b7-351">An incoming message causes the deserializer to construct an instance of a normally safe type in such a way that it has unintended consequences.</span></span>

<span data-ttu-id="037b7-352">Nelle sezioni seguenti vengono ulteriormente descritte queste categorie di minacce.</span><span class="sxs-lookup"><span data-stu-id="037b7-352">The following sections discuss these classes of threats further.</span></span>

## <a name="datacontractserializer"></a><span data-ttu-id="037b7-353">DataContractSerializer</span><span class="sxs-lookup"><span data-stu-id="037b7-353">DataContractSerializer</span></span>

<span data-ttu-id="037b7-354">Per informazioni sulla sicurezza in <xref:System.Xml.Serialization.XmlSerializer> , vedere la documentazione pertinente. Il modello di sicurezza per <xref:System.Xml.Serialization.XmlSerializer> è simile a quello di <xref:System.Runtime.Serialization.DataContractSerializer> e si differenzia principalmente per i dettagli.</span><span class="sxs-lookup"><span data-stu-id="037b7-354">(For security information on the <xref:System.Xml.Serialization.XmlSerializer>, see the relevant documentation.) The security model for the <xref:System.Xml.Serialization.XmlSerializer> is similar to that of the <xref:System.Runtime.Serialization.DataContractSerializer>, and differs mostly in details.</span></span> <span data-ttu-id="037b7-355">L'attributo <xref:System.Xml.Serialization.XmlIncludeAttribute> , ad esempio, viene utilizzato per l'inclusione del tipo in luogo dell'attributo <xref:System.Runtime.Serialization.KnownTypeAttribute> .</span><span class="sxs-lookup"><span data-stu-id="037b7-355">For example, the <xref:System.Xml.Serialization.XmlIncludeAttribute> attribute is used for type inclusion instead of the <xref:System.Runtime.Serialization.KnownTypeAttribute> attribute.</span></span> <span data-ttu-id="037b7-356">Alcune minacce univoche della classe <xref:System.Xml.Serialization.XmlSerializer> verranno tuttavia discusse più avanti in questo argomento.</span><span class="sxs-lookup"><span data-stu-id="037b7-356">However, some threats unique to the <xref:System.Xml.Serialization.XmlSerializer> are discussed later in this topic.</span></span>

### <a name="preventing-unintended-types-from-being-loaded"></a><span data-ttu-id="037b7-357">Prevenzione del caricamento di tipi imprevisti</span><span class="sxs-lookup"><span data-stu-id="037b7-357">Preventing Unintended Types from Being Loaded</span></span>

<span data-ttu-id="037b7-358">Il caricamento di tipi imprevisti può avere conseguenze significative, sia che il tipo sia dannoso sia che abbia solo effetti secondari dipendenti dalla protezione.</span><span class="sxs-lookup"><span data-stu-id="037b7-358">Loading unintended types may have significant consequences, whether the type is malicious or just has security-sensitive side effects.</span></span> <span data-ttu-id="037b7-359">Un tipo può contenere vulnerabilità di sicurezza sfruttabili, eseguire azioni dipendenti dalla protezione nel relativo costruttore o costruttore della classe, disporre di un footprint di memoria di grandi dimensioni che facilita gli attacchi Denial of Service o generare eccezioni irreversibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-359">A type may contain exploitable security vulnerability, perform security-sensitive actions in its constructor or class constructor, have a large memory footprint that facilitates denial-of-service attacks, or may throw non-recoverable exceptions.</span></span> <span data-ttu-id="037b7-360">I tipi possono disporre di costruttori della classe che vengono eseguiti appena viene caricato il tipo e prima che vengano create istanze.</span><span class="sxs-lookup"><span data-stu-id="037b7-360">Types may have class constructors that run as soon as the type is loaded and before any instances are created.</span></span> <span data-ttu-id="037b7-361">Per queste ragioni, è importante controllare il set dei tipi caricabili dal deserializzatore.</span><span class="sxs-lookup"><span data-stu-id="037b7-361">For these reasons, it is important to control the set of types that the deserializer may load.</span></span>

<span data-ttu-id="037b7-362">La classe <xref:System.Runtime.Serialization.DataContractSerializer> esegue la deserializzazione in una modalità ad accoppiamento debole (loose coupling).</span><span class="sxs-lookup"><span data-stu-id="037b7-362">The <xref:System.Runtime.Serialization.DataContractSerializer> deserializes in a loosely coupled way.</span></span> <span data-ttu-id="037b7-363">Non legge mai il tipo e i nomi degli assembly CLR (Common Language Runtime) dai dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-363">It never reads common language runtime (CLR) type and assembly names from the incoming data.</span></span> <span data-ttu-id="037b7-364">Il relativo funzionamento è simile al comportamento delle a classe <xref:System.Xml.Serialization.XmlSerializer>, ma differisce da quello di <xref:System.Runtime.Serialization.NetDataContractSerializer>, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>e di <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span><span class="sxs-lookup"><span data-stu-id="037b7-364">This is similar to the behavior of the <xref:System.Xml.Serialization.XmlSerializer>, but differs from the behavior of the <xref:System.Runtime.Serialization.NetDataContractSerializer>, <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter>, and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span></span> <span data-ttu-id="037b7-365">L'accoppiamento debole introduce un certo grado di sicurezza, in quanto l'autore dell'attacco remoto non è in grado di indicare un tipo arbitrario da caricare semplicemente denominandolo nel messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-365">Loose coupling introduces a degree of safety, because the remote attacker cannot indicate an arbitrary type to load just by naming that type in the message.</span></span>

<span data-ttu-id="037b7-366"><xref:System.Runtime.Serialization.DataContractSerializer> può sempre caricare un tipo attualmente previsto in base al contratto.</span><span class="sxs-lookup"><span data-stu-id="037b7-366">The <xref:System.Runtime.Serialization.DataContractSerializer> is always allowed to load a type that is currently expected according to the contract.</span></span> <span data-ttu-id="037b7-367">Ad esempio, se un contratto dati dispone di un membro dati di tipo `Customer`, <xref:System.Runtime.Serialization.DataContractSerializer> è autorizzato a caricare il tipo `Customer` quando deserializza tale membro dati.</span><span class="sxs-lookup"><span data-stu-id="037b7-367">For example, if a data contract has a data member of type `Customer`, the <xref:System.Runtime.Serialization.DataContractSerializer> is allowed to load the `Customer` type when it deserializes this data member.</span></span>

<span data-ttu-id="037b7-368"><xref:System.Runtime.Serialization.DataContractSerializer> inoltre supporta il polimorfismo.</span><span class="sxs-lookup"><span data-stu-id="037b7-368">Additionally, the <xref:System.Runtime.Serialization.DataContractSerializer> supports polymorphism.</span></span> <span data-ttu-id="037b7-369">Un membro dati può essere dichiarato come <xref:System.Object>, ma i dati in arrivo possono contenere un'istanza `Customer` .</span><span class="sxs-lookup"><span data-stu-id="037b7-369">A data member may be declared as <xref:System.Object>, but the incoming data may contain a `Customer` instance.</span></span> <span data-ttu-id="037b7-370">Ciò è possibile solo se il tipo `Customer` è stato reso "noto" al deserializzatore tramite uno di questi meccanismi:</span><span class="sxs-lookup"><span data-stu-id="037b7-370">This is possible only if the `Customer` type has been made "known" to the deserializer through one of these mechanisms:</span></span>

- <span data-ttu-id="037b7-371">Attributo<xref:System.Runtime.Serialization.KnownTypeAttribute> applicato a un tipo.</span><span class="sxs-lookup"><span data-stu-id="037b7-371"><xref:System.Runtime.Serialization.KnownTypeAttribute> attribute applied to a type.</span></span>

- <span data-ttu-id="037b7-372">Attributo`KnownTypeAttribute` che specifica un metodo che restituisce un elenco di tipi.</span><span class="sxs-lookup"><span data-stu-id="037b7-372">`KnownTypeAttribute` attribute specifying a method that returns a list of types.</span></span>

- <span data-ttu-id="037b7-373">Attributo`ServiceKnownTypeAttribute` .</span><span class="sxs-lookup"><span data-stu-id="037b7-373">`ServiceKnownTypeAttribute` attribute.</span></span>

- <span data-ttu-id="037b7-374">Sezione di configurazione `KnownTypes` .</span><span class="sxs-lookup"><span data-stu-id="037b7-374">The `KnownTypes` configuration section.</span></span>

- <span data-ttu-id="037b7-375">Un elenco di tipi noti passato in modo esplicito a <xref:System.Runtime.Serialization.DataContractSerializer> durante la costruzione, se il serializzatore viene utilizzato direttamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-375">A list of known types explicitly passed to the <xref:System.Runtime.Serialization.DataContractSerializer> during construction, if using the serializer directly.</span></span>

<span data-ttu-id="037b7-376">Ognuno di questi meccanismi aumenta la superficie di attacco introducendo più tipi di quanti non ne possa caricare il serializzatore.</span><span class="sxs-lookup"><span data-stu-id="037b7-376">Each of these mechanisms increases the surface area by introducing more types that the deserializer can load.</span></span> <span data-ttu-id="037b7-377">Controllare tutti questi meccanismi per assicurarsi che non vengano aggiunti tipi dannosi o imprevisti all'elenco dei tipi noti.</span><span class="sxs-lookup"><span data-stu-id="037b7-377">Control each of these mechanisms to ensure no malicious or unintended types are added to the known types list.</span></span>

<span data-ttu-id="037b7-378">Una volta che un tipo noto è nell'ambito, può essere caricato in qualsiasi momento e potranno esserne create istanze anche se di fatto il contratto impedisce di utilizzarlo.</span><span class="sxs-lookup"><span data-stu-id="037b7-378">Once a known type is in scope, it can be loaded at any time, and instances of the type can be created, even if the contract forbids actually using it.</span></span> <span data-ttu-id="037b7-379">Si supponga, ad esempio, che il tipo "MyDangerousType" venga aggiunto all'elenco dei tipi noti utilizzando uno dei meccanismi sopra descritti.</span><span class="sxs-lookup"><span data-stu-id="037b7-379">For example, suppose the type "MyDangerousType" is added to the known types list using one of the mechanisms above.</span></span> <span data-ttu-id="037b7-380">Ciò significa che:</span><span class="sxs-lookup"><span data-stu-id="037b7-380">This means that:</span></span>

- <span data-ttu-id="037b7-381">`MyDangerousType` viene caricato e viene eseguito il relativo costruttore di classe.</span><span class="sxs-lookup"><span data-stu-id="037b7-381">`MyDangerousType` is loaded and its class constructor runs.</span></span>

- <span data-ttu-id="037b7-382">Anche in caso di deserializzazione di un contratto dati con un membro dati in formato di stringa, un messaggio dannoso può indurre la creazione di un'istanza di `MyDangerousType` .</span><span class="sxs-lookup"><span data-stu-id="037b7-382">Even when deserializing a data contract with a string data member, a malicious message may still cause an instance of `MyDangerousType` to create.</span></span> <span data-ttu-id="037b7-383">Può essere eseguito codice contenuto in `MyDangerousType`, ad esempio codice per i metodi Setter sulla proprietà.</span><span class="sxs-lookup"><span data-stu-id="037b7-383">Code in `MyDangerousType`, such as property setters, may run.</span></span> <span data-ttu-id="037b7-384">Successivamente il deserializzatore tenta di assegnare questa istanza al membro dati in formato di stringa e non verrà completato correttamente generando un'eccezione.</span><span class="sxs-lookup"><span data-stu-id="037b7-384">After this is done, the deserializer tries to assign this instance to the string data member and fail with an exception.</span></span>

<span data-ttu-id="037b7-385">Quando si scrive un metodo che restituisce un elenco di tipi noti o si passa direttamente un elenco al costruttore <xref:System.Runtime.Serialization.DataContractSerializer> , assicurarsi che il codice preposto alla creazione dell'elenco sia sicuro e agisca solo su dati attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-385">When writing a method that returns a list of known types, or when passing a list directly to the <xref:System.Runtime.Serialization.DataContractSerializer> constructor, ensure that the code that prepares the list is secure and operates only on trusted data.</span></span>

<span data-ttu-id="037b7-386">Se in questa configurazione si specificano tipi noti, assicurarsi che il file di configurazione sia sicuro.</span><span class="sxs-lookup"><span data-stu-id="037b7-386">If specifying known types in configuration, ensure that the configuration file is secure.</span></span> <span data-ttu-id="037b7-387">Utilizzare sempre nomi sicuri nella configurazione, specificando la chiave pubblica dell'assembly firmato dove risiede il tipo, senza specificare la versione del tipo da caricare.</span><span class="sxs-lookup"><span data-stu-id="037b7-387">Always use strong names in configuration (by specifying the public key of the signed assembly where the type resides), but do not specify the version of the type to load.</span></span> <span data-ttu-id="037b7-388">Il caricatore del tipo sceglie automaticamente la versione più recente, se possibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-388">The type loader automatically picks the latest version, if possible.</span></span> <span data-ttu-id="037b7-389">Se si specifica una particolare versione nella configurazione si corre il rischio seguente: in un tipo può essere contenuta una vulnerabilità di sicurezza che verrà corretta in una versione futura, ma la versione con la vulnerabilità continua a essere caricata perché specificata in modo esplicito nella configurazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-389">If you specify a particular version in configuration, you run the following risk: A type may have a security vulnerability that may be fixed in a future version, but the vulnerable version still loads because it is explicitly specified in configuration.</span></span>

<span data-ttu-id="037b7-390">La presenza di troppi tipi noti produce un'altra conseguenza: <xref:System.Runtime.Serialization.DataContractSerializer> crea una cache del codice di serializzazione/deserializzazione nel dominio dell'applicazione, con una voce per ogni tipo da serializzare e deserializzare.</span><span class="sxs-lookup"><span data-stu-id="037b7-390">Having too many known types has another consequence: The <xref:System.Runtime.Serialization.DataContractSerializer> creates a cache of serialization/deserialization code in the application domain, with an entry for each type it must serialize and deserialize.</span></span> <span data-ttu-id="037b7-391">Il contenuto della cache non viene eliminato finché è in esecuzione il dominio dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-391">This cache is never cleared as long as the application domain is running.</span></span> <span data-ttu-id="037b7-392">Un pirata informatico consapevole del fatto che un'applicazione utilizza molti tipi noti può causare la deserializzazione di tutti questi tipi, facendo in modo che la cache utilizzi una quantità di memoria estremamente grande.</span><span class="sxs-lookup"><span data-stu-id="037b7-392">Therefore, an attacker who is aware that an application uses many known types can cause the deserialization of all these types, causing the cache to consume a disproportionately large amount of memory.</span></span>

### <a name="preventing-types-from-being-in-an-unintended-state"></a><span data-ttu-id="037b7-393">Come impedire che i tipi abbiano uno stato imprevisto</span><span class="sxs-lookup"><span data-stu-id="037b7-393">Preventing Types from Being in an Unintended State</span></span>

<span data-ttu-id="037b7-394">Per un tipo possono sussistere vincoli di coerenza interni da applicare necessariamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-394">A type may have internal consistency constraints that must be enforced.</span></span> <span data-ttu-id="037b7-395">Si deve prestare attenzione per evitare di infrangerli durante la deserializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-395">Care must be taken to avoid breaking these constraints during deserialization.</span></span>

<span data-ttu-id="037b7-396">L'esempio seguente di un tipo rappresenta lo stato di una sacca d'aria su un'astronave e applica il vincolo che le porte interne ed esterne non possano essere aperte contemporaneamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-396">The following example of a type represents the state of an airlock on a spacecraft, and enforces the constraint that both the inner and the outer doors cannot be open at the same time.</span></span>

[!code-csharp[DataContractAttribute#3](../../../../samples/snippets/csharp/VS_Snippets_CFX/datacontractattribute/cs/overview.cs#3)]
[!code-vb[DataContractAttribute#3](../../../../samples/snippets/visualbasic/VS_Snippets_CFX/datacontractattribute/vb/overview.vb#3)]

<span data-ttu-id="037b7-397">Il possibile autore di un attacco potrebbe inviare un messaggio dannoso come questo, aggirando i vincoli e portando l'oggetto in uno stato non valido che può avere conseguenze impreviste e imprevedibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-397">An attacker may send a malicious message like this, getting around the constraints and getting the object into an invalid state, which may have unintended and unpredictable consequences.</span></span>

```xml
<SpaceStationAirlock>
    <innerDoorOpen>true</innerDoorOpen>
    <outerDoorOpen>true</outerDoorOpen>
</SpaceStationAirlock>
```

<span data-ttu-id="037b7-398">È possibile evitare questa situazione essendo a conoscenza dei punti seguenti:</span><span class="sxs-lookup"><span data-stu-id="037b7-398">This situation can be avoided by being aware of the following points:</span></span>

- <span data-ttu-id="037b7-399">Quando <xref:System.Runtime.Serialization.DataContractSerializer> deserializza gran parte delle classi, i costruttori non sono in esecuzione.</span><span class="sxs-lookup"><span data-stu-id="037b7-399">When the <xref:System.Runtime.Serialization.DataContractSerializer> deserializes most classes, constructors do not run.</span></span> <span data-ttu-id="037b7-400">Non basarsi pertanto su una gestione dello stato eseguita nel costruttore.</span><span class="sxs-lookup"><span data-stu-id="037b7-400">Therefore, do not rely on any state management done in the constructor.</span></span>

- <span data-ttu-id="037b7-401">Utilizzare richiamate per assicurare che l'oggetto sia in uno stato valido.</span><span class="sxs-lookup"><span data-stu-id="037b7-401">Use callbacks to ensure that the object is in a valid state.</span></span> <span data-ttu-id="037b7-402">La richiamata contrassegnata con l'attributo <xref:System.Runtime.Serialization.OnDeserializedAttribute> è particolarmente utile in quanto viene eseguita dopo che la deserializzazione è stata completata e ha quindi la possibilità di esaminare e correggere lo stato complessivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-402">The callback marked with the <xref:System.Runtime.Serialization.OnDeserializedAttribute> attribute is especially useful because it runs after deserialization is complete and has a chance to examine and correct the overall state.</span></span> <span data-ttu-id="037b7-403">Per altre informazioni, vedere [callback di serializzazione a tolleranza di versione](version-tolerant-serialization-callbacks.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-403">For more information, see [Version-Tolerant Serialization Callbacks](version-tolerant-serialization-callbacks.md).</span></span>

- <span data-ttu-id="037b7-404">Non progettare tipi di contratto dati che si affidano a un ordine particolare per la chiamata dei metodi Setter sulla proprietà.</span><span class="sxs-lookup"><span data-stu-id="037b7-404">Do not design data contract types to rely on any particular order in which property setters must be called.</span></span>

- <span data-ttu-id="037b7-405">Fare attenzione quando si utilizzano tipi legacy contrassegnati con l'attributo <xref:System.SerializableAttribute> .</span><span class="sxs-lookup"><span data-stu-id="037b7-405">Take care using legacy types marked with the <xref:System.SerializableAttribute> attribute.</span></span> <span data-ttu-id="037b7-406">Molti di essi sono stati progettati per funzionare con .NET Framework Remoting per l'uso solo con dati attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-406">Many of them were designed to work with .NET Framework remoting for use with trusted data only.</span></span> <span data-ttu-id="037b7-407">I tipi esistenti contrassegnati con questo attributo possono non essere stati progettati tenendo presente la sicurezza dello stato.</span><span class="sxs-lookup"><span data-stu-id="037b7-407">Existing types marked with this attribute may not have been designed with state safety in mind.</span></span>

- <span data-ttu-id="037b7-408">Non affidarsi alla proprietà <xref:System.Runtime.Serialization.DataMemberAttribute.IsRequired%2A> dell'attributo <xref:System.Runtime.Serialization.DataMemberAttribute> per garantire la presenza di dati per quanto riguarda la sicurezza dello stato.</span><span class="sxs-lookup"><span data-stu-id="037b7-408">Do not rely on the <xref:System.Runtime.Serialization.DataMemberAttribute.IsRequired%2A> property of the <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to guarantee presence of data as far as state safety is concerned.</span></span> <span data-ttu-id="037b7-409">I dati potrebbero sempre essere `null`, `zero`o `invalid`.</span><span class="sxs-lookup"><span data-stu-id="037b7-409">Data could always be `null`, `zero`, or `invalid`.</span></span>

- <span data-ttu-id="037b7-410">Non considerare mai attendibile un oggetto grafico deserializzato da un'origine dati non attendibile senza prima convalidarlo.</span><span class="sxs-lookup"><span data-stu-id="037b7-410">Never trust an object graph deserialized from an untrusted data source without validating it first.</span></span> <span data-ttu-id="037b7-411">Ogni singolo oggetto può essere in uno stato coerente, ma l'oggetto grafico nell'insieme potrebbe non esserlo,</span><span class="sxs-lookup"><span data-stu-id="037b7-411">Each individual object may be in a consistent state, but the object graph as a whole may not be.</span></span> <span data-ttu-id="037b7-412">inoltre, anche se la modalità di mantenimento è disattivata, se l'oggetto grafico viene deserializzato può contenere più riferimenti allo stesso oggetto o riferimenti circolari.</span><span class="sxs-lookup"><span data-stu-id="037b7-412">Furthermore, even if the object graph preservation mode is disabled, the deserialized graph may have multiple references to the same object or have circular references.</span></span> <span data-ttu-id="037b7-413">Per ulteriori informazioni, vedere [serializzazione e deserializzazione](serialization-and-deserialization.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-413">For more information, see [Serialization and Deserialization](serialization-and-deserialization.md).</span></span>

### <a name="using-the-netdatacontractserializer-securely"></a><span data-ttu-id="037b7-414">Utilizzo sicuro di NetDataContractSerializer</span><span class="sxs-lookup"><span data-stu-id="037b7-414">Using the NetDataContractSerializer Securely</span></span>

<span data-ttu-id="037b7-415"><xref:System.Runtime.Serialization.NetDataContractSerializer> è un motore di serializzazione che utilizza l'accoppiamento stretto ai tipi.</span><span class="sxs-lookup"><span data-stu-id="037b7-415">The <xref:System.Runtime.Serialization.NetDataContractSerializer> is a serialization engine that uses tight coupling to types.</span></span> <span data-ttu-id="037b7-416">È simile a <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> e a <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span><span class="sxs-lookup"><span data-stu-id="037b7-416">This is similar to the <xref:System.Runtime.Serialization.Formatters.Binary.BinaryFormatter> and the <xref:System.Runtime.Serialization.Formatters.Soap.SoapFormatter>.</span></span> <span data-ttu-id="037b7-417">Ovvero determina il tipo di cui creare un'istanza leggendo l'assembly .NET Framework e il nome del tipo dai dati in arrivo.</span><span class="sxs-lookup"><span data-stu-id="037b7-417">That is, it determines which type to instantiate by reading the .NET Framework assembly and type name from the incoming data.</span></span> <span data-ttu-id="037b7-418">Sebbene faccia parte di WCF, non esiste alcun modo di collegare in questo motore di serializzazione. è necessario scrivere codice personalizzato.</span><span class="sxs-lookup"><span data-stu-id="037b7-418">Although it is a part of WCF, there is no supplied way of plugging in this serialization engine; custom code must be written.</span></span> <span data-ttu-id="037b7-419">Il `NetDataContractSerializer` viene fornito principalmente per semplificare la migrazione da .NET Framework comunicazione remota a WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-419">The `NetDataContractSerializer` is provided primarily to ease migration from .NET Framework remoting to WCF.</span></span> <span data-ttu-id="037b7-420">Per ulteriori informazioni, vedere la sezione pertinente in [serializzazione e deserializzazione](serialization-and-deserialization.md).</span><span class="sxs-lookup"><span data-stu-id="037b7-420">For more information, see the relevant section in [Serialization and Deserialization](serialization-and-deserialization.md).</span></span>

<span data-ttu-id="037b7-421">Poiché il messaggio stesso può indicare che è possibile caricare qualsiasi tipo, il meccanismo <xref:System.Runtime.Serialization.NetDataContractSerializer> non è protetto intrinsecamente e deve essere utilizzato solo con dati attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-421">Because the message itself may indicate any type can be loaded, the <xref:System.Runtime.Serialization.NetDataContractSerializer> mechanism is inherently insecure and should be used only with trusted data.</span></span> <span data-ttu-id="037b7-422">Per ulteriori informazioni, vedere la [Guida alla sicurezza di BinaryFormatter](/dotnet/standard/serialization/binaryformatter-security-guide).</span><span class="sxs-lookup"><span data-stu-id="037b7-422">For more information, see the [BinaryFormatter security guide](/dotnet/standard/serialization/binaryformatter-security-guide).</span></span>

<span data-ttu-id="037b7-423">Anche se si utilizzano dati attendibili, i dati in arrivo possono non contenere una definizione sufficiente del tipo da caricare, specialmente se la proprietà <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> è impostata su <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle.Simple>.</span><span class="sxs-lookup"><span data-stu-id="037b7-423">Even when used with trusted data, the incoming data may insufficiently specify the type to load, especially if the <xref:System.Runtime.Serialization.NetDataContractSerializer.AssemblyFormat%2A> property is set to <xref:System.Runtime.Serialization.Formatters.FormatterAssemblyStyle.Simple>.</span></span> <span data-ttu-id="037b7-424">Chiunque abbia accesso alla directory dell'applicazione o alla Global Assembly Cache può sostituire con un tipo dannoso il tipo che si prevede di caricare.</span><span class="sxs-lookup"><span data-stu-id="037b7-424">Anyone with access to the application’s directory or to the global assembly cache can substitute a malicious type in place of the one that is supposed to load.</span></span> <span data-ttu-id="037b7-425">Garantire sempre la protezione della directory dell'applicazione e della Global Assembly Cache impostando correttamente le autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-425">Always ensure the security of your application’s directory and of the global assembly cache by correctly setting permissions.</span></span>

<span data-ttu-id="037b7-426">In generale, se si consente a codice parzialmente attendibile di accedere all'istanza `NetDataContractSerializer` o in caso contrario controllare il selettore di surrogati (<xref:System.Runtime.Serialization.ISurrogateSelector>) o il gestore di associazione della serializzazione (<xref:System.Runtime.Serialization.SerializationBinder>), il codice può controllare completamente il processo di serializzazione/deserializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-426">In general, if you allow partially trusted code access to your `NetDataContractSerializer` instance or otherwise control the surrogate selector (<xref:System.Runtime.Serialization.ISurrogateSelector>) or the serialization binder (<xref:System.Runtime.Serialization.SerializationBinder>), the code may exercise a great deal of control over the serialization/deserialization process.</span></span> <span data-ttu-id="037b7-427">Ad esempio, può inserire tipi arbitrari, portare alla diffusione di informazioni, manomettere  l'oggetto grafico risultante o i dati serializzati, oppure provocare l'overflow del conseguente flusso serializzato.</span><span class="sxs-lookup"><span data-stu-id="037b7-427">For example, it may inject arbitrary types, lead to information disclosure, tamper with the resulting object graph or serialized data, or overflow the resultant serialized stream.</span></span>

<span data-ttu-id="037b7-428">Un altro problema di sicurezza relativo a `NetDataContractSerializer` riguarda una possibile minaccia Denial of Service, non l'esecuzione di codice dannoso.</span><span class="sxs-lookup"><span data-stu-id="037b7-428">Another security concern with the `NetDataContractSerializer` is a denial of service, not a malicious code execution threat.</span></span> <span data-ttu-id="037b7-429">Quando si utilizza `NetDataContractSerializer`, impostare sempre la quota <xref:System.Runtime.Serialization.NetDataContractSerializer.MaxItemsInObjectGraph%2A> su un valore sicuro.</span><span class="sxs-lookup"><span data-stu-id="037b7-429">When using the `NetDataContractSerializer`, always set the <xref:System.Runtime.Serialization.NetDataContractSerializer.MaxItemsInObjectGraph%2A> quota to a safe value.</span></span> <span data-ttu-id="037b7-430">È semplice costruire un piccolo messaggio dannoso che alloca una matrice di oggetti la cui dimensione è limitata solo da questa quota.</span><span class="sxs-lookup"><span data-stu-id="037b7-430">It is easy to construct a small malicious message that allocates an array of objects whose size is limited only by this quota.</span></span>

### <a name="xmlserializer-specific-threats"></a><span data-ttu-id="037b7-431">Minacce specifiche di XmlSerializer</span><span class="sxs-lookup"><span data-stu-id="037b7-431">XmlSerializer-Specific Threats</span></span>

<span data-ttu-id="037b7-432">Il modello di sicurezza di <xref:System.Xml.Serialization.XmlSerializer> è simile a quello di <xref:System.Runtime.Serialization.DataContractSerializer>.</span><span class="sxs-lookup"><span data-stu-id="037b7-432">The <xref:System.Xml.Serialization.XmlSerializer> security model is similar to that of the <xref:System.Runtime.Serialization.DataContractSerializer>.</span></span> <span data-ttu-id="037b7-433">Alcune minacce sono tuttavia specifiche di <xref:System.Xml.Serialization.XmlSerializer>.</span><span class="sxs-lookup"><span data-stu-id="037b7-433">A few threats, however, are unique to the <xref:System.Xml.Serialization.XmlSerializer>.</span></span>

<span data-ttu-id="037b7-434"><xref:System.Xml.Serialization.XmlSerializer> in fase di esecuzione genera *assembly di serializzazione* contenenti codice che di fatto esegue la serializzazione e la deserializzazione; tali assembly vengono creati in una directory di file temporanei.</span><span class="sxs-lookup"><span data-stu-id="037b7-434">The <xref:System.Xml.Serialization.XmlSerializer> generates *serialization assemblies* at runtime that contain code that actually serializes and deserializes; these assemblies are created in a temporary files directory.</span></span> <span data-ttu-id="037b7-435">Se un altro processo o utente dispone delle autorizzazioni di accesso a tale directory, potrà sovrascrivere il codice di serializzazione/deserializzazione con codice arbitrario.</span><span class="sxs-lookup"><span data-stu-id="037b7-435">If some other process or user has access rights to that directory, they may overwrite the serialization/deserialization code with arbitrary code.</span></span> <span data-ttu-id="037b7-436"><xref:System.Xml.Serialization.XmlSerializer> esegue quindi questo codice utilizzando il relativo contesto di sicurezza anziché il codice di serializzazione/deserializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-436">The <xref:System.Xml.Serialization.XmlSerializer> then runs this code using its security context, instead of the serialization/deserialization code.</span></span> <span data-ttu-id="037b7-437">Verificare che le autorizzazioni siano impostate correttamente nella directory di file temporanei per impedire che ciò si verifichi.</span><span class="sxs-lookup"><span data-stu-id="037b7-437">Make sure the permissions are set correctly on the temporary files directory to prevent this from happening.</span></span>

<span data-ttu-id="037b7-438"><xref:System.Xml.Serialization.XmlSerializer> dispone inoltre di una modalità nella quale utilizza assembly di serializzazione generati in precedenza anziché generarli in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="037b7-438">The <xref:System.Xml.Serialization.XmlSerializer> also has a mode in which it uses pre-generated serialization assemblies instead of generating them at runtime.</span></span> <span data-ttu-id="037b7-439">Questa modalità si attiva ogni volta che <xref:System.Xml.Serialization.XmlSerializer> trova un assembly di serializzazione adatto.</span><span class="sxs-lookup"><span data-stu-id="037b7-439">This mode is triggered whenever the <xref:System.Xml.Serialization.XmlSerializer> can find a suitable serialization assembly.</span></span> <span data-ttu-id="037b7-440"><xref:System.Xml.Serialization.XmlSerializer> controlla se l'assembly di serializzazione è firmato dalla stessa chiave utilizzata per firmare l'assembly che contiene i tipi serializzati.</span><span class="sxs-lookup"><span data-stu-id="037b7-440">The <xref:System.Xml.Serialization.XmlSerializer> checks whether or not the serialization assembly was signed by the same key that was used to sign the assembly that contains the types being serialized.</span></span> <span data-ttu-id="037b7-441">Si ottiene in tal modo la protezione da assembly dannosi mistificati come assembly di serializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-441">This offers protection from malicious assemblies being disguised as serialization assemblies.</span></span> <span data-ttu-id="037b7-442">Se l'assembly che contiene i tipi serializzabili non è tuttavia firmato, <xref:System.Xml.Serialization.XmlSerializer> non può eseguire questo controllo e utilizza qualsiasi assembly con il nome corretto.</span><span class="sxs-lookup"><span data-stu-id="037b7-442">However, if the assembly that contains your serializable types is not signed, the <xref:System.Xml.Serialization.XmlSerializer> cannot perform this check and uses any assembly with the correct name.</span></span> <span data-ttu-id="037b7-443">Ciò rende possibile l'esecuzione di codice dannoso.</span><span class="sxs-lookup"><span data-stu-id="037b7-443">This makes running malicious code possible.</span></span> <span data-ttu-id="037b7-444">Firmare sempre gli assembly che contengono tipi serializzabili o controllare strettamente l'accesso alla directory dell'applicazione e la Global Assembly Cache per impedire l'introduzione di assembly dannosi.</span><span class="sxs-lookup"><span data-stu-id="037b7-444">Always sign the assemblies that contain your serializable types, or tightly control access to your application’s directory and the global assembly cache to prevent the introduction of malicious assemblies.</span></span>

<span data-ttu-id="037b7-445"><xref:System.Xml.Serialization.XmlSerializer> può essere soggetto ad attacchi Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-445">The <xref:System.Xml.Serialization.XmlSerializer> can be subject to a denial of service attack.</span></span> <span data-ttu-id="037b7-446">La classe <xref:System.Xml.Serialization.XmlSerializer> non dispone di una quota `MaxItemsInObjectGraph` (come avviene invece per <xref:System.Runtime.Serialization.DataContractSerializer>).</span><span class="sxs-lookup"><span data-stu-id="037b7-446">The <xref:System.Xml.Serialization.XmlSerializer> does not have a `MaxItemsInObjectGraph` quota (as is available on the <xref:System.Runtime.Serialization.DataContractSerializer>).</span></span> <span data-ttu-id="037b7-447">Deserializza quindi un quantità arbitraria di oggetti, con la sola limitazione della dimensione del messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-447">Thus, it deserializes an arbitrary amount of objects, limited only by the message size.</span></span>

### <a name="partial-trust-threats"></a><span data-ttu-id="037b7-448">Minacce legate all'attendibilità parziale</span><span class="sxs-lookup"><span data-stu-id="037b7-448">Partial Trust Threats</span></span>

<span data-ttu-id="037b7-449">Notare i seguenti problemi riguardanti minacce correlate a codice in esecuzione con attendibilità parziale.</span><span class="sxs-lookup"><span data-stu-id="037b7-449">Note the following concerns regarding threats related to code running with partial trust.</span></span> <span data-ttu-id="037b7-450">Queste minacce includono codice parzialmente attendibile dannoso da solo e in combinazione con gli altri scenari di attacco, ad esempio, codice parzialmente attendibile che costruisce una stringa specifica e quindi la deserializza.</span><span class="sxs-lookup"><span data-stu-id="037b7-450">These threats include malicious partially-trusted code as well as malicious partially-trusted code in combination with other attack scenarios (for example, partially-trusted code that constructs a specific string and then deserializing it).</span></span>

- <span data-ttu-id="037b7-451">Quando si utilizzano componenti di serializzazione, non dichiarare mai autorizzazioni prima di tale sintassi, anche se l'intero scenario di serializzazione rientra nell'ambito dell'asserzione e non si trattano dati o oggetti non attendibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-451">When using any serialization components, never assert any permissions before such usage, even if the entire serialization scenario is within the scope of your assert, and you are not dealing with any untrusted data or objects.</span></span> <span data-ttu-id="037b7-452">Questo utilizzo può condurre a problemi di sicurezza.</span><span class="sxs-lookup"><span data-stu-id="037b7-452">Such usage may lead to security vulnerabilities.</span></span>

- <span data-ttu-id="037b7-453">Nei casi in cui un codice parzialmente attendibile prenda il controllo del processo di serializzazione tramite punti di estendibilità (surrogati), tipi serializzati o in altri modi, può fare in modo che il serializzatore restituisca una grande quantità di dati nel flusso serializzato. Ciò potrebbe causare attacchi di tipo Denial of Service (DoS) al destinatario di questo flusso.</span><span class="sxs-lookup"><span data-stu-id="037b7-453">In cases where partially-trusted code has control over the serialization process, either through extensibility points (surrogates), types being serialized, or through other means, the partially-trusted code may cause the serializer to output a large amount of data into the serialized stream, which may cause Denial of Service (DoS) to the receiver of this stream.</span></span> <span data-ttu-id="037b7-454">Se si sta serializzando dati soggetti a minacce DoS, non bisogna serializzare tipi parzialmente attendibili o al contrario permettere che codice parzialmente attendibile controlli il processo di serializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-454">If you are serializing data intended for a target that is sensitive to DoS threats, do not serialize partially-trusted types or otherwise let partially-trusted code control serialization.</span></span>

- <span data-ttu-id="037b7-455">Se si consente l'accesso di codice parzialmente attendibile all' <xref:System.Runtime.Serialization.DataContractSerializer> istanza o in caso contrario controllare i [surrogati del contratto dati](../extending/data-contract-surrogates.md), è possibile che si verifichi un notevole controllo sul processo di serializzazione/deserializzazione.</span><span class="sxs-lookup"><span data-stu-id="037b7-455">If you allow partially-trusted code access to your <xref:System.Runtime.Serialization.DataContractSerializer> instance or otherwise control the [Data Contract Surrogates](../extending/data-contract-surrogates.md), it may exercise a great deal of control over the serialization/deserialization process.</span></span> <span data-ttu-id="037b7-456">Ad esempio, può inserire tipi arbitrari, portare alla diffusione di informazioni, manomettere  l'oggetto grafico risultante o i dati serializzati, oppure provocare l'overflow del conseguente flusso serializzato.</span><span class="sxs-lookup"><span data-stu-id="037b7-456">For example, it may inject arbitrary types, lead to information disclosure, tamper with the resulting object graph or serialized data, or overflow the resultant serialized stream.</span></span> <span data-ttu-id="037b7-457">Una minaccia equivalente <xref:System.Runtime.Serialization.NetDataContractSerializer> viene descritta nella sezione "Utilizzo sicuro di NetDataContractSerializer".</span><span class="sxs-lookup"><span data-stu-id="037b7-457">An equivalent <xref:System.Runtime.Serialization.NetDataContractSerializer> threat is described in the "Using the NetDataContractSerializer Securely" section.</span></span>

- <span data-ttu-id="037b7-458">Se l'attributo <xref:System.Runtime.Serialization.DataContractAttribute> viene applicato a un tipo (o al tipo contrassegnato come <xref:System.SerializableAttribute> ma che non è <xref:System.Runtime.Serialization.ISerializable>) il deserializzatore può creare un'istanza di tale tipo anche se tutti i costruttori non sono pubblici o sono protetti dalle richieste.</span><span class="sxs-lookup"><span data-stu-id="037b7-458">If the <xref:System.Runtime.Serialization.DataContractAttribute> attribute is applied to a type (or the type marked as <xref:System.SerializableAttribute> but is not <xref:System.Runtime.Serialization.ISerializable>), the deserializer can create an instance of such a type even if all constructors are non-public or protected by demands.</span></span>

- <span data-ttu-id="037b7-459">Non fidarsi mai del risultato della deserializzazione, a meno che i dati da deserializzare siano attendibili e si sia certi che tutti i tipi noti risultino essere tipi attendibili .</span><span class="sxs-lookup"><span data-stu-id="037b7-459">Never trust the result of deserialization unless the data to be deserialized is trusted and you are certain that all known types are types that you trust.</span></span> <span data-ttu-id="037b7-460">Si noti che, in caso di esecuzione in condizioni di attendibilità parziale, i tipi noti non vengono caricati dal file di configurazione dell'applicazione, ma vengono caricati dal file di configurazione del computer.</span><span class="sxs-lookup"><span data-stu-id="037b7-460">Note that known types are not loaded from the application configuration file, (but are loaded from the computer configuration file) when running in partial trust.</span></span>

- <span data-ttu-id="037b7-461">Se si passa un'istanza di <xref:System.Runtime.Serialization.DataContractSerializer> con l'aggiunta di un surrogato al codice parzialmente attendibile, il codice può cambiare impostazioni modificabili nel surrogato.</span><span class="sxs-lookup"><span data-stu-id="037b7-461">If you pass a <xref:System.Runtime.Serialization.DataContractSerializer> instance with a surrogate added to partially-trusted code, the code can change any modifiable settings on that surrogate.</span></span>

- <span data-ttu-id="037b7-462">Per un oggetto deserializzato, se il lettore XML (o i dati inclusi) proviene da codice parzialmente attendibile, trattare l'oggetto deserializzato risultante come dati non attendibili,</span><span class="sxs-lookup"><span data-stu-id="037b7-462">For a deserialized object, if the XML reader (or the data therein) comes from partially-trusted code, treat the resulting deserialized object as untrusted data.</span></span>

- <span data-ttu-id="037b7-463">Il fatto che il tipo <xref:System.Runtime.Serialization.ExtensionDataObject> non abbia membri pubblici non significa che i dati al suo interno siano sicuri.</span><span class="sxs-lookup"><span data-stu-id="037b7-463">The fact that the <xref:System.Runtime.Serialization.ExtensionDataObject> type has no public members does not mean that data within it is secure.</span></span> <span data-ttu-id="037b7-464">Se, ad esempio, si esegue la deserializzazione da un'origine dati privilegiata in un oggetto nel quale risiedono dati e quindi si passa tale oggetto a codice parzialmente attendibile, quest'ultimo potrà leggere i dati contenuti in `ExtensionDataObject` serializzando l'oggetto.</span><span class="sxs-lookup"><span data-stu-id="037b7-464">For example, if you deserialize from a privileged data source into an object in which some data resides, then hand that object to partially-trusted code, the partially-trusted code can read the data in the `ExtensionDataObject` by serializing the object.</span></span> <span data-ttu-id="037b7-465">Impostare <xref:System.Runtime.Serialization.DataContractSerializer.IgnoreExtensionDataObject%2A> su `true` quando la deserializzazione viene eseguita da un'origine dati privilegiata in un oggetto che in seguito viene passato a codice parzialmente attendibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-465">Consider setting <xref:System.Runtime.Serialization.DataContractSerializer.IgnoreExtensionDataObject%2A> to `true` when deserializing from a privileged data source into an object that is later passed to partially-trusted code.</span></span>

- <span data-ttu-id="037b7-466"><xref:System.Runtime.Serialization.DataContractSerializer> e <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> supportano la serializzazione di membri privati, protetti, interni e pubblici in condizioni di attendibilità totale.</span><span class="sxs-lookup"><span data-stu-id="037b7-466"><xref:System.Runtime.Serialization.DataContractSerializer> and <xref:System.Runtime.Serialization.Json.DataContractJsonSerializer> support the serialization of private, protected, internal, and public members in full trust.</span></span> <span data-ttu-id="037b7-467">In condizioni di attendibilità parziale, tuttavia, solo i membri pubblici possono essere serializzati.</span><span class="sxs-lookup"><span data-stu-id="037b7-467">However, in partial trust, only public members can be serialized.</span></span> <span data-ttu-id="037b7-468">Se un'applicazione tenta di serializzare un membro non pubblico, viene generata un'eccezione <xref:System.Security.SecurityException> .</span><span class="sxs-lookup"><span data-stu-id="037b7-468">A <xref:System.Security.SecurityException> is thrown if an application attempts to serialize a non-public member.</span></span>

    <span data-ttu-id="037b7-469">Per consentire che i membri interni o protetti possano essere serializzati in condizioni di attendibilità parziale, utilizzare l'attributo dell'assembly <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> .</span><span class="sxs-lookup"><span data-stu-id="037b7-469">To allow internal or protected internal members to be serialized in partial trust, use the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> assembly attribute.</span></span> <span data-ttu-id="037b7-470">Questo attributo consente a un assembly di dichiarare che i propri membri interni sono visibili ad altri assembly.</span><span class="sxs-lookup"><span data-stu-id="037b7-470">This attribute allows an assembly to declare that its internal members are visible to some other assembly.</span></span> <span data-ttu-id="037b7-471">In questo caso, un assembly per cui i membri interni devono essere serializzati dichiara che tali membri sono visibili a System.Runtime.Serialization.dll.</span><span class="sxs-lookup"><span data-stu-id="037b7-471">In this case, an assembly that wants to have its internal members serialized declares that its internal members are visible to System.Runtime.Serialization.dll.</span></span>

    <span data-ttu-id="037b7-472">Il vantaggio di questo approccio è rappresentato dal fatto che non è necessario un percorso di generazione di codice con privilegi elevati.</span><span class="sxs-lookup"><span data-stu-id="037b7-472">The advantage of this approach is that it does not require an elevated code generation path.</span></span>

    <span data-ttu-id="037b7-473">Sono tuttavia presenti due svantaggi principali.</span><span class="sxs-lookup"><span data-stu-id="037b7-473">At the same time, there are two major disadvantages.</span></span>

    <span data-ttu-id="037b7-474">Il primo svantaggio è costituito dal fatto che la proprietà di scelta esplicita dell'attributo <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> è a livello di assembly.</span><span class="sxs-lookup"><span data-stu-id="037b7-474">The first disadvantage is that the opt-in property of the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute is assembly-wide.</span></span> <span data-ttu-id="037b7-475">Questo significa che non è possibile specificare che solo una determinata classe può disporre di membri interni serializzati.</span><span class="sxs-lookup"><span data-stu-id="037b7-475">That is, you cannot specify that only a certain class can have its internal members serialized.</span></span> <span data-ttu-id="037b7-476">Chiaramente, è comunque possibile scegliere di non serializzare un membro interno specifico aggiungendo semplicemente un attributo <xref:System.Runtime.Serialization.DataMemberAttribute> a tale membro.</span><span class="sxs-lookup"><span data-stu-id="037b7-476">Of course, you can still choose not to serialize a specific internal member, by simply not adding a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to that member.</span></span> <span data-ttu-id="037b7-477">In modo analogo, uno sviluppatore può scegliere di rendere interno un membro anziché privato o protetto, con problemi di visibilità non significativi.</span><span class="sxs-lookup"><span data-stu-id="037b7-477">Similarly, a developer can also choose to make a member internal rather than private or protected, with slight visibility concerns.</span></span>

    <span data-ttu-id="037b7-478">Il secondo svantaggio è rappresentato dal fatto che non sono ancora supportati membri privati o protetti.</span><span class="sxs-lookup"><span data-stu-id="037b7-478">The second disadvantage is that it still does not support private or protected members.</span></span>

    <span data-ttu-id="037b7-479">Per illustrare l'utilizzo dell'attributo <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> in condizioni di attendibilità parziale, considerare il programma seguente:</span><span class="sxs-lookup"><span data-stu-id="037b7-479">To illustrate the use of the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute in partial trust, consider the following program:</span></span>

    [!code-csharp[CDF_WCF_SecurityConsiderationsForData#1](../../../../samples/snippets/csharp/VS_Snippets_CFX/cdf_wcf_securityconsiderationsfordata/cs/program.cs#1)]

    <span data-ttu-id="037b7-480">Nell'esempio precedente `PermissionsHelper.InternetZone` corrisponde a <xref:System.Security.PermissionSet> in condizioni di attendibilità parziale.</span><span class="sxs-lookup"><span data-stu-id="037b7-480">In the example above, `PermissionsHelper.InternetZone` corresponds to the <xref:System.Security.PermissionSet> for partial trust.</span></span> <span data-ttu-id="037b7-481">A questo punto, senza l' <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attributo, l'applicazione avrà esito negativo, generando un valore <xref:System.Security.SecurityException> che indica che i membri non pubblici non possono essere serializzati in attendibilità parziale.</span><span class="sxs-lookup"><span data-stu-id="037b7-481">Now, without the <xref:System.Runtime.CompilerServices.InternalsVisibleToAttribute> attribute, the application will fail, throwing a <xref:System.Security.SecurityException> indicating that non-public members cannot be serialized in partial trust.</span></span>

    <span data-ttu-id="037b7-482">Se al file di origine si aggiunge tuttavia la riga seguente, il programma viene eseguito correttamente.</span><span class="sxs-lookup"><span data-stu-id="037b7-482">However, if we add the following line to the source file, the program runs successfully.</span></span>

    [!code-csharp[CDF_WCF_SecurityConsiderationsForData#2](../../../../samples/snippets/csharp/VS_Snippets_CFX/cdf_wcf_securityconsiderationsfordata/cs/program.cs#2)]

## <a name="other-state-management-concerns"></a><span data-ttu-id="037b7-483">Altri problemi di gestione dello stato</span><span class="sxs-lookup"><span data-stu-id="037b7-483">Other State Management Concerns</span></span>

<span data-ttu-id="037b7-484">È utile citare alcuni altri problemi riguardanti la gestione dello stato dell'oggetto:</span><span class="sxs-lookup"><span data-stu-id="037b7-484">A few other concerns regarding object state management are worth mentioning:</span></span>

- <span data-ttu-id="037b7-485">Quando si utilizza il modello di programmazione basato sul flusso con un trasporto di flusso, l'elaborazione del messaggio avviene immediatamente come arriva il messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-485">When using the stream-based programming model with a streaming transport, processing of the message occurs as the message arrives.</span></span> <span data-ttu-id="037b7-486">Il mittente può interrompere l'operazione di invio a metà del flusso, lasciando il codice in uno stato imprevedibile se è atteso altro contenuto.</span><span class="sxs-lookup"><span data-stu-id="037b7-486">The sender of the message may abort the send operation in the middle of the stream, leaving your code in an unpredictable state if more content was expected.</span></span> <span data-ttu-id="037b7-487">In generale è bene non dare per scontato che il flusso sia completo e non intervenire su operazioni basate sul flusso delle quali non è possibile eseguire il rollback nel caso il flusso venga interrotto.</span><span class="sxs-lookup"><span data-stu-id="037b7-487">In general, do not rely on the stream being complete, and do not perform any work in a stream-based operation that cannot be rolled back in case the stream is aborted.</span></span> <span data-ttu-id="037b7-488">Quanto sopra si applica anche nel caso un messaggio sia in formato non valido dopo il corpo nel flusso, ad esempio, se il tag finale della busta SOAP è mancante o se è presente un secondo corpo del messaggio.</span><span class="sxs-lookup"><span data-stu-id="037b7-488">This also applies to the situation where a message may be malformed after the streaming body (for example, it may be missing an end tag for the SOAP envelope or may have a second message body).</span></span>

- <span data-ttu-id="037b7-489">L'utilizzo della funzione `IExtensibleDataObject` può causare l'emissione di dati sensibili.</span><span class="sxs-lookup"><span data-stu-id="037b7-489">Using the `IExtensibleDataObject` feature may cause sensitive data to be emitted.</span></span> <span data-ttu-id="037b7-490">Se si accettano dati da un'origine non attendibile in contratti dati con `IExtensibleObjectData` che in seguito verranno riemessi in un canale sicuro in cui i messaggi sono firmati, potenzialmente si giustificano dati di cui non si hanno informazioni.</span><span class="sxs-lookup"><span data-stu-id="037b7-490">If you are accepting data from an untrusted source into data contracts with `IExtensibleObjectData` and later re-emitting it on a secure channel where messages are signed, you are potentially vouching for data you know nothing about.</span></span> <span data-ttu-id="037b7-491">Lo stato complessivo che si sta inviando potrebbe inoltre non essere valido se si tengono in considerazione sia le parti note sia quelle non note.</span><span class="sxs-lookup"><span data-stu-id="037b7-491">Moreover, the overall state you are sending may be invalid if you take both the known and unknown pieces of data into account.</span></span> <span data-ttu-id="037b7-492">Evitare questa situazione impostando selettivamente la proprietà dei dati di estensione su `null` o disattivando selettivamente la funzionalità `IExtensibleObjectData` .</span><span class="sxs-lookup"><span data-stu-id="037b7-492">Avoid this situation by either selectively setting the extension data property to `null` or by selectively disabling the `IExtensibleObjectData` feature.</span></span>

## <a name="schema-import"></a><span data-ttu-id="037b7-493">Importazione di schemi</span><span class="sxs-lookup"><span data-stu-id="037b7-493">Schema Import</span></span>

<span data-ttu-id="037b7-494">In genere, il processo di importazione dello schema per la generazione dei tipi avviene solo in fase di progettazione, quando si usa lo [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) in un servizio Web per generare una classe client.</span><span class="sxs-lookup"><span data-stu-id="037b7-494">Normally, the process of importing schema to generate types happens only at design time, for example, when using the [ServiceModel Metadata Utility Tool (Svcutil.exe)](../servicemodel-metadata-utility-tool-svcutil-exe.md) on a Web service to generate a client class.</span></span> <span data-ttu-id="037b7-495">In scenari più avanzati è tuttavia possibile elaborare gli schemi in fase di esecuzione.</span><span class="sxs-lookup"><span data-stu-id="037b7-495">However, in more advanced scenarios, you may process schema at runtime.</span></span> <span data-ttu-id="037b7-496">È necessario essere consapevoli del fatto che così facendo ci si espone al rischio di attacchi Denial of Service.</span><span class="sxs-lookup"><span data-stu-id="037b7-496">Be aware that doing so can expose you to denial-of-service risks.</span></span> <span data-ttu-id="037b7-497">Per l'importazione di alcuni schemi può essere necessario molto tempo.</span><span class="sxs-lookup"><span data-stu-id="037b7-497">Some schema may take a long time to be imported.</span></span> <span data-ttu-id="037b7-498">Non utilizzare mai il componente per l'importazione di schemi <xref:System.Xml.Serialization.XmlSerializer> in tali scenari se gli schemi provengono da un'origine non attendibile.</span><span class="sxs-lookup"><span data-stu-id="037b7-498">Never use the <xref:System.Xml.Serialization.XmlSerializer> schema import component in such scenarios if schemas are possibly coming from an untrusted source.</span></span>

## <a name="threats-specific-to-aspnet-ajax-integration"></a><span data-ttu-id="037b7-499">Minacce specifiche dell'integrazione AJAX ASP.NET</span><span class="sxs-lookup"><span data-stu-id="037b7-499">Threats Specific to ASP.NET AJAX Integration</span></span>

<span data-ttu-id="037b7-500">Quando l'utente implementa <xref:System.ServiceModel.Description.WebScriptEnablingBehavior> o <xref:System.ServiceModel.Description.WebHttpBehavior> , WCF espone un endpoint che può accettare sia i messaggi XML che quelli JSON.</span><span class="sxs-lookup"><span data-stu-id="037b7-500">When the user implements <xref:System.ServiceModel.Description.WebScriptEnablingBehavior> or <xref:System.ServiceModel.Description.WebHttpBehavior>, WCF exposes an endpoint that can accept both XML and JSON messages.</span></span> <span data-ttu-id="037b7-501">In ogni caso, esiste un unico set di quote di reader utilizzate da entrambi i lettori XML e JSON.</span><span class="sxs-lookup"><span data-stu-id="037b7-501">However, there is only one set of reader quotas, used both by the XML reader and the JSON reader.</span></span> <span data-ttu-id="037b7-502">Alcune quote di reader possono risultare appropriate per un lettore ma troppo grandi per l'altro.</span><span class="sxs-lookup"><span data-stu-id="037b7-502">Some quota settings may be appropriate for one reader but too large for the other.</span></span>

<span data-ttu-id="037b7-503">Se si implementa `WebScriptEnablingBehavior`, si ha la possibilità di esporre un proxy JavaScript all'endpoint.</span><span class="sxs-lookup"><span data-stu-id="037b7-503">When implementing `WebScriptEnablingBehavior`, the user has the option to expose a JavaScript proxy at the endpoint.</span></span> <span data-ttu-id="037b7-504">È necessario considerare i seguenti problemi di sicurezza:</span><span class="sxs-lookup"><span data-stu-id="037b7-504">The following security issues must be considered:</span></span>

- <span data-ttu-id="037b7-505">Si possono ottenere informazioni sul servizio (nomi di operazione, nomi di parametri e così via), esaminando il proxy JavaScript.</span><span class="sxs-lookup"><span data-stu-id="037b7-505">Information about the service (operation names, parameter names, and so on) can be obtained by examining the JavaScript proxy.</span></span>

- <span data-ttu-id="037b7-506">Se si utilizza l'endpoint JavaScript, si possono mantenere informazioni riservate nella cache del browser Web del client.</span><span class="sxs-lookup"><span data-stu-id="037b7-506">When using the JavaScript endpoint, sensitive and private information might be retained in the client Web browser cache.</span></span>

## <a name="a-note-on-components"></a><span data-ttu-id="037b7-507">Nota sui componenti</span><span class="sxs-lookup"><span data-stu-id="037b7-507">A Note on Components</span></span>

<span data-ttu-id="037b7-508">WCF è un sistema flessibile e personalizzabile.</span><span class="sxs-lookup"><span data-stu-id="037b7-508">WCF is a flexible and customizable system.</span></span> <span data-ttu-id="037b7-509">La maggior parte del contenuto di questo argomento è incentrata sugli scenari di utilizzo più comuni di WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-509">Most of the contents of this topic focus on the most common WCF usage scenarios.</span></span> <span data-ttu-id="037b7-510">È tuttavia possibile comporre componenti che WCF fornisce in molti modi diversi.</span><span class="sxs-lookup"><span data-stu-id="037b7-510">However, it is possible to compose components WCF provides in many different ways.</span></span> <span data-ttu-id="037b7-511">È importante essere a conoscenza delle implicazioni per la protezione derivanti dall'utilizzo di ogni componente.</span><span class="sxs-lookup"><span data-stu-id="037b7-511">It is important to understand the security implications of using each component.</span></span> <span data-ttu-id="037b7-512">In particolare:</span><span class="sxs-lookup"><span data-stu-id="037b7-512">In particular:</span></span>

- <span data-ttu-id="037b7-513">Quando è necessario utilizzare lettori XML, utilizzare i lettori forniti dalla classe <xref:System.Xml.XmlDictionaryReader> anziché qualsiasi altro lettore.</span><span class="sxs-lookup"><span data-stu-id="037b7-513">When you must use XML readers, use the readers the <xref:System.Xml.XmlDictionaryReader> class provides as opposed to any other readers.</span></span> <span data-ttu-id="037b7-514">Si creano lettori sicuri utilizzando <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>o metodi <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> .</span><span class="sxs-lookup"><span data-stu-id="037b7-514">Safe readers are created using <xref:System.Xml.XmlDictionaryReader.CreateTextReader%2A>, <xref:System.Xml.XmlDictionaryReader.CreateBinaryReader%2A>, or <xref:System.Xml.XmlDictionaryReader.CreateMtomReader%2A> methods.</span></span> <span data-ttu-id="037b7-515">Non utilizzare il metodo <xref:System.Xml.XmlReader.Create%2A> .</span><span class="sxs-lookup"><span data-stu-id="037b7-515">Do not use the <xref:System.Xml.XmlReader.Create%2A> method.</span></span> <span data-ttu-id="037b7-516">Configurare sempre i lettori con quote sicure.</span><span class="sxs-lookup"><span data-stu-id="037b7-516">Always configure the readers with safe quotas.</span></span> <span data-ttu-id="037b7-517">I motori di serializzazione in WCF sono protetti solo se utilizzati con lettori XML sicuri da WCF.</span><span class="sxs-lookup"><span data-stu-id="037b7-517">The serialization engines in WCF are secure only when used with secure XML readers from WCF.</span></span>

- <span data-ttu-id="037b7-518">Quando si utilizza la classe <xref:System.Runtime.Serialization.DataContractSerializer> per deserializzare dati potenzialmente non attendibili, impostare sempre la proprietà <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> .</span><span class="sxs-lookup"><span data-stu-id="037b7-518">When using the <xref:System.Runtime.Serialization.DataContractSerializer> to deserialize potentially untrusted data, always set the <xref:System.Runtime.Serialization.DataContractSerializer.MaxItemsInObjectGraph%2A> property.</span></span>

- <span data-ttu-id="037b7-519">Quando si crea un messaggio, impostare il parametro `maxSizeOfHeaders` se `MaxReceivedMessageSize` non offre una protezione sufficiente.</span><span class="sxs-lookup"><span data-stu-id="037b7-519">When creating a message, set the `maxSizeOfHeaders` parameter if `MaxReceivedMessageSize` does not offer enough protection.</span></span>

- <span data-ttu-id="037b7-520">Quando si crea un codificatore, configurare sempre le relative quote, ad esempio `MaxSessionSize` e `MaxBufferSize`.</span><span class="sxs-lookup"><span data-stu-id="037b7-520">When creating an encoder, always configure the relevant quotas, such as `MaxSessionSize` and `MaxBufferSize`.</span></span>

- <span data-ttu-id="037b7-521">Quando si utilizza un filtro XPath per i messaggi, impostare <xref:System.ServiceModel.Dispatcher.XPathMessageFilter.NodeQuota%2A> per limitare la quantità di nodi XML visitati dal filtro.</span><span class="sxs-lookup"><span data-stu-id="037b7-521">When using an XPath message filter, set the <xref:System.ServiceModel.Dispatcher.XPathMessageFilter.NodeQuota%2A> to limit the amount of XML nodes the filter visits.</span></span> <span data-ttu-id="037b7-522">Non utilizzare espressioni XPath che richiedono lunghi tempi di calcolo anche senza visitare molti nodi.</span><span class="sxs-lookup"><span data-stu-id="037b7-522">Do not use XPath expressions that could take a long time to compute without visiting many nodes.</span></span>

- <span data-ttu-id="037b7-523">In generale, quando si utilizza un componente che accetta quote, è necessario comprenderne le implicazioni a livello di sicurezza e impostarle su valori sicuri.</span><span class="sxs-lookup"><span data-stu-id="037b7-523">In general, when using any component that accepts a quota, understand its security implications and set it to a safe value.</span></span>

## <a name="see-also"></a><span data-ttu-id="037b7-524">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="037b7-524">See also</span></span>

- <xref:System.Runtime.Serialization.DataContractSerializer>
- <xref:System.Xml.XmlDictionaryReader>
- <xref:System.Xml.Serialization.XmlSerializer>
- [<span data-ttu-id="037b7-525">Tipi conosciuti di contratto dati</span><span class="sxs-lookup"><span data-stu-id="037b7-525">Data Contract Known Types</span></span>](data-contract-known-types.md)
