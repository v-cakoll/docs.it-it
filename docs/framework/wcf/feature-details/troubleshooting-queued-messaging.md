---
title: Risoluzione dei problemi relativi ai messaggi in coda
ms.date: 03/30/2017
ms.assetid: a5f2836f-018d-42f5-a571-1e97e64ea5b0
ms.openlocfilehash: c85b0701c870fe2b4a3c11dc384e890e1ed001dd
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: it-IT
ms.lasthandoff: 04/23/2019
ms.locfileid: "62050766"
---
# <a name="troubleshooting-queued-messaging"></a><span data-ttu-id="1f58e-102">Risoluzione dei problemi relativi ai messaggi in coda</span><span class="sxs-lookup"><span data-stu-id="1f58e-102">Troubleshooting Queued Messaging</span></span>
<span data-ttu-id="1f58e-103">In questa sezione contiene domande frequenti e risoluzione dei problemi per l'uso delle code in Windows Communication Foundation (WCF).</span><span class="sxs-lookup"><span data-stu-id="1f58e-103">This section contains common questions and troubleshooting help for using queues in Windows Communication Foundation (WCF).</span></span>  
  
## <a name="common-questions"></a><span data-ttu-id="1f58e-104">Domande frequenti</span><span class="sxs-lookup"><span data-stu-id="1f58e-104">Common Questions</span></span>  
 <span data-ttu-id="1f58e-105">**Q:** Ho utilizzato WCF Beta 1 e installato l'hotfix MSMQ.</span><span class="sxs-lookup"><span data-stu-id="1f58e-105">**Q:** I used WCF Beta 1 and I installed the MSMQ hotfix.</span></span> <span data-ttu-id="1f58e-106">È necessario rimuovere l'hotfix?</span><span class="sxs-lookup"><span data-stu-id="1f58e-106">Do I need to remove the hotfix?</span></span>  
  
 <span data-ttu-id="1f58e-107">**R:** Sì.</span><span class="sxs-lookup"><span data-stu-id="1f58e-107">**A:** Yes.</span></span> <span data-ttu-id="1f58e-108">Questo hotfix non è più supportato.</span><span class="sxs-lookup"><span data-stu-id="1f58e-108">This hotfix is no longer supported.</span></span> <span data-ttu-id="1f58e-109">WCF ora funziona con MSMQ senza la necessità di hotfix.</span><span class="sxs-lookup"><span data-stu-id="1f58e-109">WCF now works on MSMQ without a hotfix requirement.</span></span>  
  
 <span data-ttu-id="1f58e-110">**Q:** Sono disponibili due associazioni per MSMQ: <xref:System.ServiceModel.NetMsmqBinding> e <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span><span class="sxs-lookup"><span data-stu-id="1f58e-110">**Q:** There are two bindings for MSMQ: <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding>.</span></span> <span data-ttu-id="1f58e-111">Quando è opportuno utilizzare l'una o l'altra?</span><span class="sxs-lookup"><span data-stu-id="1f58e-111">What should I use and when?</span></span>  
  
 <span data-ttu-id="1f58e-112">**R:** Usare il <xref:System.ServiceModel.NetMsmqBinding> quando si desidera utilizzare MSMQ come trasporto per la comunicazione in coda tra due applicazioni WCF.</span><span class="sxs-lookup"><span data-stu-id="1f58e-112">**A:** Use the <xref:System.ServiceModel.NetMsmqBinding> when you want to use MSMQ as a transport for queued communication between two WCF applications.</span></span> <span data-ttu-id="1f58e-113">Usare il <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> quando si desidera utilizzare le applicazioni MSMQ esistenti per comunicare con le nuove applicazioni WCF.</span><span class="sxs-lookup"><span data-stu-id="1f58e-113">Use the <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> when you want to use existing MSMQ applications to communicate with new WCF applications.</span></span>  
  
 <span data-ttu-id="1f58e-114">**Q:** È necessario aggiornare MSMQ per utilizzare il <xref:System.ServiceModel.NetMsmqBinding> e `MsmqIntegration` associazioni?</span><span class="sxs-lookup"><span data-stu-id="1f58e-114">**Q:** Do I have to upgrade MSMQ to use the <xref:System.ServiceModel.NetMsmqBinding> and `MsmqIntegration` bindings?</span></span>  
  
 <span data-ttu-id="1f58e-115">**R:** No.</span><span class="sxs-lookup"><span data-stu-id="1f58e-115">**A:** No.</span></span> <span data-ttu-id="1f58e-116">Entrambe le associazioni funzionano con MSMQ 3.0 in [!INCLUDE[wxp](../../../../includes/wxp-md.md)] e [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1f58e-116">Both bindings work with MSMQ 3.0 on [!INCLUDE[wxp](../../../../includes/wxp-md.md)] and [!INCLUDE[ws2003](../../../../includes/ws2003-md.md)].</span></span> <span data-ttu-id="1f58e-117">Alcune funzionalità delle associazioni divengono disponibili quando si esegue l'aggiornamento a MSMQ 4.0 in [!INCLUDE[wv](../../../../includes/wv-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1f58e-117">Certain features of the bindings become available when you upgrade to MSMQ 4.0 in [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span>  
  
 <span data-ttu-id="1f58e-118">**Q:** Quali funzionalità dei <xref:System.ServiceModel.NetMsmqBinding> e <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> associazioni sono disponibili in MSMQ 4.0, ma non in MSMQ 3.0?</span><span class="sxs-lookup"><span data-stu-id="1f58e-118">**Q:** What features of the <xref:System.ServiceModel.NetMsmqBinding> and <xref:System.ServiceModel.MsmqIntegration.MsmqIntegrationBinding> bindings are available in MSMQ 4.0 but not in MSMQ 3.0?</span></span>  
  
 <span data-ttu-id="1f58e-119">**R:** Le funzionalità seguenti sono disponibili in MSMQ 4.0, ma non in MSMQ 3.0:</span><span class="sxs-lookup"><span data-stu-id="1f58e-119">**A:** The following features are available in MSMQ 4.0 but not in MSMQ 3.0:</span></span>  
  
- <span data-ttu-id="1f58e-120">Le code di messaggi non recapitabili personalizzate sono supportate solo in MSMQ 4.0.</span><span class="sxs-lookup"><span data-stu-id="1f58e-120">Custom dead-letter queue is supported only on MSMQ 4.0.</span></span>  
  
- <span data-ttu-id="1f58e-121">MSMQ 3.0 e 4.0 gestiscono i messaggi non elaborabili in modo diverso.</span><span class="sxs-lookup"><span data-stu-id="1f58e-121">MSMQ 3.0 and 4.0 handle poison messages differently.</span></span>  
  
- <span data-ttu-id="1f58e-122">La lettura transazionale remota è supportata solo in MSMQ 4.0.</span><span class="sxs-lookup"><span data-stu-id="1f58e-122">Only MSMQ 4.0 supports remote transacted read.</span></span>  
  
 <span data-ttu-id="1f58e-123">Per altre informazioni, vedere [differenze nelle funzionalità di Accodamento in Windows Vista, Windows Server 2003 e Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span><span class="sxs-lookup"><span data-stu-id="1f58e-123">For more information, see [Differences in Queuing Features in Windows Vista, Windows Server 2003, and Windows XP](../../../../docs/framework/wcf/feature-details/diff-in-queue-in-vista-server-2003-windows-xp.md).</span></span>  
  
 <span data-ttu-id="1f58e-124">**Q:** È possibile utilizzare MSMQ 3.0 su un lato di una comunicazione in coda e MSMQ 4.0 su altro lato?</span><span class="sxs-lookup"><span data-stu-id="1f58e-124">**Q:** Can I use MSMQ 3.0 on one side of a queued communication and MSMQ 4.0 on the other side?</span></span>  
  
 <span data-ttu-id="1f58e-125">**R:** Sì.</span><span class="sxs-lookup"><span data-stu-id="1f58e-125">**A:** Yes.</span></span>  
  
 <span data-ttu-id="1f58e-126">**Q:** Si desidera integrare applicazioni MSMQ esistenti con i nuovi client WCF o server.</span><span class="sxs-lookup"><span data-stu-id="1f58e-126">**Q:** I want to integrate existing MSMQ applications with new WCF clients or servers.</span></span> <span data-ttu-id="1f58e-127">è necessario aggiornare entrambi i lati dell'infrastruttura MSMQ?</span><span class="sxs-lookup"><span data-stu-id="1f58e-127">Do I need to upgrade both sides of my MSMQ infrastructure?</span></span>  
  
 <span data-ttu-id="1f58e-128">**R:** No.</span><span class="sxs-lookup"><span data-stu-id="1f58e-128">**A:** No.</span></span> <span data-ttu-id="1f58e-129">Non è necessario eseguire l'aggiornamento a MSMQ 4.0 in entrambi i lati.</span><span class="sxs-lookup"><span data-stu-id="1f58e-129">You do not have to upgrade to MSMQ 4.0 on either side.</span></span>  
  
## <a name="troubleshooting"></a><span data-ttu-id="1f58e-130">Risoluzione dei problemi</span><span class="sxs-lookup"><span data-stu-id="1f58e-130">Troubleshooting</span></span>  
 <span data-ttu-id="1f58e-131">Contenuto della sezione sono contenute risposte per la risoluzione della maggior parte dei problemi frequenti.</span><span class="sxs-lookup"><span data-stu-id="1f58e-131">This section contains answers to most common troubleshooting issues.</span></span> <span data-ttu-id="1f58e-132">Alcuni problemi costituiti da limitazioni note sono descritti anche nelle note sulla versione.</span><span class="sxs-lookup"><span data-stu-id="1f58e-132">Some issues that are known limitations are also described in the release notes.</span></span>  
  
 <span data-ttu-id="1f58e-133">**Q:** Sto cercando di usare una coda privata e viene generata l'eccezione seguente: `System.InvalidOperationException`: L'URL non è valido.</span><span class="sxs-lookup"><span data-stu-id="1f58e-133">**Q:** I am trying to use a private queue and I get the following exception: `System.InvalidOperationException`: The URL is invalid.</span></span> <span data-ttu-id="1f58e-134">L'URL per la coda non può contenere il carattere '$'.</span><span class="sxs-lookup"><span data-stu-id="1f58e-134">The URL for the queue cannot contain the '$' character.</span></span> <span data-ttu-id="1f58e-135">Utilizzare la sintassi in net.msmq://machine/private/queueName per indirizzare una coda privata.</span><span class="sxs-lookup"><span data-stu-id="1f58e-135">Use the syntax in net.msmq://machine/private/queueName to address a private queue.</span></span>  
  
 <span data-ttu-id="1f58e-136">**R:** Controllare la coda Uniform Resource Identifier (URI) nella configurazione e nel codice.</span><span class="sxs-lookup"><span data-stu-id="1f58e-136">**A:** Please check the queue Uniform Resource Identifier (URI) in your configuration and code.</span></span> <span data-ttu-id="1f58e-137">Non utilizzare il carattere "$" nell'URI.</span><span class="sxs-lookup"><span data-stu-id="1f58e-137">Do not use the "$" character in the URI.</span></span> <span data-ttu-id="1f58e-138">Per indirizzare, ad esempio, una coda privata denominata OrdersQueue, specificare l'URI come segue: net.msmq://localhost/private/ordersQueue.</span><span class="sxs-lookup"><span data-stu-id="1f58e-138">For example, to address a private queue named OrdersQueue, specify the URI as net.msmq://localhost/private/ordersQueue.</span></span>  
  
 <span data-ttu-id="1f58e-139">**Q:** La chiamata `ServiceHost.Open()` sull'applicazione in coda genera l'eccezione seguente: `System.ArgumentException`: Un indirizzo di base non può contenere una stringa di query URI.</span><span class="sxs-lookup"><span data-stu-id="1f58e-139">**Q:** Calling `ServiceHost.Open()` on my queued application throws the following exception: `System.ArgumentException`: A base address cannot contain a URI query string.</span></span> <span data-ttu-id="1f58e-140">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-140">Why?</span></span>  
  
 <span data-ttu-id="1f58e-141">**R:** Controllare l'URI nel file di configurazione e nel codice della coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-141">**A:** Check the queue URI in your configuration file and in your code.</span></span> <span data-ttu-id="1f58e-142">Mentre le code MSMQ supportano l'utilizzo del carattere '?', gli URI interpretano questo carattere come l'inizio di una query di stringa.</span><span class="sxs-lookup"><span data-stu-id="1f58e-142">While MSMQ queues support the use of the '?' character, URIs interpret this character as the beginning of a string query.</span></span> <span data-ttu-id="1f58e-143">Per evitare questo problema, utilizzare nomi di coda che non contengono caratteri '?'.</span><span class="sxs-lookup"><span data-stu-id="1f58e-143">To avoid this issue, use queue names that do not contain '?' characters.</span></span>  
  
 <span data-ttu-id="1f58e-144">**Q:** L'invio è riuscito ma il ricevitore viene richiamata alcuna operazione di servizio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-144">**Q:** My send succeeded but no service operation is invoked on the receiver.</span></span> <span data-ttu-id="1f58e-145">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-145">Why?</span></span>  
  
 <span data-ttu-id="1f58e-146">**R:** Per determinare la risposta, consultare l'elenco di controllo seguente:</span><span class="sxs-lookup"><span data-stu-id="1f58e-146">**A:** To determine the answer, work through the following check list:</span></span>  
  
- <span data-ttu-id="1f58e-147">Controllare che i requisiti della coda transazionale siano compatibili con le garanzie specificate.</span><span class="sxs-lookup"><span data-stu-id="1f58e-147">Check that the transactional queue requirements are compatible with the assurances specified.</span></span> <span data-ttu-id="1f58e-148">Tenere presenti i principi seguenti:</span><span class="sxs-lookup"><span data-stu-id="1f58e-148">Note the following principles:</span></span>  
  
    - <span data-ttu-id="1f58e-149">È possibile inviare messaggi durevoli (datagrammi e sessioni) con "exactly-once" garanzie (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) solo a una coda transazionale.</span><span class="sxs-lookup"><span data-stu-id="1f58e-149">You can send durable messages (datagrams and sessions) with "exactly once" assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`) only to a transactional queue.</span></span>  
  
    - <span data-ttu-id="1f58e-150">È possibile inviare sessioni solo con assicurazioni "una sola volta".</span><span class="sxs-lookup"><span data-stu-id="1f58e-150">You can send sessions only with "exactly once" assurances.</span></span>  
  
    - <span data-ttu-id="1f58e-151">È necessaria una transazione per ricevere messaggi da una coda transazionale in una sessione.</span><span class="sxs-lookup"><span data-stu-id="1f58e-151">A transaction is required to receive messages in a session from a transactional queue.</span></span>  
  
    - <span data-ttu-id="1f58e-152">È possibile inviare o ricevere messaggi volatili o durevoli (solo datagrammi) senza garanzie (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) solo a una coda non transazionale.</span><span class="sxs-lookup"><span data-stu-id="1f58e-152">You can send or receive volatile or durable messages (datagrams only) with no assurances (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`) only to a non-transactional queue.</span></span>  
  
- <span data-ttu-id="1f58e-153">Controllare la coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="1f58e-153">Check the dead-letter queue.</span></span> <span data-ttu-id="1f58e-154">Se sono presenti messaggi, determinare perché non sono stati recapitati.</span><span class="sxs-lookup"><span data-stu-id="1f58e-154">If you find the messages there, determine why they were not delivered.</span></span>  
  
- <span data-ttu-id="1f58e-155">Verificare la connettività o eventuali problemi di indirizzamento delle code in uscita.</span><span class="sxs-lookup"><span data-stu-id="1f58e-155">Check the outgoing queues for connectivity or addressing problems.</span></span>  
  
 <span data-ttu-id="1f58e-156">**Q:** È stata specificata una coda non recapitabili personalizzata, ma quando avvia l'applicazione mittente, viene generata un'eccezione che la coda di lettera non consegnata non viene trovata, o l'applicazione mittente non dispone di autorizzazioni per la coda di messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="1f58e-156">**Q:** I have specified a custom dead-letter queue, but when I start the sender application, I get an exception that either the dead-letter queue is not found, or the sending application has no permission to the dead-letter queue.</span></span> <span data-ttu-id="1f58e-157">Perché si verifica questa situazione?</span><span class="sxs-lookup"><span data-stu-id="1f58e-157">Why is this happening?</span></span>  
  
 <span data-ttu-id="1f58e-158">**R:** L'URI della coda non recapitabilità personalizzato deve includere "localhost" o il nome del computer nel primo segmento, ad esempio, MSMQ: //localhost/private/coda msgnonrecapitabiliapp.</span><span class="sxs-lookup"><span data-stu-id="1f58e-158">**A:** The custom dead-letter queue URI must include a "localhost" or the computer name in the first segment, for example, net.msmq://localhost/private/myAppdead-letter queue.</span></span>  
  
 <span data-ttu-id="1f58e-159">**Q:** È sempre necessario definire una coda non recapitabili personalizzata o è presente un coda predefinita?</span><span class="sxs-lookup"><span data-stu-id="1f58e-159">**Q:** Is it always necessary to define a custom dead-letter queue, or is there a default dead-letter queue?</span></span>  
  
 <span data-ttu-id="1f58e-160">**R:** Se le garanzie sono "exactly-once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), e se non si specifica una coda non recapitabili personalizzata, il valore predefinito è una coda recapitabili transazionale a livello di sistema.</span><span class="sxs-lookup"><span data-stu-id="1f58e-160">**A:** If assurances are "exactly once" (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `true`), and if you do not specify a custom dead-letter queue, the default is a system-wide transactional dead-letter queue.</span></span>  
  
 <span data-ttu-id="1f58e-161">Se vi sono garanzie (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), quindi il valore predefinito è disponibile alcuna funzionalità di coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="1f58e-161">If assurances are none (<xref:System.ServiceModel.MsmqBindingBase.ExactlyOnce%2A> = `false`), then the default is no dead-letter queue functionality.</span></span>  
  
 <span data-ttu-id="1f58e-162">**Q:** Il servizio genera un'eccezione in Svchost con un messaggio "i requisiti di EndpointListener non possono essere soddisfatti da ListenerFactory".</span><span class="sxs-lookup"><span data-stu-id="1f58e-162">**Q:** My service throws on SvcHost.Open with a message "EndpointListener requirements cannot be met by the ListenerFactory".</span></span> <span data-ttu-id="1f58e-163">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-163">Why?</span></span>  
  
 <span data-ttu-id="1f58e-164">Un </span><span class="sxs-lookup"><span data-stu-id="1f58e-164">A.</span></span> <span data-ttu-id="1f58e-165">Controllare il contratto di servizio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-165">Check your service contract.</span></span> <span data-ttu-id="1f58e-166">È possibile avere dimenticato di inserire "IsOneWay =`true`" in tutte le operazioni del servizio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-166">You may have forgotten to put "IsOneWay=`true`" on all the service operations.</span></span> <span data-ttu-id="1f58e-167">Le code supportano solo operazioni del servizio unidirezionali.</span><span class="sxs-lookup"><span data-stu-id="1f58e-167">Queues support only one-way service operations.</span></span>  
  
 <span data-ttu-id="1f58e-168">**Q:** Sono presenti messaggi nella coda, ma viene richiamata alcuna operazione di servizio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-168">**Q:** There are messages in the queue but no service operation is invoked.</span></span> <span data-ttu-id="1f58e-169">Da che cosa è causato il problema?</span><span class="sxs-lookup"><span data-stu-id="1f58e-169">What is the problem?</span></span>  
  
 <span data-ttu-id="1f58e-170">**R:** Determinare se l'host del servizio contiene errori.</span><span class="sxs-lookup"><span data-stu-id="1f58e-170">**A:** Determine if your service host is faulted.</span></span> <span data-ttu-id="1f58e-171">È possibile eseguire questo controllo analizzando la traccia o implementando `IErrorHandler`.</span><span class="sxs-lookup"><span data-stu-id="1f58e-171">You can check by looking at the trace or implementing `IErrorHandler`.</span></span> <span data-ttu-id="1f58e-172">L'host del servizio, per impostazione predefinita, entra in stato di errore se viene rilevato un messaggio non elaborabile.</span><span class="sxs-lookup"><span data-stu-id="1f58e-172">Service host faults, by default, if a poison message is detected.</span></span>  
  
 <span data-ttu-id="1f58e-173">**Q:** Sono presenti messaggi nella coda ma non si attiva il mio servizio in coda ospitata sul Web.</span><span class="sxs-lookup"><span data-stu-id="1f58e-173">**Q:** There are messages in the queue but my Web-hosted queued service is not getting activated.</span></span> <span data-ttu-id="1f58e-174">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-174">Why?</span></span>  
  
 <span data-ttu-id="1f58e-175">**R:** Il motivo più comune è le autorizzazioni.</span><span class="sxs-lookup"><span data-stu-id="1f58e-175">**A:** The most common reason is permissions.</span></span>  
  
1. <span data-ttu-id="1f58e-176">Assicurarsi che il processo `NetMsmqActivator` sia in esecuzione e che all'identità del processo `NetMsmqActivator` sia concessa l'autorizzazione alla lettura e alla scrittura sulla coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-176">Ensure that the `NetMsmqActivator` process is running and the identity of the `NetMsmqActivator` process is given read and seek permission on the queue.</span></span>  
  
2. <span data-ttu-id="1f58e-177">Se `NetMsmqActivator` sta controllando le code in un computer remoto, assicurarsi che `NetMsmqActivator` non sia in esecuzione con un token di accesso con restrizioni.</span><span class="sxs-lookup"><span data-stu-id="1f58e-177">If the `NetMsmqActivator` is monitoring queues on a remote machine, ensure that `NetMsmqActivator` does not run under a restricted token.</span></span> <span data-ttu-id="1f58e-178">Per eseguire `NetMsmqActivator` con un token di accesso senza restrizioni:</span><span class="sxs-lookup"><span data-stu-id="1f58e-178">To run the `NetMsmqActivator` with an unrestricted token:</span></span>  
  
    ```  
    sc sidtype NetMsmqActivator unrestricted  
    ```  
  
 <span data-ttu-id="1f58e-179">Per problemi non correlato alla sicurezza correlati Web host, vedere: [Web che ospita un'applicazione in coda](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span><span class="sxs-lookup"><span data-stu-id="1f58e-179">For non-security related Web host issues refer to: [Web Hosting a Queued Application](../../../../docs/framework/wcf/feature-details/web-hosting-a-queued-application.md).</span></span>  
  
 <span data-ttu-id="1f58e-180">**Q:** Che cos'è il modo più semplice per accedere alle sessioni?</span><span class="sxs-lookup"><span data-stu-id="1f58e-180">**Q:** What is the easiest way to access sessions?</span></span>  
  
 <span data-ttu-id="1f58e-181">**R:** Impostare AutoComplete =`true` sull'operazione che corrisponde all'ultimo messaggio della sessione e AutoComplete =`false` su tutte le altre operazioni di servizio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-181">**A:** Set AutoComplete=`true` on the operation that corresponds to the last message in the session, and set AutoComplete=`false` on all remaining service operations.</span></span>  
  
 <span data-ttu-id="1f58e-182">**Q:** Dove trovare le risposte alle domande comuni su MSMQ?</span><span class="sxs-lookup"><span data-stu-id="1f58e-182">**Q:** Where can I find answers to common questions on MSMQ?</span></span>  
  
 <span data-ttu-id="1f58e-183">**R:** Per altre informazioni su MSMQ, vedere [Accodamento messaggi Microsoft](https://go.microsoft.com/fwlink/?LinkId=87810).</span><span class="sxs-lookup"><span data-stu-id="1f58e-183">**A:** For more information about MSMQ, see [Microsoft Message Queuing](https://go.microsoft.com/fwlink/?LinkId=87810).</span></span>  
  
 <span data-ttu-id="1f58e-184">**Q:** Il motivo per cui il servizio genera una `ProtocolException` quando la lettura da una coda contenente sia messaggi della sessione e messaggi del datagramma in coda?</span><span class="sxs-lookup"><span data-stu-id="1f58e-184">**Q:** Why does my service throw a `ProtocolException` when reading from a queue that contains both queued session messages and queued datagram messages?</span></span>  
  
 <span data-ttu-id="1f58e-185">**R:** È presente una differenza fondamentale nei messaggi di sessione in modo coda e sono composti da messaggi del datagramma in coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-185">**A:** There is a fundamental difference in the way queued session messages and queued datagram messages are composed.</span></span> <span data-ttu-id="1f58e-186">Per questo motivo, un servizio che prevede di leggere un messaggio della sessione in coda non può ricevere un messaggio del datagramma in coda e un servizio che prevede di leggere un messaggio del datagramma in coda non può ricevere un messaggio della sessione.</span><span class="sxs-lookup"><span data-stu-id="1f58e-186">Because of this, a service that is expecting to read a queued session message cannot receive a queued datagram message and a service expecting to read a queued datagram message cannot receive a session message.</span></span> <span data-ttu-id="1f58e-187">Eseguendo il tentativo di leggere entrambi tipi di messaggi dalla stessa coda viene generata l'eccezione seguente:</span><span class="sxs-lookup"><span data-stu-id="1f58e-187">Attempting to read both types of messages from the same queue throws the following exception:</span></span>  
  
```  
System.ServiceModel.MsmqPoisonMessageException: The transport channel detected a poison message. This occurred because the message exceeded the maximum number of delivery attempts or because the channel detected a fundamental problem with the message. The inner exception may contain additional information.   
---> System.ServiceModel.ProtocolException: An incoming MSMQ message contained invalid or unexpected .NET Message Framing information in its body. The message cannot be received. Ensure that the sender is using a compatible service contract with a matching SessionMode.  
```  
  
 <span data-ttu-id="1f58e-188">La coda dei messaggi non recapitabili di sistema, così come quella personalizzata, è particolarmente interessata dal problema se un'applicazione invia sia messaggi della sessione sia messaggi del datagramma in coda dallo stesso computer.</span><span class="sxs-lookup"><span data-stu-id="1f58e-188">The system dead-letter queue, as well as any custom dead-letter queue, is particularly susceptible to this issue if an application sends both queued session messages and queued datagram messages from the same computer.</span></span> <span data-ttu-id="1f58e-189">Se non è possibile inviare correttamente un messaggio, questo viene spostato nella coda dei messaggi non recapitabili.</span><span class="sxs-lookup"><span data-stu-id="1f58e-189">If a message cannot be sent successfully, it is moved to the dead-letter queue.</span></span> <span data-ttu-id="1f58e-190">In queste circostanze è possibile che nella coda dei messaggi non recapitabili siano presenti sia messaggi della sessione sia messaggi del datagramma.</span><span class="sxs-lookup"><span data-stu-id="1f58e-190">Under these circumstances, it is possible to have both session and datagram messages in the dead-letter queue.</span></span> <span data-ttu-id="1f58e-191">Non vi è modo di separare i due tipi di messaggi in fase di esecuzione quando viene letta una coda, pertanto le applicazioni non devono inviare messaggi della sessione e messaggi del datagramma in coda dallo stesso computer.</span><span class="sxs-lookup"><span data-stu-id="1f58e-191">There is no way to separate both types of messages at runtime when reading from a queue, therefore, applications should not send both queued session messages and queued datagram messages from the same computer.</span></span>  
  
### <a name="msmq-integration-specific-troubleshooting"></a><span data-ttu-id="1f58e-192">Integrazione con MSMQ Risoluzione dei problemi specifici</span><span class="sxs-lookup"><span data-stu-id="1f58e-192">MSMQ Integration: Specific Troubleshooting</span></span>  
 <span data-ttu-id="1f58e-193">**Q:** Quando si invia un messaggio o quando si apre l'host del servizio, viene visualizzato un errore che indica che lo schema è errato.</span><span class="sxs-lookup"><span data-stu-id="1f58e-193">**Q:** When I send a message, or when I open the service host, I get an error that indicates the scheme is wrong.</span></span> <span data-ttu-id="1f58e-194">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-194">Why?</span></span>  
  
 <span data-ttu-id="1f58e-195">**R:** Quando si usa l'associazione di integrazione MSMQ, è necessario usare lo schema MSMQ. FormatName.</span><span class="sxs-lookup"><span data-stu-id="1f58e-195">**A:** When you use the MSMQ integration binding, you must use the msmq.formatname scheme.</span></span> <span data-ttu-id="1f58e-196">Ad esempio, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span><span class="sxs-lookup"><span data-stu-id="1f58e-196">For example, msmq.formatname:DIRECT=OS:.\private$\OrdersQueue.</span></span> <span data-ttu-id="1f58e-197">Ma quando si specifica la coda dei messaggi non recapitabili personalizzata è necessario utilizzare lo schema net.msmq.</span><span class="sxs-lookup"><span data-stu-id="1f58e-197">But when you specify the custom dead-letter queue, you must use the net.msmq scheme.</span></span>  
  
 <span data-ttu-id="1f58e-198">**Q:** Quando Usa un nome di formato pubblici o privati e aprire l'host del servizio su [!INCLUDE[wv](../../../../includes/wv-md.md)], viene visualizzato un errore.</span><span class="sxs-lookup"><span data-stu-id="1f58e-198">**Q:** When I use a public or private format name and open the service host on [!INCLUDE[wv](../../../../includes/wv-md.md)], I get an error.</span></span> <span data-ttu-id="1f58e-199">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-199">Why?</span></span>  
  
 <span data-ttu-id="1f58e-200">**R:** Il canale di integrazione WCF su [!INCLUDE[wv](../../../../includes/wv-md.md)] controlla se una coda secondaria può essere aperto per la coda dell'applicazione principale per la gestione dei messaggi non elaborabili.</span><span class="sxs-lookup"><span data-stu-id="1f58e-200">**A:** The WCF integration channel on [!INCLUDE[wv](../../../../includes/wv-md.md)] checks to see if a sub-queue can be opened for the main application queue for handling poison messages.</span></span> <span data-ttu-id="1f58e-201">Il nome della coda secondaria deriva da un URI msmq.formatname passato al listener.</span><span class="sxs-lookup"><span data-stu-id="1f58e-201">The sub-queue name is derived from an msmq.formatname URI passed to the listener.</span></span> <span data-ttu-id="1f58e-202">Il nome della coda secondaria in MSMQ può essere solo un nome in formato diretto.</span><span class="sxs-lookup"><span data-stu-id="1f58e-202">The sub-queue name in MSMQ can only be a direct format name.</span></span> <span data-ttu-id="1f58e-203">Per questo motivo viene generato l'errore.</span><span class="sxs-lookup"><span data-stu-id="1f58e-203">So you see the error.</span></span> <span data-ttu-id="1f58e-204">Modificare l'URI della coda in modo che il nome sia in un formato diretto.</span><span class="sxs-lookup"><span data-stu-id="1f58e-204">Change the queue URI to a direct format name.</span></span>  
  
 <span data-ttu-id="1f58e-205">**Q:** Quando si riceve un messaggio da un'applicazione MSMQ, il messaggio rimane nella coda e non viene letto dall'applicazione di ricezione WCF.</span><span class="sxs-lookup"><span data-stu-id="1f58e-205">**Q:** When receiving a message from an MSMQ application, the message sits in the queue and is not read by the receiving WCF application.</span></span> <span data-ttu-id="1f58e-206">Perché?</span><span class="sxs-lookup"><span data-stu-id="1f58e-206">Why?</span></span>  
  
 <span data-ttu-id="1f58e-207">**R:** Verificare se il messaggio contiene un corpo.</span><span class="sxs-lookup"><span data-stu-id="1f58e-207">**A:** Check to see whether the message has a body.</span></span> <span data-ttu-id="1f58e-208">Se è privo di corpo viene ignorato dal canale di integrazione con MSMQ.</span><span class="sxs-lookup"><span data-stu-id="1f58e-208">If the message has no body, the MSMQ integration channel ignores the message.</span></span> <span data-ttu-id="1f58e-209">Implementare `IErrorHandler` per ricevere notifica delle eccezioni e controllare le tracce.</span><span class="sxs-lookup"><span data-stu-id="1f58e-209">Implement `IErrorHandler` to be notified of exceptions and check the traces.</span></span>  
  
### <a name="security-related-troubleshooting"></a><span data-ttu-id="1f58e-210">Risoluzione dei problemi correlati alla protezione</span><span class="sxs-lookup"><span data-stu-id="1f58e-210">Security-Related Troubleshooting</span></span>  
 <span data-ttu-id="1f58e-211">**Q:** Quando esegue l'esempio che usa un'associazione predefinita in modalità gruppo di lavoro, i messaggi sembrano essere inviati, ma non vengono mai ricevuti dal ricevitore.</span><span class="sxs-lookup"><span data-stu-id="1f58e-211">**Q:** When I run the sample that uses a default binding in workgroup mode, messages seem to get sent but are never received by the receiver.</span></span>  
  
 <span data-ttu-id="1f58e-212">**R:** Per impostazione predefinita, i messaggi vengono firmati usando un certificato interno MSMQ che richiede il servizio directory Active Directory.</span><span class="sxs-lookup"><span data-stu-id="1f58e-212">**A:** By default, messages are signed using an MSMQ internal certificate that requires the Active Directory directory service.</span></span> <span data-ttu-id="1f58e-213">In modalità gruppo di lavoro, poiché Active Directory non è disponibile, viene generato un errore nella firma del messaggio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-213">In workgroup mode, because Active Directory is not available, signing the message fails.</span></span> <span data-ttu-id="1f58e-214">Pertanto, il messaggio arriva la coda di messaggi non recapitabili e viene indicata causa dell'errore, ad esempio "Firma errata".</span><span class="sxs-lookup"><span data-stu-id="1f58e-214">So the message lands in the dead-letter queue and failure cause, such as "Bad signature", is indicated.</span></span>  
  
 <span data-ttu-id="1f58e-215">La soluzione alternativa consiste nel disattivare la sicurezza.</span><span class="sxs-lookup"><span data-stu-id="1f58e-215">The workaround is to turn off security.</span></span> <span data-ttu-id="1f58e-216">Questa operazione viene eseguita impostando <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A>  =  <xref:System.ServiceModel.NetMsmqSecurityMode.None> per consentire il funzionamento in modalità gruppo di lavoro.</span><span class="sxs-lookup"><span data-stu-id="1f58e-216">This is done by setting <xref:System.ServiceModel.NetMsmqSecurity.Mode%2A> = <xref:System.ServiceModel.NetMsmqSecurityMode.None> to make it work in workgroup mode.</span></span>  
  
 <span data-ttu-id="1f58e-217">Un'altra soluzione alternativa è ottenere <xref:System.ServiceModel.MsmqTransportSecurity> dalla proprietà <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> e impostarlo su <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, quindi impostare il certificato client.</span><span class="sxs-lookup"><span data-stu-id="1f58e-217">Another workaround is to get the <xref:System.ServiceModel.MsmqTransportSecurity> from the <xref:System.ServiceModel.NetMsmqSecurity.Transport%2A> property and set it to <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate>, and set the client certificate.</span></span>  
  
 <span data-ttu-id="1f58e-218">Un'ulteriore soluzione alternativa consiste nell'installare MSMQ unitamente all'integrazione con Active Directory.</span><span class="sxs-lookup"><span data-stu-id="1f58e-218">Yet another workaround is to install MSMQ with Active Directory integration.</span></span>  
  
 <span data-ttu-id="1f58e-219">**Q:** Quando si invia un messaggio con l'associazione predefinita (trasporto sicurezza attivata) in Active Directory per una coda, viene visualizzato un messaggio "certificato interno non trovato".</span><span class="sxs-lookup"><span data-stu-id="1f58e-219">**Q:** When I send a message with default binding (transport security turned on) in Active Directory to a queue, I get an "internal certificate not found" message.</span></span> <span data-ttu-id="1f58e-220">Com'è possibile risolvere il problema?</span><span class="sxs-lookup"><span data-stu-id="1f58e-220">How do I fix this?</span></span>  
  
 <span data-ttu-id="1f58e-221">**R:** Ciò significa che il certificato in Active Directory per il mittente deve essere rinnovato.</span><span class="sxs-lookup"><span data-stu-id="1f58e-221">**A:** This means that the certificate in Active Directory for the sender must be renewed.</span></span> <span data-ttu-id="1f58e-222">A tale scopo, aprire **Pannello di controllo**, **strumenti di amministrazione**, **Gestione Computer**, fare doppio clic su **MSMQ**e scegliere **Proprietà**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-222">To do so, open **Control Panel**, **Administrative Tools**, **Computer Management**, right-click **MSMQ**, and select **Properties**.</span></span> <span data-ttu-id="1f58e-223">Selezionare il **certificato utente** scheda e fare clic sui **Renew** pulsante.</span><span class="sxs-lookup"><span data-stu-id="1f58e-223">Select the **User Certificate** tab and click the **Renew** button.</span></span>  
  
 <span data-ttu-id="1f58e-224">**Q:** Quando si invia un messaggio utilizzando <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> e specificare il certificato da usare, viene visualizzato un messaggio "Certificato non valido".</span><span class="sxs-lookup"><span data-stu-id="1f58e-224">**Q:** When I send a message using <xref:System.ServiceModel.MsmqAuthenticationMode.Certificate> and specify the certificate to use, I get an "Invalid certificate" message.</span></span> <span data-ttu-id="1f58e-225">Com'è possibile risolvere il problema?</span><span class="sxs-lookup"><span data-stu-id="1f58e-225">How do I fix this?</span></span>  
  
 <span data-ttu-id="1f58e-226">**R:** È possibile utilizzare un archivio certificati computer locale con la modalità certificati.</span><span class="sxs-lookup"><span data-stu-id="1f58e-226">**A:** You cannot use a local machine certificate store with certificate mode.</span></span> <span data-ttu-id="1f58e-227">È necessario copiare il certificato dall'archivio dei certificati del computer all'archivio dell'utente corrente utilizzando lo snap-in Certificati.</span><span class="sxs-lookup"><span data-stu-id="1f58e-227">You have to copy the certificate from the machine certificate store to the current user store using the Certificate snap-in.</span></span> <span data-ttu-id="1f58e-228">Per ottenere lo snap-in Certificati:</span><span class="sxs-lookup"><span data-stu-id="1f58e-228">To get the Certificate snap-in:</span></span>  
  
1. <span data-ttu-id="1f58e-229">Fare clic su **avviare**, selezionare **eseguito**, digitare `mmc`, fare clic su **OK**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-229">Click **Start**, select **Run**, type `mmc`, and click **OK**.</span></span>  
  
2. <span data-ttu-id="1f58e-230">Nel **Microsoft Management Console**, aprire il **File** dal menu **Aggiungi/Rimuovi Snap-in**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-230">In the **Microsoft Management Console**, open the **File** menu and select **Add/Remove Snap-in**.</span></span>  
  
3. <span data-ttu-id="1f58e-231">Nel **Aggiungi/Rimuovi Snap-in** finestra di dialogo, fare clic sul **Aggiungi** pulsante.</span><span class="sxs-lookup"><span data-stu-id="1f58e-231">In the **Add/Remove Snap-in** dialog box, click the **Add** button.</span></span>  
  
4. <span data-ttu-id="1f58e-232">Nel **Aggiungi Snap-in Standalone** finestra di dialogo selezionare certificati e fare clic su **Add**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-232">In the **Add Standalone Snap-in** dialog box, select Certificates and click **Add**.</span></span>  
  
5. <span data-ttu-id="1f58e-233">Nel **certificati** snap-in finestra di dialogo **account dell'utente** e fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-233">In the **Certificates** snap-in dialog box, select **My user account,** and click **Finish**.</span></span>  
  
6. <span data-ttu-id="1f58e-234">Successivamente, aggiungere un secondo snap-in certificati usando i passaggi precedenti, ma questa volta selezionare **account Computer** e fare clic su **successivo**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-234">Next, add a second Certificates snap-in using the previous steps, but this time select **Computer account** and click **Next**.</span></span>  
  
7. <span data-ttu-id="1f58e-235">Selezionare **Computer locale** e fare clic su **fine**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-235">Select **Local Computer** and click **Finish**.</span></span> <span data-ttu-id="1f58e-236">È ora possibile trascinare i certificati dall'archivio del computer all'archivio dell'utente corrente.</span><span class="sxs-lookup"><span data-stu-id="1f58e-236">You can now drag and drop certificates from the machine certificate store to the current user store.</span></span>  
  
 <span data-ttu-id="1f58e-237">**Q:** Quando il servizio legge da una coda in un altro computer in modalità gruppo di lavoro, viene generata un'eccezione "accesso negato".</span><span class="sxs-lookup"><span data-stu-id="1f58e-237">**Q:** When my service reads from a queue on another computer in workgroup mode, I get an "access denied" exception.</span></span>  
  
 <span data-ttu-id="1f58e-238">**R:** In modalità gruppo di lavoro, per un'applicazione remota accedere alla coda, l'applicazione deve avere l'autorizzazione per accedere alla coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-238">**A:** In workgroup mode, for a remote application to gain access to the queue, the application must have permission to access the queue.</span></span> <span data-ttu-id="1f58e-239">Aggiungere "Accesso anonimo" all'elenco di controllo di accesso della coda (ACL) e assegnargli l'autorizzazione di lettura.</span><span class="sxs-lookup"><span data-stu-id="1f58e-239">Add "Anonymous login" to the queue's access control list (ACL) and give it read permission.</span></span>  
  
 <span data-ttu-id="1f58e-240">**Q:** Quando un client del servizio di rete (o qualsiasi client che non dispone di un account di dominio) invia un messaggio in coda, l'invio ha esito negativo con un certificato non valido.</span><span class="sxs-lookup"><span data-stu-id="1f58e-240">**Q:** When a network service client (or any client that does not have a domain account) sends a queued message, the send fails with an invalid certificate.</span></span> <span data-ttu-id="1f58e-241">Com'è possibile risolvere il problema?</span><span class="sxs-lookup"><span data-stu-id="1f58e-241">How do I fix this?</span></span>  
  
 <span data-ttu-id="1f58e-242">**R:** Controllare la configurazione dell'associazione.</span><span class="sxs-lookup"><span data-stu-id="1f58e-242">**A:** Check the binding configuration.</span></span> <span data-ttu-id="1f58e-243">Per l'associazione predefinita è attivata la protezione del trasporto MSMQ per la firma del messaggio.</span><span class="sxs-lookup"><span data-stu-id="1f58e-243">The default binding has MSMQ transport security turned on to sign the message.</span></span> <span data-ttu-id="1f58e-244">Disattivarla.</span><span class="sxs-lookup"><span data-stu-id="1f58e-244">Turn it off.</span></span>  
  
### <a name="remote-transacted-receives"></a><span data-ttu-id="1f58e-245">Ricezioni transazionali remote</span><span class="sxs-lookup"><span data-stu-id="1f58e-245">Remote Transacted Receives</span></span>  
 <span data-ttu-id="1f58e-246">**Q:** Quando si dispone di una coda un oggetto e un servizio WCF che legge i messaggi da una coda sul computer B (scenario di ricezione transazionale remota) del computer, i messaggi sono non letto dalla coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-246">**Q:** When I have a queue on machine A, and a WCF service that reads messages from a queue on machine B (the remote transacted receive scenario), messages are not read from the queue.</span></span> <span data-ttu-id="1f58e-247">Informazioni di traccia indicano la ricezione non è riuscita con il messaggio "delle transazioni non possono essere importati."</span><span class="sxs-lookup"><span data-stu-id="1f58e-247">Tracing information indicates the receive failed with the message "Transaction cannot be imported."</span></span> <span data-ttu-id="1f58e-248">Cosa può fare per risolvere questo problema?</span><span class="sxs-lookup"><span data-stu-id="1f58e-248">What can I do to fix this?</span></span>  
  
 <span data-ttu-id="1f58e-249">**R:** Le ragioni possibili sono tre:</span><span class="sxs-lookup"><span data-stu-id="1f58e-249">**A:** There are three possible reasons for this:</span></span>  
  
- <span data-ttu-id="1f58e-250">In modalità di dominio per la ricezione transazionale remota è necessario l'accesso alla rete di Microsoft Distributed Transaction Coordinator (MSDTC).</span><span class="sxs-lookup"><span data-stu-id="1f58e-250">If you are in domain mode, remote transacted receive requires Microsoft Distributed Transaction Coordinator (MSDTC) network access.</span></span> <span data-ttu-id="1f58e-251">È possibile abilitarla usando **Aggiungi/Rimuovi componenti**.</span><span class="sxs-lookup"><span data-stu-id="1f58e-251">You can enable this using **Add/Remove Components**.</span></span>  
  
     ![Screenshot che mostra l'abilitazione di rete DTC accesso.](./media/troubleshooting-queued-messaging/enable-distributed-transaction-coordinator-access.jpg)  
  
- <span data-ttu-id="1f58e-253">Verificare la modalità di autenticazione per la comunicazione con il gestore transazioni.</span><span class="sxs-lookup"><span data-stu-id="1f58e-253">Check the authentication mode for communicating with the transaction manager.</span></span> <span data-ttu-id="1f58e-254">Se si è in modalità gruppo di lavoro, è non necessario selezionare "Nessuna autenticazione".</span><span class="sxs-lookup"><span data-stu-id="1f58e-254">If you are in workgroup mode, "No Authentication Required" must be selected.</span></span> <span data-ttu-id="1f58e-255">Se si è in modalità di dominio, è necessario selezionare "Necessaria autenticazione reciproca".</span><span class="sxs-lookup"><span data-stu-id="1f58e-255">If you are in domain mode, then "Mutual Authentication Required" must be selected.</span></span>  
  
     <span data-ttu-id="1f58e-256">![Abilitazione delle transazioni XA](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span><span class="sxs-lookup"><span data-stu-id="1f58e-256">![Enabling XA transactions](../../../../docs/framework/wcf/feature-details/media/4f3695e0-fb0b-4c5b-afac-75f8860d2bb0.jpg "4f3695e0-fb0b-4c5b-afac-75f8860d2bb0")</span></span>  
  
- <span data-ttu-id="1f58e-257">Assicurarsi che MSDTC sia nell'elenco delle eccezioni nel **Internet Connection Firewall** impostazioni.</span><span class="sxs-lookup"><span data-stu-id="1f58e-257">Make sure that MSDTC is in the list of exceptions in the **Internet Connection Firewall** settings.</span></span>  
  
- <span data-ttu-id="1f58e-258">Assicurarsi di utilizzare [!INCLUDE[wv](../../../../includes/wv-md.md)].</span><span class="sxs-lookup"><span data-stu-id="1f58e-258">Ensure that you are using [!INCLUDE[wv](../../../../includes/wv-md.md)].</span></span> <span data-ttu-id="1f58e-259">MSMQ con [!INCLUDE[wv](../../../../includes/wv-md.md)] supporta la lettura transazionale remota.</span><span class="sxs-lookup"><span data-stu-id="1f58e-259">MSMQ on [!INCLUDE[wv](../../../../includes/wv-md.md)] supports remote transacted read.</span></span> <span data-ttu-id="1f58e-260">MSMQ con le versioni precedenti di Windows non supporta la lettura transazionale remota.</span><span class="sxs-lookup"><span data-stu-id="1f58e-260">MSMQ on earlier Windows releases does not support remote transacted read.</span></span>  
  
 <span data-ttu-id="1f58e-261">**Q:** Quando il servizio che legge dalla coda è un servizio di rete, ad esempio, un sito Web host, il motivo per cui ottenere un'eccezione di accesso negato viene generato durante la lettura dalla coda?</span><span class="sxs-lookup"><span data-stu-id="1f58e-261">**Q:** When the service reading from the queue is a network service, for example, in a Web host, why do I get an access-denied exception is raised when reading from the queue?</span></span>  
  
 <span data-ttu-id="1f58e-262">**R:** Accesso in lettura del servizio di rete deve essere aggiunto alla coda di ACL per assicurarsi che un servizio di rete può leggere dalla coda.</span><span class="sxs-lookup"><span data-stu-id="1f58e-262">**A:** Network service read access must be added to the queue ACL to ensure that a network service can read from the queue.</span></span>  
  
 <span data-ttu-id="1f58e-263">**Q:** È possibile usare il servizio di attivazione MSMQ per attivare le applicazioni basate su messaggi in una coda in un computer remoto?</span><span class="sxs-lookup"><span data-stu-id="1f58e-263">**Q:** Can I use the MSMQ activation service to activate applications based on messages in a queue on a remote machine?</span></span>  
  
 <span data-ttu-id="1f58e-264">**R:** Sì.</span><span class="sxs-lookup"><span data-stu-id="1f58e-264">**A:** Yes.</span></span> <span data-ttu-id="1f58e-265">A questo scopo, è necessario configurare il servizio di attivazione MSMQ in modo che venga eseguito come servizio di rete e aggiungere l'accesso al servizio di rete alla coda nel computer remoto.</span><span class="sxs-lookup"><span data-stu-id="1f58e-265">To do this, you must configure the MSMQ activation service to run as a network service, and add network service access to the queue on the remote machine.</span></span>  
  
## <a name="using-custom-msmq-bindings-with-receivecontext-enabled"></a><span data-ttu-id="1f58e-266">Utilizzo di associazioni MSMQ personalizzate con ReceiveContext abilitato</span><span class="sxs-lookup"><span data-stu-id="1f58e-266">Using Custom MSMQ Bindings with ReceiveContext Enabled</span></span>  
 <span data-ttu-id="1f58e-267">Quando si utilizza un'associazione MSMQ personalizzata con <xref:System.ServiceModel.Channels.ReceiveContext> abilitato, per elaborare un messaggio in arrivo verrà utilizzato un thread del pool poiché il componente MSMQ nativo non supporta il completamento I/O per ricezioni di <xref:System.ServiceModel.Channels.ReceiveContext> asincrone.</span><span class="sxs-lookup"><span data-stu-id="1f58e-267">When using a custom MSMQ binding with <xref:System.ServiceModel.Channels.ReceiveContext> enabled processing an incoming message will use a thread pool thread because native MSMQ does not support I/O completion for asynchronous <xref:System.ServiceModel.Channels.ReceiveContext> receives.</span></span> <span data-ttu-id="1f58e-268">Questa situazione si verifica perché l'elaborazione di tale messaggio utilizza transazioni interne per <xref:System.ServiceModel.Channels.ReceiveContext> e MSMQ non supporta l'elaborazione asincrona.</span><span class="sxs-lookup"><span data-stu-id="1f58e-268">This is because processing such a message uses internal transactions for <xref:System.ServiceModel.Channels.ReceiveContext> and MSMQ does not support asynchronous processing.</span></span> <span data-ttu-id="1f58e-269">Per risolvere questo problema, è possibile aggiungere un oggetto <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> all'endpoint per forzare l'elaborazione asincrona o impostare <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> su 1.</span><span class="sxs-lookup"><span data-stu-id="1f58e-269">To work around this issue you can add a <xref:System.ServiceModel.Description.SynchronousReceiveBehavior> to the endpoint to force synchronous processing or set <xref:System.ServiceModel.Description.DispatcherSynchronizationBehavior.MaxPendingReceives%2A> to 1.</span></span>
