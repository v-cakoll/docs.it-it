---
title: "Considerazioni sulle prestazioni per l'interoperabilità fra Direct3D9 e WPF"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
helpviewer_keywords:
- WPF [WPF], Direct3D9 interop performance
- Direct3D9 [WPF interoperability], performance
ms.assetid: ea8baf91-12fe-4b44-ac4d-477110ab14dd
caps.latest.revision: "19"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: 8142125eae26b15f12652d28fdf0c34f19d49c4e
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 12/22/2017
---
# <a name="performance-considerations-for-direct3d9-and-wpf-interoperability"></a><span data-ttu-id="63dde-102">Considerazioni sulle prestazioni per l'interoperabilità fra Direct3D9 e WPF</span><span class="sxs-lookup"><span data-stu-id="63dde-102">Performance Considerations for Direct3D9 and WPF Interoperability</span></span>
<span data-ttu-id="63dde-103">È possibile ospitare contenuto Direct3D9 utilizzando la <xref:System.Windows.Interop.D3DImage> classe.</span><span class="sxs-lookup"><span data-stu-id="63dde-103">You can host Direct3D9 content by using the <xref:System.Windows.Interop.D3DImage> class.</span></span> <span data-ttu-id="63dde-104">Hosting di contenuto Direct3D9 influire sulle prestazioni dell'applicazione.</span><span class="sxs-lookup"><span data-stu-id="63dde-104">Hosting Direct3D9 content can affect the performance of your application.</span></span> <span data-ttu-id="63dde-105">In questo argomento vengono descritte le procedure consigliate per ottimizzare le prestazioni quando si ospita il contenuto Direct3D9 in un'applicazione Windows Presentation Foundation (WPF).</span><span class="sxs-lookup"><span data-stu-id="63dde-105">This topic describes best practices to optimize performance when hosting Direct3D9 content in a Windows Presentation Foundation (WPF) application.</span></span> <span data-ttu-id="63dde-106">Queste procedure consigliate per la modalità di utilizzo <xref:System.Windows.Interop.D3DImage> e procedure consigliate quando si utilizza Windows Vista, Windows XP, e viene visualizzato con più monitor.</span><span class="sxs-lookup"><span data-stu-id="63dde-106">These best practices include how to use <xref:System.Windows.Interop.D3DImage> and best practices when you are using Windows Vista, Windows XP, and multi-monitor displays.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="63dde-107">Per esempi di codice che illustrano le procedure consigliate, vedere [interoperatività di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="63dde-107">For code examples that demonstrate these best practices, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="use-d3dimage-sparingly"></a><span data-ttu-id="63dde-108">Utilizzare con cautela D3DImage</span><span class="sxs-lookup"><span data-stu-id="63dde-108">Use D3DImage Sparingly</span></span>  
 <span data-ttu-id="63dde-109">Contenuto Direct3D9 ospitato in un <xref:System.Windows.Interop.D3DImage> istanza non esegue il rendering con la stessa velocità come in un'applicazione Direct3D pura.</span><span class="sxs-lookup"><span data-stu-id="63dde-109">Direct3D9 content hosted in a <xref:System.Windows.Interop.D3DImage> instance does not render as fast as in a pure Direct3D application.</span></span> <span data-ttu-id="63dde-110">Area di copia e lo scaricamento buffer dei comandi possono essere operazioni costose.</span><span class="sxs-lookup"><span data-stu-id="63dde-110">Copying the surface and flushing the command buffer can be costly operations.</span></span> <span data-ttu-id="63dde-111">Come il numero di <xref:System.Windows.Interop.D3DImage> aumento di istanze, viene eseguita una svuotamento aumentano e comporta una riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="63dde-111">As the number of <xref:System.Windows.Interop.D3DImage> instances increases, more flushing occurs, and performance degrades.</span></span> <span data-ttu-id="63dde-112">Pertanto, è necessario utilizzare <xref:System.Windows.Interop.D3DImage> con cautela.</span><span class="sxs-lookup"><span data-stu-id="63dde-112">Therefore, you should use <xref:System.Windows.Interop.D3DImage> sparingly.</span></span>  
  
## <a name="best-practices-on-windows-vista"></a><span data-ttu-id="63dde-113">Procedure consigliate in Windows Vista</span><span class="sxs-lookup"><span data-stu-id="63dde-113">Best Practices on Windows Vista</span></span>  
 <span data-ttu-id="63dde-114">Per prestazioni ottimali in Windows Vista con un display configurato per l'utilizzo di Windows Driver Model (WDDM Display), creare la superficie Direct3D9 in un `IDirect3DDevice9Ex` dispositivo.</span><span class="sxs-lookup"><span data-stu-id="63dde-114">For best performance on Windows Vista with a display that is configured to use the Windows Display Driver Model (WDDM), create your Direct3D9 surface on an `IDirect3DDevice9Ex` device.</span></span> <span data-ttu-id="63dde-115">In questo modo la condivisione della superficie.</span><span class="sxs-lookup"><span data-stu-id="63dde-115">This enables surface sharing.</span></span> <span data-ttu-id="63dde-116">La scheda video deve supportare il `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` e `D3DCAPS2_CANSHARERESOURCE` le funzionalità del driver in Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="63dde-116">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` and `D3DCAPS2_CANSHARERESOURCE` driver capabilities on Windows Vista.</span></span> <span data-ttu-id="63dde-117">Tutte le altre impostazioni causano la superficie viene copiata attraverso il software, che riduce significativamente le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="63dde-117">Any other settings cause the surface to be copied through software, which reduces performance significantly.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="63dde-118">Se Windows Vista ha una visualizzazione che è configurata per l'utilizzo di Windows XP Driver XDDM (Display Model), la superficie viene sempre copiata tramite software, indipendentemente dalle impostazioni.</span><span class="sxs-lookup"><span data-stu-id="63dde-118">If Windows Vista has a display that is configured to use the Windows XP Display Driver Model (XDDM), the surface is always copied through software, regardless of settings.</span></span> <span data-ttu-id="63dde-119">Con le impostazioni appropriate e la scheda video si noteranno prestazioni migliori in Windows Vista quando si utilizza WDDM perché le copie della superficie vengono eseguite nell'hardware.</span><span class="sxs-lookup"><span data-stu-id="63dde-119">With the proper settings and video card, you will see better performance on Windows Vista when you use the WDDM because surface copies are performed in hardware.</span></span>  
  
## <a name="best-practices-on-windows-xp"></a><span data-ttu-id="63dde-120">Procedure consigliate in Windows XP</span><span class="sxs-lookup"><span data-stu-id="63dde-120">Best Practices on Windows XP</span></span>  
 <span data-ttu-id="63dde-121">Per prestazioni ottimali in Windows XP, che utilizza il Windows XP Visualizza modello XDDM (Driver), creare una superficie bloccabile che si comporti correttamente quando il `IDirect3DSurface9::GetDC` metodo viene chiamato.</span><span class="sxs-lookup"><span data-stu-id="63dde-121">For best performance on Windows XP, which uses the Windows XP Display Driver Model (XDDM), create a lockable surface that behaves correctly when the `IDirect3DSurface9::GetDC` method is called.</span></span> <span data-ttu-id="63dde-122">Internamente, il `BitBlt` metodo trasferisce la superficie tra i dispositivi hardware.</span><span class="sxs-lookup"><span data-stu-id="63dde-122">Internally, the `BitBlt` method transfers the surface across devices in hardware.</span></span> <span data-ttu-id="63dde-123">Il `GetDC` metodo funziona sempre sulle superfici XRGB.</span><span class="sxs-lookup"><span data-stu-id="63dde-123">The `GetDC` method always works on XRGB surfaces.</span></span> <span data-ttu-id="63dde-124">Tuttavia, se il computer client è in esecuzione Windows XP con SP3 o SP2, e se il client ha anche l'aggiornamento rapido per la funzionalità di finestre sovrapposte, questo metodo funziona solo sulle superfici ARGB.</span><span class="sxs-lookup"><span data-stu-id="63dde-124">However, if the client computer is running Windows XP with SP3 or SP2, and if the client also has the hotfix for the layered-window feature, this method only works on ARGB surfaces.</span></span> <span data-ttu-id="63dde-125">La scheda video deve supportare il `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` funzionalità del driver.</span><span class="sxs-lookup"><span data-stu-id="63dde-125">The video card must support the `D3DDEVCAPS2_CAN_STRETCHRECT_FROM_TEXTURES` driver capability.</span></span>  
  
 <span data-ttu-id="63dde-126">Una profondità di visualizzazione del desktop a 16 bit può ridurre notevolmente le prestazioni.</span><span class="sxs-lookup"><span data-stu-id="63dde-126">A 16-bit desktop display depth can significantly reduce performance.</span></span> <span data-ttu-id="63dde-127">È consigliabile un desktop a 32 bit.</span><span class="sxs-lookup"><span data-stu-id="63dde-127">A 32-bit desktop is recommended.</span></span>  
  
 <span data-ttu-id="63dde-128">Se si sviluppa per Windows Vista e Windows XP, è possibile testare le prestazioni in Windows XP.</span><span class="sxs-lookup"><span data-stu-id="63dde-128">If you are developing for Windows Vista and Windows XP, test the performance on Windows XP.</span></span> <span data-ttu-id="63dde-129">Esaurimento di memoria video in Windows XP è un problema.</span><span class="sxs-lookup"><span data-stu-id="63dde-129">Running out of video memory on Windows XP is a concern.</span></span> <span data-ttu-id="63dde-130">Inoltre, <xref:System.Windows.Interop.D3DImage> in Windows XP Usa più memoria video e larghezza di banda rispetto a Windows Vista WDDM, a causa di una copia di memoria video aggiuntiva necessaria.</span><span class="sxs-lookup"><span data-stu-id="63dde-130">In addition, <xref:System.Windows.Interop.D3DImage> on Windows XP uses more video memory and bandwidth than Windows Vista WDDM, due to a necessary extra video memory copy.</span></span> <span data-ttu-id="63dde-131">Pertanto, è possibile prevedere prestazioni peggiori in Windows XP rispetto a Windows Vista per lo stesso hardware video.</span><span class="sxs-lookup"><span data-stu-id="63dde-131">Therefore, you can expect performance to be worse on Windows XP than on Windows Vista for the same video hardware.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="63dde-132">XDDM è disponibile in Windows XP e Windows Vista. Tuttavia, WDDM è disponibile solo in Windows Vista.</span><span class="sxs-lookup"><span data-stu-id="63dde-132">XDDM is available on both Windows XP and Windows Vista; however, WDDM is available only on Windows Vista.</span></span>  
  
## <a name="general-best-practices"></a><span data-ttu-id="63dde-133">Procedure consigliate generali</span><span class="sxs-lookup"><span data-stu-id="63dde-133">General Best Practices</span></span>  
 <span data-ttu-id="63dde-134">Quando si crea il dispositivo, utilizzare il `D3DCREATE_MULTITHREADED` flag di creazione.</span><span class="sxs-lookup"><span data-stu-id="63dde-134">When you create the device, use the `D3DCREATE_MULTITHREADED` creation flag.</span></span> <span data-ttu-id="63dde-135">Ciò riduce le prestazioni, ma il sistema di rendering WPF chiama i metodi su questo dispositivo da un altro thread.</span><span class="sxs-lookup"><span data-stu-id="63dde-135">This reduces performance, but the WPF rendering system calls methods on this device from another thread.</span></span> <span data-ttu-id="63dde-136">Assicurarsi di seguire il protocollo di blocco in modo corretto, in modo che nessun due thread di accedere al dispositivo nello stesso momento.</span><span class="sxs-lookup"><span data-stu-id="63dde-136">Be sure to follow the locking protocol correctly, so that no two threads access the device at the same time.</span></span>  
  
 <span data-ttu-id="63dde-137">Se il rendering viene eseguito in un thread gestito da WPF, è consigliabile creare il dispositivo con il `D3DCREATE_FPU_PRESERVE` flag di creazione.</span><span class="sxs-lookup"><span data-stu-id="63dde-137">If your rendering is performed on a WPF managed thread, it is strongly recommended that you create the device with the `D3DCREATE_FPU_PRESERVE` creation flag.</span></span> <span data-ttu-id="63dde-138">Senza questa impostazione, il rendering D3D può ridurre l'accuratezza di operazioni a precisione doppia WPF e comportare problemi di rendering.</span><span class="sxs-lookup"><span data-stu-id="63dde-138">Without this setting, the D3D rendering can reduce the accuracy of WPF double-precision operations and introduce rendering issues.</span></span>  
  
 <span data-ttu-id="63dde-139">Affiancamento un <xref:System.Windows.Interop.D3DImage> è veloce, a meno che non è affiancare un'area di non-pow2 senza supporto hardware o se è affiancare un <xref:System.Windows.Media.DrawingBrush> o <xref:System.Windows.Media.VisualBrush> che contiene un <xref:System.Windows.Interop.D3DImage>.</span><span class="sxs-lookup"><span data-stu-id="63dde-139">Tiling a <xref:System.Windows.Interop.D3DImage> is fast, unless you tile a non-pow2 surface without hardware support, or if you tile a <xref:System.Windows.Media.DrawingBrush> or <xref:System.Windows.Media.VisualBrush> that contains a <xref:System.Windows.Interop.D3DImage>.</span></span>  
  
## <a name="best-practices-for-multi-monitor-displays"></a><span data-ttu-id="63dde-140">Procedure consigliate per visualizzazioni con più monitor</span><span class="sxs-lookup"><span data-stu-id="63dde-140">Best Practices for Multi-Monitor Displays</span></span>  
 <span data-ttu-id="63dde-141">Se si utilizza un computer che dispone di più monitor, è necessario seguire le procedure consigliate descritte in precedenza.</span><span class="sxs-lookup"><span data-stu-id="63dde-141">If you are using a computer that has multiple monitors, you should follow the previously described best practices.</span></span> <span data-ttu-id="63dde-142">Esistono inoltre alcune considerazioni sulle prestazioni per una configurazione di più monitor.</span><span class="sxs-lookup"><span data-stu-id="63dde-142">There are also some additional performance considerations for a multi-monitor configuration.</span></span>  
  
 <span data-ttu-id="63dde-143">Quando si crea il buffer nascosto, viene creato in un dispositivo specifico e l'adapter ma WPF visualizzi il front buffer in qualsiasi scheda.</span><span class="sxs-lookup"><span data-stu-id="63dde-143">When you create the back buffer, it is created on a specific device and adapter, but WPF may display the front buffer on any adapter.</span></span> <span data-ttu-id="63dde-144">Copia tra le schede per aggiornare il front-buffer può risultare molto costosa.</span><span class="sxs-lookup"><span data-stu-id="63dde-144">Copying across adapters to update the front buffer can be very expensive.</span></span> <span data-ttu-id="63dde-145">In Windows Vista, è configurato per l'utilizzo di WDDM con più schede video e con un `IDirect3DDevice9Ex` dispositivo, se il buffer anteriore è su una scheda differente ma con la stessa scheda video, non vi è alcuna riduzione delle prestazioni.</span><span class="sxs-lookup"><span data-stu-id="63dde-145">On Windows Vista that is configured to use the WDDM with multiple video cards and with an `IDirect3DDevice9Ex` device, if the front buffer is on a different adapter but still the same video card, there is no performance penalty.</span></span> <span data-ttu-id="63dde-146">Tuttavia, in Windows XP e la XDDM con più schede video, è una riduzione significativa delle prestazioni quando il buffer anteriore viene visualizzato in una scheda diversa rispetto al buffer nascosto.</span><span class="sxs-lookup"><span data-stu-id="63dde-146">However, on Windows XP and the XDDM with multiple video cards, there is a significant performance penalty when the front buffer is displayed on a different adapter than the back buffer.</span></span> <span data-ttu-id="63dde-147">Per ulteriori informazioni, vedere [interoperatività di WPF e Direct3D9](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span><span class="sxs-lookup"><span data-stu-id="63dde-147">For more information, see [WPF and Direct3D9 Interoperation](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md).</span></span>  
  
## <a name="performance-summary"></a><span data-ttu-id="63dde-148">Riepilogo delle prestazioni</span><span class="sxs-lookup"><span data-stu-id="63dde-148">Performance Summary</span></span>  
 <span data-ttu-id="63dde-149">La tabella seguente mostra le prestazioni dell'aggiornamento buffer front-come funzione di sistema operativo, il formato pixel e bloccabilità superficie di attacco.</span><span class="sxs-lookup"><span data-stu-id="63dde-149">The following table shows performance of the front buffer update as a function of operating system, pixel format, and surface lockability.</span></span> <span data-ttu-id="63dde-150">Il front buffer e buffer nascosto vengono considerati nella stessa scheda.</span><span class="sxs-lookup"><span data-stu-id="63dde-150">The front buffer and back buffer are assumed to be on the same adapter.</span></span> <span data-ttu-id="63dde-151">A seconda della configurazione di adapter, gli aggiornamenti hardware sono in genere molto più veloci gli aggiornamenti software.</span><span class="sxs-lookup"><span data-stu-id="63dde-151">Depending on the adapter configuration, hardware updates are generally much faster than software updates.</span></span>  
  
|<span data-ttu-id="63dde-152">Formato pixel della superficie</span><span class="sxs-lookup"><span data-stu-id="63dde-152">Surface pixel format</span></span>|<span data-ttu-id="63dde-153">9Ex, WDDM e Windows Vista</span><span class="sxs-lookup"><span data-stu-id="63dde-153">Windows Vista, WDDM and 9Ex</span></span>|<span data-ttu-id="63dde-154">Altre configurazioni di Windows Vista</span><span class="sxs-lookup"><span data-stu-id="63dde-154">Other Windows Vista configurations</span></span>|<span data-ttu-id="63dde-155">Windows XP SP3 o SP2 con aggiornamento rapido</span><span class="sxs-lookup"><span data-stu-id="63dde-155">Windows XP SP3 or SP2 w/ hotfix</span></span>|<span data-ttu-id="63dde-156">Windows XP SP2</span><span class="sxs-lookup"><span data-stu-id="63dde-156">Windows XP SP2</span></span>|  
|--------------------------|---------------------------------|----------------------------------------|--------------------------------------|--------------------|  
|<span data-ttu-id="63dde-157">D3DFMT_X8R8G8B8 (non bloccabile)</span><span class="sxs-lookup"><span data-stu-id="63dde-157">D3DFMT_X8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="63dde-158">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-158">**Hardware Update**</span></span>|<span data-ttu-id="63dde-159">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-159">Software Update</span></span>|<span data-ttu-id="63dde-160">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-160">Software Update</span></span>|<span data-ttu-id="63dde-161">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-161">Software Update</span></span>|  
|<span data-ttu-id="63dde-162">D3DFMT_X8R8G8B8 (bloccabile)</span><span class="sxs-lookup"><span data-stu-id="63dde-162">D3DFMT_X8R8G8B8 (lockable)</span></span>|<span data-ttu-id="63dde-163">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-163">**Hardware Update**</span></span>|<span data-ttu-id="63dde-164">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-164">Software Update</span></span>|<span data-ttu-id="63dde-165">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-165">**Hardware Update**</span></span>|<span data-ttu-id="63dde-166">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-166">**Hardware Update**</span></span>|  
|<span data-ttu-id="63dde-167">D3DFMT_A8R8G8B8 (non bloccabile)</span><span class="sxs-lookup"><span data-stu-id="63dde-167">D3DFMT_A8R8G8B8 (not lockable)</span></span>|<span data-ttu-id="63dde-168">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-168">**Hardware Update**</span></span>|<span data-ttu-id="63dde-169">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-169">Software Update</span></span>|<span data-ttu-id="63dde-170">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-170">Software Update</span></span>|<span data-ttu-id="63dde-171">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-171">Software Update</span></span>|  
|<span data-ttu-id="63dde-172">D3DFMT_A8R8G8B8 (bloccabile)</span><span class="sxs-lookup"><span data-stu-id="63dde-172">D3DFMT_A8R8G8B8 (lockable)</span></span>|<span data-ttu-id="63dde-173">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-173">**Hardware Update**</span></span>|<span data-ttu-id="63dde-174">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-174">Software Update</span></span>|<span data-ttu-id="63dde-175">**Aggiornamento dell'hardware**</span><span class="sxs-lookup"><span data-stu-id="63dde-175">**Hardware Update**</span></span>|<span data-ttu-id="63dde-176">Aggiornamento software</span><span class="sxs-lookup"><span data-stu-id="63dde-176">Software Update</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="63dde-177">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="63dde-177">See Also</span></span>  
 <xref:System.Windows.Interop.D3DImage>  
 [<span data-ttu-id="63dde-178">Interoperatività di WPF e Direct3D9</span><span class="sxs-lookup"><span data-stu-id="63dde-178">WPF and Direct3D9 Interoperation</span></span>](../../../../docs/framework/wpf/advanced/wpf-and-direct3d9-interoperation.md)  
 [<span data-ttu-id="63dde-179">Procedura dettagliata: Creazione di contenuto Direct3D9 per l'hosting in WPF</span><span class="sxs-lookup"><span data-stu-id="63dde-179">Walkthrough: Creating Direct3D9 Content for Hosting in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-creating-direct3d9-content-for-hosting-in-wpf.md)  
 [<span data-ttu-id="63dde-180">Procedura dettagliata: Hosting di contenuto Direct3D9 in WPF</span><span class="sxs-lookup"><span data-stu-id="63dde-180">Walkthrough: Hosting Direct3D9 Content in WPF</span></span>](../../../../docs/framework/wpf/advanced/walkthrough-hosting-direct3d9-content-in-wpf.md)
