---
title: Gestione delle autorizzazioni con stored procedure in SQL Server
ms.date: 03/30/2017
ms.assetid: 08fa34e8-2ffa-470d-ba62-e511a5f8558e
ms.openlocfilehash: 0688157b45892cacb73f858dffb93836da9fc91d
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/23/2019
ms.locfileid: "61923123"
---
# <a name="managing-permissions-with-stored-procedures-in-sql-server"></a><span data-ttu-id="584c2-102">Gestione delle autorizzazioni con stored procedure in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-102">Managing Permissions with Stored Procedures in SQL Server</span></span>
<span data-ttu-id="584c2-103">Per creare più linee di difesa intorno al database, è possibile implementare tutto l'accesso ai dati tramite stored procedure o funzioni definite dall'utente.</span><span class="sxs-lookup"><span data-stu-id="584c2-103">One method of creating multiple lines of defense around your database is to implement all data access using stored procedures or user-defined functions.</span></span> <span data-ttu-id="584c2-104">Revocare o negare tutte le autorizzazioni per gli oggetti sottostanti, ad esempio tabelle, e concedere autorizzazioni EXECUTE sulle stored procedure.</span><span class="sxs-lookup"><span data-stu-id="584c2-104">You revoke or deny all permissions to underlying objects, such as tables, and grant EXECUTE permissions on stored procedures.</span></span> <span data-ttu-id="584c2-105">In questo modo viene creato un perimetro di sicurezza efficace intorno ai dati e agli oggetti di database.</span><span class="sxs-lookup"><span data-stu-id="584c2-105">This effectively creates a security perimeter around your data and database objects.</span></span>  
  
## <a name="stored-procedure-benefits"></a><span data-ttu-id="584c2-106">Vantaggi delle stored procedure</span><span class="sxs-lookup"><span data-stu-id="584c2-106">Stored Procedure Benefits</span></span>  
 <span data-ttu-id="584c2-107">Le stored procedure offrono i vantaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="584c2-107">Stored procedures have the following benefits:</span></span>  
  
-   <span data-ttu-id="584c2-108">La logica dei dati e le regole business possono essere incapsulate in modo tale che gli utenti possano accedere a dati e oggetti soltanto nelle modalità previste dagli sviluppatori e dagli amministratori di database.</span><span class="sxs-lookup"><span data-stu-id="584c2-108">Data logic and business rules can be encapsulated so that users can access data and objects only in ways that developers and database administrators intend.</span></span>  
  
-   <span data-ttu-id="584c2-109">Le stored procedure con parametri che convalidano tutto l'input dell'utente possono essere usate per contrastare gli attacchi SQL injection.</span><span class="sxs-lookup"><span data-stu-id="584c2-109">Parameterized stored procedures that validate all user input can be used to thwart SQL injection attacks.</span></span> <span data-ttu-id="584c2-110">Se si usano istruzioni SQL dinamiche, aggiungere parametri ai comandi e non includere mai i valori dei parametri direttamente in una stringa di query.</span><span class="sxs-lookup"><span data-stu-id="584c2-110">If you use dynamic SQL, be sure to parameterize your commands, and never include parameter values directly into a query string.</span></span>  
  
-   <span data-ttu-id="584c2-111">È possibile non consentire le query e le modifiche dei dati ad hoc,</span><span class="sxs-lookup"><span data-stu-id="584c2-111">Ad hoc queries and data modifications can be disallowed.</span></span> <span data-ttu-id="584c2-112">per impedire agli utenti di eliminare in modo permanente i dati o di eseguire query che compromettono le prestazioni del server o della rete, inavvertitamente o intenzionalmente.</span><span class="sxs-lookup"><span data-stu-id="584c2-112">This prevents users from maliciously or inadvertently destroying data or executing queries that impair performance on the server or the network.</span></span>  
  
-   <span data-ttu-id="584c2-113">Gli errori possono essere gestiti nel codice procedurale senza essere passati direttamente alle applicazioni client.</span><span class="sxs-lookup"><span data-stu-id="584c2-113">Errors can be handled in procedure code without being passed directly to client applications.</span></span> <span data-ttu-id="584c2-114">In questo modo si impedisce la restituzione di messaggi di errore che potrebbero agevolare un attacco di tipo probe.</span><span class="sxs-lookup"><span data-stu-id="584c2-114">This prevents error messages from being returned that could aid in a probing attack.</span></span> <span data-ttu-id="584c2-115">Registrare gli errori e gestirli sul server.</span><span class="sxs-lookup"><span data-stu-id="584c2-115">Log errors and handle them on the server.</span></span>  
  
-   <span data-ttu-id="584c2-116">Le stored procedure possono essere scritte una sola volta ed essere accessibili a molte applicazioni.</span><span class="sxs-lookup"><span data-stu-id="584c2-116">Stored procedures can be written once, and accessed by many applications.</span></span>  
  
-   <span data-ttu-id="584c2-117">Le applicazioni client non devono necessariamente riconoscere le strutture dati sottostanti.</span><span class="sxs-lookup"><span data-stu-id="584c2-117">Client applications do not need to know anything about the underlying data structures.</span></span> <span data-ttu-id="584c2-118">Il codice delle stored procedure può essere modificato senza richiedere modifiche nelle applicazioni client, purché le modifiche non abbiano effetto sugli elenchi di parametri o sui tipi di dati restituiti.</span><span class="sxs-lookup"><span data-stu-id="584c2-118">Stored procedure code can be changed without requiring changes in client applications as long as the changes do not affect parameter lists or returned data types.</span></span>  
  
-   <span data-ttu-id="584c2-119">Le stored procedure consentono di ridurre il traffico di rete combinando più operazioni in un'unica chiamata di procedura.</span><span class="sxs-lookup"><span data-stu-id="584c2-119">Stored procedures can reduce network traffic by combining multiple operations into one procedure call.</span></span>  
  
## <a name="stored-procedure-execution"></a><span data-ttu-id="584c2-120">Esecuzione delle stored procedure</span><span class="sxs-lookup"><span data-stu-id="584c2-120">Stored Procedure Execution</span></span>  
 <span data-ttu-id="584c2-121">Le stored procedure traggono vantaggio dal concatenamento della proprietà per fornire l'accesso ai dati. In questo modo gli utenti non devono disporre di autorizzazioni esplicite per l'accesso agli oggetti di database.</span><span class="sxs-lookup"><span data-stu-id="584c2-121">Stored procedures take advantage of ownership chaining to provide access to data so that users do not need to have explicit permission to access database objects.</span></span> <span data-ttu-id="584c2-122">Una catena di proprietà esiste quando gli oggetti che accedono ad altri oggetti in modo sequenziale appartengono allo stesso utente.</span><span class="sxs-lookup"><span data-stu-id="584c2-122">An ownership chain exists when objects that access each other sequentially are owned by the same user.</span></span> <span data-ttu-id="584c2-123">Ad esempio, una stored procedure può chiamare un'altra stored procedure oppure può accedere a più tabelle.</span><span class="sxs-lookup"><span data-stu-id="584c2-123">For example, a stored procedure can call other stored procedures, or a stored procedure can access multiple tables.</span></span> <span data-ttu-id="584c2-124">Se tutti gli oggetti nella catena di esecuzione appartengono allo stesso utente, in SQL server viene controllata solo l'autorizzazione EXECUTE del chiamante, non le autorizzazioni per altri oggetti.</span><span class="sxs-lookup"><span data-stu-id="584c2-124">If all objects in the chain of execution have the same owner, then SQL Server only checks the EXECUTE permission for the caller, not the caller's permissions on other objects.</span></span> <span data-ttu-id="584c2-125">Pertanto, è necessario concedere solo le autorizzazioni EXECUTE sulle stored procedure e revocare o negare tutte le autorizzazioni per le tabelle sottostanti.</span><span class="sxs-lookup"><span data-stu-id="584c2-125">Therefore you need to grant only EXECUTE permissions on stored procedures; you can revoke or deny all permissions on the underlying tables.</span></span>  
  
## <a name="best-practices"></a><span data-ttu-id="584c2-126">Suggerimenti</span><span class="sxs-lookup"><span data-stu-id="584c2-126">Best Practices</span></span>  
 <span data-ttu-id="584c2-127">Scrivere stored procedure non è sufficiente per proteggere in modo adeguato l'applicazione.</span><span class="sxs-lookup"><span data-stu-id="584c2-127">Simply writing stored procedures isn't enough to adequately secure your application.</span></span> <span data-ttu-id="584c2-128">È necessario prendere in considerazione anche i possibili problemi di sicurezza elencati di seguito.</span><span class="sxs-lookup"><span data-stu-id="584c2-128">You should also consider the following potential security holes.</span></span>  
  
-   <span data-ttu-id="584c2-129">Concedere autorizzazioni EXECUTE sulle stored procedure per i ruoli del database che si desidera siano in grado di accedere ai dati.</span><span class="sxs-lookup"><span data-stu-id="584c2-129">Grant EXECUTE permissions on the stored procedures for database roles you want to be able to access the data.</span></span>  
  
-   <span data-ttu-id="584c2-130">Revocare o negare tutte le autorizzazioni sulle tabelle sottostanti per tutti i ruoli e gli utenti del database, incluso il ruolo `public`.</span><span class="sxs-lookup"><span data-stu-id="584c2-130">Revoke or deny all permissions to the underlying tables for all roles and users in the database, including the `public` role.</span></span> <span data-ttu-id="584c2-131">Tutti gli utenti ereditano le autorizzazioni dal ruolo public.</span><span class="sxs-lookup"><span data-stu-id="584c2-131">All users inherit permissions from public.</span></span> <span data-ttu-id="584c2-132">Pertanto, negando le autorizzazioni a `public`, solo i proprietari e i membri `sysadmin` dispongono di accesso, mentre tutti gli altri utenti non saranno in grado di ereditare le autorizzazioni dall'appartenenza ad altri ruoli.</span><span class="sxs-lookup"><span data-stu-id="584c2-132">Therefore denying permissions to `public` means that only owners and `sysadmin` members have access; all other users will be unable to inherit permissions from membership in other roles.</span></span>  
  
-   <span data-ttu-id="584c2-133">Non aggiungere utenti o ruoli ai ruoli `sysadmin` o `db_owner`.</span><span class="sxs-lookup"><span data-stu-id="584c2-133">Do not add users or roles to the `sysadmin` or `db_owner` roles.</span></span> <span data-ttu-id="584c2-134">Gli amministratori di sistema e i proprietari di database possono accedere a tutti gli oggetti di database.</span><span class="sxs-lookup"><span data-stu-id="584c2-134">System administrators and database owners can access all database objects.</span></span>  
  
-   <span data-ttu-id="584c2-135">Disabilitare l'account `guest`.</span><span class="sxs-lookup"><span data-stu-id="584c2-135">Disable the `guest` account.</span></span> <span data-ttu-id="584c2-136">In questo modo gli utenti anonimi non potranno connettersi al database.</span><span class="sxs-lookup"><span data-stu-id="584c2-136">This will prevent anonymous users from connecting to the database.</span></span> <span data-ttu-id="584c2-137">L'account Guest è disabilitato per impostazione predefinita nei nuovi database.</span><span class="sxs-lookup"><span data-stu-id="584c2-137">The guest account is disabled by default in new databases.</span></span>  
  
-   <span data-ttu-id="584c2-138">Implementare la gestione degli errori e registrare gli errori.</span><span class="sxs-lookup"><span data-stu-id="584c2-138">Implement error handling and log errors.</span></span>  
  
-   <span data-ttu-id="584c2-139">Creare stored procedure con parametri che convalidano tutto l'input dell'utente.</span><span class="sxs-lookup"><span data-stu-id="584c2-139">Create parameterized stored procedures that validate all user input.</span></span> <span data-ttu-id="584c2-140">Considerare tutto l'input dell'utente come non attendibile.</span><span class="sxs-lookup"><span data-stu-id="584c2-140">Treat all user input as untrusted.</span></span>  
  
-   <span data-ttu-id="584c2-141">Evitare le istruzioni SQL dinamiche se non sono assolutamente necessarie.</span><span class="sxs-lookup"><span data-stu-id="584c2-141">Avoid dynamic SQL unless absolutely necessary.</span></span> <span data-ttu-id="584c2-142">Usare la funzione Transact-SQL QUOTENAME() per delimitare un valore di stringa e usare caratteri di escape per tutte le occorrenze del delimitatore nella stringa di input.</span><span class="sxs-lookup"><span data-stu-id="584c2-142">Use the Transact-SQL QUOTENAME() function to delimit a string value and escape any occurrence of the delimiter in the input string.</span></span>  
  
## <a name="external-resources"></a><span data-ttu-id="584c2-143">Risorse esterne</span><span class="sxs-lookup"><span data-stu-id="584c2-143">External Resources</span></span>  
 <span data-ttu-id="584c2-144">Per altre informazioni, vedere le seguenti risorse.</span><span class="sxs-lookup"><span data-stu-id="584c2-144">For more information, see the following resources.</span></span>  
  
|<span data-ttu-id="584c2-145">Risorsa</span><span class="sxs-lookup"><span data-stu-id="584c2-145">Resource</span></span>|<span data-ttu-id="584c2-146">Descrizione</span><span class="sxs-lookup"><span data-stu-id="584c2-146">Description</span></span>|  
|--------------|-----------------|  
|<span data-ttu-id="584c2-147">[Stored procedure](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) e [Attacco SQL Injection](https://go.microsoft.com/fwlink/?LinkId=98234) nella documentazione online di SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-147">[Stored Procedures](/sql/relational-databases/stored-procedures/stored-procedures-database-engine) and [SQL Injection](https://go.microsoft.com/fwlink/?LinkId=98234) in SQL Server Books Online</span></span>|<span data-ttu-id="584c2-148">Viene descritto come creare stored procedure e come funziona SQL Injection.</span><span class="sxs-lookup"><span data-stu-id="584c2-148">Topics describe how to create stored procedures and how SQL Injection works.</span></span>|  
  
## <a name="see-also"></a><span data-ttu-id="584c2-149">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="584c2-149">See also</span></span>

- [<span data-ttu-id="584c2-150">Protezione delle applicazioni ADO.NET</span><span class="sxs-lookup"><span data-stu-id="584c2-150">Securing ADO.NET Applications</span></span>](../../../../../docs/framework/data/adonet/securing-ado-net-applications.md)
- [<span data-ttu-id="584c2-151">Cenni preliminari sulla sicurezza in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-151">Overview of SQL Server Security</span></span>](../../../../../docs/framework/data/adonet/sql/overview-of-sql-server-security.md)
- [<span data-ttu-id="584c2-152">Scenari di sicurezza delle applicazioni in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-152">Application Security Scenarios in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/application-security-scenarios-in-sql-server.md)
- [<span data-ttu-id="584c2-153">Scrittura dinamica sicura in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-153">Writing Secure Dynamic SQL in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/writing-secure-dynamic-sql-in-sql-server.md)
- [<span data-ttu-id="584c2-154">Firma di stored procedure in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-154">Signing Stored Procedures in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/signing-stored-procedures-in-sql-server.md)
- [<span data-ttu-id="584c2-155">Personalizzazione delle autorizzazioni con rappresentazione in SQL Server</span><span class="sxs-lookup"><span data-stu-id="584c2-155">Customizing Permissions with Impersonation in SQL Server</span></span>](../../../../../docs/framework/data/adonet/sql/customizing-permissions-with-impersonation-in-sql-server.md)
- [<span data-ttu-id="584c2-156">Modifica di dati con stored procedure</span><span class="sxs-lookup"><span data-stu-id="584c2-156">Modifying Data with Stored Procedures</span></span>](../../../../../docs/framework/data/adonet/modifying-data-with-stored-procedures.md)
- [<span data-ttu-id="584c2-157">Provider gestiti ADO.NET e Centro per sviluppatori di set di dati</span><span class="sxs-lookup"><span data-stu-id="584c2-157">ADO.NET Managed Providers and DataSet Developer Center</span></span>](https://go.microsoft.com/fwlink/?LinkId=217917)
