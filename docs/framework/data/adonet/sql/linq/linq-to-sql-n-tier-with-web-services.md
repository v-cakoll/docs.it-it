---
title: Più livelli di LINQ to SQL con Servizi Web
ms.date: 03/30/2017
ms.assetid: 9cb10eb8-957f-4beb-a271-5f682016fed2
ms.openlocfilehash: 7b13a0cd77925423a12c093b1b5ac9b63ad7e019
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 04/08/2019
ms.locfileid: "59107406"
---
# <a name="linq-to-sql-n-tier-with-web-services"></a><span data-ttu-id="f12c5-102">Più livelli di LINQ to SQL con Servizi Web</span><span class="sxs-lookup"><span data-stu-id="f12c5-102">LINQ to SQL N-Tier with Web Services</span></span>
[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="f12c5-103">è progettato appositamente per essere utilizzati nel livello intermedio in un livello di accesso a regime di controllo dei dati (DAL), ad esempio un servizio Web.</span><span class="sxs-lookup"><span data-stu-id="f12c5-103">is designed especially for use on the middle tier in a loosely-coupled data access layer (DAL) such as a Web service.</span></span> <span data-ttu-id="f12c5-104">Se il livello di presentazione è una pagina Web ASP.NET, verrà usato il controllo server Web <xref:System.Web.UI.WebControls.LinqDataSource> per gestire il trasferimento dei dati tra l'interfaccia utente e [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] nel livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="f12c5-104">If the presentation tier is an ASP.NET Web page, then you use the <xref:System.Web.UI.WebControls.LinqDataSource> Web server control to manage the data transfer between the user interface and [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] on the middle-tier.</span></span> <span data-ttu-id="f12c5-105">Se il livello di presentazione non è una pagina ASP.NET, sarà necessario eseguire operazioni aggiuntive nel livello intermedio e nel livello di presentazione in modo da gestire la serializzazione e deserializzazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="f12c5-105">If the presentation tier is not an ASP.NET page, then both the middle-tier and the presentation tier must do some additional work to manage the serialization and deserialization of data.</span></span>  
  
## <a name="setting-up-linq-to-sql-on-the-middle-tier"></a><span data-ttu-id="f12c5-106">Configurazione di LINQ to SQL nel livello intermedio</span><span class="sxs-lookup"><span data-stu-id="f12c5-106">Setting up LINQ to SQL on the Middle Tier</span></span>  
 <span data-ttu-id="f12c5-107">In un servizio Web o in un'applicazione a più livelli, il livello intermedio contiene il contesto dati e le classi di entità.</span><span class="sxs-lookup"><span data-stu-id="f12c5-107">In a Web service or n-tier application, the middle tier contains the data context and the entity classes.</span></span> <span data-ttu-id="f12c5-108">È possibile creare manualmente queste classi oppure usando SQLMetal.exe o la [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)] come descritto in un altro punto della documentazione.</span><span class="sxs-lookup"><span data-stu-id="f12c5-108">You can create these classes manually, or by using either SQLMetal.exe or the [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)] as described elsewhere in the documentation.</span></span> <span data-ttu-id="f12c5-109">In fase di progettazione è possibile rendere le classi di entità serializzabili.</span><span class="sxs-lookup"><span data-stu-id="f12c5-109">At design time, you have the option to make the entity classes serializable.</span></span> <span data-ttu-id="f12c5-110">Per altre informazioni, vedere [Procedura: Rendere serializzabili le entità](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md).</span><span class="sxs-lookup"><span data-stu-id="f12c5-110">For more information, see [How to: Make Entities Serializable](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md).</span></span> <span data-ttu-id="f12c5-111">Un'altra opzione è creare un set separato di classi che incapsulano i dati da serializzare e quindi proiettare in tali tipi serializzabili quando si restituiscono i dati nelle query [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f12c5-111">Another option is to create a separate set of classes that encapsulate the data to be serialized, and then project into those serializable types when you return data in your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span>  
  
 <span data-ttu-id="f12c5-112">Definire quindi l'interfaccia con i metodi che i client chiameranno per recuperare, inserire e aggiornare i dati.</span><span class="sxs-lookup"><span data-stu-id="f12c5-112">You then define the interface with the methods that the clients will call to retrieve, insert and update data.</span></span> <span data-ttu-id="f12c5-113">I metodi di interfaccia eseguono il wrapping delle query [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f12c5-113">The interface methods wrap your [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] queries.</span></span> <span data-ttu-id="f12c5-114">È possibile usare qualsiasi tipo di meccanismo di serializzazione per gestire le chiamate al metodo remote e la serializzazione dei dati.</span><span class="sxs-lookup"><span data-stu-id="f12c5-114">You can use any kind of serialization mechanism to handle the remote method calls and the serialization of data.</span></span> <span data-ttu-id="f12c5-115">L'unico requisito è che se si hanno relazioni cicliche o bidirezionali nel modello a oggetti, come ad esempio tra Customers e Orders nel modello a oggetti standard Northwind, è necessario usare un serializzatore che lo supporti.</span><span class="sxs-lookup"><span data-stu-id="f12c5-115">The only requirement is that if you have cyclic or bi-directional relationships in your object model, such as that between Customers and Orders in the standard Northwind object model, then you must use a serializer that supports it.</span></span> <span data-ttu-id="f12c5-116">Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> relazioni bidirezionali supporta, ma la classe XmlSerializer utilizzata con servizi Web non WCF non esiste.</span><span class="sxs-lookup"><span data-stu-id="f12c5-116">The Windows Communication Foundation (WCF) <xref:System.Runtime.Serialization.DataContractSerializer> supports bi-directional relationships but the XmlSerializer that is used with non-WCF Web services does not.</span></span> <span data-ttu-id="f12c5-117">Se si sceglie di utilizzare XmlSerializer, sarà necessario accertarsi che il modello a oggetti non contenga relazioni cicliche.</span><span class="sxs-lookup"><span data-stu-id="f12c5-117">If you select to use the XmlSerializer, then you must make sure that your object model has no cyclic relationships.</span></span>  
  
 <span data-ttu-id="f12c5-118">Per altre informazioni su Windows Communication Foundation, vedere [servizi di Windows Communication Foundation e WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span><span class="sxs-lookup"><span data-stu-id="f12c5-118">For more information about Windows Communication Foundation, see [Windows Communication Foundation Services and WCF Data Services in Visual Studio](/visualstudio/data-tools/windows-communication-foundation-services-and-wcf-data-services-in-visual-studio).</span></span>  
  
 <span data-ttu-id="f12c5-119">Implementare le regole business o un'altra regola specifica del dominio usando le classi e i metodi parziali delle classi <xref:System.Data.Linq.DataContext> e di entità per effettuare l'hook negli eventi di runtime [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span><span class="sxs-lookup"><span data-stu-id="f12c5-119">Implement your business rules or other domain-specific logic by using the partial classes and methods on the <xref:System.Data.Linq.DataContext> and entity classes to hook into [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] runtime events.</span></span> <span data-ttu-id="f12c5-120">Per altre informazioni, vedere [che implementa la logica di Business a più livelli](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).</span><span class="sxs-lookup"><span data-stu-id="f12c5-120">For more information, see [Implementing N-Tier Business Logic](../../../../../../docs/framework/data/adonet/sql/linq/implementing-business-logic-linq-to-sql.md).</span></span>  
  
## <a name="defining-the-serializable-types"></a><span data-ttu-id="f12c5-121">Definizione dei tipi serializzabili</span><span class="sxs-lookup"><span data-stu-id="f12c5-121">Defining the Serializable Types</span></span>  
 <span data-ttu-id="f12c5-122">Il livello client o di presentazione deve avere le definizioni dei tipi per le classi che riceverà dal livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="f12c5-122">The client or presentation tier must have type definitions for the classes that it will be receiving from the middle tier.</span></span> <span data-ttu-id="f12c5-123">Tali tipi possono essere classi di entità o classi speciali che eseguono il wrapping solo di determinati campi delle classi di entità per i servizi remoti.</span><span class="sxs-lookup"><span data-stu-id="f12c5-123">Those types may be the entity classes themselves, or special classes that wrap only certain fields from the entity classes for remoting.</span></span> <span data-ttu-id="f12c5-124">In ogni caso, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] è completamente ignorare il concatenando sul modo in cui il livello di presentazione acquisisce le definizioni dei tipi.</span><span class="sxs-lookup"><span data-stu-id="f12c5-124">In any case, [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] is completely unconcerned about how the presentation tier acquires those type definitions.</span></span> <span data-ttu-id="f12c5-125">Ad esempio, il livello di presentazione può usare WCF per generare automaticamente i tipi o può avere una copia di una DLL in cui vengono definiti tali tipi o ancora può definire versioni dei tipi personalizzate.</span><span class="sxs-lookup"><span data-stu-id="f12c5-125">For example, the presentation tier could use WCF to generate the types automatically, or it could have a copy of a DLL in which those types are defined, or it could just define its own versions of the types.</span></span>  
  
## <a name="retrieving-and-inserting-data"></a><span data-ttu-id="f12c5-126">Recupero e inserimento dei dati</span><span class="sxs-lookup"><span data-stu-id="f12c5-126">Retrieving and Inserting Data</span></span>  
 <span data-ttu-id="f12c5-127">Il livello intermedio definisce un'interfaccia che specifica il modo in cui il livello di presentazione accede ai dati,</span><span class="sxs-lookup"><span data-stu-id="f12c5-127">The middle tier defines an interface that specifies how the presentation tier accesses the data.</span></span> <span data-ttu-id="f12c5-128">ad esempio `GetProductByID(int productID)` o `GetCustomers()`.</span><span class="sxs-lookup"><span data-stu-id="f12c5-128">For example `GetProductByID(int productID)`, or `GetCustomers()`.</span></span> <span data-ttu-id="f12c5-129">Nel livello intermedio, il corpo del metodo crea in genere una nuova istanza di <xref:System.Data.Linq.DataContext> ed esegue una query su una o più tabelle.</span><span class="sxs-lookup"><span data-stu-id="f12c5-129">On the middle tier, the method body typically creates a new instance of the <xref:System.Data.Linq.DataContext>, executes a query against one or more of its table.</span></span> <span data-ttu-id="f12c5-130">Il livello intermedio restituisce quindi il risultato come <xref:System.Collections.Generic.IEnumerable%601>, dove `T` è una classe di entità o un altro tipo usato per la serializzazione.</span><span class="sxs-lookup"><span data-stu-id="f12c5-130">The middle tier then returns the result as an <xref:System.Collections.Generic.IEnumerable%601>, where `T` is either an entity class or another type that is used for serialization.</span></span> <span data-ttu-id="f12c5-131">Il livello di presentazione non invia o riceve direttamente le variabili di query dal livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="f12c5-131">The presentation tier never sends or receives query variables directly to or from the middle tier.</span></span> <span data-ttu-id="f12c5-132">I due livelli scambiano valori, oggetti e raccolte di dati concreti.</span><span class="sxs-lookup"><span data-stu-id="f12c5-132">The two tiers exchange values, objects, and collections of concrete data.</span></span> <span data-ttu-id="f12c5-133">Dopo aver ricevuto una raccolta, il livello di presentazione può usare [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects per eseguirne una query, se necessario.</span><span class="sxs-lookup"><span data-stu-id="f12c5-133">After it has received a collection, the presentation tier can use [!INCLUDE[vbteclinq](../../../../../../includes/vbteclinq-md.md)] to Objects to query it if necessary.</span></span>  
  
 <span data-ttu-id="f12c5-134">Durante l'inserimento dei dati, il livello di presentazione può costruire un nuovo oggetto e inviarlo al livello intermedio oppure il livello intermedio può costruire l'oggetto in base ai valori forniti dal livello di presentazione.</span><span class="sxs-lookup"><span data-stu-id="f12c5-134">When inserting data, the presentation tier can construct a new object and send it to the middle tier, or it can have the middle tier construct the object based on values that it provides.</span></span> <span data-ttu-id="f12c5-135">In generale, il recupero e l'inserimento dei dati nelle applicazioni a più livelli non differiscono molto dal processo nelle applicazioni a 2 livelli.</span><span class="sxs-lookup"><span data-stu-id="f12c5-135">In general, retrieving and inserting data in n-tier applications does not differ much from the process in 2-tier applications.</span></span> <span data-ttu-id="f12c5-136">Per altre informazioni, vedere [una query sul Database](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) e [Making e inviare le modifiche ai dati](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).</span><span class="sxs-lookup"><span data-stu-id="f12c5-136">For more information, see [Querying the Database](../../../../../../docs/framework/data/adonet/sql/linq/querying-the-database.md) and [Making and Submitting Data Changes](../../../../../../docs/framework/data/adonet/sql/linq/making-and-submitting-data-changes.md).</span></span>  
  
## <a name="tracking-changes-for-updates-and-deletes"></a><span data-ttu-id="f12c5-137">Rilevamento delle modifiche per aggiornamenti ed eliminazioni</span><span class="sxs-lookup"><span data-stu-id="f12c5-137">Tracking Changes for Updates and Deletes</span></span>  
 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] <span data-ttu-id="f12c5-138">supporta la concorrenza ottimistica basata sui timestamp (anche denominato RowVersions) e sui valori originali.</span><span class="sxs-lookup"><span data-stu-id="f12c5-138">supports optimistic concurrency based on timestamps (also named RowVersions) and on original values.</span></span> <span data-ttu-id="f12c5-139">Se le tabelle di database hanno timestamp, gli aggiornamenti e le eliminazioni richiedono operazioni aggiuntive sul livello intermedio o sul livello della presentazione.</span><span class="sxs-lookup"><span data-stu-id="f12c5-139">If the database tables have timestamps, then updates and deletions require little extra work on either the middle-tier or presentation tier.</span></span> <span data-ttu-id="f12c5-140">Tuttavia, se è necessario usare i valori originali per i controlli di concorrenza ottimistica, il livello di presentazione sarà responsabile del rilevamento e dell'invio di tali valori durante l'aggiornamento</span><span class="sxs-lookup"><span data-stu-id="f12c5-140">However, if you must use original values for optimistic concurrency checks, then the presentation tier is responsible for tracking those values and sending them back when it makes updates.</span></span> <span data-ttu-id="f12c5-141">poiché le modifiche effettuate alle entità nel livello di presentazione non vengono rilevate nel livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="f12c5-141">This is because changes that were made to entities on the presentation tier are not tracked on the middle tier.</span></span> <span data-ttu-id="f12c5-142">Infatti, il recupero originale di un'entità e l'eventuale aggiornamento vengono eseguiti in genere da due istanze completamente separate di <xref:System.Data.Linq.DataContext>.</span><span class="sxs-lookup"><span data-stu-id="f12c5-142">In fact, the original retrieval of an entity, and the eventual update made to it are typically performed by two completely separate instances of the <xref:System.Data.Linq.DataContext>.</span></span>  
  
 <span data-ttu-id="f12c5-143">Maggiore è il numero delle modifiche effettuate dal livello di presentazione, più sono complessi il rilevamento e l'invio delle modifiche al livello intermedio.</span><span class="sxs-lookup"><span data-stu-id="f12c5-143">The greater the number of changes that the presentation tier makes, the more complex it becomes to track those changes and package them back to the middle tier.</span></span> <span data-ttu-id="f12c5-144">L'implementazione di un meccanismo per la comunicazione delle modifiche spetta completamente all'applicazione.</span><span class="sxs-lookup"><span data-stu-id="f12c5-144">The implementation of a mechanism for communicating changes is completely up to the application.</span></span> <span data-ttu-id="f12c5-145">È necessario solo fornire a [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] i valori originali necessari per i controlli di concorrenza ottimistica.</span><span class="sxs-lookup"><span data-stu-id="f12c5-145">The only requirement is that [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] must be given those original values that are required for optimistic concurrency checks.</span></span>  
  
 <span data-ttu-id="f12c5-146">Per altre informazioni, vedere [recupero di dati e operazioni CUD in applicazioni a più livelli (LINQ to SQL)](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).</span><span class="sxs-lookup"><span data-stu-id="f12c5-146">For more information, see [Data Retrieval and CUD Operations in N-Tier Applications (LINQ to SQL)](../../../../../../docs/framework/data/adonet/sql/linq/data-retrieval-and-cud-operations-in-n-tier-applications.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="f12c5-147">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="f12c5-147">See also</span></span>

- [<span data-ttu-id="f12c5-148">Applicazioni a più livelli e remote con LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="f12c5-148">N-Tier and Remote Applications with LINQ to SQL</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/n-tier-and-remote-applications-with-linq-to-sql.md)
- [<span data-ttu-id="f12c5-149">Cenni preliminari sul controllo Server Web LinqDataSource</span><span class="sxs-lookup"><span data-stu-id="f12c5-149">LinqDataSource Web Server Control Overview</span></span>](https://docs.microsoft.com/previous-versions/aspnet/bb547113(v=vs.100))
