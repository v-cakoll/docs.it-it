---
title: Provider di flusso (WCF Data Services)
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework-oob
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
dev_langs:
- csharp
- vb
helpviewer_keywords:
- WCF Data Services, providers
- WCF Data Services, binary data
- streaming data provider [WCF Data Services]
- WCF Data Services, streams
ms.assetid: f0978fe4-5f9f-42aa-a5c2-df395d7c9495
caps.latest.revision: "8"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.workload: dotnet
ms.openlocfilehash: f965bc46c62742c0e2ffb0a7f8ae2e09eca5dc1c
ms.sourcegitcommit: c0dd436f6f8f44dc80dc43b07f6841a00b74b23f
ms.translationtype: MT
ms.contentlocale: it-IT
ms.lasthandoff: 01/19/2018
---
# <a name="streaming-provider-wcf-data-services"></a><span data-ttu-id="ce420-102">Provider di flusso (WCF Data Services)</span><span class="sxs-lookup"><span data-stu-id="ce420-102">Streaming Provider (WCF Data Services)</span></span>
<span data-ttu-id="ce420-103">Un servizio dati può esporre dati Large Object Binary.</span><span class="sxs-lookup"><span data-stu-id="ce420-103">A data service can expose large object binary data.</span></span> <span data-ttu-id="ce420-104">Tali dati binari possono rappresentare flussi audio e video, immagini, file documento o altri tipi di elementi multimediali binari.</span><span class="sxs-lookup"><span data-stu-id="ce420-104">This binary data might represent video and audio streams, images, document files, or other types of binary media.</span></span> <span data-ttu-id="ce420-105">Quando un'entità del modello di dati include una o più proprietà binarie, il servizio dati restituisce tali dati binari codificati in base 64 all'interno dell'elemento entry presente nel feed di risposta.</span><span class="sxs-lookup"><span data-stu-id="ce420-105">When an entity in the data model includes one or more binary properties, the data service returns this binary data encoded as base-64 inside the entry in the response feed.</span></span> <span data-ttu-id="ce420-106">Poiché il caricamento e la serializzazione di dati binari di grandi dimensioni in questo modo può influire sulle prestazioni, la [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] definisce un meccanismo per recuperare dati binari indipendentemente dell'entità a cui appartiene.</span><span class="sxs-lookup"><span data-stu-id="ce420-106">Because loading and serializing large binary data in this manner can affect performance, the [!INCLUDE[ssODataFull](../../../../includes/ssodatafull-md.md)] defines a mechanism for retrieving binary data independent of the entity to which it belongs.</span></span> <span data-ttu-id="ce420-107">Questa operazione viene eseguita separando i dati binari dall'entità in uno o più flussi di dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-107">This is accomplished by separating the binary data from the entity into one or more data streams.</span></span>  
  
-   <span data-ttu-id="ce420-108">Risorsa multimediale: dati binari che appartengono a un'entità, quali una risorsa video, audio, immagine o altri tipi di flusso di risorse multimediali.</span><span class="sxs-lookup"><span data-stu-id="ce420-108">Media resource - binary data that belongs to an entity, such as a video, audio, image or other type of media resource stream.</span></span>  
  
-   <span data-ttu-id="ce420-109">Elemento entry di collegamento multimediale: entità che presenta un riferimento a un flusso di risorse multimediali correlato.</span><span class="sxs-lookup"><span data-stu-id="ce420-109">Media link entry - an entity that has a reference to a related media resource stream.</span></span>  
  
 <span data-ttu-id="ce420-110">Con [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] si definisce un flusso di risorse binarie implementando un provider di dati di flusso.</span><span class="sxs-lookup"><span data-stu-id="ce420-110">With [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)], you define a binary resource stream by implementing a streaming data provider.</span></span> <span data-ttu-id="ce420-111">L'implementazione del provider di flusso fornisce al servizio dati con il flusso di risorsa multimediale associato a un'entità specifica come un <xref:System.IO.Stream> oggetto.</span><span class="sxs-lookup"><span data-stu-id="ce420-111">The streaming provider implementation supplies the data service with the media resource stream associated with a specific entity as an <xref:System.IO.Stream> object.</span></span> <span data-ttu-id="ce420-112">Questa implementazione consente al servizio dati di accettare e restituire risorse multimediali tramite HTTP sotto forma di flussi di dati binari di un tipo MIME specificato.</span><span class="sxs-lookup"><span data-stu-id="ce420-112">This implementation enables the data service to accept and return media resources over HTTP as binary data streams of a specified MIME type.</span></span>  
  
 <span data-ttu-id="ce420-113">La configurazione di un servizio dati per supportare il flusso di dati binari richiede l'esecuzione dei passaggi seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce420-113">Configuring a data service to support the streaming of binary data requires the following steps:</span></span>  
  
1.  <span data-ttu-id="ce420-114">Assegnare una o più entità del modello di dati come entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-114">Attribute one or more entities in the data model as a media link entry.</span></span> <span data-ttu-id="ce420-115">Queste entità non devono includere dati binari da trasmettere.</span><span class="sxs-lookup"><span data-stu-id="ce420-115">These entities should not include the binary data to be streamed.</span></span> <span data-ttu-id="ce420-116">Qualsiasi proprietà binaria di un'entità viene sempre restituita nell'elemento entry sotto forma di dati binari codificati in base 64.</span><span class="sxs-lookup"><span data-stu-id="ce420-116">Any binary properties of an entity are always returned in the entry as base-64 encoded binary.</span></span>  
  
2.  <span data-ttu-id="ce420-117">Implementare l'interfaccia T:System.Data.Services.Providers.IDataServiceStreamProvider.</span><span class="sxs-lookup"><span data-stu-id="ce420-117">Implement the T:System.Data.Services.Providers.IDataServiceStreamProvider interface.</span></span>  
  
3.  <span data-ttu-id="ce420-118">Definire un servizio dati che implementi l'interfaccia <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="ce420-118">Define a data service that implements the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="ce420-119">Il servizio dati usa l'implementazione <xref:System.IServiceProvider.GetService%2A> per accedere all'implementazione del provider di dati di flusso.</span><span class="sxs-lookup"><span data-stu-id="ce420-119">The data service uses the <xref:System.IServiceProvider.GetService%2A> implementation to access the streaming data provider implementation.</span></span> <span data-ttu-id="ce420-120">Questo metodo restituisce l'implementazione del provider di flusso appropriata.</span><span class="sxs-lookup"><span data-stu-id="ce420-120">This method returns the appropriate streaming provider implementation.</span></span>  
  
4.  <span data-ttu-id="ce420-121">Abilitare flussi di messaggi di grandi dimensioni nella configurazione dell'applicazione Web.</span><span class="sxs-lookup"><span data-stu-id="ce420-121">Enable large message streams in the Web application configuration.</span></span>  
  
5.  <span data-ttu-id="ce420-122">Abilitare accesso alle risorse binarie sul server o in un'origine dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-122">Enable access to binary resources on the server or in a data source.</span></span>  
  
 <span data-ttu-id="ce420-123">Gli esempi in questo argomento sono basati su un campione di servizio di foto, come illustrato in dettaglio nel post di streaming [serie Provider di flusso di dati Services: implementazione di un Provider di flusso (parte 1)](http://go.microsoft.com/fwlink/?LinkID=198989).</span><span class="sxs-lookup"><span data-stu-id="ce420-123">The examples in this topic are based on a sample streaming photo service, which is discussed in depth in the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](http://go.microsoft.com/fwlink/?LinkID=198989).</span></span> <span data-ttu-id="ce420-124">Il codice sorgente per questo servizio di esempio è disponibile il [pagina di esempio di servizio dati foto di flusso](http://go.microsoft.com/fwlink/?LinkID=198988) in MSDN Code Gallery.</span><span class="sxs-lookup"><span data-stu-id="ce420-124">The source code for this sample service is available on the [Streaming Photo Data Service Sample page](http://go.microsoft.com/fwlink/?LinkID=198988) on MSDN Code Gallery.</span></span>  
  
## <a name="defining-a-media-link-entry-in-the-data-model"></a><span data-ttu-id="ce420-125">Definizione di un elemento entry di collegamento multimediale nel modello di dati</span><span class="sxs-lookup"><span data-stu-id="ce420-125">Defining a Media Link Entry in the Data Model</span></span>  
 <span data-ttu-id="ce420-126">Il provider dell'origine dati determina la modalità di definizione di un'entità come entry di collegamento multimediale nel modello di dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-126">The data source provider determines the way that an entity is defined as a media link entry in the data model.</span></span>  
  
 <span data-ttu-id="ce420-127">**Provider di Entity Framework**</span><span class="sxs-lookup"><span data-stu-id="ce420-127">**Entity Framework Provider**</span></span>  
 <span data-ttu-id="ce420-128">Per indicare che un'entità è un elemento entry di collegamento multimediale, aggiungere l'attributo `HasStream` alla definizione del tipo di entità nel modello concettuale, come nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="ce420-128">To indicate that an entity is a media link entry, add the `HasStream` attribute to the entity type definition in the conceptual model, as in the following example:</span></span>  
  
 [!code-xml[Astoria Photo Streaming Service#HasStream](../../../../samples/snippets/xml/VS_Snippets_Misc/astoria photo streaming service/xml/photodata.edmx#hasstream)]  
  
 <span data-ttu-id="ce420-129">È inoltre necessario aggiungere lo spazio dei nomi `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` all'entità o alla radice del file con estensione edmx o csdl che definisce il modello di dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-129">You must also add the namespace `xmlns:m=http://schemas.microsoft.com/ado/2007/08/dataservices/metadata` either to the entity or to the root of the .edmx or .csdl file that defines the data model.</span></span>  
  
 [!INCLUDE[crexample](../../../../includes/crexample-md.md)]<span data-ttu-id="ce420-130">un servizio dati che utilizza il [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)] provider ed espone una risorsa multimediale, vedere il post [serie Provider di flusso di dati Services: implementazione di un Provider di flusso (parte 1)](http://go.microsoft.com/fwlink/?LinkID=198989).</span><span class="sxs-lookup"><span data-stu-id="ce420-130"> a data service that uses the [!INCLUDE[adonet_ef](../../../../includes/adonet-ef-md.md)] provider and exposes a media resource, see the post [Data Services Streaming Provider Series: Implementing a Streaming Provider (Part 1)](http://go.microsoft.com/fwlink/?LinkID=198989).</span></span>  
  
 <span data-ttu-id="ce420-131">**Provider di reflection**</span><span class="sxs-lookup"><span data-stu-id="ce420-131">**Reflection Provider**</span></span>  
 <span data-ttu-id="ce420-132">Per indicare che un'entità è un elemento entry di collegamento multimediale, aggiungere <xref:System.Data.Services.Common.HasStreamAttribute> alla classe che definisce il tipo di entità nel provider di reflection.</span><span class="sxs-lookup"><span data-stu-id="ce420-132">To indicate that an entity is a media link entry, add the <xref:System.Data.Services.Common.HasStreamAttribute> to the class that defines the entity type in the reflection provider.</span></span>  
  
 <span data-ttu-id="ce420-133">**Provider del servizio dati personalizzato**</span><span class="sxs-lookup"><span data-stu-id="ce420-133">**Custom Data Service Provider**</span></span>  
 <span data-ttu-id="ce420-134">Quando si usano provider di servizi personalizzati, si implementa l'interfaccia <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> per definire i metadati per il servizio dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-134">When using custom service providers, you implement the <xref:System.Data.Services.Providers.IDataServiceMetadataProvider> interface to define the metadata for your data service.</span></span> <span data-ttu-id="ce420-135">Per ulteriori informazioni, vedere [provider di servizi dati personalizzati](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ce420-135">For more information, see [Custom Data Service Providers](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md).</span></span> <span data-ttu-id="ce420-136">Si indica che un flusso di risorse binarie appartiene a un oggetto <xref:System.Data.Services.Providers.ResourceType> impostando la proprietà <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> su `true` nell'oggetto <xref:System.Data.Services.Providers.ResourceType> che rappresenta il tipo di entità, un elemento entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-136">You indicate that a binary resource stream belongs to a <xref:System.Data.Services.Providers.ResourceType> by setting the <xref:System.Data.Services.Providers.ResourceType.IsMediaLinkEntry%2A> property to `true` on the <xref:System.Data.Services.Providers.ResourceType> that represents the entity type, which is a media link entry.</span></span>  
  
## <a name="implementing-the-idataservicestreamprovider-interface"></a><span data-ttu-id="ce420-137">Implementazione dell'interfaccia IDataServiceStreamProvider</span><span class="sxs-lookup"><span data-stu-id="ce420-137">Implementing the IDataServiceStreamProvider Interface</span></span>  
 <span data-ttu-id="ce420-138">Per creare un servizio dati che supporta i flussi di dati binari, è necessario implementare l'interfaccia <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="ce420-138">To create a data service that supports binary data streams, you must implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface.</span></span> <span data-ttu-id="ce420-139">Questa implementazione consente al servizio dati di restituire al client i dati binari sotto forma di flusso e di usarli come flusso inviato dal client.</span><span class="sxs-lookup"><span data-stu-id="ce420-139">This implementation enables the data service to return binary data as a stream to the client and consume binary data as a stream sent from the client.</span></span> <span data-ttu-id="ce420-140">Il servizio dati crea un'istanza di questa interfaccia ogni volta che deve accedere ai dati binari sotto forma di flusso.</span><span class="sxs-lookup"><span data-stu-id="ce420-140">The data service creates an instance of this interface whenever it needs to access binary data as a stream.</span></span> <span data-ttu-id="ce420-141">L'interfaccia <xref:System.Data.Services.Providers.IDataServiceStreamProvider> specifica i membri seguenti:</span><span class="sxs-lookup"><span data-stu-id="ce420-141">The <xref:System.Data.Services.Providers.IDataServiceStreamProvider> interface specifies the following members:</span></span>  
  
|<span data-ttu-id="ce420-142">Nome del membro</span><span class="sxs-lookup"><span data-stu-id="ce420-142">Member name</span></span>|<span data-ttu-id="ce420-143">Descrizione</span><span class="sxs-lookup"><span data-stu-id="ce420-143">Description</span></span>|  
|-----------------|-----------------|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>|<span data-ttu-id="ce420-144">Questo metodo viene richiamato dal servizio dati per eliminare la risorsa multimediale corrispondente quando viene eliminato l'elemento entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-144">This method is invoked by the data service to delete the corresponding media resource when its media link entry is deleted.</span></span> <span data-ttu-id="ce420-145">Quando si implementa <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, questo metodo contiene il codice che elimina la risorsa multimediale associata all'elemento entry di collegamento multimediale fornito.</span><span class="sxs-lookup"><span data-stu-id="ce420-145">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that deletes the media resource associated with the supplied media link entry.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>|<span data-ttu-id="ce420-146">Questo metodo viene richiamato dal servizio dati per restituire una risorsa multimediale come flusso.</span><span class="sxs-lookup"><span data-stu-id="ce420-146">This method is invoked by the data service to return a media resource as a stream.</span></span> <span data-ttu-id="ce420-147">Quando si implementa <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, questo metodo contiene il codice che fornisce un flusso usato dal servizio dati per restituire la risorsa multimediale associata all'elemento entry di collegamento multimediale specifico.</span><span class="sxs-lookup"><span data-stu-id="ce420-147">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, this method contains the code that provides a stream that is used by the data service to the return media resource that is associated with the provided media link entry.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStreamUri%2A>|<span data-ttu-id="ce420-148">Questo metodo viene richiamato dal servizio dati per restituire l'URI usato per richiedere la risorsa multimediale relativa all'elemento entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-148">This method is invoked by the data service to return the URI that is used to request the media resource for the media link entry.</span></span> <span data-ttu-id="ce420-149">Questo valore consente di creare l'attributo `src` nell'elemento di contenuto dell'entry di collegamento multimediale che viene usato per richiedere il flusso di dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-149">This value is used to create the `src` attribute in the content element of the media link entry and that is used to request the data stream.</span></span> <span data-ttu-id="ce420-150">Quando questo metodo restituisce `null`, il servizio dati determina automaticamente l'URI.</span><span class="sxs-lookup"><span data-stu-id="ce420-150">When this method returns `null`, the data service automatically determines the URI.</span></span> <span data-ttu-id="ce420-151">Usare questo metodo quando è necessario fornire ai client accesso diretto ai dati binari senza usare il provider di flusso.</span><span class="sxs-lookup"><span data-stu-id="ce420-151">Use this method when you need to provide clients with direct access to binary data without using the steam provider.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamContentType%2A>|<span data-ttu-id="ce420-152">Questo metodo viene richiamato dal servizio dati per restituire il valore Content-Type della risorsa multimediale associata all'elemento entry di collegamento multimediale specificato.</span><span class="sxs-lookup"><span data-stu-id="ce420-152">This method is invoked by the data service to return the Content-Type value of the media resource that is associated with the specified media link entry.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetStreamETag%2A>|<span data-ttu-id="ce420-153">Questo metodo viene richiamato dal servizio dati per restituire il valore eTag del flusso di dati associato all'entità specificata</span><span class="sxs-lookup"><span data-stu-id="ce420-153">This method is invoked by the data service to return the eTag of the data stream that is associated with the specified entity.</span></span> <span data-ttu-id="ce420-154">e viene usato per gestire la concorrenza dei dati binari.</span><span class="sxs-lookup"><span data-stu-id="ce420-154">This method is used when you manage concurrency for the binary data.</span></span> <span data-ttu-id="ce420-155">Quando questo metodo restituisce Null, il servizio dati non rileva la concorrenza.</span><span class="sxs-lookup"><span data-stu-id="ce420-155">When this method returns null, the data service does not track concurrency.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>|<span data-ttu-id="ce420-156">Questo metodo viene richiamato dal servizio dati per ottenere il flusso usato per la ricezione del flusso inviato dal client.</span><span class="sxs-lookup"><span data-stu-id="ce420-156">This method is invoked by the data service to obtain the stream that is used when receiving the stream sent from the client.</span></span> <span data-ttu-id="ce420-157">Quando si implementa <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, è necessario restituire un flusso scrivibile nel quale il servizio dati possa scrivere i dati del flusso ricevuti.</span><span class="sxs-lookup"><span data-stu-id="ce420-157">When you implement <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, you must return a writable stream to which the data service writes received stream data.</span></span>|  
|<xref:System.Data.Services.Providers.IDataServiceStreamProvider.ResolveType%2A>|<span data-ttu-id="ce420-158">Restituisce un nome di tipo completo con lo spazio dei nomi che rappresenta il tipo che il runtime del servizio dati deve creare per l'elemento entry di collegamento multimediale associato al flusso di dati della risorsa multimediale inserita.</span><span class="sxs-lookup"><span data-stu-id="ce420-158">Returns a namespace-qualified type name that represents the type that the data service runtime must create for the media link entry that is associated with the data stream for the media resource that is being inserted.</span></span>|  
  
## <a name="creating-the-streaming-data-service"></a><span data-ttu-id="ce420-159">Creazione del servizio dati di flusso</span><span class="sxs-lookup"><span data-stu-id="ce420-159">Creating the Streaming Data Service</span></span>  
 <span data-ttu-id="ce420-160">Per fornire al runtime di [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] l'accesso all'implementazione <xref:System.Data.Services.Providers.IDataServiceStreamProvider>, il servizio dati creato deve implementare anche l'interfaccia <xref:System.IServiceProvider>.</span><span class="sxs-lookup"><span data-stu-id="ce420-160">To provide the [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] runtime with access to the <xref:System.Data.Services.Providers.IDataServiceStreamProvider> implementation, the data service that you create must also implement the <xref:System.IServiceProvider> interface.</span></span> <span data-ttu-id="ce420-161">Nell'esempio seguente viene illustrato come implementare il metodo <xref:System.IServiceProvider.GetService%2A> per restituire un'istanza della classe `PhotoServiceStreamProvider` che implementa <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="ce420-161">The following example shows how to implement the <xref:System.IServiceProvider.GetService%2A> method to return an instance of the `PhotoServiceStreamProvider` class that implements <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span></span>  
  
 [!code-csharp[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/csharp/VS_Snippets_Misc/astoria photo streaming service/cs/photodata.svc.cs#photoservicestreamingprovider)]
 [!code-vb[Astoria Photo Streaming Service#PhotoServiceStreamingProvider](../../../../samples/snippets/visualbasic/VS_Snippets_Misc/astoria photo streaming service/vb/photodata.svc.vb#photoservicestreamingprovider)]  
  
 <span data-ttu-id="ce420-162">Per informazioni generali su come creare un servizio dati, vedere [configurazione del servizio dati](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ce420-162">For general information about how to create a data service, see [Configuring the Data Service](../../../../docs/framework/data/wcf/configuring-the-data-service-wcf-data-services.md).</span></span>  
  
## <a name="enabling-large-binary-streams-in-the-hosting-environment"></a><span data-ttu-id="ce420-163">Abilitazione dei flussi binari di grandi dimensioni nell'ambiente di hosting</span><span class="sxs-lookup"><span data-stu-id="ce420-163">Enabling Large Binary Streams in the Hosting Environment</span></span>  
 <span data-ttu-id="ce420-164">Quando si crea un servizio dati in un [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] applicazione Web, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] viene utilizzata per fornire l'implementazione del protocollo HTTP.</span><span class="sxs-lookup"><span data-stu-id="ce420-164">When you create a data service in an [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Web application, [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] is used to provide the HTTP protocol implementation.</span></span> <span data-ttu-id="ce420-165">Per impostazione predefinita, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] limita la dimensione dei messaggi HTTP a solo KB 65.</span><span class="sxs-lookup"><span data-stu-id="ce420-165">By default, [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] limits the size of HTTP messages to only 65K bytes.</span></span> <span data-ttu-id="ce420-166">Per consentire il flusso dei dati binari di grandi dimensioni verso e dal servizio dati, è inoltre necessario configurare l'applicazione Web per l'abilitazione di file binari di grandi dimensioni e l'uso di flussi per il trasferimento.</span><span class="sxs-lookup"><span data-stu-id="ce420-166">To be able to stream large binary data to and from the data service, you must also configure the Web application to enable large binary files and to use streams for transfer.</span></span> <span data-ttu-id="ce420-167">A tal fine, aggiungere quanto segue all'elemento `<configuration />` del file Web.config dell'applicazione:</span><span class="sxs-lookup"><span data-stu-id="ce420-167">To do this, add the following in the `<configuration />` element of the application's Web.config file:</span></span>  
  
  
  
> [!NOTE]
>  <span data-ttu-id="ce420-168">È necessario usare una modalità di trasferimento del campo <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> per assicurarsi che i dati binari nei messaggi di richiesta e di risposta vengano trasmessi, ma non memorizzati nel buffer da parte di [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span><span class="sxs-lookup"><span data-stu-id="ce420-168">You must use a <xref:System.ServiceModel.TransferMode.Streamed?displayProperty=nameWithType> transfer mode to ensure that the binary data in both the request and response messages are streamed and not buffered by [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span>  
  
 <span data-ttu-id="ce420-169">Per ulteriori informazioni, vedere [Streaming di trasferimento messaggi](../../../../docs/framework/wcf/feature-details/streaming-message-transfer.md) e [delle quote del trasporto](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span><span class="sxs-lookup"><span data-stu-id="ce420-169">For more information, see [Streaming Message Transfer](../../../../docs/framework/wcf/feature-details/streaming-message-transfer.md) and [Transport Quotas](../../../../docs/framework/wcf/feature-details/transport-quotas.md).</span></span>  
  
 <span data-ttu-id="ce420-170">Per impostazione predefinita, Internet Information Services (IIS) consente anche di limitare la dimensione delle richieste a 4 MB.</span><span class="sxs-lookup"><span data-stu-id="ce420-170">By default, Internet Information Services (IIS) also limits the size of requests to 4MB.</span></span> <span data-ttu-id="ce420-171">Per abilitare il servizio dati per la ricezione di flussi di dimensioni superiori a 4MB durante l'esecuzione in IIS, è necessario impostare anche la `maxRequestLength` attributo del [elemento httpRuntime (Schema delle impostazioni ASP.NET)](http://msdn.microsoft.com/library/e9b81350-8aaf-47cc-9843-5f7d0c59f369) nel `<system.web />` sezione di configurazione, come Nell'esempio seguente:</span><span class="sxs-lookup"><span data-stu-id="ce420-171">To enable your data service to receive streams larger than 4MB when running on IIS, you must also set the `maxRequestLength` attribute of the [httpRuntime Element (ASP.NET Settings Schema)](http://msdn.microsoft.com/library/e9b81350-8aaf-47cc-9843-5f7d0c59f369) in the `<system.web />` configuration section, as shown in the following example:</span></span>  
  
  
  
## <a name="using-data-streams-in-a-client-application"></a><span data-ttu-id="ce420-172">Utilizzo dei flussi di dati in un'applicazione client</span><span class="sxs-lookup"><span data-stu-id="ce420-172">Using Data Streams in a Client Application</span></span>  
 <span data-ttu-id="ce420-173">La libreria client [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] consente di recuperare e aggiornare tali risorse esposte come flussi binari sul client.</span><span class="sxs-lookup"><span data-stu-id="ce420-173">The [!INCLUDE[ssAstoria](../../../../includes/ssastoria-md.md)] client library enables you to both retrieve and update these exposed resources as binary streams on the client.</span></span> <span data-ttu-id="ce420-174">Per ulteriori informazioni, vedere [funziona con dati binari](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ce420-174">For more information, see [Working with Binary Data](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md).</span></span>  
  
## <a name="considerations-for-working-with-a-streaming-provider"></a><span data-ttu-id="ce420-175">Considerazioni sull'utilizzo di un provider di flusso</span><span class="sxs-lookup"><span data-stu-id="ce420-175">Considerations for Working with a Streaming Provider</span></span>  
 <span data-ttu-id="ce420-176">Quando si implementa un provider di flusso e si accede alle risorse multimediali da un servizio dati, è necessario tenere presente le considerazioni seguenti.</span><span class="sxs-lookup"><span data-stu-id="ce420-176">The following are things to consider when you implement a streaming provider and when you access media resources from a data service.</span></span>  
  
-   <span data-ttu-id="ce420-177">Le richieste MERGE non sono supportate per le risorse multimediali.</span><span class="sxs-lookup"><span data-stu-id="ce420-177">MERGE requests are not supported for media resources.</span></span> <span data-ttu-id="ce420-178">Usare una richiesta PUT per modificare la risorsa multimediale di un'entità esistente.</span><span class="sxs-lookup"><span data-stu-id="ce420-178">Use a PUT request to change the media resource of an existing entity.</span></span>  
  
-   <span data-ttu-id="ce420-179">Non è possibile usare una richiesta POST per creare un nuovo elemento entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-179">A POST request cannot be used to create a new media link entry.</span></span> <span data-ttu-id="ce420-180">È invece necessario inviare una richiesta POST per creare una nuova risorsa multimediale. Il servizio dati crea un nuovo elemento entry di collegamento multimediale con i valori predefiniti.</span><span class="sxs-lookup"><span data-stu-id="ce420-180">Instead, you must issue a POST request to create a new media resource, and the data service creates a new media link entry with default values.</span></span> <span data-ttu-id="ce420-181">Questa nuova entità può essere aggiornata da una richiesta MERGE o PUT successiva.</span><span class="sxs-lookup"><span data-stu-id="ce420-181">This new entity can be updated by a subsequent MERGE or PUT request.</span></span> <span data-ttu-id="ce420-182">È anche possibile memorizzare l'entità nella cache ed eseguire nell'elemento di eliminazione aggiornamenti, quale l'impostazione del valore della proprietà sul valore dell'intestazione Slug nella richiesta POST.</span><span class="sxs-lookup"><span data-stu-id="ce420-182">You may also consider caching the entity and make updates in the disposer, such as setting the property value to the value of the Slug header in the POST request.</span></span>  
  
-   <span data-ttu-id="ce420-183">Quando viene ricevuta una richiesta POST, il servizio dati chiama <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> per creare la risorsa multimediale prima di chiamare <xref:System.Data.Services.IUpdatable.SaveChanges%2A> per creare l'elemento entry di collegamento multimediale.</span><span class="sxs-lookup"><span data-stu-id="ce420-183">When a POST request is received, the data service calls <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> to create the media resource before it calls <xref:System.Data.Services.IUpdatable.SaveChanges%2A> to create the media link entry.</span></span>  
  
-   <span data-ttu-id="ce420-184">Un'implementazione di <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> non deve restituire un oggetto <xref:System.IO.MemoryStream>.</span><span class="sxs-lookup"><span data-stu-id="ce420-184">An implementation of <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> should not return a <xref:System.IO.MemoryStream> object.</span></span> <span data-ttu-id="ce420-185">Quando si usa questo tipo di flusso, si verificano problemi nelle risorse di memoria alla ricezione di flussi di dati di dimensioni molto elevate da parte del servizio.</span><span class="sxs-lookup"><span data-stu-id="ce420-185">When you use this kind of stream, memory resource issues will occur when the service receives very large data streams.</span></span>  
  
-   <span data-ttu-id="ce420-186">Quando si archiviano le risorse multimediali in un database, occorre tenere presente le seguenti considerazioni.</span><span class="sxs-lookup"><span data-stu-id="ce420-186">The following are things to consider when storing media resources in a database:</span></span>  
  
    -   <span data-ttu-id="ce420-187">Nel modello di dati non devono essere incluse le proprietà binarie che sono risorse multimediali.</span><span class="sxs-lookup"><span data-stu-id="ce420-187">A binary property that is a media resource should not be included in the data model.</span></span> <span data-ttu-id="ce420-188">Tutte le proprietà esposte in un modello di dati vengono restituite nell'elemento entry di un feed di risposta.</span><span class="sxs-lookup"><span data-stu-id="ce420-188">All properties exposed in a data model are returned in the entry in a response feed.</span></span>  
  
    -   <span data-ttu-id="ce420-189">Per migliorare le prestazioni con flussi binari di grandi dimensioni, è consigliabile creare una classe del flusso personalizzata per archiviare i dati binari nel database.</span><span class="sxs-lookup"><span data-stu-id="ce420-189">To improve performance with a large binary stream, we recommend that you create a custom stream class to store binary data in the database.</span></span> <span data-ttu-id="ce420-190">Questa classe viene restituita dall'implementazione di <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> e invia i dati binari al database in blocchi.</span><span class="sxs-lookup"><span data-stu-id="ce420-190">This class is returned by your <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> implementation and sends the binary data to the database in chunks.</span></span> <span data-ttu-id="ce420-191">Per un [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] database, è consigliabile utilizzare un flusso di dati FILESTREAM nel database quando i dati binari sono maggiori di 1 MB.</span><span class="sxs-lookup"><span data-stu-id="ce420-191">For a [!INCLUDE[ssNoVersion](../../../../includes/ssnoversion-md.md)] database, we recommend that you use a FILESTREAM to stream data into the database when the binary data is larger than 1MB.</span></span>  
  
    -   <span data-ttu-id="ce420-192">Assicurarsi che il database sia stato progettato per archiviare flussi binari di grandi dimensioni che devono essere ricevuti dal servizio dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-192">Ensure that your database is designed to store the binary large streams that are to be received by your data service.</span></span>  
  
    -   <span data-ttu-id="ce420-193">Quando un client invia una richiesta POST per inserire un elemento entry di collegamento multimediale e una risorsa multimediale in una sola richiesta, viene chiamato <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> per ottenere il flusso prima che il servizio dati inserisca la nuova entità nel database.</span><span class="sxs-lookup"><span data-stu-id="ce420-193">When a client sends a POST request to insert a media link entry with a media resource in a single request, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> is called to obtain the stream before the data service inserts the new entity into the database.</span></span> <span data-ttu-id="ce420-194">Un'implementazione del provider di flusso deve essere in grado di gestire questo comportamento del servizio dati.</span><span class="sxs-lookup"><span data-stu-id="ce420-194">A streaming provider implementation must be able to handle this data service behavior.</span></span> <span data-ttu-id="ce420-195">Usare una tabella di dati separata per archiviare i dati binari o archiviare il flusso di dati in un file fino al completo inserimento dell'entità nel database.</span><span class="sxs-lookup"><span data-stu-id="ce420-195">Consider using a separate data table to store the binary data or store the data stream in a file until after the entity has been inserted into the database.</span></span>  
  
-   <span data-ttu-id="ce420-196">Quando si implementa il metodo <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A> o <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A>, è necessario usare i valori eTag e Content-Type forniti come parametri dei metodi.</span><span class="sxs-lookup"><span data-stu-id="ce420-196">When you implement the <xref:System.Data.Services.Providers.IDataServiceStreamProvider.DeleteStream%2A>, <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetReadStream%2A>, or <xref:System.Data.Services.Providers.IDataServiceStreamProvider.GetWriteStream%2A> methods, you must use the eTag and Content-Type values that are supplied as method parameters.</span></span> <span data-ttu-id="ce420-197">Non impostare le intestazioni eTag o Content-Type nell'implementazione del provider <xref:System.Data.Services.Providers.IDataServiceStreamProvider>.</span><span class="sxs-lookup"><span data-stu-id="ce420-197">Do not set eTag or Content-Type headers in your <xref:System.Data.Services.Providers.IDataServiceStreamProvider> provider implementation.</span></span>  
  
-   <span data-ttu-id="ce420-198">Per impostazione predefinita, il client invia i flussi binari di grandi dimensioni tramite codifica di trasferimento HTTP Chunked.</span><span class="sxs-lookup"><span data-stu-id="ce420-198">By default, the client sends large binary streams by using a chunked HTTP Transfer-Encoding.</span></span> <span data-ttu-id="ce420-199">Poiché il [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server non supporta questo tipo di codifica, è possibile utilizzare il server Web per ospitare un servizio dati di flusso che debba accettare flussi binari di grandi dimensioni.</span><span class="sxs-lookup"><span data-stu-id="ce420-199">Because the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server does not support this kind of encoding, you cannot use this Web server to host a streaming data service that must accept large binary streams.</span></span> <span data-ttu-id="ce420-200">Per ulteriori informazioni su [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server, vedere [server Web in Visual Studio per progetti Web ASP.NET](http://msdn.microsoft.com/library/31d4f588-df59-4b7e-b9ea-e1f2dd204328).</span><span class="sxs-lookup"><span data-stu-id="ce420-200">For more information on [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Development Server, see [Web Servers in Visual Studio for ASP.NET Web Projects](http://msdn.microsoft.com/library/31d4f588-df59-4b7e-b9ea-e1f2dd204328).</span></span>  
  
<a name="versioning"></a>   
## <a name="versioning-requirements"></a><span data-ttu-id="ce420-201">Requisiti di versione</span><span class="sxs-lookup"><span data-stu-id="ce420-201">Versioning Requirements</span></span>  
 <span data-ttu-id="ce420-202">Il provider di flusso prevede i seguenti requisiti di versione del protocollo [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)]:</span><span class="sxs-lookup"><span data-stu-id="ce420-202">The streaming provider has the following [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol versioning requirements:</span></span>  
  
-   <span data-ttu-id="ce420-203">Il provider di flusso richiede che il servizio dati supporti la versione 2.0 del protocollo [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] e versioni successive.</span><span class="sxs-lookup"><span data-stu-id="ce420-203">The streaming provider requires that the data service support version 2.0 of the [!INCLUDE[ssODataShort](../../../../includes/ssodatashort-md.md)] protocol and later versions.</span></span>  
  
 <span data-ttu-id="ce420-204">Per ulteriori informazioni, vedere [controllo delle versioni del servizio dati](../../../../docs/framework/data/wcf/data-service-versioning-wcf-data-services.md).</span><span class="sxs-lookup"><span data-stu-id="ce420-204">For more information, see [Data Service Versioning](../../../../docs/framework/data/wcf/data-service-versioning-wcf-data-services.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ce420-205">Vedere anche</span><span class="sxs-lookup"><span data-stu-id="ce420-205">See Also</span></span>  
 [<span data-ttu-id="ce420-206">Provider di servizi dati</span><span class="sxs-lookup"><span data-stu-id="ce420-206">Data Services Providers</span></span>](../../../../docs/framework/data/wcf/data-services-providers-wcf-data-services.md)  
 [<span data-ttu-id="ce420-207">Provider di servizi dati personalizzati</span><span class="sxs-lookup"><span data-stu-id="ce420-207">Custom Data Service Providers</span></span>](../../../../docs/framework/data/wcf/custom-data-service-providers-wcf-data-services.md)  
 [<span data-ttu-id="ce420-208">Utilizzo di dati binari</span><span class="sxs-lookup"><span data-stu-id="ce420-208">Working with Binary Data</span></span>](../../../../docs/framework/data/wcf/working-with-binary-data-wcf-data-services.md)
