### <a name="avoiding-endless-recursion-for-iworkflowinstancemanagementtransactedcancel-and-iworkflowinstancemanagementtransactedterminate"></a><span data-ttu-id="cbfb0-101">Evitare la ricorsione infinita per IWorkflowInstanceManagement.TransactedCancel e IWorkflowInstanceManagement.TransactedTerminate</span><span class="sxs-lookup"><span data-stu-id="cbfb0-101">Avoiding endless recursion for IWorkflowInstanceManagement.TransactedCancel and IWorkflowInstanceManagement.TransactedTerminate</span></span>

|   |   |
|---|---|
|<span data-ttu-id="cbfb0-102">Dettagli</span><span class="sxs-lookup"><span data-stu-id="cbfb0-102">Details</span></span>|<span data-ttu-id="cbfb0-103">In alcune circostanza quando si usano le API <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> o <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> per annullare o terminare un'istanza del servizio del flusso di lavoro, nell'istanza del flusso di lavoro può verificarsi un overflow dello stack a causa della ricorsione infinita quando il runtime di <code>Workflow</code> tenta di rendere persistente l'istanza del servizio nell'ambito dell'elaborazione della richiesta.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-103">Under some circumstances when using <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedCancel%2A?displayProperty=nameWithType> or <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement.TransactedTerminate%2A?displayProperty=nameWithType> APIs to cancel or terminate a worklow service instance, the workflow instance may encounter a stack overflow due to endless recursion when the <code>Workflow</code> runtime attempts to persist the service instance as part of processing the request.</span></span> <span data-ttu-id="cbfb0-104">Il problema si verifica se l'istanza del flusso di lavoro si trova in uno stato di attesa del completamento di un'altra richiesta WCF in sospeso a un altro servizio. Le operazioni <code>TransactedCancel</code> e <code>TransactedTerminate</code> creano elementi di lavoro in coda per l'istanza del servizio del flusso di lavoro.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-104">The problem occurs if the workflow instance is in a state where it is waiting for some other outstanding WCF request to another service to complete.The <code>TransactedCancel</code> and <code>TransactedTerminate</code> operations create work items that are queued for the workflow service instance.</span></span> <span data-ttu-id="cbfb0-105">Questi elementi di lavoro non vengono eseguiti nell'ambito dell'elaborazione della richiesta <code>TransactedCancel/TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-105">These work items are not executed as part of the processing of the <code>TransactedCancel/TransactedTerminate</code> request.</span></span> <span data-ttu-id="cbfb0-106">Poiché l'istanza del servizio del flusso di lavoro è in attesa del completamento dell'altra richiesta WCF in sospeso, l'elemento di lavoro creato rimane in coda.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-106">Because the workflow service instance is busy waiting for the other outstanding WCF request to complete, the work item created remains queued.</span></span> <span data-ttu-id="cbfb0-107">L'operazione <code>TransactedCancel/TransactedTerminate</code> viene completata e il controllo torna al client.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-107">The <code>TransactedCancel/TransactedTerminate</code> operation completes and control is returned back to the client.</span></span> <span data-ttu-id="cbfb0-108">Quando la transazione associata con l'operazione <code>TransactedCancel/TransactedTerminate</code> tenta di eseguire il commit, è necessario che lo stato dell'istanza del servizio del flusso di lavoro sia persistente.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-108">When the transaction associated with the <code>TransactedCancel/TransactedTerminate</code> operation attempts to commit, it needs to persist the workflow serivce instance state.</span></span> <span data-ttu-id="cbfb0-109">Tuttavia, la presenza di una richiesta <code>WCF</code> in sospeso per l'istanza impedisce al runtime di Workflow di rendere persistente l'istanza del servizio del flusso di lavoro e un ciclo di ricorsione infinito determina l'overflow dello stack. Dal momento che <code>TransactedCancel</code> e <code>TransactedTerminate</code> creano un elemento di lavoro solo in memoria, l'esistenza di una transazione non produce alcun effetto.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-109">But because there is an outstanding <code>WCF</code> request for the instance, the Workflow runtime cannot persist the workflow service instance, and an endless recursion loop leads to the stack overflow.Because <code>TransactedCancel</code> and <code>TransactedTerminate</code> only create a work item in memory, the fact that a transaction exists doesn't have any effect.</span></span> <span data-ttu-id="cbfb0-110">Il rollback della transazione non rimuove l'elemento di lavoro. Per risolvere questo problema, a partire da .NET Framework 4.7.2, è stato introdotto un elemento <code>AppSetting</code> che può essere aggiunto al file <code>web.config/app.config</code> del servizio del flusso di lavoro che indica a quest'ultimo di ignorare le transazioni per <code>TransactedCancel</code> e <code>TransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-110">A rollback of the transaction does not discard the work item.To address this issue, starting in .NET Framework 4.7.2, we have introduced an <code>AppSetting</code> that can be added to the <code>web.config/app.config</code> of the workflow service that tells it to ignore transactions for <code>TransactedCancel</code> and <code>TransactedTerminate</code>.</span></span> <span data-ttu-id="cbfb0-111">Ciò consente il commit della transazione senza attendere che l'istanza del flusso di lavoro sia persistente. L'elemento AppSetting per questa funzionalità è denominato <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-111">This allows the transaction to commit without waiting for the workflow instance to persist.The AppSetting for this feature is named <code>microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate</code>.</span></span> <span data-ttu-id="cbfb0-112">Il valore <code>true</code> indica che la transazione deve essere ignorata, evitando quindi l'overflow dello stack.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-112">A value of <code>true</code> indicates that the transaction should be ignored, thus avoiding the stack overflow.</span></span> <span data-ttu-id="cbfb0-113">Il valore predefinito di AppSetting è <code>false</code>, quindi le istanze del servizio del flusso di lavoro esistenti non sono interessate.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-113">The default value of this AppSetting is <code>false</code>, so existing workflow service instances are not affected.</span></span>|
|<span data-ttu-id="cbfb0-114">Suggerimento</span><span class="sxs-lookup"><span data-stu-id="cbfb0-114">Suggestion</span></span>|<span data-ttu-id="cbfb0-115">Se si usa AppFabric o un altro client <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> e si riscontra un overflow dello stack nell'istanza del servizio del flusso di lavoro quando si tenta di annullare o terminare un'istanza, è possibile aggiungere il codice seguente alla sezione <code>&lt;appSettings&gt;</code> del file web.config/app.config per il servizio del flusso di lavoro:</span><span class="sxs-lookup"><span data-stu-id="cbfb0-115">If you are using AppFabric or another <xref:System.ServiceModel.Activities.IWorkflowInstanceManagement> client and are encountering a stack overflow in the workflow serivce instance when trying to cancel or terminate a workflow instance, you can add the following to the <code>&lt;appSettings&gt;</code> section of the web.config/app.config file for the workflow service:</span></span><pre><code class="lang-xml">&lt;add key=&quot;microsoft:WorkflowServices:IgnoreTransactionsForTransactedCancelAndTransactedTerminate&quot; value=&quot;true&quot;/&gt;&#13;&#10;</code></pre><span data-ttu-id="cbfb0-116">Se il problema non si verifica, questa operazione non è necessaria.</span><span class="sxs-lookup"><span data-stu-id="cbfb0-116">If you are not encountering the problem, you do not need to do this.</span></span>|
|<span data-ttu-id="cbfb0-117">Ambito</span><span class="sxs-lookup"><span data-stu-id="cbfb0-117">Scope</span></span>|<span data-ttu-id="cbfb0-118">Microsoft Edge</span><span class="sxs-lookup"><span data-stu-id="cbfb0-118">Edge</span></span>|
|<span data-ttu-id="cbfb0-119">Versione</span><span class="sxs-lookup"><span data-stu-id="cbfb0-119">Version</span></span>|<span data-ttu-id="cbfb0-120">4.7.2</span><span class="sxs-lookup"><span data-stu-id="cbfb0-120">4.7.2</span></span>|
|<span data-ttu-id="cbfb0-121">Tipo</span><span class="sxs-lookup"><span data-stu-id="cbfb0-121">Type</span></span>|<span data-ttu-id="cbfb0-122">Ridestinazione</span><span class="sxs-lookup"><span data-stu-id="cbfb0-122">Retargeting</span></span>|

